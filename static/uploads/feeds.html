<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"
    integrity="sha384-6khuMg9gaYr5AxOqhkVIODVIvm9ynTT5J4V1cfthmT+emCG6yVmEZsRHdxlotUnm"
    crossorigin="anonymous"></script>

<body id="myApp" ng-app="myApp" ng-controller="myCtrl">
    <script src="https://unpkg.com/rss-parser@3.7.3/dist/rss-parser.min.js"></script>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Publish Date</th>
                <th>Feed Name</th>
                <th>Feed Type</th>
                <th>Feed Link</th>
            </tr>
        </thead>
        <tbody>
            <tr scope="row" ng-repeat="feed in records | orderBy: '-time'">
                <td>{{feed.pubDate}}</td>
                <td>{{feed.type}}</td>
                <td>{{feed.feedName}}</td>
                <td>
                    <a href="{{feed.link}}">{{feed.title}}</a>
                </td>
                </div>
        </tbody>
    </table>

    <script>
        var app = angular.module("myApp", []);
        app.controller("myCtrl", function ($scope, $q) {
            $scope.records = [];

            //const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/'
            const CORS_PROXY = 'https://cors-anywhere-jace.herokuapp.com/'
            const parser = new RSSParser;
            var feeds = [
                {
                    "title": "An Errant Programmer",
                    "type": "Blog",
                    "url": "http://anerrantprogrammer.com/?feed=rss2"
                }, {
                    "title": "An Errant Programmer",
                    "type": "YouTube",
                    "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UC2ey_HG743-CrxOTPU_ft7g"
                },
                { "title": "Andrew Albury-Dor", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCH1byb2cbzlFrYndyKic_Lg" },
                { "title": "Ben Hollifield", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCpXBKCVchJqXo08OyD0i2eQ" },
                { "title": "ServiceNow Elite", "type": "Blog", "url": "http://www.servicenowelite.com/blog?format=rss" },
                { "title": "CloudMinus89", "type": "Blog", "url": "http://www.cloudminus89.com/feeds/posts/default?alt=rss" },
                { "title": "CodeCreative", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCmwKZdMYyUD4AWnAIrx5JVw" },
                { "title": "CodeCreative", "type": "Blog", "url": "https://codecreative.io/index.xml" },
                { "title": "Shiva Thomas", "type": "Blog", "url": "https://servicenow.implementation.blog/feed/" },
                { "title": "Goran Lundqvist", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCUJK90r6dnu-YXHyDOVIRww" },
                { "title": "John James Andersen", "type": "Blog", "url": "http://john-james-andersen.com/feed" },
                { "title": "Mark Scott", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCysyuAe0q31GOOedkJja67Q" },
                { "title": "Mav", "type": "Blog", "url": "https://mavembry.info/index.xml" },
                { "title": "Robert, The Duke, Fedoruk", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCfhKNeCYiaJQaaKuACKt0Sg" },
                { "title": "CJ & The Duke", "type": "Podcast", "url": "https://feeds.transistor.fm/cj-the-duke" },
                { "title": "Jace Benson", "type": "Blog", "url": "https://jace.pro/index.xml" },
                { "title": "ServiceNow Dev Program", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCdXorgCT87YlFRN9n8oJ7_A" },
                { "title": "ServiceNow Developer Blog", "type": "Blog", "url": "https://developer.servicenow.com/blog.do?p=/index.xml" },
                { "title": "ServiceNow Gems", "type": "Blog", "url": "http://servicenowgems.com/feed" },
                { "title": "ServiceNow Community", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCCBQU8mlFrElxQNR2mo-gLg" },
                { "title": "ServiceNow Support", "type": "YouTube", "url": "https://www.youtube.com/feeds/videos.xml?channel_id=UCQjE37R-Y4DTq7kUWPO83Wg" },
                { "title": "ServiceNow TechBytes Podcast", "type": "Podcast", "url": "https://omny.fm/shows/servicenow-techbytes/playlists/podcast.rss" },
                { "title": "ServiceNow Community Podcasts", "type": "Podcast", "url": "https://omny.fm/shows/servicenow-cloudcast/playlists/servicenow-podcasts.rss" },
                { "title": "ServiceNow Think", "type": "Blog", "url": "https://servicenowthink.wordpress.com/feed" },
                { "title": "Acorio - Candid Podcast", "type": "Podcast", "url": "https://feeds.buzzsprout.com/457558.rss" },
                { "title": "ServiceShart Podcast", "type": "Podcast", "url": "https://anchor.fm/s/a71217c/podcast/rss" },
                { "title": "Workflow", "type": "Newsletter", "url": "https://workflow.servicenow.com/feed/" },
                { "title": "SNProtips", "type": "Blog", "url": "https://snprotips.com/?format=rss" },
                { "title": "SNC-Blog", "type": "Blog", "url": "http://www.snc-blog.com/feed" },
                { "title": "SNDevelopment", "type": "Blog", "url": "https://sncdevelopment.com/feed" },
                { "title": "WomenNow", "type": "Blog", "url": "https://womennow.dev/?feed=rss2" },
                { "title": "Pathway", "type": "Blog", "url": "https://pathwayscg.com/feed/" },
                { "title": "Reddit", "type": "Questions", "url": "http://reddit.com/r/servicenow/.rss" },
                { "title": "StackOverflow", "type": "Questions", "url":"https://stackoverflow.com/feeds/tag?tagnames=servicenow&amp;sort=newest"},
                //["#ServiceNow", "https://twitter.com/hashtag/ServiceNow?src=hash&amp;f=live"],
                //["#ServiceNowDev", "https://twitter.com/search?q=%23ServiceNowDev&amp;src=typed_query&amp;f=live"],
                //['COvid', "https://twitter.com/search?q=COVID&src=typed_query&amp;f=live"]
            ];
            var promises = [];
            feeds.map(function parseFeeds(feed, idx) {
                var fullURL = CORS_PROXY + feed.url;
                if (feed.url.toLowerCase().indexOf('jace.pro') >= 0) {
                    fullURL = feed.url;
                }
                //console.log('using', fullURL)
                var promise = parser.parseURL(fullURL, (error, feed) => {
                    //console.log('feed', feed);
                    if (error) {
                        console.log("error", url, error);
                    } else if (feed) {
                        feed.items.map(({ link, title, pubDate, type }) => {
                            const d = new Date(pubDate)
                            const dStr = d.toLocaleDateString() + ' ' + d.toLocaleTimeString()
                            if (title.length > 70) {
                                title = title.substring(0, 60);
                                title += " ...";
                            }
                            $scope.records.push({
                                feedName: title,
                                type: type,
                                time: d.getTime(),
                                pubDate: dStr,
                                title: title,
                                link: link
                            });
                        });
                    } else {
                        console.log(url, "has issue with feed", feed);
                    }

                });
                promises.push(promise);
            })
            $q.all(promises).then(function () {
                $scope.records = $scope.records.reverse();
                console.log('done', $scope.records);
            })
            /*[
              "Alfreds Futterkiste",
              "Berglunds snabbk√∂p",
              "Centro comercial Moctezuma",
              "Ernst Handel",
            ]*/
        });
    </script>

</body>

</html>