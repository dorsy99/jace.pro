---
title: "Unexpectedly Variable"
date: 2011-09-29T16:28:51.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=7bbd6ea9dbd0dbc01dcaf3231f9619cc"
---
<p><img  alt="" class="jive-image" src="07c24846dbd8d3041dcaf3231f961975.iix" style="width: auto; height: 127px;" />Sometimes the most innocent-looking code can really bend your mind — especially if it violates some deeply held notion you have about how things actually work inside a computer. That's exactly what's happened to the formerly normal fellow at right after running this unexpectedly diabolical snippet of code:<pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />test();<br /><br />function test() {<br />    var a = 1;<br />    gs.log('a outer: ' + a);<br />    for (var b = 0; b &lt; 2; b++) {<br />        var a = 2;<br />        gs.log('a inner: ' + a);<br />        gs.log('b inner: ' + b);<br />    }<br />    gs.log('a outer: ' + a);<br />    gs.log('b outer: ' + b);<br />}</pre><br />It did <i>not</i> log what he expected!<br /><!--break--><br />He was expecting this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />a outer: 1<br />a inner: 2<br />b inner: 0<br />a inner: 2<br />b inner: 1<br />a outer: 1<br />b outer: undefined<br /></pre>But what he actually got was this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />a outer: 1<br />a inner: 2<br />b inner: 0<br />a inner: 2<br />b inner: 1<br />a outer: 2<br />b outer: 2<br /></pre>What in Knuth's name is going on here? Those last two log lines are just <i>wrong</i>!<br /><br />Well, they're not <i>really</i> wrong, of course. But if you're used to the 'C' family of languages (C, C++, C#, Java, etc.), they surely <i>look</i> wrong. Two features of JavaScript are combining here to produce the unexpected result.<br /><br />The first is that JavaScript (unlike the 'C' family of languages) <i>doesn't</i> have variable scopes inside code blocks defined by curly braces (these are sometimes called compound statements). In other words, in JavaScript variables defined inside a code block are accessible outside that code block. Like the other langauges, JavaScript does have variable scopes inside functions or methods (so variables defined inside a function are not accessible outside that function), plus there's a separate global scope which some other 'C' family languages have as well. But the absence of variable scopes inside code blocks sets JavaScript apart. This JavaScript feature is why the last line of the log is different than you might expect: in JavaScript, the variable <i>b</i> is accessible outside the code block it was defined in.<br /><br />The second is that JavaScript (again, unlike the 'C' family of languages) lets you redeclare variables anytime you'd like. Any redeclarations that include initializers act like assignments. The following code is perfectly legal in JavaScript (you end up with a single variable <i>a</i> with a value of 2), but would get you in trouble in any other 'C' family language:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var a = 1;<br />var a = 2;</pre><br />Now that's a silly example, but consider the function we started out with. In it, the variable <i>a</i> is declared at the beginning of the function, and again inside the loop's code block. Remember that there is no separate variable scope inside code blocks — so that second declaration of <i>a</i> is <i>re</i>declaring the original variable. That's why the next-to-last log line had the unexpected <i>2</i> — the second declaration assigned a 2 to the originally declared variable <i>a</i>.<br /><br />Some people are quite irritated by these JavaScript features. On the forums and message boards that discuss programming languages, it's easy to find discussion threads on this topic filled with fanatically defended views (for and against), vitriol, and disgusting suggestions. The fellow above had normal hair and no perforations before engaging in these discussions. I don't recommend getting excited about such things myself. After all, what matters to getting your job done isn't the righteousness of a language feature. What matters is whether you know how to use it...</p>