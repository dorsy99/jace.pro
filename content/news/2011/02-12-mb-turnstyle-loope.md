---
title: "Turnstyle Looper Workflow Activity"
date: 2011-02-12T01:04:32.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=98dc2665dbd0dbc01dcaf3231f961963"
---
<p>Recently I came across a situation that required me, in a workflow, to loop a dynamic amount of times. Normally you could use the "Turnstyle" activity to accomplish this. However the "Turnstyle" activity is limited to a static number that you manually add in. This is extremely limiting which is why, I would guess, I do not see it used that often. I gave the "Turnstyle" activity the ability to calculate the number of times it runs based on a variable name (e.g. current.something, workflow.scratchpad.something, workflow.input.something (I have not tried this input one, but should work), or some other variable you can think of. You can also specify a script to calculate and return this number. With these additional capabilities this activity can be a true loop. Maybe this activity can become more useful now. Once created this new activity should appear in your workflow Utility activities with whatever name you have specified.<br /><br />Use Case:<br />Here was my use case if you need one. I wanted a workflow to create "X" amount of subtasks based on how many related items there were. This could also be used for Runbook automation to run a diagnostic script or configuration based on how many network adapters, web sites, or databases a particular CI has.<br /> <br />Here is how I did it. The update set is also attached below. Be sure to take off the .txt. It has to end in .xml, but this blog does not allow .xml to be uploaded.<br /><ol><li>Copy the current Turnstyle activity definition to maintain the current activity for any future upgrades.<br /><ul><li>Go to Workflow --&gt; Activity Definition --&gt; Turnstyle<br /> Change its name. Maybe something like "Turnstyle Looper". Then right click on the top bar and click "insert and stay".</li></ul><br /></li><li>Copy the following code into the newly created activity script field<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />// Workflow activity definition handler class<br />//<br />// Implement activity definition handling in the onExecute method<br />//<br />// Implement any event handlers for the activity definition as a method named 'on[event_name]'<br />// For example, to handle the 'cancel' event, implement an 'onCancel' method<br />//<br /><br />var Turnstyle_with_VariableActivityHandler = Class.create();<br />Turnstyle_with_VariableActivityHandler.prototype = Object.extendsObject(WFActivityHandler, {<br /><br />initialize: function() {<br />var schpdName = 'iterations_' + activity.activity.sys_id;<br />WFActivityHandler.prototype.initialize.call(this);<br />if (!workflow.scratchpad[schpdName]) {<br />workflow.scratchpad[schpdName] = 1;<br />}<br />},<br /><br />onExecute: function() {<br />// implement activity definition code here<br />var schpdName = 'iterations_' + activity.activity.sys_id;<br /><br />var iterCountVar = parseInt(workflow.scratchpad[schpdName], 10);<br /><br />if(activity.vars.turnstyletype == 'variable'){<br />var thevar = workflow.eval(activity.vars.workflowvar);<br />var iterAllowedVar = parseInt(thevar, 10);<br />}<br />else if (activity.vars.turnstyletype == 'script') {<br />var thevar = workflow.eval(activity.vars.varscript);<br />var iterAllowedVar = parseInt(thevar, 10);<br />}<br />else {<br />var iterAllowedVar = parseInt(activity.vars.iterations, 10);<br />}<br /><br />if (iterCountVar &gt; iterAllowedVar) {<br />//Youve iterated too many times...stop iterating<br />activity.result = 'cancel';<br /><br />} else {<br />//Still iterating<br />iterCountVar ++;<br /><br />workflow.scratchpad[schpdName] = iterCountVar;<br />activity.result = 'continue';<br />}<br />},<br /><br />type: 'Turnstyle_with_VariableActivityHandler'<br />});<br /></pre><br /></li><li>Add some variables<br />Since we did an insert and stay the previous variables, conditions, and UI Policies get dropped out.<br /><ul><li>Column Name: turnstyletype , Label: "Turnstyle Type" , Type: string - make it a choice with no dropdown and default of "static" , Order: 10 , with the below choice list</li><li style="list-style: none"><br /><ol><li>Label: "Static Value" , Value: static , Sequence: 10</li><li>Label: "Variable" , Value: variable , Sequence: 20</li><li>Label: "Script" , Value: script , Sequence: 30</li></ol><br /><br /></li><li>Column Name: iterations , Label: "Allowed Iterations" , Type: integer , Order: 20</li><li>Column Name: workflowvar , Label: "Variable Name" , Type: string , Order: 30</li><li>Column Name: varscript , Label: "Script" , Type: script , Order: 40</li></ul><br /></li><li>Add the same condition defaults as the standard Turnstyle activity<br /><ul><li>Name: "Continue" , Condition: activity.result == 'continue' , Short Description: Continue iterating</li><li>Name: "Cancel" , Condition: activity.result == 'cancel' , Short Description: You've looped too many times...cancel iterating</li></ul><br /></li><li>Add some UI policies so that if the Static choice is selected, the "Allowed Iterations" is displayed. Or the Variable shows the "Variable Name", or the Script shows the script field.</li></ol><br /><br />Attached are some screenshots of what the Activity looks like in the workflow.<br /><br />&lt;script&gt;&lt;/script&gt;<br /> var _gaq = _gaq || [];<br /> _gaq.push(['_setAccount', 'UA-22945975-1']);<br /> _gaq.push(['_trackPageview']);<br /><br /> (function() {<br /> var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;<br /> ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';<br /> var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);<br /> })();<br /><br /></p>