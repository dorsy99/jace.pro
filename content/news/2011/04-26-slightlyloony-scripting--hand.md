---
title: "Scripting Handling ManytoMany MM Relationships"
date: 2011-04-25T18:25:18.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=72dd2ae9dbd0dbc01dcaf3231f9619eb"
---
<p><img  alt="" class="jive-image" src="ee2acd0edb9497049c9ffb651f96195e.iix" style="width: auto; height: 200px;" />The second type of relationship between records I'm going to talk about is the <i>many-to-many</i> relationship. That name is a little bit misleading, as this kind of relationship can be used to implement one-to-one, one-to-many, <i>or</i> many-to-many relationships. These kinds of relationships are used in dozens of places within the Service-now system, and you can create your own as well. <br /><br /><img  alt="" class="jive-image" src="08222c0adb10dfc068c1fb651f96197a.iix" style="width: auto; height: 13px;" />One example of a many-to-many relationship in the out-of-the-box Service-now product is the relationship between users and roles. In this case, it really <i>is</i> a many-to-many relationship: any given user can have multiple roles, and there many be multiple users associated with any given role. An ERD for this relationship might look like the one at left.<br /><br />So let's suppose that we had a GlideRecord for a user — how could we find the roles that user had?<br /><!--break--><br />What we'd really like to do is to be able to run some code like this (assuming <i>gr</i> contains the user record we're interested in:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var gru = new GRUtil();<br />var roles = gru.getM2MList(gr, 'sys_user_has_role', 'user', 'role', 'sys_user_role');<br />while (roles.next())<br />   gs.log(roles.name);</pre><br /><br />Here's what that new method <i>getM2MList</i> might look like:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br /><br />   /*<br />    * Returns a GlideRecord instance containing the records related to the given parent (a GlideRecord)<br />    * in the given child table related through the given m2m_table with the given parent reference and<br />    * child reference fields.<br />    */<br />   getM2MList: function(parent, m2m_table, parent_reference, child_reference, child_table) {<br />      var m2m_gr = new GlideRecord(m2m_table);<br />      m2m_gr.addQuery(parent_reference, parent.sys_id);<br />      m2m_gr.query();<br />      var kids = [];<br />      while (m2m_gr.next())<br />         kids.push('' + m2m_gr.getValue(child_reference));<br />      var kids_gr = new GlideRecord(child_table);<br />      kids_gr.addQuery('sys_id', kids);<br />      kids_gr.query();<br />      return kids_gr;<br />   },<br /></pre><br /><br />If you haven't seen programs that work with many-to-many tables before, this may look a little odd. The first six lines query the many-to-many table, looking for records whose parent reference points to the given parent. Then we gather up the <i>child</i> references of those records into an array. At the end of those six lines of code, the <i>kids</i> variable contains an array of the sys_ids of all the records in the child table that we want. The last four lines of code simply query the child table for the records with those sys_ids, and return the result.<br /><br />The same method works equally well for finding the users that have a given role. In fact, that method can be used to query for either side of any many-to-many relationship. If you'd like to see what the many-to-many relationships in your instance are, navigate to <i>System Maintenance â†’ Collections</i>. In this table you'll find a pair of entries for each many-to-many table defined in your instance.</p>