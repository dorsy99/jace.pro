---
title: "Jelly The Strange Case of Dr JEXL and Dr Hyde"
date: 2011-12-02T21:06:28.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=517dee29dbd0dbc01dcaf3231f961926"
---
<p><span class="asset-asset_lightbox-Small asset-align-right"><a href="/files/SlightlyLoony/slightly_skeptical.jpg" rel="lightbox"><img rel="lightbox" src="http://community.service-now.com/files/imagecache/Small/SlightlyLoony/slightly_skeptical.jpg" alt="" title="" class="imagecache imagecache-Small" /></a></span>Yesterday I sort of glossed over a couple of things that appeared in our simple Jelly template sample:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;j:jelly&gt;<br />    &lt;j:set/&gt;<br />    &lt;j:while&gt;<br />       <br />Test<br />        &lt;j:set/&gt;<br />    &lt;/j:while&gt;<br />&lt;/j:jelly&gt;<br /></pre><br />What I skipped were the two things that look like an expression surrounded by dollar signs and curly braces, like this one: <span style="font-family=Courier;color:FireBrick;">${jvar_loopCount + 1}</span>. What's up with <a title=".wikipedia.org/wiki/Strange_Case_of_Dr_Jekyll_and_Mr_Hyde#Dr_Henry_Jekyll_.2F_Mr_Edward_Hyde" href="http://en.wikipedia.org/wiki/Strange_Case_of_Dr_Jekyll_and_Mr_Hyde#Dr_Henry_Jekyll_.2F_Mr_Edward_Hyde">that name</a> and that odd-looking syntax, my friend would like to know?<br /><!--break--><br />That, folks, is an example of JEXL, or Java EXpression Language — another <a title="mmons.apache.org/jexl/index.html" href="http://commons.apache.org/jexl/index.html">open source technology from the Apache Foundation</a> that is used by Jelly for various purposes. If you're familiar with the notion of <i>macros</i> (from C or assembly programming), these JEXL expressions are very similar. The <span style="font-family=Courier;color:FireBrick;">${ }</span> syntax simply identifies the contents of the curly braces as a JEXL expression. If you write something like that <i>anywhere</i> in a Jelly template, when the template is processed the first step in processing each Jelly tag is to find all the stuff enclosed by dollar sign/curly braces within the tag and evaluate them as JEXL expressions. The <i>result</i> of each expression will be substituted for the entire dollar sign/curly brace construct. For example, consider this line in the sample Jelly template:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />        &lt;j:set/&gt;<br /></pre><br />The expression inside the curly braces (<span style="font-family=Courier;color:FireBrick;">jvar_loopCount + 1</span>) will be evaluated (computed) for <i>each iteration</i> of the while loop. On the first iteration, the value of <span style="font-family=Courier;color:FireBrick;">jvar_loopCount</span> is zero (because it was set to zero before executing the while loop), so the result of the JEXL expression evaluation is <span style="font-family=Courier;color:FireBrick;">1</span>. That line of Jelly, after evaluating the JEXL, will look like this (internally only; you can't inspect this):<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />        &lt;j:set/&gt;<br /></pre><br />Then the Jelly engine will simply set the <span style="font-family=Courier;color:FireBrick;">jvar_loopCount</span> variable to one. On the next loop iteration, that JEXL expression will be re-evaluated — and this time the result will be two.<br /><br />It bears repeating that a JEXL expression (in the curly brace syntax) can be <i>anywhere</i> in a Jelly template, so long as before processing the JEXL, the Jelly template is still valid XML. In particular, there's no requirement that it appear in a string literal, as we've done in our example. Check out this small modification to our sample Jelly template:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;j:jelly&gt;<br />    &lt;j:set/&gt;<br />    &lt;j:while&gt;<br />       <br />Test ${jvar_loopCount}<br />        &lt;j:set/&gt;<br />    &lt;/j:while&gt;<br />&lt;/j:jelly&gt;<br /></pre><br />That is still valid XML, even though our new JEXL expression isn't inside of a string literal. Instead, it is just text inside the HTML tag. While there are many places where you <i>can't</i> put a JEXL expression (because it would mess up the XML syntax), there are many useful places where you <i>can</i>...<br /><br />The JEXL expression language is actually quite powerful, as you can see if you read <a title="mmons.apache.org/jexl/reference/syntax.html" href="http://commons.apache.org/jexl/reference/syntax.html">the reference to it's syntax</a>. A few features of JEXL can't be used in Jelly because they conflict with either XML syntax or the dollar sign/curly brace syntax, but most of it is wide open for you.<br /><br />One last thing: if you look through the UI pages and other Jelly templates that come with your ServiceNow instance, you may notice something that looks an awful lot like JEXL, except that instead of curly braces it uses square braces. For example, you might see something like <span style="font-family=Courier;color:FireBrick;">$[jvar_x lt 42]</span>. Well, that <i>is</i> JEXL, but with twist that is one of the ServiceNow enhancements to Jelly. For now, don't worry about why it's different (we'll cover that in detail in a later post) — just know that it <i>is</i> JEXL, just like the curly braces version...</p>