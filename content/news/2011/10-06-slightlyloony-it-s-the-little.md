---
title: "Its the Little Things that Count"
date: 2011-10-05T19:47:30.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=6c6d6a29dbd0dbc01dcaf3231f9619d3"
---
<p><span class="asset-asset_lightbox-Small asset-align-right"><a href="/files/SlightlyLoony/scream.jpg" rel="lightbox"><img rel="lightbox" src="http://community.service-now.com/files/imagecache/Small/SlightlyLoony/scream.jpg" alt="" title="" class="imagecache imagecache-Small" /></a></span>Not long ago, I helped one of our customer's developers with some JavaScript issues that were making her want to scream. Actually, she did scream — right in my ear as she was describing her frustration. It was mainly two relatively little things that were bugging her. First, she had a list of software object instances in an array, and she wanted to sort them by price. She knew she could write a <a title="lightlyLoony/blog/2010/7/14/2010" href="/community?id=community_blog&sys_id=5cbc2a25dbd0dbc01dcaf3231f961994">custom sort function</a> to do this, but she really didn't want to do that — she wanted an easier way. Second, when she computed the extended price of a purchase, she got a very funny looking result.<br /><br />"Help!" said she. Loudly.<br /><br />Here's a simplified version of what she had when she called me:<br /><!--break--><br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var Software = function(name, price) {<br />    this.name = name;<br />    this.price = price;<br />};<br />Software.prototype.toString = function() {return this.name;};<br /><br /><br />var s1 = new Software("X", 400);<br />var s2 = new Software("A", 359.99);<br />var s3 = new Software("M", 19.98);<br /><br />var s = [s1, s2, s3];<br /><br />s.sort();<br />for (var i = 0; i &lt; s.length; i++)<br />    gs.log(s<i>.name + ' ' + s</i>.price);<br />gs.log(10 * s1.price + 5 * s2.price + s3.price);<br /></pre><br />When she ran her code, she got something like this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />A 359.99<br />M 19.98<br />X 400<br />5819.929999999999</pre><br />There were two big problems with this from her perspective: the list was sorted alphabetically by name whereas she wanted it sorted in order of price, and the value at the bottom was screwy looking. Plus the way the prices were formatted in the list were hard to read, and the code that does the math seemed hard to read (with all those <i>.price</i> pieces in there).<br /><br />The reason her list sorted in alphabetical order was because she supplied a <i>toString()</i> method (which JavaScript will use to convert her objects to a string), and the default behavior of the <i>Array.sort()</i> method is to sort alphabetically. The "normal" way to solve this problem would be to write a custom sort function — but that's exactly what my frustrated lady <i>didn't</i> want to do (she finds them overly complex and hard for novices to understand). Well, ok. We can do what she wants by changing the <i>.toString()</i> method to return a string that sorts in the order she wants. You can see that in our tweaked code below:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var Software = function(name, price) {<br />    this.name = name;<br />    this.price = price;<br />};<br />Software.prototype.valueOf = function() {return this.price;};<br />Software.prototype.toString = function() {return rpad(this.price.toFixed(2), '0', 10);};<br /><br />function rpad(val, pad, num) {<br />    while (val.length &lt; num)<br />        val = pad + val;<br />    return val;<br />}<br /><br />var s1 = new Software("X", 400);<br />var s2 = new Software("A", 359.99);<br />var s3 = new Software("M", 19.98);<br /><br />var s = [s1, s2, s3];<br /><br />s.sort();<br />for (var i = 0; i &lt; s.length; i++)<br />    gs.log(s<i>.name + rpad(s</i>.price.toFixed(2), ' ', 8));<br />gs.log((10 * s1 + 5 * s2 + s3).toFixed(2));<br /></pre><br />We've done a few other things in here as well to address her other issues.<br /><br />Note the addition of the <i>valueOf()</i> method in the prototype. JavaScript will look for, and use, this method anytime it needs to convert an object to a primitive value. By having it return the price, our now-happier developer can get rid of all the <i>.price</i> references she didn't like — JavaScript will know what to do because of the <i>valueOf()</i> method. <br /><br />We also added a new function to right-justify numbers in a field of fixed length (the <i>rpad()</i> function). This makes it very easy to line up numbers in a right-justified column, which our intrepid-but-frustrated developer wanted.<br /><br />Finally, we fixed the screwy-looking result of her extended price calculation simply by adding <i>.toFixed(2)</i> to her result. What does that do? And why did we get the screwy result in the first place? This <a title="lightlyLoony/blog/2010/7/13/2009" href="/community?id=community_blog&sys_id=68edeae9dbd0dbc01dcaf3231f961908">old post of mine</a> explains the why, and also describes one of the solutions: rounding. The <i>.toFixed(2)</i> does the rounding, to two decimal places — which (if you're dealing with American money) is exactly what you need.<br /><br />When she ran the new code, she saw this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />M   19.98<br />A  359.99<br />X  400.00<br />5819.93</pre><br />Which she was pretty happy about. My demonic developer diva was breathing considerably easier after our conversation, and she learned a few useful tricks. Hopefully you did, too!</p>