---
title: "How to Add Custom Filters to a Reference Field Lookup"
date: 2011-03-10T06:57:58.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=35ace225dbd0dbc01dcaf3231f9619c2"
---
<p>I recently came across a situation where I wanted to open a reference field lookup with some custom filter. The built in drop down filter is nice, but takes a little time to filter what you want. In particular I, as many of you do, use a "Parent Incident" field on the Incident form. Part of the incident process I am trying to follow is to search open incidents with the same Configuration item maybe, or something else on your form, and select an incident to be populated in the "Parent Incident" field.<br /><br />Mark Stanger gave me the suggestion to use a popupOpenStandard(url, 'lookup'); type function. I created something like the below, which initially worked great. It popped open a window and I could see the filtered results. However the issue I ran into, was when I clicked an incident in the list, it would not populate the "Parent Incident" field.<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var url = 'incident_list.do?sysparm_target=incident.u_parent_incident&amp;sysparm_query=active=true';<br />popupOpenStandard(url, "lookup");<br /></pre><br /><br />So I dug a little more and found some interesting variations of this popupOpenStandard() function. Using this function in conjuction with the "reflistOpenURL" function, I was able to basically duplicate the Reference Lookup functionality with a custom filter. Here is how I did it...<br /><br />I wanted to add an additional icon next to the Reference Lookup icon and make it so that when clicked would popup my custom filter window. So I created an onLoad Client Script. You will need to change "thefield" variable to be whatever reference field you want this to execute against. You will then need to modify the "opensearch()" function to contain the fields and the "url" (which is your filter). I added the "taskid" piece to exclude the task you are currently searching from. The "url" is built up just like a reference qualifier.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />function onLoad() {<br />var thefield = 'u_parent_incident'; //Identify the reference field this should be attached to.<br />var thetable = g_form.getTableName(); //This gets whatever table you are on.<br />var lookupfield = 'lookup.'+ thetable + '.' + thefield; //Creates the lookup or reference field ID.<br />var pinclookup = $(lookupfield);<br /><br />if (pinclookup){<br />var thetarget = thetable + '.' + thefield;<br /><br />pinclookup.insert({<br />after:'&lt;a id="u.searchparentincidents"&gt;&lt;img width="16" height="16" border="0" src="images/icons/filter.gif" title="Search Parent Incidents"&gt;&lt;/a&gt;'});<br /><br />var userpop = $('u.searchparentincidents');<br />userpop.observe('click', opensearch);<br />}<br /><br />function opensearch() {<br />//Here you create some variables to get the values of the fields you want in your custom filter.<br />var theci = g_form.getValue('cmdb_ci'); //Get Value of field to pass into query<br />var taskid = g_form.getUniqueValue(); //Get current sys_id to exclude it in the query<br />//This line builds up the URL filter.  Build this just like a reference qualifier.<br />var url = '&amp;sysparm_query=active=true^cmdb_ci=' + theci + '^sys_id!=' + taskid;<br /><br />var refurl = reflistOpenUrl(thetarget, thetarget, thefield, thetable, 'null', 'false', '');<br />var refurlquery = refurl + url;<br />popupOpenStandard(refurlquery, 'lookup');<br />}<br /><br />}<br /></pre><br /><br />The field with icon would look like this. I thought the filter icon was a nice touch.<br /><img  alt="" class="jive-image" src="2a23d486db949fc068c1fb651f9619aa.iix" /><br /><br />Once Clicked the filter window looks like this. Notice the custom filter at the top.<br /><img  alt="" class="jive-image" src="29d4510adb981b04ed6af3231f96193d.iix" /><br /><br />And then when you click a field it populates your "Parent Incident" field like so.<br /><img  alt="" class="jive-image" src="1fa4b886db9c57049c9ffb651f961916.iix" /><br /><br />Enjoy.<br />&lt;script&gt;&lt;/script&gt;<br /> var _gaq = _gaq || [];<br /> _gaq.push(['_setAccount', 'UA-22945975-1']);<br /> _gaq.push(['_trackPageview']);<br /><br /> (function() {<br /> var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;<br /> ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';<br /> var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);<br /> })();<br /><br /></p>