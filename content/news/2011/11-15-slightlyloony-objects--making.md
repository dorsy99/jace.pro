---
title: "Objects Making It A Little Easier"
date: 2011-11-14T22:42:42.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ce2ea66ddbd0dbc01dcaf3231f9619c3"
---
<p><span class="asset-asset_lightbox-Small asset-align-right"><a href="/files/SlightlyLoony/xmas_baby.jpg" rel="lightbox"><img rel="lightbox" src="http://community.service-now.com/files/imagecache/Small/SlightlyLoony/xmas_baby.jpg" alt="" title="" class="imagecache imagecache-Small" /></a></span>At the beginning of this series I alluded to a mysterious thing called <span style="font-family=Courier;color:FireBrick;">prototype.js</span> that would allegedly make defining JavaScript classes a little easier. We use <span style="font-family=Courier;color:FireBrick;">prototype.js</span> for all the classes we define in ServiceNow's Script Includes.<br /><br />But what is <span style="font-family=Courier;color:FireBrick;">prototype.js</span>, anyway? In this post we'll delve into it a bit, just for the parts we use in ServiceNow's server-side JavaScript classes. But in general, <span style="font-family=Courier;color:FireBrick;">prototype.js</span> is a popular <a title="w.prototypejs.org/" href="http://www.prototypejs.org/">open source JavaScript library</a> created by <a title="tephenson.us/" href="http://sstephenson.us/">Sam Stephenson</a>, and used by thousands of web sites for their client-side JavaScript code. Not only is it a great library for its intended purposes, but it's also a great resource for anyone who wants to learn about JavaScript — the <span style="font-family=Courier;color:FireBrick;">prototype.js</span> is some of the most beautiful JavaScript code I've run across.<br /><br />Here's what we do with <span style="font-family=Courier;color:FireBrick;">prototype.js</span> on the ServiceNow instance (and my little colleague at right is all ears):<br /><!--break--><br />There are two pieces of <span style="font-family=Courier;color:FireBrick;">prototype.js</span> that we use. The first one does a neat little trick: it lets you define the body of the constructor function in your prototype. Here's our example from two posts ago transformed to use <span style="font-family=Courier;color:FireBrick;">prototype.js</span>'s class definition style:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var MyObj = Class.create();<br /><br />MyObj.prototype = {<br />    initialize: function(x, y) {<br />        this.x = x;<br />        this.y = y;<br />    },<br />    x: null,<br />    y: null,<br />    average: function() {<br />        return (this.x + this.y) / 2;<br />    }<br />};<br /><br />MyObj.toString = function(){<br />    return 'MyObj';<br />}<br /><br />var mo = new MyObj(5, 12);<br /><br />gs.log(mo.average());<br />gs.log(MyObj.toString());<br />gs.log(mo.constructor.toString());<br /><br />JSUtil.logObject(mo, 'mo, an instance of MyObj');<br />JSUtil.logObject(mo.constructor.prototype, 'prototype of MyObj');<br /></pre><br />There are really just a couple difference here from what we did without <span style="font-family=Courier;color:FireBrick;">prototype.js</span>. <br /><br />First, instead of defining a constructor function, we assigned <span style="font-family=Courier;color:FireBrick;">Class.create()</span> to our constructor function property. What does that do? Well, if you'd like to see the code, go look in the <span style="font-family=Courier;color:FireBrick;">PrototypeServer</span> Script Include — but in short, what it does is to create a constructor function that calls the <span style="font-family=Courier;color:FireBrick;">initialize()</span> (spelled the American way!) method. Then if you look at the object literal that we use to initialize our prototype, you'll see that it defines an <span style="font-family=Courier;color:FireBrick;">initialize()</span> method. So all that's going on here is that the <span style="font-family=Courier;color:FireBrick;">Class.create()</span> automatically makes a constructor function that calls <span style="font-family=Courier;color:FireBrick;">initialize()</span>, which we defined to be exactly like our original class' constructor function. What's the point? Well, it lets us define all the instance methods and properties in a single object literal, <i>including</i> the constructor function. It's just a bit more convenient.<br /><br />The second difference is a bit more subtle. When you run this code, the second of these two lines behaves differently than it did in our original code:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />gs.log(MyObj.toString());<br />gs.log(mo.constructor.toString());<br /></pre><br />The reason the second form doesn't work now has to do with the details of how <span style="font-family=Courier;color:FireBrick;">Class.create()</span> works. The function that gets assigned to <span style="font-family=Courier;color:FireBrick;">MyObj.prototype.constructor</span> is created by a closure, and isn't the same function as <span style="font-family=Courier;color:FireBrick;">MyObj</span>. There's an easy fix, though, and it works both with and without <span style="font-family=Courier;color:FireBrick;">prototype.js</span>: just define your <span style="font-family=Courier;color:FireBrick;">toString()</span> method like this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />MyObj.toString = function(){<br />    return 'MyObj';<br />}<br />MyObj.prototype.constructor.toString = function(){<br />    return MyObj.toString();<br />}<br /></pre><br />The second piece of <span style="font-family=Courier;color:FireBrick;">prototype.js</span> that we use in the ServiceNow instance makes it easier to create child classes, or classes that extend other classes. Actually, JavaScript doesn't natively support class inheritance at all; strictly speaking, <span style="font-family=Courier;color:FireBrick;">prototype.js</span> is <i>simulating</i> class inheritance for us. I won't get into detail here about <i>why</i> one would want class inheritance — trust me, it's occasionally very useful. You can see lots of examples of class extension in the Script Includes that come with your ServiceNow instance (for example, the Discovery plugin has a number of them). Here we'll just show you how easy <span style="font-family=Courier;color:FireBrick;">prototype.js</span> makes this. If I wanted to extend the class above, I'd make something like this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var MyChildObj = Class.create();<br />MyChildObj.prototype = Object.extendsObject(MyObj, {<br />    mult: function() {<br />        return this.x * this.y;<br />    }<br />});<br /><br />var mco = new MyChildObj(5, 12);<br />gs.log(mco.average());<br />gs.log(mco.mult());<br /></pre><br />If you run this code (by appending it to the earlier code), you'll see that in fact a new JavaScript class <span style="font-family=Courier;color:FireBrick;">MyChildObj</span> is created, and that class "inherits" all the properties and methods of the <span style="font-family=Courier;color:FireBrick;">MyObj</span> class. Again, if you'd like to see the code that does this magic, go look in the <span style="font-family=Courier;color:FireBrick;">PrototypeServer</span> Script Include. It's not at all difficult to understand, but you don't actually have to understand it to use it.<br /><br />Got it?</p>