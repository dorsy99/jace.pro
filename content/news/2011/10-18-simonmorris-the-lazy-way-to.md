---
title: "The LAZY way to create a Problem from Incidents"
date: 2011-10-17T17:00:50.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=284daee5dbd0dbc01dcaf3231f96193f"
---
<p>As all good administrators and developers know, Laziness is a virtue that should be practiced, cherished and encouraged!<br /><br />Taking a good hint from "<a title="w.thelazyprojectmanager.com/" href="http://www.thelazyprojectmanager.com/">The Lazy Project Manager</a>" I've been on the lookout for ways to be productively lazy.<br /><br />On the ServiceNow forums a chap by the name of <a title="50017" href="/community?id=community_question&sys_id=904287addb98dbc01dcaf3231f961985">Reanimate asked:</a><br /><br /><blockquote><br />I want to create an Incident UI Action (List choice) to create a Problem from checked Incidents.<br /><br />I.e. check a number of incidents, select the UI Action "Create Problem" - ideally capture a description from the user then create a problem and relate all the checked incidents to the newly created problem.<br /></blockquote><br /><br />OBVIOUSLY a man after my own heart. He's far too lazy to create that Problem record and go and manually relate all of the Incidents.<br /><br />This is what he was after. As an Incident Manager you start to see multiple Incidents stacking up that have the same root cause, in this case a problem with SAP. How best to tie this information into a single Problem record.<br /><br /><embed width="640" height="480" src="http://www.youtube.com/embed/lbJWhkFkF0E" frameborder="0" allowfullscreen=""></embed><br /><br /><a title="w.youtube.com/watch?v=lbJWhkFkF0E" href="http://www.youtube.com/watch?v=lbJWhkFkF0E">YouTube link</a><br /><br />So, to free up more of Reanimates day, so he has more time to do.. well, whatever he does.. here is how to do it.<br /><br />You need 3 components to make this work.<br /><br /><ul><li>A new view on the Problem form - to make the interface more concise and relevant for a quick entry of a Problem record</li><li>A Script Include to read and write the Incident records, and associate them to the Problem record</li><li>A UI Action to hold it all together</li></ul><br /><br /><h2>The new view</h2><br /><br />Lets cut down the default Problem form to only show the bare minimum needed to create a new Problem.<br /><br />I've called the view <b>Create and Relate</b> - remember the name of the view you create so that you can reference it in the UI action later.<br /><br /><img  alt="" class="jive-image" src="6a23208adb50dfc03eb27a9e0f9619ed.iix" /><br /><br /><br /><img  alt="" class="jive-image" src="7b11484edb58d3049c9ffb651f961977.iix" /><br /><br />Click to enlarge the images.<br /><br /><h2>The Script Include</h2><br /><br />This code lives on the ServiceNow server listening for calls to the AssociateIncidentsToProblems AJAX call.<br /><br />When it gets a call it takes the sys_id of the Problem record that just been created, and a list of Incident sys_ids.<br /><br />It then loops through the Incidents making the necessary association. You can download this Script Include at the bottom of this post.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var AssociateIncidentsToProblems = Class.create();<br /><br />AssociateIncidentsToProblems.prototype = Object.extendsObject(AbstractAjaxProcessor, {<br /><br />   associate: function() {<br /><br />        var problem_sysid = this.getParameter("sysparm_problem_sysid");<br />        var incident_list = this.getParameter("sysparm_incident_list");<br /><br />        var incident_array = incident_list.split(',');<br />        for (var x = 0; x &lt; incident_array.length; x++) {<br />     <br />            var inc = new GlideRecord('incident');<br />            inc.get(incident_array[x]);<br />            inc.problem_id = problem_sysid;<br />            inc.update();<br />        }<br />       <br />        var r = this.newItem();<br />        r.setAttribute('result', 'success');<br />   }<br />});<br /></pre><br /><br /><h2>The UI Action</h2><br /><br />The UI action on the Incident table holds all of this together. I've set the type to be <b>List Choice</b>, and also told it to run on the Client side.<br /><br /><img  alt="" class="jive-image" src="4da2a37ddb5093049c9ffb651f961973.iix" /><br /><br />The code looks like this:<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var CreateAndRelateCallback = function(response) {<br />   var resp = response.responseXML.getElementsByTagName('item');<br />  <br />   if (resp[0].getAttribute('result') != 'success'){<br />      alert("Something went wrong with associating these Incidents to a Problem");<br />   } else {<br />      var win = getMainWindow();<br />      reloadWindow(win);<br />   }<br />}<br /><br />var CreateAndRelate = function(action_verb, sys_id, updated_table, display_value) {<br /><br />   var ga = new GlideAjax('AssociateIncidentsToProblems'); <br />   ga.addParam('sysparm_name', 'associate');<br />   ga.addParam('sysparm_problem_sysid', sys_id);<br />   var list = GlideList2.get('incident');<br />   ga.addParam('sysparm_incident_list', list.getChecked());<br />   ga.getXML(CreateAndRelateCallback);<br />}<br /><br />var CreateAndRelateForm = function() {<br />  <br />   var dialog = new GlidePaneForm("Create a Problem", "problem", document.body, CreateAndRelate);<br />   dialog.addParm('sysparm_view', "create_and_relate");<br />   dialog.addParm('sysparm_form_only', 'true');<br />   dialog.render();  <br />}<br /></pre><br /><br />Basically there is an initial function (CreateAndRelateForm) that is called when the UI Action is clicked. <br /><br />Note that the new Problem form view is referenced here - and it uses the <b>Name</b> of the view and not the <b>Title</b>. I.e. "Create and Relate" == 'create_and_relate'. <br /><br />Check in System UI &gt; Views if you aren't sure of the name.<br /><br />CreateAndRelateForm specifes CreateAndRelate as a callback to run when the Problem form is submitted.<br /><br />CreateAndRelate creates the AJAX client to talk to the Script Include we saw above. When the XML comes back from the server it passes data into CreateAndRelateCallback to throw an error if anything went wrong, and finally to reload the form.<br /><br />There you go! Not so lazy to write, but once you've set it up associating Incidents to Problems should be laaaazy!<br /><br />Thanks to James Grinter for the help in debugging my namespace issues :-)</p>