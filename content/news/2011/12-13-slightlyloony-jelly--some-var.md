---
title: "Jelly Some Variables are More Equal than Others"
date: 2011-12-12T23:19:53.000Z
authors: ["SlightlyLoony"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b84ee2addbd0dbc01dcaf3231f961903"
---
<p>I've briefly mentioned (but didn't really explain) the two types of variables one can find in Jelly templates: <em>Jelly</em> variables and <em>JavaScript</em> variables. My colleague Burton (seen at right while creating a particularly challenging Jelly template) wants to know things. "Why," he asks "would I use a Jelly variable instead of a JavaScript variable? Or <em>vice versa</em>? And whatever those differences are, why on earth didn't you blithering idiots just make it all work with one or the other? Do I have to do it <em>all</em> for you?"<br/><br/>Well, Burt, it's like this:<br/><br/>First, wash your face, bud. You're about to make a serious mess of your keyboard and mouse.<br/><br/>The key to sorting all this out is to realize that there are three different places where variables get used — and of course, what works where is different in each case:</p><ul><li><span style="text-decoration: underline;"><em>Jelly</em></span>: This may surprise you, but…Jelly doesn't know about JavaScript variables <em>at all</em>. It <em>only</em> knows about Jelly variables. Jelly itself doesn't actually care what the names of Jelly variables are, but nevertheless when using Jelly on the ServiceNow platform, it's vital to start the name of <em>every</em> Jelly variable with the prefix <span style="font-family=courier;color: FireBrick;">jvar_</span>, which you'll see used throughout the out-of-the-box Jelly templates. In Jelly, this naming convention allows some optimization — but in JEXL (as you'll see below) it is imperative.</li><li><span style="text-decoration: underline;"><em>JEXL</em></span>: On the ServiceNow platform, JEXL will work with <em>either</em> Jelly variables or JavaScript variable. Standard JEXL only works with Jelly variables, but ServiceNow has extended it to work with both. The mechanism is simple (pay attention, this is <em>important!</em>): if the variable name starts with <span style="font-family=courier;color: FireBrick;">jvar_</span>, JEXL assumes it's a Jelly variable. Otherwise, JEXL assumes it's a JavaScript variable. This has some consequences. For example, if you create a JavaScript variable that starts with <span style="font-family=courier;color: FireBrick;">jvar_</span>, JEXL won't know it's there. Also, if you create a Jelly variable that <em>doesn't</em> start with <span style="font-family=courier;color: FireBrick;">jvar_</span>, JEXL won't know it's there. Bottom line: follow the Jelly variable naming convention, and you won't get hurt.</li><li><span style="text-decoration: underline;"><em>JavaScript</em></span>: Of course JavaScript knows about its own variables — but it <em>can</em> also know about Jelly variables, through the <span style="font-family=courier;color: FireBrick;">jelly="true"</span> attribute I introduced in an earlier post. There's a catch, though: JavaScript can read (look at the values of) Jelly variables, but it cannot write (change the values of) or create Jelly variables. This happens because of the way that <span style="font-family=courier;color: FireBrick;">jelly="true"</span> attribute actually works: it <em>copies</em> the Jelly variables into JavaScript variables. You can modify the JavaScript variable all you want — but the changes you make <em>won't</em> be copied back to the Jelly variables.</li></ul><p><br/>Here's an example of several easy-to-make mistakes regarding Jelly and JavaScript variables:</p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br/><br/>&lt;pre style="margin-left:20px;line-height:1;color:FireBrick;"&gt;<br/>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br/>&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;<br/>       &lt;j:set var="jvar_alpha" value="alpha" /&gt;<br/>       &lt;g:evaluate jelly="true"&gt;<br/>               var colors = ['Red', 'Black', 'Blue', 'Brown', 'CadetBlue', 'DarkGreen', 'DeepPink'];<br/>               var jvar_test = 'test';<br/>               jelly.jvar_alpha = 'ALPHA';<br/>               jelly.jvar_beta = 'BETA';<br/>       &lt;/g:evaluate&gt;<br/>       &lt;j:forEach items="${colors}" var="color"&gt;<br/>               &lt;g:breakpoint/&gt;<br/>               &lt;p&gt;Color: $[SP] &lt;span style="color:${color};"&gt; ${color}&lt;/span&gt;&lt;/p&gt;<br/>       &lt;/j:forEach&gt;<br/>       &lt;p&gt;test: ${jvar_test}&lt;/p&gt;<br/>       &lt;p&gt;alpha: ${jvar_alpha}&lt;/p&gt;<br/>       &lt;p&gt;beta: ${jvar_beta}&lt;/p&gt;<br/>&lt;/j:jelly&gt;<br/>&lt;/pre&gt;</pre><p><br/>This goes horribly wrong in several ways. We'll take 'em one at a time:</p><ul><li>The <span style="font-family=courier;color: FireBrick;">evaluate</span> tag has the <span style="font-family=courier;color: FireBrick;">jelly="true"</span> attribute, so the Jelly variable <span style="font-family=courier;color: FireBrick;">jvar_alpha</span> defined on the preceding line gets copied into the <span style="font-family=courier;color: FireBrick;">jelly</span> variable (as <span style="font-family=courier;color: FireBrick;">jelly.jvar_alpha</span>). That part works just fine. In the script we attempt to change the value of that property (with <span style="font-family=courier;color: FireBrick;">jelly.jvar_alpha = 'ALPHA';</span>. We also try to create a new Jelly variable (with <span style="font-family=courier;color: FireBrick;">jelly.jvar_beta = 'BETA';</span>). Near the end of the Jelly template, we try inserting these Jelly variables into paragraphs — and if you run this as a UI Page, you'll see that it does <em>not</em> work.</li><li>Inside the <span style="font-family=courier;color: FireBrick;">evaluate</span> tag, you can see the line <span style="font-family=courier;color: FireBrick;">var jvar_test = 'test';</span>. This looks like we're trying to set the value of a Jelly variable, but actually what we're doing is setting the value of a <em>JavaScript</em> variable whose name happens to look like the name of a Jelly variable. Near the end of the Jelly template you can see where we try to insert that variable into a paragraph — and it works very poorly indeed. This fails because JEXL expression <span style="font-family=courier;color: FireBrick;">${jvar_test}</span> sees that the name starts with <span style="font-family=courier;color: FireBrick;">jvar_</span> and assumes that it's a <em>Jelly</em> variable — one that doesn't actually exist. Fail.</li><li>Now look at the tag <span style="font-family=courier;color: FireBrick;">j:forEach items="${colors}" var="color"</span>. This is going to iterate over the JavaScript array <span style="font-family=courier;color: FireBrick;">j:forEach items="${colors}" var="color"</span> and put each value it iterates over into the variable <span style="font-family=courier;color: FireBrick;">color</span>. It's that variable name that poses a problem: the name <span style="font-family=courier;color: FireBrick;">color</span>is a valid Jelly variable name, so Jelly works just fine with it. But a little later (in<p>Color: $[SP] <span style="color: ${color};">${color}</span></p>), we use that variable name in JEXL expressions — and <em>those</em> try to look up the value in a JavaScript variable (because the variable name <em>doesn't</em> start with <span style="font-family=courier;color: FireBrick;">jvar_</span>). This is a good example of a bad thing that can happen because you didn't start a Jelly variable's name with <span style="font-family=courier;color: FireBrick;">jvar_</span>.</li></ul><p></p><p></p><p>Just for fun, here's the same thing with all the problems fixed. Note the use of JEXL expressions to move JavaScript values into Jelly variables:</p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br/><br/>&lt;pre style="margin-left:20px;line-height:1;color:FireBrick;"&gt;<br/>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br/>&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;<br/>       &lt;g:evaluate jelly="true"&gt;<br/>               var colors = ['Red', 'Black', 'Blue', 'Brown', 'CadetBlue', 'DarkGreen', 'DeepPink'];<br/>               var test = 'test';<br/>               var alpha = 'ALPHA';<br/>               var beta = 'BETA';<br/>       &lt;/g:evaluate&gt;<br/>       &lt;j:set var="jvar_test" value="${test}"/&gt;<br/>       &lt;j:set var="jvar_alpha" value="${alpha}"/&gt;<br/>       &lt;j:set var="jvar_beta" value="${beta}"/&gt;<br/>       &lt;j:forEach items="${colors}" var="jvar_color"&gt;<br/>               &lt;g:breakpoint/&gt;<br/>               &lt;p&gt;Color: $[SP] &lt;span style="color:${jvar_color};"&gt; ${jvar_color}&lt;/span&gt;&lt;/p&gt;<br/>       &lt;/j:forEach&gt;<br/>       &lt;p&gt;test: ${jvar_test}&lt;/p&gt;<br/>       &lt;p&gt;alpha: ${jvar_alpha}&lt;/p&gt;<br/>       &lt;p&gt;beta: ${jvar_beta}&lt;/p&gt;<br/>&lt;/j:jelly&gt;<br/>&lt;/pre&gt;</pre><p><br/>I hope that's quite enough on this subject, Burt! Did you wash your face yet?</p>