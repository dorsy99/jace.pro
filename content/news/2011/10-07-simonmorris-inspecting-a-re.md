---
title: "Inspecting a record before its been saved"
date: 2011-10-06T14:28:09.000Z
authors: ["SimonMorris"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=535d2a29dbd0dbc01dcaf3231f96190a"
---
<p>I've done some work on some concept code this week, and have learned some interesting things about Glideform and Conditions<br /><br />The code I'm prototyping would be used during the creation of a record, as the user fills in the form. It's an interesting problem to inspect the form during this state as there isn't a record in the database to query or get until the user hits submit.<br /><br />The way to do it is to use GlideAjax - <a title="ki.service-now.com/index.php?title=GlideAjax" href="http://wiki.service-now.com/index.php?title=GlideAjax">a great walkthrough on the wiki</a> - to send the form to the server in it's unwritten state.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var ga = new GlideAjax('MyExampleCode');<br />ga.addParam('sysparm_name','functionName');<br /><br /><br />var fields = g_form.getEditableFields();<br />for (var x = 0; x &lt; fields.length; x++) {<br />    ga.addParam('sysparm_' + fields[x], g_form.getValue(fields[x]));<br />}<br /><br />ga.getXML(CallbackFunction);<br /></pre><br /><br />So <b>g_form.getEditableFields()</b> is a handy method to grab the fields on the form, which would include any customisations a customer will have made. Iterating through those fields I'm building the client side of GlideAjax up by adding sysparm_<i>fieldname</i> to the parameters.<br /><br />EDIT: Hmm, of course getEditableFields() only gets <b>editable</b> fields, so this isn't so good for fields such as Priority which is typically read-only. I'll update this post when I get that fixed, for the moment I manually added <b>ga.addParam('sysparm_priority', g_form.getValue('priority'));</b><br /><br /><b>g_form.getValue(fields[x])</b> is populating that parameter with the current value of the form.<br /><br />The screenshot below shows Firebug with the Ajax client sending the values of the form to the server.<br /><br /><img  alt="" class="jive-image" src="db370dcedb10d304b322f4621f9619bd.iix" width="800" /><br /><br />On the server side of the GlideAjax conversation I created an empty (or dummy) record and populated the object with the data from the form.<br /><br />The main part of this snippet is <b>GlideRecordUtil().getFields(incident)</b>. This returns a list of all the fields that exist on the form for that table, again including any customer tweaks.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />incident = new GlideRecord('incident');<br />incident.newRecord();<br /><br />fields = new GlideRecordUtil().getFields(incident);<br />for (var num = 0; num &lt; fields.length; num++) {<br />    var field_name = fields[num];<br />    incident[field_name] = this.getParameter('sysparm_' + field_name);<br />}<br /></pre><br /><br />Now that I have a representation of the record, should the user hit Submit, I can compare the record against filters.<br /><br />There is a function - <b>Packages.com.glide.script.Filter.checkRecord()</b> that compares a record, in my case a dummy record, against a filter.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var condition = 'category=hardware^priority=2';<br />var matches = Packages.com.glide.script.Filter.checkRecord(incident, condition);<br />if (matches) {<br />    // do something with the dummy record that is a priority 2 hardware incident<br />}<br /></pre><br /><br />So in summary - how to compare a record against a filter, before it's even been saved!</p>