---
title: "Scripting Handling Relationships"
date: 2011-04-20T17:45:19.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=0ebc2e25dbd0dbc01dcaf3231f961918"
---
<p><img  alt="" class="jive-image" src="2f83848adbd85fc068c1fb651f9619f6.iix" style="width: auto; height: 225px;" />Many tables in Service-now have <i>relationships</i> to other tables. For example, records in the CMDB's network adapter table (<i>cmdb_ci_network_adapter</i>) are generally related to other CIs (such as a computer). This relationship reflects the real-world relationship of (say) a couple network adapters installed in a server.<br /><br /><img  alt="" class="jive-image" src="75442bb9db1c5b048c8ef4621f9619c3.iix" style="width: auto; height: 25px;" />If we were drawing an <a title=".wikipedia.org/wiki/Entity_relationship_diagram" href="http://en.wikipedia.org/wiki/Entity_relationship_diagram">ERD</a> of this relationship, it might look like the diagram at left. There are many different graphic notations for ERDs, so what you're used to might look a bit different — but the general idea is the same in any notation. Here our little ERD is showing that there is a many-to-one relationship between network adapters and computers — a network adapter belongs to a single CI, but a single CI may have any number of network adapters.<br /><br /><i>GlideRecord</i> automagically handles the pesky details of object hierarchies, but when you want to find or manipulate related records, you're on your own. For example, suppose that in a script you've got a GlideRecord for a computer (which is a CI), and you want to find the network adapters that belong to it. How do you do that?<br /><!--break--><br />The first thing you have to do is figure out exactly what <i>kind</i> of relationship your two tables have. On the Service-now platform there are three distinct types of relationships between records. Today we'll talk about one of those: the <i>related list</i>, which the CI/network adapter relationship is a good example of.<br /><br />In related lists, the table on the <i>many</i> side of the relationship (related lists are <i>always</i> a many-to-one relationship) has a reference field in it that "points" to the <i>one</i> side of the relationship. In the case of network adapters, the <i>cmdb_ci_network_adapter</i> has a field named <i>cmdb_ci</i> that is a reference to <i>cmdb_ci</i> (meaning to any CI). If you had a record for computer "Benonio" and it had two associated network adapters, your network adapter table would contain two records whose <i>cmdb_ci</i> field pointed to "Benonio". It's a simple as that.<br /><br />How could we generalize this and make it easy? Wouldn't it be nice if I could write code like this?<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var gru = new GRUtil();<br />var nics = gru.getRelatedList(computer, 'cmdb_ci_network_adapter', 'cmdb_ci');</pre><br /><br />The idea here is that if my <i>computer</i> variable contains a <i>GlideRecord</i> with a particular computer in it, then I can call <i>getRelatedList()</i> and it will return another <i>GlideRecord</i> containing the network adapters that belong to that computer. Here's how I can extend <i>GRUtil</i> to add that method. I started with the version of GRUtil <a title="lightlyLoony/blog/2011/4/15/2069" href="/community?id=community_blog&sys_id=fedc2a65dbd0dbc01dcaf3231f9619ad">defined here</a>, then added this new method:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />   /*<br />    * Returns a GlideRecord instance containing the records related to the given parent (a GlideRecord)<br />    * in the given related table through the given reference field.<br />    */<br />   getRelatedList: function(parent, related_table, reference_field) {<br />      var result = new GlideRecord(related_table);<br />      result.addQuery(reference_field, parent.sys_id);<br />      result.query();<br />      return result;<br />   },</pre><br /><br />When I run this test code (I have a computer named "labapp02"):<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var computer = new GlideRecord('cmdb_ci_computer');<br />computer.addQuery('name', 'labapp02');<br />computer.query();<br />if (computer.next()) {<br />   var gru = new GRUtil();<br />   var nics = gru.getRelatedList(computer, 'cmdb_ci_network_adapter', 'cmdb_ci');<br />   while (nics.next())<br />      gs.log(nics.name);<br />}</pre><br /><br />I get this result:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />  eth0<br />  eth1<br />  eth2</pre><br /><br />Perfect.<br /><br />See why that kid is all excited? Aren't you?</p>