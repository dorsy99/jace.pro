---
title: "Discovery Parsing retrieved XML files"
date: 2011-09-16T01:26:43.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=4baca625dbd0dbc01dcaf3231f96193d"
---
<p>Recently, a customer asked me if it is possible to write a probe and sensor to get an XML file from a Windows target. Getting the file was the easy part. Parsing the returned results in the sensor was a new learning experience for me. Since I couldn't seem to find it documented anywhere else, this seemed like the best place. That's right... from the developer, to me, to you in just a few hours.<br /><br /><!--break--><br />Retrieving the XML file is the same as with any other text file. Create a probe under Discovery Definition&gt; Probes, and click New. Define the probe like this:<br /><br />Name: Windows - Get XML file<br />Probe type: Probe<br />ECC queue topic: RemoteRunner<br />ECC queue name: WMI: Get XML file<br />Description: Retrieve an XML file for some application<br />Used by Discovery: true<br />Used by Runbook: false<br /><br />Right click, Save<br /><br />Under the "Probe Parameters" (related list), create a new entry with the following parameters:<br /><br />Name: WMI_get_xml_file.js<br />Probe: (reference to the parent probe record: Windows - Get XML file)<br />Active: true<br />Value:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />//// Sample probe to gather text from the file: D:\myapp\config\database.xml<br />//<br /><br />var FOR_READING = 1;<br />var OUTPUT_FILE = "D:\\myapp\\config\\database.xml";<br />var res = getInfo();<br /><br />WScript.Echo(res);<br /><br />function getInfo() {<br />  var output = readFile(OUTPUT_FILE);<br />  return output;<br />}<br /><br />function readFile(fileName) {<br />  var fileObj = new ActiveXObject("Scripting.FileSystemObject");<br />  var objTextFile = fileObj.OpenTextFile(fileName, FOR_READING);<br />  var output = objTextFile.ReadAll();<br /><br />  objTextFile.close();<br /><br />  return output;<br />}<br /></pre><br /><br />Value script: (empty)<br /><br />Now comes the sensor. Normally, we would create a variable as an XMLdocument object from the result.output and use getNodeText() to tease out the parameters we want. That's not necessary here (never mind the fact that it doesn't work either). Discovery is smart enough to recognize that we retrieved an XML file and puts it directly inline with the XML payload on the ECC input record (look under the  tag).<br /><br />Here's the cool part I learned... To get to that information, simply dot-walk the XML structure to the answer. Given the following information in the <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />&lt;result&gt;</pre>section of the XML payload...<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />&lt;test&gt;<br />  &lt;one&gt;<br />    &lt;two att="xxx"&gt;abcd1234&lt;/two&gt;<br />    &lt;three boo="yah" att="yyy"&gt;1234abcd&lt;/three&gt;<br />    &lt;two&gt;another&lt;/two&gt;<br />  &lt;/one&gt;<br />  &lt;number&gt;1234&lt;/number&gt;<br />&lt;/test&gt;<br /></pre><br /><br />Instead of using XMLDocument and getNodeText() functions, use the much simpler statement: <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />var myNum = result.test.number;</pre><br /><br />To use this in a sensor, create a new sensor from Discovery Definition&gt; Sensors, click New and fill in the form similar to the following:<br /><br />Name: Windows - Get XML file<br />Reacts to probe: Windows - Get XML file<br />Sensor type: Sensor<br />Description: Tell me what's in the "number" tag of the retrieved XML file<br />Sensor type: Javascript<br />Active: true<br />Script:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />//<br />// Name: My sensor<br />// Description: Parse the output retrieved by the probe of the same name<br />//<br /><br />new DiscoverySensor({<br />/*<br />* Process the results of the probe<br />*<br />* @param: result - the value of the "result" tag of the XML payload on the input record<br />*/<br />process: function(result) {<br /><br />  var myNum = result.test.number; // Dot walk to the answer<br />  gs.log('&gt;&gt;&gt;DEBUG: My sensor: number=' + myNum);<br />},<br /><br />  type: "DiscoverySensor"<br />});<br /></pre><br />The power and simplicity of this is the statement "var myNum=result.test.number" to dot-walk to the answer. If you look in the system log, you should see an entry with the message:<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />&gt;&gt;&gt;DEBUG: My sensor: number=1234</pre><br /><br />I had one challenge when I ran in to with XML tags that have dashes (-) in them. The JavaScript parser thinks of these as mathematical equations with subtraction. For example:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var myNum = result.data-sources.data-source.name; // Won't work !!!<br /></pre><br /><br />is interpreted as "<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />result.data</pre>" minus "<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />sources.data</pre>" minus "<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />source.name</pre>". I got an error stating "sources is an unknown reference". The workaround is to use array notation for the items with dashes. Rewriting the statement above would look like:<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var myNum = result['data-sources']['data-source'].name;<br /></pre><br /><br />If you have XML tags with attributes (as in "three" from the example above having attributes "boo" and "att"), you can get the values of these with a statement like the following:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var booVal = result.test.one.three['@boo'];<br /></pre><br /><br />Will produce the answer "yah".<br /><br />Happy XML file parsing!<br /><br />Reference:<br />http://wiki.service-now.com/index.php?title=XMLDocument_Script_Object</p>