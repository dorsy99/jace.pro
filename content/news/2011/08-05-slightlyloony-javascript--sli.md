---
title: "JavaScript Slightly Subtle"
date: 2011-08-04T20:22:01.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=c33e22addbd0dbc01dcaf3231f96191c"
---
<p><img  alt="" class="jive-image" src="d244efb1dbdc9f04e9737a9e0f96192a.iix" style="width: auto; height: 134px;" />What do you think is logged when you run the following script, assuming that you have three computers named "Aleck", "Ben", and "Tom" in your CMDB?<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var gr = new GlideRecord('cmdb_ci_computer');<br />gr.orderBy('name');<br />gr.query();<br />var name;<br />var sys_id;<br />while (gr.next()) {<br />   if (gr.name == 'Ben') {<br />      name = gr.name;<br />      sys_id = gr.sys_id;<br />   }<br />}<br />gs.log(name + ' @ ' + sys_id);</pre><br />If you thought it would log Ben and its sys_id, why, then, you would be wrong. Here's why:<br /><!--break--><br />This code will <i>always</i> log the name and sys_id of the last computer it iterates over â€” in this case, "Tom". The reason for this is ever-so-slightly subtle, so follow along carefully...<br /><br />First, the code inside the "if" block probably isn't doing what you think it's doing. In particular, it's <i>not</i> assigning the string value of the name field to the name variable, nor is it assigning the string value of the sys_id field to the sys_id variable. Instead, it's assigning the GlideElement instance for each field to its respective variable. If you're not familiar with GlideElement, you can read all about it <a title="ki.service-now.com/index.php?title=GlideElement" href="http://wiki.service-now.com/index.php?title=GlideElement">here</a>.<br /><br />Now here's the slightly subtle part: any given GlideRecord only has one instance of GlideElement for each field. It does <i>not</i> have a separate instance of GlideElement for each field <i>in each record</i>. Instead, the value within the GlideElement changes each time GlideRecord iterates to a new record. That means that when the while loop finishes, the name variable contains the GlideElement instance for the name field, and the GlideElement instance contains the name value for the last record we iterated over: "Tom".<br /><br />But if gr.name returns a GlideElement and not a string, then how could the "if" statement work? It's comparing a string to the GlideElement representing the name field! Well, that works because JavaScript <a title="lightlyLoony/blog/2011/4/4/2061" href="/community?id=community_blog&sys_id=441e6e2ddbd0dbc01dcaf3231f961973">coerces</a> the GlideElement to a string (by calling the GlideElement's .toString() method). The variable assignment doesn't need to coerce, because the variable can hold a GlideElement just fine.<br /><br />To make the code work the way you most likely expected, here's what you can do:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var gr = new GlideRecord('cmdb_ci_computer');<br />gr.orderBy('name');<br />gr.query();<br />var name;<br />var sys_id;<br />while (gr.next()) {<br />   if (gr.name == 'Ben') {<br />      name = '' + gr.name;<br />      sys_id = '' + gr.sys_id;<br />   }<br />}<br />gs.log(name + ' @ ' + sys_id);</pre><br />By concatenating the GlideElement references to an empty string, we're forcing JavaScript to coerce the GlideElement to a string. Just as it did in the "if" statement, this retrieves the string value from the GlideElement instead of returning the GlideElement itself...</p>