---
title: "Scripting Script IncludeClass Basics"
date: 2011-04-08T18:45:23.000Z
authors: ["SlightlyLoony"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=45edeae9dbd0dbc01dcaf3231f9619b2"
---
<p><img  alt="" class="jive-image" src="f2f94042db109fc068c1fb651f961999.iix" style="width: auto; height: 188px;" />On occasion in this blog, I've mentioned Script Includes (navigate to <i>System Definition â†’ Script Includes</i>) and talked about <a href="http://www.prototypejs.org/learn/class-inheritance" javascript=""><i>classes</i> using the prototype.js library</a>. On the Service-now instance, JavaScript classes are generally defined within a Script Include, so on our platform the two notions are related. In this post, I'm going to start a series of posts on scripting within the Service-now platform. All of these posts will result in code that you could actually use, at least theoretically. Even if you can't use them directly, they will serve as practical examples. If you've got ideas for things you'd like to see me discuss, by all means let me know about them.<br /><br />In today's post, I'm going to start with this problem: I want a reusable bit of code that will let me find the CI that has a given network MAC address. Such a piece of code might be useful in a UI action (perhaps to let a service technician find out what device a particular MAC address belongs to), or it might be useful in a business rule associated with a change process. The real point is this: it's a bit of code that I'd like to write once, then be able to use it in multiple places without having to write it all over again. <br /><br />In this particular case, I'm envisioning being able to write code like this:<br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var mac = new MACResolver();<br />var gr = mac.resolve('00:50:56:ae:33:d9');<br />gs.log(gr.sys_class_name + ': ' + gr.name);</pre><br /><br />How would I do this?<br /><!--break--><br />First I have to know how the CMDB schema needed works. There are two possible ways that the MAC address could be stored. The simplest way is that it could be in the <i>mac_address</i> field of the CI I want. If you're not using Discovery, you may have your desktop computers in your CMDB this way. The slightly more complex way is that the MAC address could be in the <i>mac_address</i> field of a <i>cmdb_ci_network_adapter</i> record, and that record would have a reference in the <i>cmdb_ci</i> field to the CI it's a part of (and that's what I really need). <br /><br /><img  alt="" class="jive-image" src="4e45633ddb1493041dcaf3231f961929.iix" style="width: auto; height: 88px;" />So with that information, here's how my script include/class might look. I start by creating the new Script Include. At right is a screenshot of what it looked like after I clicked "New" and filled in the name and description. The stuff in the script field is the default, automagically put in as a guide for you when creating a new JavaScript class. Then I modified that script to what you see below. Note in particular how I modified the default script to put in the name of my class, which matches the name of the Script Include (and it <i>must!</i>). Most of what is happening in the script below you should be able to follow without any trouble, but there are a couple of points that may not be obvious:<br /><ol><li style="padding-bottom:10px;">The <i>_get_real_gr</i> function is needed because our original GlideRecord is on the <i>cmdb_ci</i> table, and in two places we need the GlideRecord for the actual class of that CI. For example, in one place the script detects that a CI is a network adapter and uses this function to return a GlideRecord for the network adapter. This is necessary because the original GlideRecord (for <i>cmdb_ci</i>) doesn't have access to the fields that are specific to <i>cmdb_ci_network_adapter</i> — and we need one of them (<i>cmdb_ci</i>).</li><li style="padding-bottom:10px;">The script skips right over records in <i>dscy_swtch_fwd_rule</i> (Switch Forwarding Rules). Unless you know our CMDB well, this won't make any sense at all. Here's why we skip over it: in the case of this table, the MAC address field doesn't represent the MAC address of that particular device, but rather a configuration of that device (a network switch). Because we know this can't be the device we really want, we're just skipping it.</li></ol><br /><pre style="margin-left:20px;line-height:1;color:FireBrick;"><br />var MACResolver = Class.create();<br /><br />MACResolver.prototype = {<br />  initialize: function() {<br />     // naught to do here...<br />  },<br /><br />  /*<br />   * If there is a CI in the CMDB with the given MAC address, a GlideRecord instance<br />   * for that CI is returned.  Otherwise a null is returned.<br />   */<br />  resolve: function(mac) {<br />     // find a CI with this MAC...<br />     var gr = new GlideRecord('cmdb_ci');<br />     gr.addQuery('mac_address', mac);<br />     gr.query();<br />     while (gr.next()) {<br />        // if it's not installed, try another...<br />        if (gr.install_status == 100)<br />           continue;<br /><br />        var klass = '' + gr.sys_class_name;<br /><br />        // if we have a switch forwarding rule, just move along...<br />        if (klass == 'dscy_swtch_fwd_rule')<br />           continue;<br /><br />        // if we have a NIC here, get the real CI...<br />        if (klass == 'cmdb_ci_network_adapter') {<br />           gr = this._get_real_gr(gr);<br />           if (!gr)<br />              continue;<br /><br />           var ci = '' + gr.cmdb_ci;<br />           gr = new GlideRecord('cmdb_ci');<br />           if (!gr.get(ci))<br />              continue;<br />        }<br /><br />        // right now we have a GlideRecord on cmdb_ci<br />        // get the correct table<br />        gr = this._get_real_gr(gr);<br />        if (gr)<br />           return gr;<br />     }<br />     // if we get here, then we failed to find a CI...<br />     return null;<br />  },<br /><br />  _get_real_gr: function(gr) {<br />     var sys_id = gr.getUniqueValue();<br />     var table = '' + gr.sys_class_name;<br />     var real_gr = new GlideRecord(table);<br />     return real_gr.get(sys_id) ? real_gr : null;<br />  }<br />}</pre></p>