---
title: "Know Your Numbers Rack Design"
date: 2014-06-11T22:03:29.000Z
authors: ["josiahsullivan"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=025ce6a1dbd0dbc01dcaf3231f961946"
---
<p><span style="font-family: inherit; font-size: 12pt; font-style: inherit; font-weight: inherit; color: #666666; line-height: 1.5em;">This is part of Cost Modeling Your Cloud series:</span></p><ul><li><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><a title="" _jive_internal="true" data-containerid="2927" data-containertype="37" data-objectid="2860" data-objecttype="38" href="/community?id=community_blog&sys_id=1b5c2aa1dbd0dbc01dcaf3231f9619ea">Part 1: Know your numbers</a></span></li><li><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><a title="" _jive_internal="true" data-containerid="2927" data-containertype="37" data-objectid="2904" data-objecttype="38" href="/community?id=community_blog&sys_id=7d5e6aaddbd0dbc01dcaf3231f96196f">Part 2: Develop the model</a></span></li><li><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><a title="" _jive_internal="true" data-containerid="2927" data-containertype="37" data-objectid="2951" data-objecttype="38" href="/community?id=community_blog&sys_id=3b8d2a69dbd0dbc01dcaf3231f9619e3">Part 3: Be consistent</a></span></li></ul><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">** Disclaimer: Math ahead. Actual costs and data points obfuscated for confidentiality. **</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">Industry media champions density and utilization as harbingers of efficiency in the datacenter.   But what do they actually mean? How do you use them in your day-to-day operation? How much can you safely cram in a rack?</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">While there are really only 3 elements, the subtle nuances of each can either dramatically increase efficiency or expose your business to a high degree of risk.</span></p><ul style="list-style-type: disc;"><li><span style="font-size: 12pt;">Design Envelope: How much usable power per rack</span></li><li><span style="font-size: 12pt;">Target Device Utilization: How much power will each server draw</span></li><li><span style="font-size: 12pt;">Density: How much cooling per square foot</span></li></ul><p><span style="font-size: 12pt;">Understanding and tuning these is the key to balancing efficiency against risk.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;"><strong>Rack Design Envelope</strong></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">How much power can a rack provide? This is dependent on the power circuits available in your datacenter, and those circuits vary by region. A common US standard is the L6-30 drop, which commonly provides 30A at 208V. The US specs also derate to 80%, bringing 6,240 Watts (208*30) down to 4,992. This is the ubiquitous "5kW" rack.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="padding-left: 60px;"><span style="font-size: 12pt;"><em>ProTip: You don't always have to pay for your power up front. Some data centers offer "consumption" billing where you pay for the kWh you actually use. Those that don't sometimes offer lower committed rates (say, 3.5kW/rack) as you ramp your business, with an option to increase your billed rate when usage exceeds the committed rate. This can save you millions.</em></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">One common mistake is to assume if you have 2x 5kW power feeds and 2 PDUs to a rack, you have 10kW of power per rack. In a redundant configuration, each server is connected to both PDUs. However, the overall load should not exceed the max draw of a single feed. This means there is only 5kW of usable power. If one feed fails while there is 7-9kW of draw, the remaining PDU will end up failing because it cannot handle the load.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="padding-left: 60px;"><span style="font-size: 12pt;"><em>ProTip: Certain stateless services can tolerate entire rack failures without issue, and in those cases all 10kW could be used. But most stateless services tend to drop in a single high amperage power feed at 10kW, 12kW, or 14kW rather than multiple with lower power. </em></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;"><strong>Target Device Utilization</strong></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">Server resources are infinitely customizable and how applications use those resources will vary widely, which means accurate power estimates can be hard to come by.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">First, you need to use a manufacturer power calculator to determine the "<a title="k-external-small" class="jive-link-external-small" href="http://en.wikipedia.org/wiki/Nameplate_capacity" rel="nofollow" target="_blank">nameplate</a>" rating of a particular combination of components. If you have been following best practices and standardizing your devices, you only have a few different combinations to consider. If every device is different, you are in a world of hurt and optimization will be somewhere between difficult and impossible.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">Second, you must determine average utilization. <a title="" _jive_internal="true" data-containerid="2927" data-containertype="37" data-objectid="2860" data-objecttype="38" href="/community?id=community_blog&sys_id=1b5c2aa1dbd0dbc01dcaf3231f9619ea">This should be a combination of science, art, and risk management, and based on *your* applications.</a> Nobody else can tell you how your applications run or what resources they need.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">This can be done by looking across your active environment and documenting the 95th percentile resource utilization that devices experience and how much power they draw at that point. A server may have a nameplate rating of 475 watts at 100% utilization. But it may realistically run at 75%, drawing 393 watts of power. Do your best to look across multiple servers to get an accurate representation. A great way to cross-check your assumptions is to get current and max power draws on each power circuit from your datacenter provider. If a current rack has 10 servers that are drawing around 393 watts per, the facility should be showing roughly 4kW/rack. If these numbers don't match, you missed something.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">Most racks also have 1-3 networking switches in them, which will also have average draws. Refer to network device manufacturer documentation or calculators to determine these numbers. </span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="padding-left: 60px;"><span style="font-size: 12pt;"><em>ProTip: Customer maturity is a huge predictor of server load at ServiceNow. New customers don't stretch the system while the largest most experienced ones have considerably more impact. This dynamic means that we have to ensure we look at racks with more mature customers to identify our target utilization. Looking at fresh racks with new customers would result in bad utilization estimates.</em></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">Once you know how much power you have to work with per rack and how much each device draws, simply divide. Assuming a 5kW rack, 2x 300W switches, and a server draw of 393 watts, you can put 11 servers into this standard rack. Easy as pie!</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;"><strong>Density</strong></span></p><p><span style="font-size: 12pt;"><br/></span></p><p><span style="font-size: 12pt;">Newer data centers can cool 14kW-20kW racks side by side in certain configurations, but older facilities might only be able to cool between 1kW and 2kW per rack position. Talk to your provider to ensure your dense racks can be adequately cooled. Occasionally high-density racks can be accommodated into facilities with low density cooling so long as the racks are physically spaced away from each other. This doesn't generally affect your overall performance per watt optimization, but could increase your operational datacenter costs as additional square footage would be required. We avoid this like the plague and shut down all low-density sites.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;"><strong>One More Thing: Cascading Failure… A Worst Case Scenario</strong></span></p><p><span style="font-size: 12pt;">Someone designs a rack standard with redundant 5kW feeds with 9.5kW of equipment. 5 racks are deployed, and the service runs well. The datacenter executes planned maintenance with the appropriate notification. One feed in a single rack drops, spiking draw and tripping the second PDU. The entire rack is now offline, but the worst is yet to come.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">The capacity plan assumed servers would be running at 50% utilization. With 1 rack down out of 5, that rack's load is added to each of the remaining 4 racks. That 9.5kW is divided by 4 (2.375kw), and each goes from 9.5kW to 11.9kW. Even assuming the increased load is non-linear, there is a high likelihood that some or all of the remaining racks would fall offline after exceeding the draw cap on the circuits and tripping breakers.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">While this scenario is unlikely, it *does* happen. Make sure you know what happens when a portion of your application falls offline and your remaining infrastructure has to pick up the slack.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;"><strong>Common Mistakes</strong></span></p><p><span style="font-size: 12pt;"><br/></span></p><p><span style="font-size: 12pt;">People frequently…</span></p><ul style="list-style-type: disc;"><li><span style="font-size: 12pt;">Assume 2x 5kW drops can support 10kW of equipment redundantly.</span></li><li><span style="font-size: 12pt;">Assume no other racks will increase utilization if one goes down.</span></li><li><span style="font-size: 12pt;">Try to apply power assumptions from one service or role to another. DNS may behave quite differently than a giant database.</span></li><li><span style="font-size: 12pt;">Assume your application runs at 100% when it really runs at 20%.</span></li></ul><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><span style="font-size: 12pt;">But if you walk through these basic steps and validate your assumptions at each stage, it is simple and straightforward to optimize what you have and identify targets for the next generation of optimization.</span></p>