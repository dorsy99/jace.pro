---
title: "The Benefits of good Behavior while Performing Discovery Scans"
date: 2014-10-14T22:28:50.000Z
authors: ["christopher.thompson"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=c38de669dbd0dbc01dcaf3231f9619fd"
---
<p><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">The <a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Shazzam_Probe" rel="nofollow" target="_blank">Shazzam probe</a> is used to try to get some initial information about all of the IP's we are trying to scan, so it would be helpful if there were some ways to make this run a little faster. You can save time and effort running the Shazzam probe with the use of <a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Discovery_Behaviors" rel="nofollow" target="_blank">Discovery Behaviors</a>.</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">When creating a new <span style="color: windowtext;"><a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Discovery_Schedules" rel="nofollow" target="_blank">Discovery Schedule</a></span>, you will have two options for how you want to run the Discovery scan.</span></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-3533-14528/New Schedule.JPG"><img   alt="New Schedule.JPG" class="image-0 jive-image" height="504" src="a1716fb1db5c9f04e9737a9e0f961904.iix" style="height: 292px; width: 620px; display: block; margin-left: auto; margin-right: auto;" width="1070"/></a><br/></span></p><p><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">Typically, you can just choose a MID Server in the "MID Server" field and this will signify that you want this scan to be run by the MID Server you have selected.</span></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">However, a more advanced and effective option is to choose a "Behavior".</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">A Discovery Behavior is useful not only for being able to choose what MID Server (or MID Servers) you want to use for this schedule, but you can also control what port probes you want to specify for this scan and even when to run them.</span><span style="font-size: 10pt; line-height: 1.5em; color: #535353; font-family: Arial;">Some of the scenarios for using Discovery Behaviors are mentioned in our product documentation, such as </span><span style="color: windowtext;"><a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Discovery_Behavior_-_Load_Balancing" rel="nofollow" target="_blank">Load Balancing</a></span><span style="font-size: 10pt; line-height: 1.5em; color: #535353; font-family: Arial;">, </span><span style="color: windowtext;"><a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Discovery_Behavior_-_Multiple_Domains" rel="nofollow" target="_blank">running in multiple domains</a></span><span style="font-size: 10pt; line-height: 1.5em; color: #535353; font-family: Arial;">, and </span><span style="color: windowtext;"><a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Discovery_Behavior_-_Access_Control_Lists_(ACL)" rel="nofollow" target="_blank">getting past ACL's</a>.</span></p><p><span style="color: windowtext;"><br/></span></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;">However, there are also some simple and practical benefits from using a Behavior for almost any Schedule you want to create.</span></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;"><strong><br/></strong></span></p><h2>Reduce Unneeded Port Probes</h2><p></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;">By default, when running a "Quick discovery" or if you choose the "MID Server" option for your Discovery Schedule, we will use the following port probes for each IP we try to scan.</span></p><p></p><ul style="list-style-type: disc;"><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">http (443)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">slp (427)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">wins (137)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">dns (53)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">ssh (22)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">wbem (5988/5989)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">wmi (135)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">vmapp (5480)</span></li><li><span style="font-size: 10pt; font-family: Arial; color: #535353;">snmp (161)</span></li></ul><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">While this may be effective, especially if you are unsure of what devices you are scanning initially, once you know what devices are linked to certain IP's, you likely will not need to run all these port probes in subsequent scans of this device.</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">For example, below is the results of a "Quick discovery" Shazzam probe that I ran on my local Windows VM machine.</span><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-3533-14530/windows.JPG"><img   alt="windows.JPG" class="image-0 jive-image" height="348" src="e761514adb54d304b322f4621f96197e.iix" style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em; height: 135px; width: 620px; display: block; margin-left: auto; margin-right: auto;" width="1600"/></a></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">As you can see, for this machine I am getting results from 7 of these different port probes, but 5 of them coming back as "refused" or "unresolved".</span></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">The only ports that come back with valid results are "wmi" (port 135) and "wins" (port 137), which are used to trigger the "Windows — Classify" probe to identify my device.</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">In the future, if I wanted to run another scan against this computer (assuming the IP is statically assigned), I would only need to use these wmi and wins port probes.</span></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">I wouldn't need to waste any time and effort scanning these other ports (snmp, ssh, etc.). </span><span style="font-size: 10pt; font-family: Arial; color: #535353;">This is where the concept of "Discovery Behaviors" can be very effective.</span><span style="font-size: 10pt; line-height: 1.5em; color: #535353; font-family: Arial;">By using a Schedule with a Behavior for the subsequent times I wanted to scan this device, I can choose to only use the wmi and wins port probes.</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">Now, this will not have much effect only for scanning one device, as the amount of effort and time for each port probe is minimal.</span></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;">However, if I was scanning a /24 range of these Windows machines (up to 256 devices) or even a /16 range (up to 65536 devices), this could potentially add up to hundreds of thousands of wasted port probe calls and even though most of these calls may only take milliseconds to process, it can certainly add up over time and especially if you decide to scan multiples ranges.</span></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;"><br/></span></p><h2>Prevent running Incorrect Classify probes</h2><p><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;"><br/></span></p><p><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">Sometimes you may have a device, like a Switch or a Router, which may have multiple ports open. </span><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">For example, if you scan a Router and it comes back and shows that port 22 is open, our default process will be at first to try to run a "Unix — Classify" against this device.</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">Now, this device is likely not intended for being able to login via SSH, so this Unix - Classify probe will run and fail. </span><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">Eventually, we should run the "SNMP — Classify" probe, as long as the snmp port is open, however, we just wasted running an additional probe and sensor against this Router that was unnecessary.</span></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">By using Discovery Behavior, we could have specified when running a Discovery Schedule against this Router (or perhaps against a set of Routers) that we don't want SSH to be used for this Schedule. </span><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">This way, we only need to see that SNMP is open and we can prevent wasting the time and effort of running unneeded Unix - Classify probes.</span></p><p></p><p></p><p><span style="font-size: 10pt; font-family: Arial; color: #535353;">Overall, while using Behaviors may not be practical for every scenario, there are likely some Schedules you can create where this can be useful. </span><span style="color: #535353; font-family: Arial; font-size: 10pt; line-height: 1.5em;">The more you can utilize these Behaviors with your Discovery scans, the less time and effort it will take your MID servers to process this Shazzam probe and proceed to the next activities.</span></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;"><br/></span></p><p><span style="color: #535353; font-size: 10pt; font-family: Arial;"><br/></span></p>