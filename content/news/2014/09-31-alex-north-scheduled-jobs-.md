---
title: "Scheduled jobs set adrift"
date: 2014-09-30T21:48:34.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=1dada2a9dbd0dbc01dcaf3231f96191a"
---
<p>One of the functions of the ServiceNow platform is the ability to <a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Creating_a_Scheduled_Job" rel="nofollow" target="_blank">create a scheduled job</a><a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Creating_a_Scheduled_Job" rel="nofollow" target="_blank"> </a>to run at a specified point in the future.<span style="font-size: 13.63636302948px;"> Scheduled jobs can be used for o</span>ut-of-box maintenance tasks or a custom code that you have implemented to perform a specific function on a given schedule.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p><a _jive_internal="true" href="/servlet/JiveServlet/showImage/38-3489-14122/create a scheduled job servicenow.png"><img  alt="create a scheduled job servicenow.png" class="image-0 jive-image" height="193" src="a3f91c42db5c17041dcaf3231f961958.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;" width="552"/></a></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>First things first, all scheduled jobs are stored in the sys_trigger table (scheduled reports are stored in sysauto_report).</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><div><p>Each JVM (application node) has a scheduler manager thread that is constantly checking to see whether there are any scheduled jobs that need to be run by this node. This is determined by the 'Next run time' being equal to or earlier than 'now.'</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><div style="clear: both;"> </div><div style="float: center; border: 1px solid black; width: 90%; padding: 15px; margin-left: 20px; margin-bottom: 20px;"><p><strong>The Scheduler Manager</strong></p><p style="text-align: left;"><span style="font-size: 10pt;"><em>There is a scheduler manager thread running on each node</em></span></p><ul><li>Check sys_cluster_state - is this node configured to take 'any' or only 'specified' scheduled jobs</li><li>Check sys_trigger for any job which is past his 'Next Run' time and is in a 'Ready' state</li><li>Depending on how the node is configured, pick up the job and move it to the scheduler queue</li></ul><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>If a node is in the passive datacenter of the High Availability pair, we don't want scheduled jobs to be executed. The latency between the application node in the passive datacenter and the database in the active datacenter is too high and the processing of any job would take far too long.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>To prevent this from happening, nodes in the passive datacenter have their schedulers set to "specified".</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>The scheduler manager thread will only pick up jobs that are directly assigned to his System ID, or any job if his schedulers are set to "any".</p></div><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>Most people think that a scheduled job would execute exactly at the 'Next run time'. There is however, a little known field which users typically do not display on the form or list views of sys_trigger:<span style="font-size: 10pt; line-height: 1.5em;"> the "</span>max_drift<span style="font-size: 10pt; line-height: 1.5em;">" setting.</span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><h3>Using the max_drift setting when creating a scheduled job</h3><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>Using round numbers like top of the hour, quarter past the hour, and half past the hour, will make scheduling jobs simple and easy to keep organized.   When an interval or repeat based scheduled job begins to be processed, the next run time is calculated. The max_drift setting gives the system a window of time around what the admin has configured, to avoid having everything execute at the exact same time.   <span style="font-size: 10pt; line-height: 1.5em;">For the most part, you won't even realize this is going on as it all happens on the back end. </span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="text-align: center;"><span style="font-size: 13.63636302948px; text-align: center;"><em>** Note: This behavior does not apply to </em></span><em><a title="k-external-small" class="jive-link-external-small" href="http://wiki.servicenow.com/index.php?title=Scheduling_and_Publishing_Reports" rel="nofollow" target="_blank">Scheduled Reports</a></em><span style="font-size: 13.63636302948px; text-align: center;"><em>. These will execute at the specified time. **</em></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><h3>Maintenance Tasks</h3><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>There are a couple of maintenance tasks which you may want to ensure start at a specific time, preferably during your least busy time. Most notable of these are the Zing maintenance tasks, particularly on releases earlier than Calgary.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>Zing maintenance tasks in the following sequence:</p><ul><li>TS Index Reaper - tidies up obsolete text search indexes (document was either updated or deleted)</li><li>TS Index Stats - Runs statistics against Zing usage, generates new auto-stop words</li><li>TS Search Stats - Runs statistics against Zing usage</li></ul><p style="margin-top: 20px;">By making sure maintenance tasks happen during off-peak usage hours, you can limit impacting performance. Another common job which we really want to know when it's going to fire is the "Upgrade" job. Part of ensuring an upgrade starts when you want is setting a low max_drift setting on the "Upgrade" scheduled job. I'll talk more about the upgrade process in my next blog post.</p><h3></h3><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><h3><span style="color: #ff0000;">Update: 24 November 2014</span></h3><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p></div><div><p>It has been pointed out that any automation or scheduled job which is created using the wizard shown in the screenshot at the top of this post would have a primary record in the sysauto table. If the job is active, a sys_trigger entry is automagically created for scheduling. So far so good. It seems that sys_trigger records which are related to a sysauto record are in fact locked down, so you can not adjust the max_drift value for these entries.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p>Any stand alone sys_trigger records (such as the Zing and upgrade maintenance jobs mentioned in the post) can have their max_drift value adjusted. Hopefully this is helpful and apologies for any confusion caused.</p><div style="clear: both;"> </div><div style="clear: both;"> </div><div style="float: center; border: 1px solid black; width: 90%; padding: 15px; margin-top: 15px; margin-left: 20px; margin-bottom: 20px;"><p><strong>Tables which extend sysauto</strong></p><p><strong><br/></strong></p><ul><li>scheduled_data_import</li><li>sysauto_custom_chart</li><li>sysauto_report</li><li>sysauto_template</li><li>sysauto_script</li></ul></div></div>