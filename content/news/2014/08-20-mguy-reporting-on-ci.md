---
title: "Reporting on CI Changes  Using History Sets"
date: 2014-08-19T18:41:59.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=5ffde62ddbd0dbc01dcaf3231f961917"
---
<p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">One of the things that I've been asked for many years is 'How can we report on our CI changes?', i.e. a customer wants to know what is changing on their CIs without having to look at each one individually or create a list of updated CIs and then trawl through that, or trawl through sys_audit which as we know is not recommended.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">So I decided to have a look into this and see whether we can use 'History' sys_history_line as a way of reporting those changes, it also looks much better than sys_audit as well as it displays CI names rather than sys_ids.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">History is a rotated table and normally those sys_history_lines are generated on the fly when a user views history in a record, that means this table doesn't become another huge sys_audit table, the records are created on-demand and then rotated/dropped off after a set period of time.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">So I created a scheduled job to generate History Sets for any CI updated in the last 24 hours and then created a scheduled report to run immediately after that history set generation to query those History lines and voila, we have a CI Change report... steps below</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;"><strong style="font-style: inherit; font-family: inherit;">Step 1</strong>- update the <strong style="font-style: inherit; font-family: inherit;">sys_property 'glide'ui.permitted_tables'</strong> to <strong style="font-style: inherit; font-family: inherit;">INCLUDE</strong> sys_history_line, now this property controls which sys_ tables are reportable, i.e. you can see them as selectable tables in the table drop-down for reporting. (add a 'report_on' ACL if you wish this table to be reportable for anyone else but admin).</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;"><strong style="font-style: inherit; font-family: inherit;">Step 2-</strong> create a report on History 'sys_history_line' as per screenshot below:</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="12656" data-objecttype="111" href="/servlet/JiveServlet/downloadImage/38-3344-12656/Report.png"><img  alt="Report.png" class="image-1 jive-image jiveImage" height="489" src="bbcb4846db509fc068c1fb651f96195d.iix" style="border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="1128"/></a></p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">Now this report will initially be empty even if you've just gone and updated a few CIs thinking cool, I will see my updates straight away, but remember the beauty of sys_history_line is that it's generated on-demand, normally when someone goes and looks at history, so now we need to run a little script before we schedule this report to simulate that for the updated CIs...</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;"><strong style="font-style: inherit; font-family: inherit;">Step 3 -</strong> Create a scheduled report from your report record and add some code in the condition script to a)check we have had some updates and b)to make it generate those history lines we need before actually sending the report empty <span class="emoticon-inline emoticon_happy" style="font-weight: inherit; font-style: inherit; font-family: inherit;"></span></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="12660" data-objecttype="111" href="/servlet/JiveServlet/downloadImage/38-3344-12660/Scheduled Report.png"><img  alt="Scheduled Report.png" class="jive-image image-2 jiveImage" height="432" src="a63763b5db181704ed6af3231f9619a8.iix" style="border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="1131"/></a></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">The code in that condition to save you some time:</p><p class="dp-highlighter" style="min-height: 8pt; height: 8pt; padding: 0px; color: #666666;">  </p><div class="bar" style="font-weight: inherit; font-style: inherit; font-family: inherit;"><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><ol class="dp-c" start="1" style="font-weight: inherit; font-style: inherit; font-family: inherit;"><li><span style="font-weight: inherit; font-style: inherit;"><span style="font-weight: inherit; font-style: inherit;">answer = </span><span class="keyword" style="font-weight: inherit; font-style: inherit;">false</span><span style="font-weight: inherit; font-style: inherit;">;   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;"><span class="keyword" style="font-weight: inherit; font-style: inherit;">var</span><span style="font-weight: inherit; font-style: inherit;"> cis = </span><span class="keyword" style="font-weight: inherit; font-style: inherit;">new</span><span style="font-weight: inherit; font-style: inherit;"> GlideRecord(</span><span class="string" style="font-weight: inherit; font-style: inherit;">'cmdb_ci'</span><span style="font-weight: inherit; font-style: inherit;">);   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;">cis.addEncodedQuery(<span class="string" style="font-weight: inherit; font-style: inherit;">'sys_updated_onRELATIVEGE@hour@ago@24'</span><span style="font-weight: inherit; font-style: inherit;">);   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;">cis.query();   </span></li><li><span style="font-weight: inherit; font-style: inherit;"><span class="keyword" style="font-weight: inherit; font-style: inherit;">if</span><span style="font-weight: inherit; font-style: inherit;"> (cis.hasNext()){   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;">   answer = <span class="keyword" style="font-weight: inherit; font-style: inherit;">true</span><span style="font-weight: inherit; font-style: inherit;">;   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;"><span class="keyword" style="font-weight: inherit; font-style: inherit;">while</span><span style="font-weight: inherit; font-style: inherit;"> (cis.next()){   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;">   <span class="keyword" style="font-weight: inherit; font-style: inherit;">var</span><span style="font-weight: inherit; font-style: inherit;"> hs = </span><span class="keyword" style="font-weight: inherit; font-style: inherit;">new</span><span style="font-weight: inherit; font-style: inherit;"> GlideHistorySet(cis);     </span></span></li><li><span style="font-weight: inherit; font-style: inherit;"><span class="keyword" style="font-weight: inherit; font-style: inherit;">var</span><span style="font-weight: inherit; font-style: inherit;"> sys_id = hs.generate();   </span></span></li><li><span style="font-weight: inherit; font-style: inherit;">}   </span></li><li><span style="font-weight: inherit; font-style: inherit;">}   </span></li></ol></div><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">So now we have our report, plus the scheduling piece to generate the history lines, I can decide whom gets it, subject, intro, how I want my attachments and hit 'Execute Now'</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">And here is the report in PDF</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="12661" data-objecttype="111" href="/servlet/JiveServlet/downloadImage/38-3344-12661/Finished Report.png"><img  alt="Finished Report.png" class="jive-image image-3 jiveImage" height="477" src="8f35958adb5813043eb27a9e0f961999.iix" style="border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="1000"/></a></p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">Disclaimer time now <span class="emoticon-inline emoticon_happy" style="font-weight: inherit; font-style: inherit; font-family: inherit;"></span>   if you have masses and masses of CI changes coming in via Discovery or some other source, you may want to run this on specific tables only, or spread out the period of time, I guess it's horses for courses though, alternatively if you only want to capture manual changes, filter out the discovery username in the sys_history or in the scheduled job to find updated records by those users, so use the filters to be most effective and only target the things you want to know about.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">Any questions please feel free to comment below.</p><p style="min-height: 8pt; height: 8pt; padding: 0px;">  </p><p style="font-size: 12.727272033691406px; font-family: arial, sans-serif; color: #666666;">Marc</p>