---
title: "Create Closure Task  Scheduled Job"
date: 2014-06-27T02:32:05.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=8daca225dbd0dbc01dcaf3231f96197e"
---
<p>//See if any closure records exist<br/>//--------------------------------------------------------------<br/>var ct = new GlideRecord('u_ks_task_closure');<br/>ct.query();<br/>while(ct.next()){</p><p>// If closure record end date is past today then add task record<br/>//---------------------------------------------------------------<br/> if(new Date().getTime() &gt; new Date(ct.u_closure_date.substring(0,4), (ct.u_closure_date.substring(5,7)-1), ct.u_closure_date.substring(8,10)).getTime()){</p><p>   //Find RITM record, change it's status to in progress and add a task<br/>   //---------------------------------------------------------------<br/>   var ritm = new GlideRecord('sc_req_item');<br/>     if(ritm.get('number',ct.u_ritm_number)){<br/>     <br/>         //If ritm wasn't rejected update it's status<br/>         //-----------------------------------------<br/>         if(ritm.approval != 'rejected'){<br/>           ritm.active = true;<br/>           ritm.state = 2;<br/>           ritm.stage = "executing"<br/>           ritm.comments = "New task added to remove access since end date ("+ct.u_closure_date+") has passed.";<br/>           ritm.update();<br/>         }else{<br/>           continue;<br/>         }   <br/>     }<br/> <br/>   //Get assignment group for this particular task/RITM<br/>   //---------------------------------------------------------------<br/>   var assignGroup = "";<br/>   var group = new GlideRecord('u_ks_task_closure_helper_table');<br/>   if(group.get('u_catalog_item',ritm.cat_item.sys_id)){<br/>       assignGroup = group.u_task_closure_group.sys_id;<br/>   }</p><p>   // Create new Task record and tie it to the parent ritm record<br/>   //---------------------------------------------------------------<br/>   var newTask = new GlideRecord('sc_task');<br/>   newTask.initialize();<br/>   newTask.short_description = "REMOVE ACCESS: '"+ritm.cat_item.name+"' for "+ritm.request.requested_for.name; <br/>   newTask.description = "Access to this resource has expired and needs to be removed";<br/>   newTask.assignment_group = assignGroup;//fulfillment group from helper table<br/>   newTask.request_item = ritm.sys_id;//sys id of parent ritm<br/>   newTask.parent = ritm.sys_id;//sys id of parent ritm<br/>   newTask.insert(); </p><p>   // Delete record from closure table<br/>   //---------------------------------------------------------------<br/>   ct.deleteRecord();   </p><p><br/> }//End if closure end date is past today</p><p>}//end loop</p>