---
title: "Using Orchestration to add users to Security Groups"
date: 2014-10-16T19:37:18.000Z
authors: ["garyopela"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=46dde6e9dbd0dbc01dcaf3231f96197b"
---
<p>So we are working on rolling out our software request portion of our catalog. We use Configuration Manager to manage the software packages. We use Active Directory Security groups to manage who all can install which software, and we have a self-service website where they can actually install the software once they are allowed access to that software title.</p><p><br/>So, with all that out of the way, we needed to manage the users' ability to request the software, for a manager to approve it, and then for the user to be granted access. What better way than to use the Service Catalog! So, my awesome co-worker, <a title="Steve Hill" __default_attr="2132" __jive_macro_name="user" class="jive_macro_user jive_macro" data-objecttype="3" data-orig-content="Steve Hill" href="/community?id=community_user_profile&user=5ab01eaddb581fc09c9ffb651f961911">Steve Hill</a> Created the catalog section, where a user can go in and request the software.</p><p><br/>So I worked on the orchestration piece, which is far from complete, but is functional so I wanted to post here on how to do it. So, basically after the RITM workflow gathers the appropriate approval, it would then call an Orchestration Run PowerShell activity to add the user to the group. Now, there is a little setup work to do that. You will need the sAMAccountName of the User (pretty much the user id from AD) and of the group. You will need to have Orchestration set up with AD credentials. You will need to have selected a default Mid-Server for orchestration activities. You will need to have set that mid-server's windows service to run as a user which has the ability to modify Active Directory.</p><p>Oh yeah, and one last thing, you need to turn on the active-directory PowerShell parts on your windows mid-server (has to be a windows mid-server). This is the part which I was missing, so I will show you how to do it:</p><p>First, go to Start -&gt; Control Panel -&gt; Programs and Features. On the left side, click 'Turn Windows features on or off" You will need to have administrator rights on your windows mid-server to do this. Next, the Server Manager box should pop up. On the left side, click on the 'Features' to expand it, then click, on the right-hand side, Add Features. Next, scroll down to "Remote Server Administration Tools" and expand it. Expand next the 'Role Administration Tools'. Lastly, expand the "AD DS and AD LDS Tools" Finally, you want to make sure to place a checkbox beside the "Active Directory module for Windows PowerShell" then click Install. This will enable your Run PowerShell activity to import the Active-Directory module.</p><p></p><p><img  class="image-1 jiveImage" src="ae02118edb989f048c8ef4621f96197f.iix" style="max-height: 900px; max-width: 1200px;"/></p><p></p><p>So, now that your server is set up to be able to use ActiveDirectory module in PowerShell, we need to create the workflow item to actually do the lifting.</p><p></p><p>So, open your workflow, add in a Run Powershell activity. It should look similar to this:</p><p><img  class="image-2 jiveImage" src="38c9e4cadb54dfc068c1fb651f96197f.iix" style="max-height: 900px; max-width: 1200px;"/></p><p></p><p>Open the Run Powershell activity. Set the Hostname to the hostname of your mid-server (not to the domain controller). Then for the command, you will have the following:</p><p></p><pre __default_attr="c#" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14134701427171303" jivemacro_uid="_14134701427171303">
<p>Import-Module ActiveDirectory</p>
<p>Add-ADGroupMember -Identity "&lt;enter your group name here&gt;" -Members "&lt;enter the user sAMAccountName here&gt;"</p>
</pre><p></p><p>Now, of course, this is hardcoded, you would of course want to pass the group and user as variables, but that's simple enough.</p><p>You can now test your script out, and you should see that the user (the second parameter) is added to the group (the first parameter).</p><p></p><p>I hope this helps you guys out. It's pretty simple with PowerShell v2. Before v2, it was quite a few lines of code to make this happen.</p>