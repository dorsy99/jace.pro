---
title: "Scripting to batch create user groups and attach them to CIs"
date: 2014-10-29T00:34:14.000Z
authors: ["yjaques"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=d4ccee25dbd0dbc01dcaf3231f961941"
---
<p>I recently had a big stack of applications, over 50, in which I was asked to create a user group for each one, assign a manager and email to each group and create a CI/Group relationship between each newly created group and its corresponding CI. Certainly I could have clicked through several hundred screens and a thousand input fields to do it, but scripting seemed like a lot more fun. Here's what I ran as a background script:</p><p></p><p>(one thing that might not be so obvious -- the <span style="font-size: 13.63636302948px;">cmdb_rel_group table that holds the relationship needs three values, the CI, the GROUP and the Relationship type. You can go into the tables and find the sys_id for the relationship type you want to add, which is what the <span style="font-size: 13.63636302948px;"> rel.type = '27c52344d95d61004f9c9aac0acc15a3'; is all about)</span></span></p><p></p><p>//table can be any CI table -- this is one that holds our java apps</p><p>var gr = new GlideRecord('u_cmdb_ci_applications_web_jav'); //Indicate the table to query from</p><p>gr.query(); //Execute the query</p><p>while (gr.next()) { //While the recordset contains records, iterate through them</p><p>   gr.u_user_group = getGroupSysId(gr);</p><p>       gr.update();</p><p>       //now lets add a CI/group relationship too</p><p>       updateGroupRel(gr);</p><p>}</p><p></p><p>//this builds the relatioship between the created group and the existing CI</p><p>function updateGroupRel(gr) {</p><p>     var rel = new GlideRecord('cmdb_rel_group'); //Indicate the table to query from</p><p>   rel.addQuery('ci', gr.sys_id);</p><p>   rel.query();</p><p>   while (rel.next()) {</p><p>   //record exists so do nothing</p><p>   return rel.sys_id;</p><p>   }</p><p>     rel.initialize();</p><p>       rel.ci = gr.sys_id;</p><p>       rel.group = gr.u_user_group;</p><p>       //sys_id of the relationship type</p><p>       rel.type = '27c52344d95d61004f9c9aac0acc15a3';</p><p>       var user_group_rel_id = rel.insert();</p><p>   if (user_group_rel_id != null) {</p><p>   gs.log("Created new relationship.");</p><p>   }</p><p>   return user_group_rel_id;</p><p>}</p><p></p><p>//this creates the group, or gets it if it already exists</p><p>function getGroupSysId(gr) {</p><p>   //get the user</p><p>   var userRecord = new GlideRecord("sys_user");     </p><p>   userRecord.get(gr.supported_by);</p><p>   //create a group for the app</p><p>   var groupRecord = new GlideRecord("sys_user_group");     </p><p>   groupRecord.addQuery('name', gr.name);</p><p>   groupRecord.query();</p><p>   while (groupRecord.next()) {</p><p>   gs.log("Found group: " + groupRecord.getDisplayValue());</p><p>   if(groupRecord.email == '') {</p><p>         groupRecord.email = userRecord.email;</p><p>         groupRecord.update();</p><p>         gs.log("Added email: " + userRecord.email);</p><p></p><p></p><p>   }</p><p>   return groupRecord.sys_id;</p><p>   }</p><p>   groupRecord.initialize();</p><p>   groupRecord.name = gr.name;</p><p>   groupRecord.manager = gr.supported_by;</p><p>   groupRecord.group_email = userRecord.email;</p><p>   var group_sys_id = groupRecord.insert();</p><p>   if (group_sys_id != null) {</p><p>   gs.log("Created new group: " + group_sys_id);</p><p>   }</p><p>   return group_sys_id;</p><p>}</p>