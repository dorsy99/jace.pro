---
title: "CI Change Reporting"
date: 2014-08-15T14:31:34.000Z
authors: ["mguy"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b30e6e2ddbd0dbc01dcaf3231f96196e"
---
<p>One of the things that I've been asked for many years is 'How can we report on our CI changes?', i.e. a customer wants to know what is changing on their CIs without having to look at each one individually or create a list of updated CIs and then trawl through that, or trawl through sys_audit which as we know is not recommended.</p><p></p><p>So I decided to have a look into this and see whether we can use 'History' sys_history_line as a way of reporting those changes, it also looks much better than sys_audit as well to be honest.</p><p></p><p>History is a rotated table and normally those sys_history_lines are generated on the fly, meaning this table doesn't become another sys_audit, records are created on-demand dropped off after a set period of time.</p><p></p><p>So I created a scheduled job to generate History Sets for any CI updated in the last 24 hours and then created a report to query those History lines and voila, we have CI Change reporting... steps below</p><p></p><p><strong>Step 1</strong>- update the <strong>sys_property 'glide'ui.permitted_tables'</strong> to <strong>INCLUDE</strong> sys_history_line, now this property controls which sys_ tables are reportable, i.e. you can see them as selectable tables in the table drop-down for reporting. (add a 'report_on' ACL if you wish this table to be reportable for anyone else but admin).</p><p></p><p><strong>Step 2-</strong> create a report on History 'sys_history_line' as per screenshot below:</p><p></p><p><img  alt="Report.png" class="image-1 jive-image" src="500ceb35db9893049c9ffb651f961973.iix" style="height: 269px; width: 620px;"/></p><p>Now this report will initially be empty even if you've just gone and updated a few CIs thinking cool, I will see my updates straight away, but remember the beauty of sys_history_line is that it's generated on-demand, normally when someone goes and looks at history, so now we need to run a little script before we schedule this report to simulate that for the updated CIs...</p><p></p><p><strong>Step 3 -</strong> Create a scheduled report from your report record and add some code in the condition script to a)check we have had some updates and b)to make it generate those history lines we need before actually sending the report empty <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_macro jive_emote" src="/6.0.3.0/images/emoticons/happy.png"></span></p><p></p><p><img  alt="Scheduled Report.png" class="jive-image image-2 jiveImage" src="a910950edb181b04ed6af3231f961980.iix"/></p><p></p><p>The code in that condition to save you some time:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14080944651567039" jivemacro_uid="_14080944651567039">
<p>answer = false;</p>
<p>var cis = new GlideRecord('cmdb_ci');</p>
<p>cis.addEncodedQuery('sys_updated_onRELATIVEGE@hour@ago@24');</p>
<p>cis.query();</p>
<p>if (cis.hasNext()){</p>
<p>   answer = true;</p>
<p>while (cis.next()){</p>
<p>   var hs = new GlideHistorySet(cis); </p>
<p>var sys_id = hs.generate();</p>
<p>}</p>
<p>}</p>
</pre><p></p><p>So now we have our report, plus the scheduling piece to generate the history lines, I can decide whom gets it, subject, intro, how I want my attachments and hit 'Execute Now'</p><p></p><p>And here is the report in PDF</p><p></p><p><img  alt="Finished Report.png" class="jive-image image-3" src="cefae482db18d704ed6af3231f961924.iix" style="height: 296px; width: 620px;"/></p><p></p><p>Disclaimer here now <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_macro jive_emote" src="/6.0.3.0/images/emoticons/happy.png"></span>   if you have masses and masses of CI changes, you may want to run this on specific tables only, or spread out the period of time, I guess it's horses for courses though, or if you only want to capture manual changes, filter out the discovery username in the sys_history or in the scheduled job to find updated record.</p><p></p><p>Any questions please feel free to comment below.</p><p></p><p>Marc</p>