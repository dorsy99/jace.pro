---
title: "Making Bulk Analytic Changes with Scripting"
date: 2018-01-05T04:35:58.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=5bdd6ae9dbd0dbc01dcaf3231f961997"
---
<pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="22_8_1192_64"><p>The discussion below is intended for advanced Performance Analytics users who have 6 or months experience with Performance Analytics and the same or more experience with the ServiceNow Platform.   The advanced topics covered assume that you understand the basics of Performance Analytics and have a working knowledge of JavaScript.</p></pre><p></p><p>There comes a time in every Analytics Administrator's life when they are faced with making some big changes to your configuration.   The UI works great for configuring indicators or reports one at a time, but what do you do if you have to make hundreds or thousands of changes in a short amount of time?   Let's look at some ways to save time when administering Performance Analytics.</p><p></p><p>One huge advantage of Performance Analytics is being part of the NOW Platform.   That lets us use <a title="ocs.servicenow.com/bundle/kingston-servicenow-platform/page/script/topic/c_Script.html" href="https://docs.servicenow.com/bundle/kingston-servicenow-platform/page/script/topic/c_Script.html">the same scripting</a> we use elsewhere in the instance to make bulk changes to your analytics configuration.   This can save you time as well as reducing the chances of missing a piece of the configuration.</p><p></p><h1>Where to Run a Script</h1><p>Before we begin, let's discuss where the best place to run a script is.   There are a few options each with different pros and cons.   Be sure to discuss your plans with your System Administrator to ensure you use an option that conforms to your organization's system controls.</p><p></p><h3></h3><h3>Run a Background Script</h3><p>If you have admin access to your instance, you can run a script directly on your instance.   This is very quick to complete, but one typo can cause you lots of headaches.   [<a title="ocs.servicenow.com/bundle/kingston-servicenow-platform/page/script/server-scripting/concept/c_ScriptsBackground.html" href="https://docs.servicenow.com/bundle/kingston-servicenow-platform/page/script/server-scripting/concept/c_ScriptsBackground.html">Here is some more information on the Script - Background module</a>]</p><p></p><h3>Run a Fix Script</h3><p>A safe option to background scripts is a fix script.   This can run the same scripts that you can run as a background script, but it is saved in an update set and is easily rerun.   This also has the benefit of allowing you to write your script in a sub-prod environment in an update set then moving the update set (with the fix script included) to a different instance to test and then finally moving it to production.   [<a title="ocs.servicenow.com/bundle/kingston-application-development/page/build/applications/concept/c_FixScripts.html" href="https://docs.servicenow.com/bundle/kingston-application-development/page/build/applications/concept/c_FixScripts.html">Here is some additional documentation on Fix Scripts</a>]</p><p></p><h3>Run a Background Script with an Update Set</h3><p>Since most analytics objects are captured in update sets when you make changes to them, you can run a script to make all your changes in a sub-prod and capture the changes in an update set.   The update set only contains the analytic object changes and does not contain the script that created/modified them.   This is the safest option but may miss things depending on how old the clone is.</p><h3></h3><p></p><h3>Which is Best?</h3><p>While there are use cases for each of these options, I generally prefer to use a Fix Script as this goes through all the appropriate change controls but still ensure we configure all objects in the instance and can't fall victim to a stale clone.</p><h1></h1><p></p><h1>What Can I Script?</h1><p>In ServiceNow, you can script just about anything, but let's walk through a few examples of things that you might want to do in bulk in the Analytics Space.   These are just quick examples and should always be tested in your environment prior to executing them in a production environment.   No guarantee is made that these will work in your environment.</p><pre __default_attr="warning" __jive_macro_name="alert" alert="warning" class="jive_text_macro jive_macro_alert" data-renderedposition="933_8_1192_65" modifiedtitle="true"><p>Before executing <strong>any</strong> script you should thoroughly test it in your environment.   Scripts are very powerful and you must ensure that you understand what you are running before you run it.   The scripts below are intended for discussion purposes only.</p></pre><h3>Add a Group to a Large Number of Reports</h3><p>In this example, we were splitting one Group ("Group A") into two.   As part of the migration, we needed to add the new group ("Group B")   to all the reports the that "Group A" had access to so everyone retained the access to all the same reports they did today.</p><p></p><p>This script takes advantage of all the permissions being stored in the table "sys_report_users_groups".   While we normally configure permissions with the Report UI, we can make changes using GlideRecord as well.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_15150843111438866" data-renderedposition="1162_8_1192_1056" jivemacro_uid="_15150843111438866"><p>// MODIFY THESE TWO LINES - Set the group name you are matching and the one you are adding</p><p>var origGroup = 'Group A';</p><p>var newGroup = 'Group B';</p><p></p><p>// get the sys_id of the group from the name</p><p>var getGroupID = function (name)</p><p>{</p><p>       // if the name is a 32 character string, assume it is a sys_id</p><p>       if(/^[0-9a-z]{32}$/ig.test(name))</p><p>       {</p><p>               return name;</p><p>       }</p><p>       var gr = new GlideRecord('sys_user_group');</p><p>       gr.addQuery('name', '=', name);</p><p>       gr.query();</p><p>       var groupCount = gr.getRowCount();</p><p>       // if we find one and only one, use it</p><p>       if(groupCount == 1)</p><p>       {</p><p>               gr.next();</p><p>               return gr.getValue('sys_id');</p><p>       } if(gr.getRowCount() == 0) {</p><p>               _log('No group found with the name: ' + name);</p><p>               return false;</p><p>       } else if(gr.getRowCount() &gt; 1) {</p><p>               _log("AHHHHH!!!!!   There is more than one - " + name + " specify the sys_id instead of the name") ;</p><p>               return false;</p><p>       }</p><p>};</p><p></p><p>// add the new group everywhere the origingal group is named</p><p>var copyReportPermissions = function (origGroup, newGroup)</p><p>{</p><p>       var gr = new GlideRecord('sys_report_users_groups');</p><p>       gr.addQuery('group_id', '=', origGroup);</p><p>       gr.query();</p><p>       var groupsFound = parseInt(gr.getRowCount());</p><p>       // loop through the report permission records for this dashboard/group</p><p>       while(gr.next())</p><p>       {</p><p>               // change the group on the record</p><p>               gr.setValue('group_id', newGroup);</p><p>               // insert the record (which makes a copy and does not update the existing record)</p><p>               gr.insert();</p><p>       }</p><p>       // return the number of records added</p><p>       return gr.groupsFound();</p><p>};</p><p></p><p>// logging function so it is easy to change the output</p><p>var _log = function (str)</p><p>{</p><p>       gs.log(str, 'PARPermCopy');</p><p>       //gs.addInfoMessage(str);</p><p>}</p><p></p><p>// translate the names to sys_ids</p><p>var origGroupID = getGroupID(origGroup);</p><p>var newGroupID = getGroupID(newGroup);</p><p>if(origGroupID &amp;&amp; newGroupID)</p><p>{</p><p>       _log("Report Permissions Copied: " + copyReportPermissions(origGroupID, newGroupID));</p><p>} else {</p><p>       _log("One or both groups were not found");</p><p>}</p><p>_log('Done');</p></pre><p></p><p>Dashboard permissions are stored in a very similar (but not identical) table called "pa_dashboards_permissions".   If you needed to make bulk permissions changes to Dashboards, a modified version of the script above may come in handy.</p><p></p><h3></h3><h3>Add an Additional Breakdown to Indicators</h3><p>In this example, we add a new breakdown (Assigned Location) to every indicator that has an existing breakdown (Assigned To).   To change the breakdowns being checked, you just need to modify line 2 &amp; 3 to set the Base Indicator (the one we are copying) and the New Indicator (that one we are adding everywhere the Base Indicator is added).</p><p></p><p>Note: This script assumes that there is only one breakdown with the name you set (Assigned To and Assigned Location in the example).   If this is not the case, you need to manually select the sys_id instead of the name on lines 2 &amp; 3.   If the value in the array is a 32 character alphanumeric string, we assume it is a sys_id.</p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_1515083484130459 jive_macro_code jive_text_macro" data-renderedposition="2455_8_1192_1376" jivemacro_uid="_1515083484130459"><p>// MODIFY THESE TWO LINES - Set the breakdowns you are matching and the one you are adding</p><p>var baseBreakdown = 'Assigned To'; // the existing indicator</p><p>var newBreakdown = 'Assigned Location'; // the new indicator (be sure you have already created it)</p><p></p><p>// get the indicators that have the base indicator but do NOT have the new one </p><p>var getIndicators = function (existingBreakdown, newBreakdown)</p><p>{</p><p>       // get the ones that already have the new one</p><p>       var gr2 = new GlideRecord('pa_indicator_breakdowns');</p><p>       gr2.addQuery('breakdown', '=' , newBreakdown);</p><p>       //gr.setLimit(5);</p><p>       gr2.query();</p><p>       var existingNew = [];</p><p>       while(gr2.next())</p><p>       {</p><p>               existingNew.push(gr2.indicator.toString());</p><p>       }</p><p>       // get the ones that need the new breakdown</p><p>       var gr = new GlideRecord('pa_indicator_breakdowns');</p><p>       gr.addQuery('breakdown', '=' , existingBreakdown);</p><p>       gr.addQuery('indicator', 'NOT IN', existingNew.join(','));</p><p>       gr.query();</p><p>       _log("New Already Exists: " + gr2.getRowCount() + " - Need to Add: " + gr.getRowCount() + " - Query:" + gr.getEncodedQuery());</p><p>       return gr;</p><p>};</p><p></p><p>// insert the new breakdown if it doesn't already exist</p><p>var upsertIndicatorBreakdown = function (indicator, breakdown)</p><p>{</p><p>       // check if the new breakdown is already associated to the indicator</p><p>       var gr = new GlideRecord('pa_indicator_breakdowns');</p><p>       gr.addQuery('indicator', '=', indicator);</p><p>       gr.addQuery('breakdown', '=', breakdown);</p><p>       gr.query();</p><p>       if(gr.hasNext())</p><p>       {</p><p>               // if it is already associated, do nothing</p><p>               _log('already exists: ' + indicator);</p><p>               return;</p><p>       } else {</p><p>               // if not there, add it</p><p>               _log('need to create for indictor breakdown: ' + indicator);</p><p>               var gr = new GlideRecord('pa_indicator_breakdowns');</p><p>               gr.setValue('indicator', indicator);</p><p>               gr.setValue('breakdown', breakdown);</p><p>               gr.insert();</p><p>               return;</p><p>       }</p><p>};</p><p></p><p>// get the sys_id given the name</p><p>var getBreakdown = function (name)</p><p>{</p><p>       // if the name is a 32 character string, assume it is a sys_id</p><p>       if(/^[0-9a-z]{32}$/ig.test(name))</p><p>       {</p><p>               return name;</p><p>       }</p><p>       var gr = new GlideRecord('pa_breakdowns');</p><p>       gr.addQuery('name', '=' , name);</p><p>       gr.query(); </p><p>       // if you have a duplicate name, we don't know which one so abort (modify the script to set the sys_id manually)</p><p>       if(gr.getRowCount() &gt; 1)</p><p>       {</p><p>               _log("AHHHHH!!!!!   There is more than one - " + name + " specify the sys_id instead of the name") ;</p><p>       }</p><p>       gr.next();</p><p>       // return the sys_id of the breakdown</p><p>       return gr.getValue('sys_id');</p><p>};</p><p></p><p>// logging function so it is easy to change the output</p><p>var _log = function (str)</p><p>{</p><p>       gs.log(str, 'PAAddBreakdown');</p><p>       //gs.addInfoMessage(str);</p><p>}</p><p></p><p>// get the indicators that have the base indicator but do NOT have the new one</p><p>var neededIndicators = getIndicators(getBreakdown(baseBreakdown), getBreakdown(newBreakdown));</p><p>_log(neededIndicators.getRowCount() + " indicators that need to have " + newBreakdown + " added")</p><p>while(neededIndicators.next())</p><p>{</p><p>       upsertIndicatorBreakdown(neededIndicators.getValue('indicator'), newIndicator);</p><p>}</p><p>_log("Done");</p></pre><p></p><p></p><h3>Add Breakdown Exclusion Everywhere Breakdowns Exist</h3><p>In this example, we are adding a breakdown exclusion for "Assigned To" and "Assigned Location" to every indicator that has both of these breakdowns.   To change the breakdowns being checked, you just need to modify line 2 (the values in the "levels" array).</p><p></p><p>Note: This script assumes that there is only one breakdown with the name you set (Assigned To and Assigned Location in the example).   If this is not the case, you need to manually select the sys_id instead of the name on line 2.   If the value in the array is a 32 character alphanumeric string, we assume it is a sys_id.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_15149998067601004 jive_macro_code jive_text_macro" data-renderedposition="4023_8_1192_1728" jivemacro_uid="_15149998067601004"><p>// MODIFY THIS - Which breakdowns are we checking for needed exclusions?</p><p>var levels = ['Assigned To', 'Assigned Location'];</p><p></p><p>// Get all indicators with both breakdowns</p><p>var getIndicators = function (level1, level2)</p><p>{</p><p>       var gr = new GlideRecord('pa_indicator_breakdowns');</p><p>       gr.addQuery('breakdown', '=' , level1);</p><p>       gr.query();</p><p>       var has1 = [];</p><p>       // create an array with all the indicators with the 1st breakdown</p><p>       while(gr.next())</p><p>       {</p><p>               has1.push(gr.indicator.toString());</p><p>       }</p><p>       // query for indicators that have both the 1st (in list) breakdown and the 2nd breakdown</p><p>       var gr2 = new GlideRecord('pa_indicator_breakdowns');</p><p>       gr2.addQuery('indicator', 'IN', has1)</p><p>       gr2.addQuery('breakdown', '=' , level2);</p><p>       gr2.query();</p><p>       // create an array of the indicators with both breakdowns</p><p>       var hasBoth = [];</p><p>       _log('has level 1: ' + gr.getRowCount() + '   has level 2: ' + gr2.getRowCount());</p><p>       {</p><p>               hasBoth.push(gr2.indicator.toString());</p><p>       }</p><p>       // return the array with indicators with both breakdowns</p><p>       return hasBoth;</p><p>};</p><p></p><p>// check if the breakdown exclusion is already there, if not add it</p><p>var upsertExclusion = function (indicator, breakdown1, breakdown2)</p><p>{</p><p>       // query for the needed exclusion</p><p>       var gr = new GlideRecord('pa_indicator_breakdown_excl');</p><p>       gr.addQuery('indicator', '=', indicator);</p><p>       gr.addQuery('breakdown', '=', breakdown1);</p><p>       gr.addQuery('breakdown_level2', '=', breakdown2);</p><p>       gr.query();</p><p>       </p><p>       if(gr.hasNext())</p><p>       {</p><p>               // it already exists, do nothing</p><p>               _log('already exists: ' + indicator);</p><p>               return;</p><p>       } else {</p><p>               // it doesn't exist, add it</p><p>               _log('need to create for indictor: ' + indicator);</p><p>               var gr = new GlideRecord('pa_indicator_breakdown_excl');</p><p>               gr.setValue('indicator', indicator);</p><p>               gr.setValue('breakdown', breakdown1);</p><p>               gr.setValue('breakdown_level2', breakdown2);</p><p>               gr.insert();</p><p>               return;</p><p>       }</p><p>};</p><p></p><p>// get the sys_id given the name</p><p>var getBreakdown = function (name)</p><p>{</p><p>       // if the name is a 32 character string, assume it is a sys_id</p><p>       if(/^[0-9a-z]{32}$/ig.test(name))</p><p>       {</p><p>               return name;</p><p>       }</p><p>       var gr = new GlideRecord('pa_breakdowns');</p><p>       gr.addQuery('name', '=' , name);</p><p>       gr.query(); </p><p>       // if you have a duplicate name, we don't know which one so abort (modify the script to set the sys_id manually)</p><p>       if(gr.getRowCount() &gt; 1)</p><p>       {</p><p>               _log("AHHHHH!!!!!   There is more than one - " + name + " specify the sys_id instead of the name") ;</p><p>       }</p><p>       gr.next();</p><p>       // return the sys_id of the breakdown</p><p>       return gr.getValue('sys_id');</p><p>};</p><p></p><p></p><p>// logging function so it is easy to change the output</p><p>var _log = function (str)</p><p>{</p><p>       gs.log(str, 'PAAddBreakdownExcl');</p><p>       //gs.addInfoMessage(str);</p><p>}</p><p></p><p>// loop through all the options</p><p>for(var l = 0; l &lt; levels.length; l++)</p><p>{</p><p>       // loop through the list again to get all the permutations</p><p>       for(var l2 = 0; l2 &lt; levels.length; l2++)</p><p>       {</p><p>               // since order does not matter, make sure we only insert the records once</p><p>               if(l &gt;= l2)</p><p>               {</p><p>                       continue;</p><p>               }</p><p>               _log(levels[l] + ': ' + getBreakdown(levels[l]) + ' - ' + levels[l2] + ': ' + getBreakdown(levels[l2]));</p><p>               // get the indicators that need to have the exclusion</p><p>               var indicators = getIndicators(getBreakdown(levels[l]), getBreakdown(levels[l2]));</p><p>               for(var i = 0; i &lt; indicators.length; i++)</p><p>               {</p><p>                       // Insert the exclusion if it is missing</p><p>                       upsertExclusion(indicators[i], getBreakdown(levels[l]), getBreakdown(levels[l2]));</p><p>               }</p><p>       }</p><p>}</p><p>_log('Done');</p></pre><p></p><p>This may be useful to run on combinations that are never looked at.   For instance, Assigned to/Priority.   Do we trend the priority by the person working on it? If we do, leave it, but if not, use this script to quickly exclude it.</p><p></p><h1>Conclusion</h1><p>Hopefully, these examples give you enough to get started with Scripting for Analytics.   There is no reason to spend hours clicking on things when you have the Power of the NOW Platform at your fingertips.</p>