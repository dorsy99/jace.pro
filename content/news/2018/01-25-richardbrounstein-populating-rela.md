---
title: "Populating Related CIs into the ServiceNow CMDB"
date: 2018-01-25T04:09:56.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f69d6e69dbd0dbc01dcaf3231f9619cb"
---
<p>There are many ways to populate the tables of the ServiceNow Configuration Management Database. Discovery, Service Mapping, REST API, JavaScript and external integrations are a few techniques that quickly come to mind.   While ServiceNow Discovery and Service Mapping are the preferred ServiceNow methods to populate the CMDB, they are not the only methods.   For various reasons, users may need to populate the CMDB from a custom external data source and they wish to populate it automatically. Fortunately, ServiceNow provides the facilities to do this.   In this document, I want to describe the population methods of inserting multiple related CIs with an internal script and the Rest API.   Before we get into that, it is important to review the CMDB Identification and Reconciliation Application.</p><p style="margin-top: 6pt; margin-bottom: 6pt;"><span style="font-size: 14.0pt;"><strong>QUICK REVIEW OF THE CMDB IDENTIFICATION AND RECONCILIATION APPLICATION</strong></span></p><p style="margin-bottom: 12.0pt;">When pushing configuration item data into the CMDB, it is important to leverage the built-in Identification and Reconciliation application.   This provides a centralized framework for uniquely identifying CIs and will maintain the CMDB integrity when different data sources or different insertion methods are used to create or update CIs.</p><p style="margin-bottom: 12.0pt;">This application will prevent duplicate configuration items from being inserted into the CMDB because it uniquely identifies the CIs based on one or more attributes that can be configured for each CI.   Without this, any program that looks to insert/update a CI must first query the CI to see if it already exists in the database.   If it does then the existing record can be updated and if not, then a new record can be inserted.   Since the Geneva release, the CDMB Identification engine has a slick user interface that allows for a configurable set of attributes that can be used to uniquely identify any configuration items.   This allows you to push CI data without having to worry about if the configuration item already exists.   If the CI is already in the database table, then it will overwrite the data without creating a duplicate.   More than that, the mechanism also automatically searches for any duplicates that might already exist for that CI class and will mark them as duplicates and they will show up on the CMDB Health Dashboard.</p><p><img   class="image-1 jive-image" height="419" src="c0c50586db9897041dcaf3231f9619ff.iix" style="max-width: 1200px; max-height: 900px; width: 767px; height: 419.293px;" width="767"/></p><p></p><p><span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;">As for reconciliation, each CI in the cmdb_ci tables and extended tables has a field called <em>discovery_source</em></span><span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;">.   This source of discovery is used to reconcile fields being inserted into CIs in the CMDB from one source with fields from another source.   In the Reconciliation Definition section of ServiceNow, users can specify which fields are allowed to be written to specific CI classes and which discovery source has greater precedence.   The reconciliation mechanism will enforce the rules and will prevent writing data to a CI if it is not allowed by a rule set by the administrator.</span></p><p><img   class="image-2 jive-image" src="b44368cadb90d704ed6af3231f9619a4.iix" style="max-width: 1200px; max-height: 900px;"/><img   class="image-3 jive-image" height="245" src="b8228802db985fc03eb27a9e0f96191f.iix" style="width: 466px; height: 245.026px;" width="466"/></p><p></p><p style="margin-top: 6pt; margin-bottom: 6pt;"><span style="font-size: 14.0pt;"><strong>Inserting CIs with JavaScript Code</strong></span></p><p>   <span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;">With JavaScript coding using JSON payloads, we can insert/update configuration items leveraging the internal ServiceNow function <em>IdentificationEngineScriptableApi.createOrUpdateCI</em>.   This will ensure that any inserts or updates leverage the Identification and Reconciliation Engine. Inserting a single CI instance is simple if the CI can exist independently.   This means that the CI can exist without it being related to anything else.   A Hardware CI, which includes Windows, Unix, and Linux Servers are examples of this. This means I can insert any Hardware CI by itself and don't need any relations. This is configured in the Identification rules by selecting "Independent".</span></p><p><span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;"><img   class="jive-image image-4" height="417" src="4df3e10adb90df048c8ef4621f961946.iix" style="max-width: 1200px; max-height: 900px; width: 1031px; height: 416.696px;" width="1031"/></span></p><p></p><p><span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;"> <span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;">Here is a sample of JavaScript code that inserts an independent CI for a Windows Server.   Since the serial_number is a unique identifier, it is important to specify the serial number in the JSON.   Note that "ServiceNow" is specified as a parameter in the IdentificationEngineScriptableApi call so it is being designated as the <em>discovery_source</em>:</span></span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_15168312374473351 jive_macro_code jive_text_macro" data-renderedposition="2486.984375_8_1192_304" jivemacro_uid="_15168312374473351"><p></p><p></p><p>var server_name="Test 123";</p><p>var payload = {</p><p>   "items": [{</p><p>       "className": 'cmdb_ci_win_server',</p><p>       "values": </p><p>           {</p><p>           "name": "Windows " + server_name,</p><p>           "serial_number": '12345678',</p><p>           "ram": "4096",</p><p>           "os": "Windows 2016 Datacenter"</p><p>           }</p><p>       }]</p><p>       }</p><p>var jsonUtil = new JSON();</p><p>var input = jsonUtil.encode(payload);</p><p>var output = SNC.IdentificationEngineScriptableApi.createOrUpdateCI ('ServiceNow', input);</p><p>gs.print (output);</p></pre><p></p><p style="margin-bottom: 12.0pt;">But what if you want to insert a CI that is not independent.   For example, an Oracle Database Instance CI class has a metadata relationship hosting rule.     This means it cannot be inserted without also inserting/specifying the Hardware on which it runs.   The required relationship must be a "Runs on" relationship. An Oracle Database Catalog cannot be inserted without also inserting /specifying the Oracle Instance on which it runs and that required relationship is a "Contains" relationship.</p><p style="margin-bottom: 12.0pt;">The identification rules and the hosting relationships can be found in the CI Class Manager.   In Kingston, there is a "Relationships" menu option when editing a CI.   In prior releases, the containment rules are located in a tab called "MetaData" on the CI Identifiers.</p><p style="margin-bottom: 12.0pt;">Jakarta version and older showing the allowed relationships for an Oracle Database:</p><p><img   class="image-5 jive-image" height="578" src="f0c54dcadb90130468c1fb651f961995.iix" style="max-width: 1200px; max-height: 900px; width: 1022px; height: 578.282px;" width="1022"/></p><p></p><p style="margin-bottom: 12.0pt;">In Kingston, the UI changed to reflect the Hosting relationship requirements required for an Oracle Database:</p><p></p><p><img   class="image-6 jive-image" height="433" src="f1b0e44adb9c1f048c8ef4621f9619a5.iix" style="max-width: 1200px; max-height: 900px; height: 433px; width: 1016.83px;" width="1017"/></p><p></p><p><img   class="image-7 jive-image" src="dbbe7bb9dbd45fc03eb27a9e0f961969.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p></p><p style="margin-bottom: 12.0pt;">Here is a sample of JavaScript code that inserts an Oracle Database Catalog contained on an Oracle Database Instance running on a Windows Server:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15168313917608850 jive_text_macro" data-renderedposition="4888.265625_8_1192_768" jivemacro_uid="_15168313917608850"><p>var db_name="Test 123";</p><p>var payload = {</p><p>"items": [{</p><p>   "className": 'cmdb_ci_db_ora_instance',</p><p>   "values": </p><p>       {</p><p>       "name": "Oracle DB " + db_name,</p><p>       "sid": 'ABCD1234'</p><p>       }</p><p>   },</p><p>   {</p><p>   "className": 'cmdb_ci_win_server',</p><p>   "values": </p><p>       {</p><p>       "name": 'Win Server 100',</p><p>       "serial_number": "12345678",</p><p>               "ip_address":"10.20.30.40",   </p><p>               "mac_address":"ABCD1234",   </p><p>               "ram":"4096",</p><p>               "os": "Windows 2016 Datacenter"</p><p>       }</p><p>   },</p><p>   {</p><p>   "className": 'cmdb_ci_db_ora_catalog',</p><p>   "values": </p><p>       {</p><p>       "name": 'Catalog test',</p><p>       "schema": 'test schema'</p><p>       }</p><p>   }     </p><p>],</p><p>"relations": </p><p>[</p><p>       {</p><p>"child":1,</p><p>"parent":0,</p><p>"type":"Runs on::Runs"</p><p>       },</p><p>       {   </p><p>               "child":2,   </p><p>               "parent":0,   </p><p>               "type":"Contains::Contained by"   </p><p>               }</p><p>]};</p><p>var jsonUtil = new JSON();</p><p>var input = jsonUtil.encode(payload);</p><p>var output = SNC.IdentificationEngineScriptableApi.createOrUpdateCI ( 'ServiceNow', input);</p><p>gs.print (output);</p></pre><p></p><p style="margin-top: 6pt; margin-bottom: 6pt;"><span style="font-size: 14.0pt;"><strong>Inserting CIs using the Rest API</strong></span></p><p style="margin-bottom: 12.0pt;">Starting in Kingston, ServiceNow released a new web services Rest API so that configuration items can be inserted into the CMDB leveraging the Identification and Reconciliation Engine.   It will insert or update a CI based on the attributes inserted with the necessary relationships if the CI is dependent on another CI in order to be inserted.</p><p style="margin-bottom: 12.0pt;">Here is an example of how to use it. If we follow the example we used with JavaScript where we wanted to create a Windows Server running an Oracle Database Instance that contained an Oracle Database, we would need 3 API calls. The Rest API will only insert one CI at a time and the sys_id of the related CI must be specified at the time of insert.   This can be accomplished by parsing out the sys_id.</p><p style="margin-bottom: 12.0pt;">Now, we can put together the web service calls.   I prefer Google Chrome Postman as an excellent application to simulate web service calls before you code them into an application.</p><p style="margin-bottom: 12.0pt;"><strong>1<sup>st</sup> Web Service Call: </strong>CREATE/UPDATE THE WINDOWS SERVER CI with "ServiceNow" as the <em>discovery_source</em>:</p><p></p><p><span style="font-size: 8.0pt;">POST: </span><span style="font-size: 9.0pt; font-family: 'Helvetica',sans-serif; color: #505050; background: #FAFAFA;"><a title="" _jive_internal="true" href="https://" rel="nofollow" target="_blank">https://</a><span>&lt;SN_INSTANCE&gt;.service-now.com/api/now/cmdb/instance/</span><span style="background: yellow;">cmdb_ci_win_server</span></span></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15168315574817018 jive_text_macro" data-renderedposition="5972.265625_8_1192_176" jivemacro_uid="_15168315574817018"><p><span style="font-size: 8.0pt;">{</span></p><p><span style="font-size: 8.0pt;">                                   "attributes": {</span></p><p><span style="font-size: 8.0pt;">                                                                       "name": "Windows Server Test",</span></p><p><span style="font-size: 8.0pt;">                                                                       "ram": "8192",</span></p><p><span style="font-size: 8.0pt;">                                                                       "ip_address": "192.165.1.123",</span></p><p><span style="font-size: 8.0pt;">                                                                       "serial_number" : "abc123",</span></p><p><span style="font-size: 8.0pt;">                                                                       "disk_space" : "4096",</span></p><p><span style="font-size: 8.0pt;">                                                                       "os" : "Windows"</span></p><p><span style="font-size: 8.0pt;">                                   },</span></p><p><span style="font-size: 8.0pt;">                                   "source": "ServiceNow"</span></p><p><span style="font-size: 8.0pt;">}</span></p></pre><p></p><p>In the Return Payload:</p><p></p><p><span style="font-size: 8.0pt;">                 "virtual": "false",</span></p><p><span style="font-size: 8.0pt;">                       "assignment_group": "",</span></p><p><span style="font-size: 8.0pt;">                       "sys_id": "<span style="background: aqua;">78c63ce94f23cb4028b4e4928110c7b5</span>",</span></p><p><span style="font-size: 8.0pt;">                       "po_number": "",</span></p><p><span style="font-size: 8.0pt;">                       "checked_in": "",</span></p><p></p><p></p><p style="margin-bottom: 12.0pt;"><strong>2<sup>nd</sup> Web Service Call: </strong>CREATE AN ORACLE DATABASE INSTANCE (note the sys_id in the target)</p><p style="margin-bottom: 12.0pt;">From the cmdb_rel_type table, we also needed to retrieve the sys_id of the "Runs on::Runs" relationship so it can be specified in the payload of the API call.   This can be retrieved manually by right-mouse clicking on the record in the cmdb_rel_type table and selecting "Copy sys_id" to copy it into the clipboard.   The sys_id of the "Runs on" relationship is <span style="background: lime;">60bc4e22c0a8010e01f074cbe6bd73c3</span></p><p style="margin-bottom: 12.0pt;"><img   class="jive-image image-8" src="02e165c6db9c13043eb27a9e0f961943.iix" style="max-width: 1200px; max-height: 900px;"/></p><p style="margin-bottom: 12.0pt;">Now we can insert the Oracle DB instance specifying that it has a "Runs on" relationship to the Windows Server we previously inserted.   Note that we specify "outbound_relations" because there is a parent/child relationship between the Oracle DB instance and the Windows Server with the Oracle DB instance being the parent:</p><p><span style="font-size: 8.0pt;">POST:</span> <span style="font-size: 9.0pt; font-family: 'Helvetica',sans-serif; color: #505050; background: #FAFAFA;"><a title="" _jive_internal="true" href="https://" rel="nofollow" target="_blank">https://</a><span>&lt;SN_INSTANCE&gt;.service-now.com/api/now/cmdb/instance/</span><span style="background: yellow;">cmdb_ci_db_ora_instance</span></span></p><p></p><p><span style="font-size: 8.0pt;">{</span></p><p><span style="font-size: 8.0pt;">                                   "attributes":{</span></p><p><span style="font-size: 8.0pt;">                                                                       "name": "Oracle DB Instance",</span></p><p><span style="font-size: 8.0pt;">                                                                       "version": "11.1.2.56",</span></p><p><span style="font-size: 8.0pt;">                                                                       "sid": "ORA_Rich"</span></p><p><span style="font-size: 8.0pt;">                                                                       },</span></p><p><span style="font-size: 8.0pt;">                                   "source": "ServiceNow",</span></p><p><span style="font-size: 8.0pt;">                                   "depends_on": {</span></p><p><span style="font-size: 8.0pt;">                                   "outbound_relations":   {</span></p><p><span style="font-size: 8.0pt;">                                                                                                           "type": "<span style="background: lime;">60bc4e22c0a8010e01f074cbe6bd73c3</span>",</span></p><p><span style="font-size: 8.0pt;">                                                                                                           "sys_class_name": "cmdb_ci_win_server",</span></p><p><span style="font-size: 8.0pt;">                                                                                                           "target": "<span style="background: aqua;">78c63ce94f23cb4028b4e4928110c7b5</span>"</span></p><p><span style="font-size: 8.0pt;">                                                   } </span></p><p><span style="font-size: 8.0pt;">       }   </span></p><p><span style="font-size: 8.0pt;">}</span></p><p></p><p></p><p>In the Return Payload we have the sys_id of the newly inserted Oracle DB instance:</p><p><span style="font-size: 8.0pt;">                   "sid": "ORA_Rich",</span></p><p><span style="font-size: 8.0pt;">                       "manufacturer": "",</span></p><p><span style="font-size: 8.0pt;">                       "sys_id": "<span style="background: red;">a577f8654fa3cb4028b4e4928110c7a9</span>",</span></p><p><span style="font-size: 8.0pt;">                       "po_number": "",</span></p><p style="margin-bottom: 12.0pt;"><strong>3<sup>rd</sup> Web Service Call: </strong>CREATE AN ORACLE DATABASE CATALOG THAT RUNS ON THE ORACLE DB INSTANCE</p><p>Note the target sys_id of: <span style="background: red;">a577f8654fa3cb4028b4e4928110c7a9</span></p><p>   <span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;">From the cmdb_rel_type table, we need to get the sys_id of the required "Contains::Contained by" relationship: <span style="background: lime;">55c95bf6c0a8010e0118ec7056ebc54d</span>. Note that we specify "inbound_relations" because there is a parent/child relationship between the Oracle DB instance and the Oracle DB catalog with the Oracle DB catalog being the child:</span></p><p><span style="font-size: 12.0pt; font-family: 'Times New Roman',serif;"><img   class="image-9 jive-image" height="505" src="91518942db50130468c1fb651f9619d5.iix" style="max-width: 1200px; max-height: 900px; height: 505px; width: 1111.93px;" width="1112"/></span></p><p></p><p></p><p><span style="font-size: 8.0pt;">POST:</span> <span style="font-size: 9.0pt; font-family: 'Helvetica',sans-serif; color: #505050; background: #FAFAFA;"><a title="" _jive_internal="true" href="https://" rel="nofollow" target="_blank">https://</a><span>&lt;SN_INSTANCE&gt;.service-now.com/api/now/cmdb/instance/</span><span style="background: yellow;">cmdb_ci_db_ora_catalog</span></span></p><p><span style="font-size: 8.0pt;">{</span></p><p><span style="font-size: 8.0pt;">                                   "attributes":{</span></p><p><span style="font-size: 8.0pt;">                                                                       "schema": "Ora Schema",</span></p><p><span style="font-size: 8.0pt;">                                                                       "name": "Ora Schema"</span></p><p><span style="font-size: 8.0pt;">                                                                       },</span></p><p><span style="font-size: 8.0pt;">                                   "source": "ServiceNow",</span></p><p><span style="font-size: 8.0pt;">                                   "depends_on": {</span></p><p><span style="font-size: 8.0pt;">                                   "inbound_relations":   {</span></p><p><span style="font-size: 8.0pt;">                                                                                                           "type": "<span style="background: lime;">55c95bf6c0a8010e0118ec7056ebc54d</span>",</span></p><p><span style="font-size: 8.0pt;">                                                                                                           "sys_class_name": "cmdb_ci_db_ora_instance",</span></p><p><span style="font-size: 8.0pt;">                                                                                                           "target": "<span style="background: red;">a577f8654fa3cb4028b4e4928110c7a9</span>"</span></p><p><span style="font-size: 8.0pt;">                                                   } </span></p><p><span style="font-size: 8.0pt;">       }   </span></p><p><span style="font-size: 8.0pt;">}</span></p><p></p><p style="margin-bottom: 12.0pt;">That's it!   You now have 3 CIs in a complex relationship.   The calls can be run as often as you wish with different data and they will be identified as the same CIs and updated so duplicates are not created.</p><p><img   class="jive-image image-10" src="5f8d948adbdc17049c9ffb651f9619ec.iix" style="max-width: 1200px; max-height: 900px;"/></p>