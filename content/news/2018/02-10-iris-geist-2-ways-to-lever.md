---
title: " Ways to Leverage Scripting in Email Client Templates"
date: 2018-02-09T21:39:03.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=783d2ae5dbd0dbc01dcaf3231f9619f5"
---
<p>Have you worked with <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/notification/task/t_CreateAnEmailClientTemplate.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/notification/task/t_CreateAnEmailClientTemplate.html">email client templates</a><span style="color: #eb7a3d;"> </span>before to not have to enter the same information again and again? I recently had two requests related to them, and I wanted to share what I have found. Email client templates help you to create default mail content for a specific table (the incident table, for example) that will be used when a user clicks on the mail icon in the record header. Scripts make this an even better solution, since you can create dynamic content in your email template.</p><p></p><h2>Determine the recipient through record fields without scripting</h2><p>You can use the field names in the TO or CC fields of the email client template. For example:</p><p>TO: caller_id,watch_list</p><p>CC: sys_created_by</p><p></p><h1>How to use scripting in email client templates</h1><p>Say, for example, that you want to send an email to the Helpdesk manager in addition to the caller and watch list when a P1 incident is opened, but for all other priorities, you just want to email the caller and the watch list. How would you do this?</p><p></p><p><img   class="image-2 jive-image" height="240" src="514665c2db501744e9737a9e0f961972.iix" style="max-width: 1200px; max-height: 900px; width: 1052px; height: 240.207px; display: block; margin-left: auto; margin-right: auto;" width="1052"/></p><p></p><h2>Send an email to the Helpdesk Manager <em>only</em> when a high priority incident is opened</h2><p>You can use (server side) java script in email client templates. This is accomplished by starting the To: field content with "javascript:"</p><p></p><p>This code was tested and works in the To: field:</p><pre __default_attr="warning" __jive_macro_name="alert" alert="warning" class="jive_text_macro jive_macro_alert" data-renderedposition="697.203125_8_1113_43"><p>A weakness of the following script: hardcoded email addresses in the watch list will not work.</p></pre><pre __default_attr="java" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15181452577204414 jive_text_macro" data-renderedposition="754.203125_8_1113_256" jivemacro_uid="_15181452577204414"><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">javascript:</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">var watchlist_email="";</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">if (current.priority==1) {</span></p><p style="font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 14.6667px;"><span>watchlist_email="</span><a title="k-email-small" class="jive-link-email-small" href="mailto:helpdeskmanager@mycompany.com">helpdeskmanager@mycompany.com</a><span>;";</span><br/></span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">}</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">var watcher=new GlideRecord("sys_user");</span></p><p><span style="font-size: 11pt;">watcher.addEncodedQuery("sys_idIN" + current.watch_list.toString());</span></p><p><span style="font-size: 11pt;">watcher.query();</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">var watchlist_email=watchlist_email + current.caller_id.email + ";";</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">while (watcher.next()) {</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">watchlist_email=watchlist_email + watcher.email + ";";</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">}</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">watchlist_email=watchlist_email;</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">recipients=watchlist_email;</span></p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"><span style="font-size: 11pt;">}</span></p></pre><p></p><p>At this time, simple scripts like the one above can be used. But complex scripts, such as scripts that can include both user names and hard-coded emails for a watchlist, need further consideration.</p><p style="font-size: 12pt; font-family: Calibri, sans-serif; color: #000000;"></p><p>While testing, we found two limitations:</p><ol><li>You cannot put the same users into TO and CC, so if you want to run two scripts on these two fields, make sure they get different results.</li><li>You cannot have html-type characters in your script, it will not render properly in the email client. We found this to be an issue with comma, less than, and greater than.</li></ol><p></p><h2>Create a complex script to determine email recipients</h2><p>The workaround for the second limitation is to create a script include and call the script include in the TO or CC field.</p><p></p><p>Sample <strong>script include</strong> (named TemplateRecipientBuilder)</p><p></p><pre __default_attr="html" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_15181454183485790" data-renderedposition="1304.59375_8_1113_560" jivemacro_uid="_15181454183485790"><p>var TemplateRecipientBuilder = Class.create();</p><p>TemplateRecipientBuilder.prototype = {</p><p>initialize: function() {</p><p>},</p><p></p><p></p><p>build: function() {</p><p>if (current.short_description.startsWith("test")) {</p><p><span>return "</span><a title="k-email-small" class="jive-link-email-small" href="mailto:testemail@somwhere.net">testemail@somwhere.net</a><span>"; </span></p><p>}</p><p>else {</p><p>var watcher=new GlideRecord("sys_user");</p><p>watcher.addEncodedQuery("sys_idIN" + current.watch_list.toString());</p><p>watcher.query();</p><p>var watchlist_email="";</p><p>while (watcher.next()) {</p><p>watchlist_email=watchlist_email + watcher.email + ",";</p><p>}</p><p>watchlist_email=watchlist_email + current.caller_id.email;</p><p></p><p></p><p>var watchlist_str=current.watch_list.toString();</p><p>var watchlist=watchlist_str.split(",");</p><p>for (j=0;j &lt; watchlist.length;j++) {</p><p>if (watchlist[j].indexOf("@")&gt;0) {</p><p>watchlist_email = watchlist_email + "," + watchlist[j];</p><p>}</p><p>}</p><p>}</p><p>return watchlist_email;</p><p>},</p><p></p><p></p><p>type: 'TemplateRecipientBuilder'</p><p>};</p></pre><p></p><p>This script include is then called from either TO or CC in the <strong>email client template</strong> as follows:</p><p>javascript: new TemplateRecipientBuilder().build();</p><p></p><p>If you are not using the email client templates, using scripted email client templates will help you promote quick, easy, and consistent emails sent from the email client within your current record. You can use simple scripts, or create more complex scripts by using the script include creation highlighted in this article.</p>