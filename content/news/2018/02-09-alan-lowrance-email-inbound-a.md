---
title: "Email Inbound Action Example"
date: 2018-02-09T02:23:16.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=17aca625dbd0dbc01dcaf3231f9619a0"
---
<p>Whenever you need to process an incoming email and craft a reply message or create a record from it, you use Inbound Actions.</p><p>The "Order" value of the Inbound Action is like the weight, and the lowest values are processed first.   When conditions are met, the action will run, and if you want the first applicable action to stop processing any further actions, just check the "Stop Processing" box or end the script with: event.state="stop_processing";</p><p>Inbound Actions have certain fields ready to use to make things easier for you such as:</p><p>email.body_text</p><p>email.body_html</p><p>email.from &amp; email.from_sys_id [to get the sysid of the ServiceNow user with that email address]</p><p>email.recipients</p><p>email.body.from &amp; email.body.from_sys_id [to get the sysid of the ServiceNow user with the email address in the from field inside the body, when parsing a reply or forwarded message]</p><p></p><p>One more observation I've made (On Istanbul and earlier at least) is that setting record fields to certain email fields using the "Field actions" builder doesn't always work as intended if you are trying to create and close a record all in one go because it seems to allow business rules to run before or after the script which will give you unintended results so if you don't want business rules to run just do all field setting in the script itself.</p><p></p><p>For this snippet, we'll use the business case that there is an email filter server that is going to be configured to send an email into our ServiceNow instance.   The email it sends contains a clickable link of an email address of a user who has clicked a malicious link in an email and the result was that the link was blocked successfully and we just need to open a Cyber Security categorized incident and close it for record-keeping purposes only.</p><p>We want the Target Table to be Incident</p><p>Action Type is a Record Action</p><p>When to run is on Type: New</p><p>Active and Stop Processing boxes are true</p><p><span>And to restrict it only run on emails From the email filter you can use the From field to point to a user in ServiceNow if it has a user created or in the condition you can put: email.from.toLowerCase() == </span><a title="k-email-small" class="jive-link-email-small" href="mailto:'whatever_server_email@yourcompanydomain.com">'whatever_server_email@yourcompanydomain.com</a><span>'</span></p><p>And the secret sauce of the whole logic is going to be finding an email address/username from a link inside of the email, so it's easiest to look for the HTML flag href=mailto inside of the message (lines 10 &amp; 11)</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15181205834446326 jive_text_macro" data-renderedposition="533_8_1192_256" jivemacro_uid="_15181205834446326"><p>current.short_description = email.subject;</p><p>current.description = email.body_text;</p><p>current.category = 'cyber_security';</p><p>current.assignment_group.setDisplayValue('Systems');</p><p>current.assigned_to = 'whateverServiceAccountYouAutoCloseWith'; //sysid or use setDisplayValue</p><p>current.contact_type = 'automatic'; //a type we added for these kinds of auto-generated tickets</p><p>current.state = '-1'; //our Resolved state</p><p>current.close_code = 'Solved (Permanently)';</p><p>current.close_notes = 'Mimecast detected and blocked the URL';</p><p>var usrname = email.body_html.slice(email.body_html.indexOf('href="mailto:')+13);//slice with one param cuts everything off before it</p><p><span>usrname = usrname.slice(0,usrname.indexOf(</span><a title="k-email-small" class="jive-link-email-small" href="mailto:'@yourcompanydomain.com">'@yourcompanydomain.com</a><span>'));//slice off the domain and everything after so we can match on username</span></p><p>var usrid = new GlideRecord('sys_user');</p><p>usrid.query('user_name',usrname);</p><p>if (usrid.next())</p><p>         current.caller_id = usrid.sys_id;</p><p>current.insert(); //creates the new record</p></pre>