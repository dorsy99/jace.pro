---
title: "A Probing Experience"
date: 2009-05-29T23:14:16.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b05d2629dbd0dbc01dcaf3231f961985"
---
<p><img  alt="" class="jive-image" src="c19f054adb181b04ed6af3231f9619cd.iix" style="width: auto; height: 175px;" />Have you ever wished that Discovery found some information that you want, but that we never thought to put into the product? It's actually quite easy to add most new capabilities to Discovery. In this post, I'll take you through a complete example.<br /><br />Suppose that your organization had a mouse crisis: your human resources folks declared that all users must have one of three ergonomic pointing devices on their computers. So now you need to know just what kind of mice are on all the Windows workstations and laptops. This is not part of the out-of-the-box information that Discovery finds, so how could you add it? Read on and see...<!--break--><br /><br />To get that information, here's what we're going to need to do:<br /><ul><li><b>Determine what information is available</b>: Since we're going to look for mouse information on Windows computers, that means we'll be using WMI to find the information. Therefore we need to do some research into what information WMI has about mice.</li><li><b>Add mouse information to the computer record</b>: The CMDB, out-of-the-box, doesn't have a place for mouse information in the computer record. So we'll add it!</li><li><b>Create a mouse probe</b>: To get the mouse information, the first step is to ask for it. Our new probe will demand the mouse information from a Windows computer.</li><li><b>Create a mouse sensor</b>: Once we have the mouse information, we need to put it into our computer record. Our new sensor will read the mouse information supplied by the probe and use it to update the computer record in the CMDB.</li><li><b>Tell Discovery to use the new probe and sensor</b>: Discovery won't start using our new probe just because we created it. So we'll tell Discovery exactly when to use the new probe.</li><li><b>Run a test Discovery to see if our new probe and sensor work</b>: Always test!</li></ul><br /><br />Microsoft's MSDN site documents the <i><a title="dn.microsoft.com/en-us/library/aa394356(VS.85).aspx" href="http://msdn.microsoft.com/en-us/library/aa394356(VS.85).aspx">Win32_PointingDevice</a></i> WMI class (along with <a title="dn.microsoft.com/en-us/library/aa394554(VS.85).aspx" href="http://msdn.microsoft.com/en-us/library/aa394554(VS.85).aspx">all the other WMI classes</a>). After looking at the Win32_PointingDevice class and thinking about our requirements, we decided we'd look for these pieces of information:<br /><ul><li>Win32_PointingDevice.Name</li><li>Win32_PointingDevice.Manufacturer</li><li>Win32_PointingDevice.DeviceInterface</li><li>Win32_PointingDevice.PointingType</li></ul><br />These are arbitrary choices on our part; we could have chosen any of the information available from WMI.<br /><br /><img  alt="" class="jive-image" src="54cae0c2dbd857041dcaf3231f9619ce.iix" style="width: auto; height: 60px;" />To add the mouse information to the computer record, just navigate to any computer form, personalize the form, and <a title="ki.service-now.com/index.php?title=Adding_Fields" href="http://wiki.service-now.com/index.php?title=Adding_Fields">add the fields</a> you want. The example at right is what our new form looks like. Two of the fields we added have numeric values (as reported by WMI) that correspond to human-readable values (as documented in the <i>Win32_PointingDevice</i> class). We created these new fields as choice lists, entering all the possible numeric values that WMI reports — and then we <a title="ki.service-now.com/index.php?title=Customizing_Choice_List_Options" href="http://wiki.service-now.com/index.php?title=Customizing_Choice_List_Options">customized the labels</a> to show the human-readable values. Perfect!<br /><br /><img  alt="" class="jive-image" src="913c8c42db1417049c9ffb651f961925.iix" style="width: auto; height: 163px;" />Next we added a new probe. This is very straightforward, as you can see in the image at left. Just navigate to <b>Discovery Definitionâ†’Probes</b>, click the "New" button, gave it a name, filled in the WMI class and properties we need to query, and we're done!<br /><br /><img  alt="" class="jive-image" src="636ee335dbd81fc068c1fb651f961955.iix" style="width: auto; height: 102px;" />The sensor is only a bit more challenging (see ours at right). First we navigated to <b>Discovery Definitionâ†’Sensors</b> and clicked the "New" button. Then we gave our brandy-new sensor a name, and (very important!) selected the probe that this sensor should respond to (<i>Windows - Mouse</i>). The most interesting part is the script. The way JavaScript sensors work is quite simple: the <tt>process</tt> (highlighted in green) function gets called for each result returned by the probe. In the case of our probe, it's actually possible to get multiple entries (if the computer has more than one pointing device), but they are returned as multiple entries within a single result. For example, laptops often have a touchpad built in, but might optionally have a USB mouse attached. Such a system will return a single result tag, with two Win32_PointingDevice tags contained within it. We decided to keep things simple with our sensor, and just take the first result, whatever it was. The code highlighted in red does exactly this: it first calls the <tt>g_array_util.ensureArray()</tt> method to convert the result to an array of individual mice, and then takes the first one as the mouse that we will store in the computer record. This logic could easily be modified to (for example) take a mouse over a touchpad. Finally, the code highlighted in blue simply pulls the data out of our selected mouse and stuffs it into the <tt>current</tt> record, which is the CMDB record for the computer being explored. That's it for the sensor...<br /><br /><img  alt="" class="jive-image" src="05cc85cadb5c97041dcaf3231f9619ce.iix" style="width: auto; height: 51px;" />Now we had to tell Discovery that we actually wanted to use the new probe and sensor. First we navigated to <b>Discovery Definitionâ†’Windows</b> (in the <i>Classification</i> section). This showed the list at left. <img  alt="" class="jive-image" src="83a9608edbd457049c9ffb651f961964.iix" style="width: auto; height: 99px;" />Then for each of the entries in that list (except for the <i>Windows Cluster</i> entry), we drilled in and added our new probe to the list (see example at right). We did this by clicking on the "Edit..." button and double clicking on the <i>Windows - Mouse</i> entry on the left (which moves it over to the right). With that, we've now told Discovery to use the new probe and sensor.<br /><br />Finally, we ran a test discovery. In the case of this simple little probe and sensor, it all ran correctly the first time. For most of our Windows CIs, we could see mouse information. In some cases we didn't get any information; these turned out to be servers that truly didn't have any pointing devices attached. One little surprise we got was that many of the CIs (like the example toward the top of this post) reported "Microsoft" as the manufacturer and "PS/2 Mouse" as the name, even when this wasn't true. It turns out these were generic mice that just used the standard out-of-the-box drivers, and they all get reported the same way.<br /><br />In talking with our customers, we've found that the needs people have for additional information are as diverse as our customers are. It's actually quite rare for us to hear two customers asking for the same thing. Some of our customers have already dreamed up some interesting probes and sensors that are proving useful in their environments — and the more success they have, the more ideas they come up with. <br /><br />Now it's your turn! What information would <i>you</i> like Discovery to find?</p>