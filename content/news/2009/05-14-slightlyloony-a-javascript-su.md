---
title: "A JavaScript Subtlety"
date: 2009-05-13T18:54:44.000Z
authors: ["SlightlyLoony"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ac5e2aaddbd0dbc01dcaf3231f961941"
---
<p><img  alt="" class="jive-image" src="f5a3594adbd89f048c8ef4621f9619e9.iix" style="width: auto; height: 184px;" />When you're using GlideRecords in JavaScript, getting properties on the GlideRecord instance may not do exactly what you think they do — and this difference can get you in trouble!<!--break--> For example, consider this little snippet of code:<br /><br /><pre><br />   var map = {};<br />   var gr = new GlideRecord('cmdb_ci_server');<br />   gr.query();<br />   while (gr.next()) {<br />      map[gr.name] = gr.ip_address;<br />   }<br />   for(var name in map) {<br />      gs.log(name + ': ' + map[name]);<br />   }<br /></pre><br /><br />You might reasonably expect this to create a map of server names to their respective IP addresses — but you would be surprised. If you actually run this code, you'll see all the server names, but they'll all have the same IP address. <br /><br />What's going on here?<br /><br />The unexpected results are caused by a subtlety in what "gr.ip_address" actually returns. You might expect that it would return the value of the IP address field, but it does not. Instead, it returns the instance of GlideElement that represents the IP address field — and (here's the key) there are only <i>one</i> of these instances, no matter how many rows there are in the query result. So the map gets built with the <i>same object</i> being assigned to every property. When the code above prints the value of all the properties in the map, it gets the same object back for each property, always with the value of the last row in the query result.<br /><br />You might ask why the "gr.name" appears to work for setting the property names in the map, when the IP address failed so miserably. The answer is that JavaScript expects a string for setting the property name, so it calls the "toString()" method on the GlideElement instance — and that returns the value contained in the name GlideElement <i>at that moment</i>, and so it works. In the case of the IP address GlideElement, there's no requirement to be a string (a property may be assigned any kind of object, after all), so this forced conversion never takes place.<br /><br />Fortunately the cure is very simple:<br /><br /><pre><br />   var map = {};<br />   var gr = new GlideRecord('cmdb_ci_server');<br />   gr.query();<br />   while (gr.next()) {<br />      map[gr.name] = gr.getValue('ip_address');<br />   }<br />   for(var name in map) {<br />      gs.log(name + ': ' + map[name]);<br />   }<br /></pre><br /><br />All we've done is to replace the "gr.ip_address" with "gr.getValue('ip_address')". The gr.getValue() method <i>always</i> returns a string representing the value in the GlideElement at that moment, so we are safe. In fact there are numerous ways to make this code work:<br /><br /><pre><br />   // just replace gr.ip_address with any of these:<br />   gr.getValue('ip_address')<br />   new String(gr.ip_address)<br />   '' + gr.ip_address<br />   gr.ip_address.toString()<br /></pre><br /><br />We prefer the obviousness of the "getValue()" syntax, but in fact all these methods work equally well.</p>