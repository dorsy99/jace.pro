---
title: "GQL Glide Query Language Part  JSAN JavaScript Array Notation"
date: 2016-10-25T18:35:09.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=52fd662ddbd0dbc01dcaf3231f96198b"
---
<p><a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=235e2eaddbd0dbc01dcaf3231f961929">Last time</a>, we worked on the retriever that takes a GQL query and returns the result set. This time, let's take a look at the data format of the result set.</p><p></p><p>For the GQL query below</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="_jivemacro_uid_14768206379022134 jive_macro_code jive_text_macro" data-renderedposition="92_8_998_176" jivemacro_uid="_14768206379022134"><p>SELECT</p><p>   number[Number]</p><p>   , short_description [Title]</p><p>   , dv_state [State]</p><p>   , caller_id.email [Caller Email]</p><p>   , caller_id.manager.email [Manager Email]</p><p>   , dv_cmdb_ci [CI]</p><p>   , cmdb_ci</p><p>FROM incident</p><p>WHERE active=true^priority&lt;2^EQ^ORDERBYpriority^ORDERBYDESCnumber</p><p>LIMIT 5,10</p></pre><p></p><p>the retriever returns the 10 records in JSON shown below (from Incident demo data):</p><p></p><pre style="font-size: 12px; white-space: pre-wrap; background-color: #000; color: #0f0;">{"records":[{"CI":"EXCH-SD-05","Caller Email":"jerrod.bennett@example.com","Manager Email":"","Number":"INC0000050","State":"Active","Title":"Can't access Exchange server - is it down?","cmdb_ci":"281190e3c0a8000b003f593aa3f20ca6"},{"CI":"","Caller Email":"employee@example.com","Manager Email":"","Number":"INC0000031","State":"Active","Title":"When can we get off Remedy? UI is killing us","cmdb_ci":""},{"CI":"IBM-T42-DLG","Caller Email":"don.goodliffe@example.com","Manager Email":"","Number":"INC0000025","State":"Active","Title":"I need more memory","cmdb_ci":"469facd7a9fe1981015830c43428ca2d"},{"CI":"","Caller Email":"taylor.vreeland@example.com","Manager Email":"","Number":"INC0000018","State":"Active","Title":"Sales forecast spreadsheet is READ ONLY","cmdb_ci":""},{"CI":"","Caller Email":"employee@example.com","Manager Email":"","Number":"INC0000017","State":"Awaiting User Info","Title":"How do I create a sub-folder","cmdb_ci":""},{"CI":"","Caller Email":"bow.ruggeri@example.com","Manager Email":"","Number":"INC0000016","State":"Active","Title":"Rain is leaking on main DNS Server","cmdb_ci":""},{"CI":"Saints and Sinners Bingo","Caller Email":"fred.luddy@example.com","Manager Email":"","Number":"INC0000015","State":"Active","Title":"I can't launch my VPN client since the last software update","cmdb_ci":"46c7318aa9fe198100c76003f0bc82e9"},{"CI":"","Caller Email":"employee@example.com","Manager Email":"","Number":"INC0000007","State":"Awaiting User Info","Title":"Need access to sales DB for the West","cmdb_ci":""},{"CI":"","Caller Email":"employee@example.com","Manager Email":"","Number":"INC0000003","State":"Active","Title":"Wireless access is down in my area","cmdb_ci":""},{"CI":"FileServerFloor2","Caller Email":"","Manager Email":"","Number":"INC0000002","State":"Awaiting Problem","Title":"Unable to get to network file shares","cmdb_ci":"b0c25d1bc0a800090168be1bfcdcd759"}]}</pre><p></p><p>There are two things to note in this JSON output:</p><p></p><ol><li>When we get a result set from a SQL query, the columns are ordered. That is, if a SQL statement's SELECT clause lists column_1, column_2, etc., we expect the result set to show those columns in the same order. In the above JSON output, the columns are listed as object properties, which are not ordered by definition in JavaScript.</li><li>I like working with JSON primarily for two reasons: a) its format is native to JavaScript so I can readily work with it in JavaScript; b) it's not as verbose as XML, in most cases. What we see above, however, is verbose because the column headings (object property keys) are repeated for every row. As the row count increases, there will be more redundant information.</li></ol><p></p><p>To address both of these points, I'd like to use JavaScript <strong>arrays</strong>, instead of objects, to represent each row, calling it JSAN (JavaScript Array Notation). This is still based on JSON, but instead of returning object key-value pairs, we'll use an array of values, which may be of any type and are ordered by definition in JavaScript. The column headings will be in its own array, separate from the data records. The savings in bytes, even just for 10 records, is pronounced in the same output below, in JSAN (1,282 vs. 1,909 characters):</p><p></p><pre style="font-size: 12px; white-space: pre-wrap; background-color: #000; color: #0f0;">{"labels":["Number","Title","State","Caller Email","Manager Email","CI","cmdb_ci"], "records":[["INC0000050","Can't access Exchange server - is it down?","Active","jerrod.bennett@example.com","","EXCH-SD-05","281190e3c0a8000b003f593aa3f20ca6"],["INC0000031","When can we get off Remedy? UI is killing us","Active","employee@example.com","","",""],["INC0000025","I need more memory","Active","don.goodliffe@example.com","","IBM-T42-DLG","469facd7a9fe1981015830c43428ca2d"],["INC0000018","Sales forecast spreadsheet is READ ONLY","Active","taylor.vreeland@example.com","","",""],["INC0000017","How do I create a sub-folder","Awaiting User Info","employee@example.com","","",""],["INC0000016","Rain is leaking on main DNS Server","Active","bow.ruggeri@example.com","","",""],["INC0000015","I can't launch my VPN client since the last software update","Active","fred.luddy@example.com","","Saints and Sinners Bingo","46c7318aa9fe198100c76003f0bc82e9"],["INC0000007","Need access to sales DB for the West","Awaiting User Info","employee@example.com","","",""],["INC0000003","Wireless access is down in my area","Active","employee@example.com","","",""],["INC0000002","Unable to get to network file shares","Awaiting Problem","","","FileServerFloor2","b0c25d1bc0a800090168be1bfcdcd759"]]} </pre><p></p><p>JSAN is different than CSV (comma-separated values) in that JSAN is still based on JSON, so no special processing (encoding/decoding) is necessary; we can still use the same JSON encode/decode methods, which are now ubiquitous in both client (<span style="font-family: 'courier new', courier;">JSON.stringify()</span>, <span style="font-family: 'courier new', courier;">JSON.parse()</span>) and server-side ( <span style="font-family: 'courier new', courier;">JSON.encode()</span>, <span style="font-family: 'courier new', courier;">JSON.decode()</span>) JavaScript. JSAN may also contain metadata to provide additional information about the data. For example, we can include not just column headings, but field names as well as data types. Since the data elements (rows and columns) are ordered, it now becomes possible in some cases to generate a hash, such as MD5, or a CRC32 checksum based on the encoded data; this may be useful if an additional layer of data integrity is required, such as for critical systems in life sciences, aerospace, military, or nuclear sectors (this may not work if a column contains unordered data like objects since they can be encoded in any arbitrary order).</p><p></p><p>JSAN would look like this for 2 records of 3 columns (although arrays are 0-based, I'm showing the first column as "column_1" below):</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14773528302387658 jive_text_macro" data-renderedposition="1383.390625_8_998_64" jivemacro_uid="_14773528302387658"><p>{<span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">"fields":["column_1_field","column_2_field","column_3_field"]</span></p><p><span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">,<span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">"labels":["column_1_heading","column_2_heading","column_3_heading"],</span></span></p><p>"records":[["row_1_column_1","row_1_column_2","row_1_column_3"]</p><p>,["row_2_column_1","row_2_column_2","row_2_column_3"]<span style="font-size: 9pt;">]}</span></p></pre><p></p><p>To incorporate this, let's modify the GQL class in the Script Include from last time slightly as below (only the changed sections are shown):</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14773532857821344" data-renderedposition="1510.390625_8_998_368" jivemacro_uid="_14773532857821344"><p>GQL.prototype = {</p><p>   initialize: function(format) {</p><p>       this.format = format || 'JSAN';   // { JSAN | JSON }</p><p>   },</p><p>};</p><p></p><p>GQL.prototype.query = function(gql, format) {</p><p></p><p>   format = format || this.format;</p><p>   var isJSON = /JSON/i.test(format);</p><p></p><p>   return { fields: fields, labels: labels, records: records };</p><p></p><p>   function getRow() {</p><p>       var row = isJSON ? {} : [];</p><p>       for (var i = 0; i &lt; fields.length; i++) {</p><p>           var field = fields[i], isDV = /(^|\.)dv_/.test(field);</p><p>           var value = isDV ? gr.getDisplayValue(field.replace('dv_', '')) || '' : gr.getElement(field).toString();</p><p>           isJSON ? row[labels[i]] = value : row.push(value);   // default to JSAN</p><p>       }</p><p>       return row;</p><p>   }</p><p>};</p></pre><p></p><p>Line 3 allows us to optionally set the default format for the instance at the time of instantiation; if not set, it defaults to JSAN.</p><p></p><p>Line 9 allows us to optionally set the format at the time of calling the <span style="font-family: 'courier new', courier;">query()</span> method; if not set, it defaults to the instance default.</p><p></p><p>Line 12 adds the additional metadata (fields and labels) to the returned data.</p><p></p><p>Line 19 adds to the row either an object key-value pair if JSON or an array element if JSAN.</p><p></p><p><a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=ce2ee66ddbd0dbc01dcaf3231f961990">Next time</a>, we'll look at the processor and see how the returned data from the GQL class are consumed; we'll also see how JSAN makes it easy to encode the result sets into HTML and CSV formats.</p><p></p><p><em>Please feel free to connect, follow, post feedback / questions / comments, share, like, bookmark, endorse.</em></p><p>John Chun, <span style="font-size: 8pt;">PhD PMP</span> <a href="http://linkedin.com/in/DrJohnChun"><img alt="see John's LinkedIn profile" class="image-2 jive-image" src="http://megaicons.net/static/img/icons_sizes/182/456/16/linkedin-icon.png" style="height: auto; vertical-align: -13px;" title="see John's LinkedIn profile"/></a></p><p><a href="http://snowaid.com/"><img alt="visit snowaid" class="image-1 jive-image" src="http://snowaid.com/images/signature.png" style="height: auto; margin-top: -9px;" title="visit snowaid"/></a></p>