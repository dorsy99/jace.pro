---
title: "A simple example of Record Watcher for Service Portal Jakarta and Kingston update"
date: 2016-10-10T08:28:01.000Z
authors: ["Sush"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=12ade2a9dbd0dbc01dcaf3231f96199e"
---
<p>Let's learn today how to use one of the powerful concepts of Service Portal called Record Watcher. This feature allows a widget developer to respond to table updates in real-time.</p><p></p><p>Now let us create a simple widget to keep count of our Critical Incidents to find out how Record Watcher works.</p><p></p><ul><li><span style="font-size: 12pt;"><strong>Step1: Create a widget</strong></span></li></ul><p><span style="font-size: 12pt;"><strong>             </strong> </span><span style="font-weight: inherit; font-style: inherit; font-size: 10pt; font-family: inherit;">Click on widgets under "Service Portal" application menu (or you can also create widgets using widget editor). Create a new widget by clicking on the new button.</span></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 10pt; font-family: inherit;">                   Below is the example widget I have created.</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 10pt; font-family: inherit;"><img   alt="Screen Shot 2016-10-09 at 6.14.24 PM.png" class="image-1 jive-image" height="173" src="8922e08edbdc1f048c8ef4621f96193d.iix" style="height: 173px; width: 879.298px;" width="879"/></span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p><span style="color: #666666; font-size: 12pt; font-family: arial, sans-serif;"><strong>Please use the below snippets to create your widget</strong></span></p><p></p><p><span style="color: #666666; font-size: 12pt; font-family: arial, sans-serif;"><strong>HTML:</strong></span></p><p></p><p><span style="font-family: 'courier new', courier;">&lt;div class="critical-incidents col-md-2"&gt;</span></p><p><span style="font-family: 'courier new', courier;">       &lt;div class="panel panel-default"&gt;</span></p><p><span style="font-family: 'courier new', courier;">               &lt;div class="panel-heading"&gt;Number of Critical Incidents&lt;/div&gt;</span></p><p><span style="font-family: 'courier new', courier;">               &lt;div class="panel-body text-center"&gt;</span></p><p><span style="font-family: 'courier new', courier;">                       &lt;div class="circle-bg" ng-class="{'red-bg' : incidata.changed}"&gt;</span></p><p><span style="font-family: 'courier new', courier;">                               &lt;p class="inci-number"&gt; {{c.data.incidentCount}}&lt;/p&gt;</span></p><p><span style="font-family: 'courier new', courier;">                       &lt;/div&gt;</span></p><p><span style="font-family: 'courier new', courier;">               &lt;/div&gt;</span></p><p><span style="font-family: 'courier new', courier;">       &lt;/div&gt;</span></p><p><span style="font-family: 'courier new', courier;">&lt;/div&gt;</span></p><p><span style="font-family: 'courier new', courier;">&lt;div class="col-md-9 "&gt;</span></p><p><span style="font-family: 'courier new', courier;">   &lt;p class="changed-rec"&gt;Changed Record {{incidata.changedRecord.display_value}}&lt;/p&gt;</span></p><p><span style="font-family: 'courier new', courier;">&lt;/div&gt;</span></p><p></p><p><span style="font-size: 12pt;"><em>ng-class is triggered whenever data changes to change the background to red</em></span></p><p><span style="font-size: 12pt;"><em> We also print the Changed/Inserted record information when the watcher is fired</em></span></p><p></p><p><span style="font-size: 12pt;"><strong>Client Controller: (<span style="color: #e23d39; font-size: 18.6667px;"><em><strong>HELSINKI and ISTANBUL</strong></em></span>)</strong></span></p><p></p><p><span style="font-family: 'courier new', courier;">function(spUtil, $scope, $timeout) {</span></p><p><span style="font-family: 'courier new', courier;">       /* widget controller */</span></p><p><span style="font-family: 'courier new', courier;">       var c = this;</span></p><p><span style="font-family: 'courier new', courier;">       $scope.incidata = {};</span></p><p><span style="font-family: 'courier new', courier;">       $scope.incidata.changed = false;</span></p><p><span style="font-family: 'courier new', courier;">       spUtil.recordWatch($scope, "incident", "priority=1^state!=7", function(name, data) {</span></p><p><span style="font-family: 'courier new', courier;">     </span></p><p><span style="font-family: 'courier new', courier;">       console.log(data);</span></p><p><span style="font-family: 'courier new', courier;">       $scope.incidata.changedRecord = data;</span></p><p><span style="font-family: 'courier new', courier;">               c.server.update();</span></p><p><span style="font-family: 'courier new', courier;">               $timeout(function() {</span></p><p><span style="font-family: 'courier new', courier;">                       $scope.changeBg();</span></p><p><span style="font-family: 'courier new', courier;">               }, 500);</span><span style="font-family: 'courier new', courier;">     </span></p><p><span style="font-family: 'courier new', courier;">       });</span></p><p></p><p><span style="font-family: 'courier new', courier;">       $scope.changeBg = function() {</span></p><p><span style="font-family: 'courier new', courier;">               $scope.incidata.changed = true;</span></p><p><span style="font-family: 'courier new', courier;">               $timeout(function() {</span></p><p><span style="font-family: 'courier new', courier;">                       $scope.incidata.changed = false;</span></p><p><span style="font-family: 'courier new', courier;">               }, 500);</span></p><p><span style="font-family: 'courier new', courier;">       }</span></p><p><span style="font-family: 'courier new', courier;">}</span></p><p></p><p><span style="font-size: 12pt;"><strong>Client Controller: (<span style="color: #e23d39; font-size: 18.6667px;"><em><strong>JAKARTA and KINGSTON</strong></em></span>)</strong></span></p><p></p><p><span style="font-family: 'courier new', courier;">function(spUtil, $scope, $timeout) {</span></p><p><span style="font-family: 'courier new', courier;">       /* widget controller */</span></p><p><span style="font-family: 'courier new', courier;">       var c = this;</span></p><p><span style="font-family: 'courier new', courier;">       $scope.incidata = {};</span></p><p><span style="font-family: 'courier new', courier;">       $scope.incidata.changed = false;</span></p><p><span style="font-family: 'courier new', courier;">       spUtil.recordWatch($scope, "incident", "priority=1^state!=7", function(name, data) {</span></p><p><span style="font-family: 'courier new', courier;">       <span style="font-family: 'courier new', courier;">console.log(data);</span> //<span style="color: #e23d39;">comes back as undefined </span>   </span></p><p><span style="font-family: 'courier new', courier;">       console.log(name); </span></p><p><span style="font-family: 'courier new', courier;">       $scope.incidata.changedRecord = name.data; <span style="font-family: 'courier new', courier;">// <span style="color: #e23d39;">name.data</span> </span><span style="font-family: 'courier new', courier; color: #e23d39;">has the updated or inserted record info</span></span></p><p><span style="font-family: 'courier new', courier;">               c.server.update();</span></p><p><span style="font-family: 'courier new', courier;">               $timeout(function() {</span></p><p><span style="font-family: 'courier new', courier;">                       $scope.changeBg();</span></p><p><span style="font-family: 'courier new', courier;">               }, 500);</span><span style="font-family: 'courier new', courier;">   </span></p><p><span style="font-family: 'courier new', courier;">       });</span></p><p></p><p><span style="font-family: 'courier new', courier;">       $scope.changeBg = function() {</span></p><p><span style="font-family: 'courier new', courier;">               $scope.incidata.changed = true;</span></p><p><span style="font-family: 'courier new', courier;">               $timeout(function() {</span></p><p><span style="font-family: 'courier new', courier;">                       $scope.incidata.changed = false;</span></p><p><span style="font-family: 'courier new', courier;">               }, 500);</span></p><p><span style="font-family: 'courier new', courier;">       }</span></p><p><span style="font-family: 'courier new', courier;">}</span></p><p>As you can see, we need to inject <span><strong>spUtil </strong>into our client controller. We have defined our watcher above like</span></p><p></p><p><strong style="color: #e23d39; font-size: 18.6667px;"><em>HELSINKI and ISTANBUL</em></strong></p><p></p><p><span><span><strong>spUtil.recordWatch($scope,tableName,filter, function(name,data){</strong></span></span></p><p><strong>//name: event information</strong></p><p><strong>//data:   information about updated or inserted record</strong></p><p><span><span><strong>})</strong></span></span></p><p></p><p><span style="color: #e23d39; font-size: 14pt;"><em><strong>JAKARTA and KINGSTON</strong></em></span></p><p><strong>spUtil.recordWatch($scope,tableName,filter, function(name,data){</strong></p><p><strong>//data:   comesback as undefined</strong></p><p></p><p><strong>//name: <strong>information about updated or inserted record.</strong><br/></strong></p><p><strong>})</strong></p><p></p><p><strong>Second Argument is the tableName you want to attach the watcher for</strong></p><p><strong>Third Argument is the filter for the table</strong></p><p><strong>Fourth is a callback function that is executed when watcher is fired, this function has two arguments.</strong></p><p></p><p><strong>In our example, the </strong>second<strong> argument is Incident table, and the </strong>filter<strong> is <span>"priority=1^state!=7", meaning we only care about incidents with priority critical and not closed.</span></strong></p><p></p><p><strong><span>Inside our watcher, we have a timeout just to change the background color.</span></strong></p><p></p><p><span style="font-size: 12pt;"><strong>SASS:</strong></span></p><p><span style="font-family: 'courier new', courier;">.critical-incidents {</span></p><p><span style="font-family: 'courier new', courier;">       margin-top: 20px;</span></p><p><span style="font-family: 'courier new', courier;">       width: 300px;</span></p><p><span style="font-family: 'courier new', courier;">       .inci-number {</span></p><p><span style="font-family: 'courier new', courier;">               font-size: 36px;</span></p><p><span style="font-family: 'courier new', courier;">               margin-bottom: 0px;</span></p><p><span style="font-family: 'courier new', courier;">               padding: 25px;</span></p><p><span style="font-family: 'courier new', courier;">               color: #E51B24;</span></p><p><span style="font-family: 'courier new', courier;">       }</span></p><p><span style="font-family: 'courier new', courier;">       .circle-bg {</span></p><p><span style="font-family: 'courier new', courier;">               margin-left: auto;</span></p><p><span style="font-family: 'courier new', courier;">               margin-right: auto;</span></p><p><span style="font-family: 'courier new', courier;">               width: 100px;</span></p><p><span style="font-family: 'courier new', courier;">               height: 100px;</span></p><p><span style="font-family: 'courier new', courier;">               border-radius: 50%;</span></p><p><span style="font-family: 'courier new', courier;">               background: #fff;</span></p><p><span style="font-family: 'courier new', courier;">       }</span></p><p><span style="font-family: 'courier new', courier;">       .red-bg {</span></p><p><span style="font-family: 'courier new', courier;">               background: #E51B24;</span></p><p><span style="font-family: 'courier new', courier;">               .inci-number {</span></p><p><span style="font-family: 'courier new', courier;">                       color: #fff;</span></p><p><span style="font-family: 'courier new', courier;">               }</span></p><p><span style="font-family: 'courier new', courier;">       }</span></p><p><span style="font-family: 'courier new', courier;">}</span></p><p><span style="font-family: 'courier new', courier;">.changed-rec {</span></p><p><span style="font-family: 'courier new', courier;">       font-size: 18px;</span></p><p><span style="font-family: 'courier new', courier;">       margin-top: 30px;</span></p><p><span style="font-family: 'courier new', courier;">}</span></p><p></p><p><span style="font-size: 12pt;"><strong>Server Script:</strong></span></p><p></p><p></p><p><span style="font-family: 'courier new', courier;">(function() {</span></p><p><span style="font-family: 'courier new', courier;">       /* populate the 'data' object */</span></p><p><span style="font-family: 'courier new', courier;">       /* e.g., data.table = $sp.getValue('table'); */</span></p><p><span style="font-family: 'courier new', courier;">       data.incidentCount = '';</span></p><p></p><p><span style="font-family: 'courier new', courier;">       var gr = new GlideRecord('incident');</span></p><p><span style="font-family: 'courier new', courier;">       gr.addQuery('priority', 1);</span></p><p><span style="font-family: 'courier new', courier;">       gr.addQuery('state','!=', 7);</span></p><p><span style="font-family: 'courier new', courier;">       gr.query();</span></p><p><span style="font-family: 'courier new', courier;">       data.incidentCount = gr.getRowCount();</span></p><p><span style="font-family: 'courier new', courier;">})();</span></p><p></p><p><span style="color: #666666; font-family: arial, sans-serif;">After populating your widget with above code, go ahead and save it.</span></p><p></p><p></p><ul><li><span style="color: #666666; font-size: 12pt; font-family: arial, sans-serif;"><strong>Step 2: Add widget to a service portal page</strong></span></li></ul><p>         Please go ahead and add the widget we created above to a page using the designer.</p><p>         After you have added this widget to a page, let us check it out how it works</p><p></p><p><img   alt="Screen Shot 2016-10-09 at 7.39.09 PM.png" class="image-2 jive-image" src="759104c6db98d3041dcaf3231f96198c.iix" style="width: 620px; height: 360px;"/></p><p></p><p>I have 10 critical incidents in my instance, thus the page looks like this for me.</p><p></p><p>Now let's try to create a new Critical Incident to see if our watcher fires.</p><p></p><p><img   alt="record_watcher.gif" class="image-3 jive-image" height="453" src="1054e9cadb1cd304b322f4621f96190b.iix" style="height: 453px; width: 877.688px;" width="878"/></p><p></p><p>As you can see, our record watcher is fired every time a new Critical Incident is created. Whenever record watcher is fired, information about the record is returned as well.</p><p>We are logging this data to the console, if we check the browser console, you can see what the data of the inserted/changed record look like.</p><p></p><p></p><p><span style="text-decoration: underline; color: #e23d39;"><strong style="font-size: 18.6667px;"><em>HELSINKI and ISTANBUL</em></strong></span></p><p><img   alt="Screen Shot 2016-10-09 at 7.49.09 PM.png" class="image-4 jive-image" src="f57e3442db901b04ed6af3231f96190a.iix" style="width: 620px; height: 345px;"/></p><p></p><p>By analyzing data we got back inside record watcher in above screenshot you can tell if it was a new insert or an update</p><p><strong> action: "entry" and operation:"insert" =&gt; new record</strong></p><p><strong> action: "change" and operation:"update" =&gt; update to an existing record</strong></p><p></p><p></p><p><span style="text-decoration: underline;"><strong style="color: #e23d39; text-decoration: underline; font-size: 18.6667px;"><em><strong>JAKARTA and KINGSTON</strong></em></strong></span></p><p><strong style="color: #e23d39; font-size: 18.6667px;"><em><strong><img   alt="jk.png" class="image-5 jive-image" src="15a5614adb105b04ed6af3231f961969.iix" style="width: 620px; height: 263px;"/></strong></em></strong></p><p></p><p></p><p>Record watchers in Service Portal are very powerful. Can be used to display real-time data.</p><p></p><p>Thanks,</p><p>Sush</p>