---
title: " examples debugging ServiceNow scripting in Google Closure Compiler"
date: 2016-09-16T03:25:59.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=bc7c22e1dbd0dbc01dcaf3231f961947"
---
<p>In ServiceNow, we use <a title="ki.servicenow.com/index.php?title=Script_in_ServiceNow#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Script_in_ServiceNow#gsc.tab=0">scripts</a> to extend your instance beyond standard configurations. When creating scripts like <a title="ki.servicenow.com/index.php?title=Script_in_ServiceNow#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Script_in_ServiceNow#gsc.tab=0">business rules or client scripts</a>, we use Javascript. Javascript is a well-known and popular language that has benefited from significant investment over the years. JavaScript is a high-level, dynamic, untyped, interpreted programming language with a feel like java. As powerful as it is now, debugging is sometimes complex. To make it less complex, you can simplify your code using a code optimizer. Code optimization is any method of code modification to improve code quality and efficiency. A program may be optimized so that it becomes a smaller size, consumes less memory, executes more rapidly, or performs fewer input/output operations. Our business rules and client script editors do have a script syntax analyzer, but you can use <a title="evelopers.google.com/closure/compiler/" href="https://developers.google.com/closure/compiler/">Google closure compiler</a> as an additional tool to simplify them.</p><p></p><p><img   alt="chromespeedo.png" class="image-11 jive-image" height="115" src="74d560c6db5457049c9ffb651f961944.iix" style="width: 153px; height: 114.75px; display: block; margin-left: auto; margin-right: auto;" width="153"/></p><p></p><h1><span style="color: #3d3d3d;">Here are 3 use case examples of how to utilize the Closure Compiler debugger tool:</span></h1><ul><li>Validating if the code syntax is correct, without having to run it</li><li>Simplifying logical operations (e.g complex conditions, etc)</li><li>Simplifying complex functions</li></ul><p></p><h2>Validating if the code syntax is correct, without having to run it</h2><p>If you find a complex code that makes some sense, but you suspect it is incorrect, then run it thought the javascript optimizer. This is similar to our own <a title="ocs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/debugging/concept/c_ScriptSyntaxErrorChecking.html" href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/debugging/concept/c_ScriptSyntaxErrorChecking.html">syntax validation</a> on the script editor. For example, let's check our password validation code for errors and inaccuracies using the debugger.</p><p></p><p>Here is an example of password validation:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14733665013229719 jive_text_macro" data-renderedposition="559.9500122070312_8_1117_336" jivemacro_uid="_14733665013229719"><p>gs.info("good password: " + CheckPassWd8CharSAnd3ofUpperLowerNumberNonAlpha("This4isAgoodPassw0rd!"));</p><p>gs.info("bad password: " + CheckPassWd8CharSAnd3ofUpperLowerNumberNonAlpha("thisisbadpassword"));</p><p></p><p>// The password must be 8 characters long (this I can do :-)).</p><p>// The password must then contain characters from at least 3 of the following 4 rules:</p><p>// * Upper case * Lower case * Numbers * Non-alpha numeric</p><p>function CheckPassWd8CharSAnd3ofUpperLowerNumberNonAlpha(passwordtext) {</p><p>       if (passwordtext.length &lt; 8) {</p><p>               return false;</p><p>       } else {</p><p>               var hasUpperCase = /[A-Z]/.test(passwordtext);</p><p>               var hasLowerCase = /[a-z]/.test(passwor dtext);</p><p>               var hasNumbers = /\d/.test(passwordtext);</p><p>               var hasNonalphas = /\W/.test(passwordtext);</p><p>               if (hasUpperCase + hasLowerCase + hasNumbers + hasNonalphas &lt; 3) {</p><p>                       return false;</p><p>               } else {</p><p>                       return true;</p><p>               }</p><p>               // IT is missig a "}"</p><p>       };</p></pre><p></p><p>We can run the code in Closure Complier to find the number of errors and where they may be. This allows us to ensure the Javascript we run is functioning and correct, and we do not need to do investigating once it is live. When we input the password validation code in the debugger, it returns with:</p><p><img   alt="closure-compiler.jpg" class="image-6 jive-image" src="4dea0dcadb941b04ed6af3231f961977.iix" style="width: 620px; height: 287px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>Once you add the<strong> missing '}'</strong>,   and remove the extra space on<strong> "passwor dtext"</strong>, it get simplified as:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14733662856605173 jive_macro_code jive_text_macro" data-renderedposition="1332.949951171875_8_1117_208" jivemacro_uid="_14733662856605173"><p>gs.info("good password: " + CheckPassWd8CharSAnd3ofUpperLowerNumberNonAlpha("This4isAgoodPassw0rd!"));</p><p>gs.info("bad password: " + CheckPassWd8CharSAnd3ofUpperLowerNumberNonAlpha("thisisbadpassword"));</p><p></p><p>function CheckPassWd8CharSAnd3ofUpperLowerNumberNonAlpha(a) {</p><p>       if (8 &gt; a.length) {</p><p>               return !1;</p><p>       }</p><p>       var b = /[A-Z]/.test(a),</p><p>               c = /[a-z]/.test(a),</p><p>               d = /\d/.test(a);</p><p>       a = /\W/.test(a);</p><p>       return 3 &gt; b + c + d + a ? !1 : !0;</p><p>};</p></pre><p>---------------------</p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="1575.949951171875_8_1117_43"><p>It reuses input variable 'a'. This is not very good when coding but thumbs up on recycling 'a'.</p></pre><p>When executed, it returns:</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="1663.949951171875_8_1117_62"><p>*** Script: good password: true</p><p>*** Script: bad password: false</p></pre><p></p><p></p><h2>Simplifying logical operations (e.g complex conditions, etc)</h2><p>There is a trick on Logical operations simplification. It is using logical optimisers. You suspect right. It is not one click. It is four(4) steps. You can simplify logical operation if you see redundancy or repetitions.</p><p></p><ol><li>The first step is to replace the expression components into the letters A,B,C,..., on the elements that could be redundant. For example:<pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14733666933592840 jive_text_macro" data-renderedposition="1894.75_38_1087_176" jivemacro_uid="_14733666933592840"><p>function ValidateInput(letter1, letter2, letter3, letter4, letter5, letter6) {</p><p>       if ((letter1 == 'a' &amp;&amp; letter2 == 'b') ||</p><p>               (letter1 == 'a' &amp;&amp; letter2 == 'b' &amp;&amp; letter3 == 'x') ||</p><p>               (letter1 == 'a' &amp;&amp; letter2 == 'b' &amp;&amp; letter3 == 'x' &amp;&amp; letter4 == 'y') ||</p><p>               (letter1 == 'a' &amp;&amp; letter2 == 'b' &amp;&amp; letter3 == 'x' &amp;&amp; letter4 == 'y' &amp;&amp; letter5 == 'z') ||</p><p>               (letter1 == 'a' &amp;&amp; letter2 == 'b' &amp;&amp; letter3 == 'x' &amp;&amp; letter4 == 'y' &amp;&amp; letter5 == 'z' &amp;&amp; letter6 == 'm')) {</p><p>               return true;</p><p>       } else {</p><p>               return false;</p><p>       }</p><p>}</p></pre><p></p><p>To simplify the logic, we replace <strong>&lt;letter1=='a'&gt; with A, &lt;letter2=='b'&gt; with B</strong>, and so on. Real life example may be a bit more complex but the target is the same. Replace it on units ready for the logical optimisers.</p><p></p><p>The function would look like:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14733667060567729 jive_text_macro" data-renderedposition="2175.75_38_1087_32" jivemacro_uid="_14733667060567729"><p>   if (A &amp;&amp; B || A &amp;&amp; B &amp;&amp; C || A &amp;&amp; B &amp;&amp; C &amp;&amp; D || A &amp;&amp; B &amp;&amp; C &amp;&amp; D &amp;&amp; E || A &amp;&amp; B &amp;&amp; C &amp;&amp; D &amp;&amp; E &amp;&amp; F)</p><p>Use a logic optimiser (e.g. wolframalpha) to remove redundancy.</p></pre></li><li>When I use wolframalpha to simplify the logical expression:<p><strong><a title="w.wolframalpha.com/input/?i=A+%26%26+B+%7C%7C+A+%26%26+B+%26%26+C+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%26%26+F" href="http://www.wolframalpha.com/input/?i=A+%26%26+B+%7C%7C+A+%26%26+B+%26%26+C+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%26%26+F">"A &amp;&amp; B || A &amp;&amp; B &amp;&amp; C || A &amp;&amp; B &amp;&amp; C &amp;&amp; D || A &amp;&amp; B &amp;&amp; C &amp;&amp; D &amp;&amp; E || A &amp;&amp; B &amp;&amp; C &amp;&amp; D &amp;&amp; E &amp;&amp; F"</a> </strong>at <a title="w.wolframalpha.com/input/?i=A+%26%26+B+%7C%7C+A+%26%26+B+%26%26+C+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%26%26+F" href="http://www.wolframalpha.com/input/?i=A+%26%26+B+%7C%7C+A+%26%26+B+%26%26+C+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%7C%7C+A+%26%26+B+%26%26+C+%26%26+D+%26%26+E+%26%26+F">www.wolframalpha.com</a></p><p><img   alt="logical expression.jpg" class="image-7 jive-image" src="2f6b604edb94dfc068c1fb651f9619c0.iix" style="width: 620px; height: 210px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>It returns "ESOP | A AND B", which translate in javascript to "A &amp;&amp; B"</p><p>which translate to &lt;(letter1=='a' &amp;&amp; letter2=='b')&gt;</p><p><img   alt="translate javascript.jpg" class="image-8 jive-image" src="eaa9484edbdc5fc068c1fb651f9619fd.iix" style="width: 620px; height: 329px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p></li><li>Replace the expression components back. Reducing the original function, the example looks like:<pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_1473366982012527" data-renderedposition="2947.35009765625_38_1087_112" jivemacro_uid="_1473366982012527"><p>function ValidateInput(letter1, letter2) {</p><p>       if ((letter1 == 'a' &amp;&amp; letter2 == 'b')) {</p><p>               return true;</p><p>       } else {</p><p>               return false;</p><p>       }</p><p>};</p></pre><p></p></li><li>Run the Google optimize on the final code. When running it on <a title="osure-compiler.appspot.com/home" href="http://closure-compiler.appspot.com/home">google optimise</a>r, the final function will be:<pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14733671841794902 jive_text_macro" data-renderedposition="3104.14990234375_38_1087_48" jivemacro_uid="_14733671841794902"><p>function ValidateInput(a, b) {</p><p>       return "a" == a &amp;&amp; "b" == b ? !0 : !1;</p><p>};</p></pre><p><img   alt="closure complier.jpg" class="image-9 jive-image" src="20c3a771db541fc03eb27a9e0f9619ac.iix" style="width: 620px; height: 244px; display: block; margin-left: auto; margin-right: auto;"/></p></li></ol><p>The final code on step 4 looks much easier to debug than the original on step 1. The code looks much cleaner and the process of testing would be easier as you have less variables to worry about.</p><p></p><h2>Simplifying complex functions</h2><p><span style="color: #3d3d3d;">Another way to simplify your Javascript code is to remove the parts on the code that are just not used. Removing excess code will help make the</span> code more readable.</p><p></p><p>For example:</p><pre __default_attr="warning" __jive_macro_name="alert" alert="warning" class="jive_text_macro jive_macro_alert" data-renderedposition="3590.14990234375_8_1117_43"><p>This code produces a memory leak</p></pre><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14733673235088374 jive_text_macro" data-renderedposition="3647.14990234375_8_1117_320" jivemacro_uid="_14733673235088374"><p>var theThing = null;</p><p>var replaceThing = function() {</p><p>       var priorThing = theThing;</p><p>       var unused = function() {</p><p>               if (priorThing) { /* This part causes MEMORY LEAK because theThing can't be release */</p><p>                       gs.info("hi");</p><p>               }</p><p>       };</p><p>       theThing = {</p><p>               longStr: (new Array(1E6)).join("*")</p><p>               , someMethod: function() {</p><p>                       gs.info(someMessage);</p><p>               }</p><p>       };</p><p>};</p><p>for (var i = 0; i &lt; 5; i++) {</p><p>       gs.info("testing " + i);</p><p>       replaceThing();</p><p>       gs.sleep(1E3);</p><p>};</p></pre><p></p><p>When running it thought <a title="osure-compiler.appspot.com/home" href="http://closure-compiler.appspot.com/home">google Closure Compiler</a>, it produces:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14733674398265771 jive_text_macro" data-renderedposition="4009.14990234375_8_1117_160" jivemacro_uid="_14733674398265771"><p>for (var theThing = null, replaceThing = function() {</p><p>               theThing = {</p><p>                       longStr: Array(1E6).join("*")</p><p>                       , someMethod: function() {</p><p>                               gs.info(someMessage);</p><p>                       }</p><p>               };</p><p>       }, i = 0; 5 &gt; i; i++) {</p><p>       gs.info("testing " + i), replaceThing(), gs.sleep(1E3);</p><p>};</p></pre><p></p><p><span style="color: #303030;">The results when debugged in the <a title="evelopers.google.com/closure/compiler/" href="https://developers.google.com/closure/compiler/">Closure Compiler</a> will come out like this:</span></p><p><img   alt="reduce code.jpg" class="image-10 jive-image" src="e398498edb50d304b322f4621f9619ac.iix" style="width: 620px; height: 260px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>This code is much easier to debug after being run through the optimizer. It will also make it clear when an unused part of the code has disappeared. For debugging purposes, you can investigate the redundant code that was causing the problem or review the remaining code for problems. The reason for the memory leak is <a title="ww.toptal.com/javascript/10-most-common-javascript-mistakes" href="https://www.toptal.com/javascript/10-most-common-javascript-mistakes">found here</a>.</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="4568.14990234375_8_1117_62"><p>"There is not one right way to ride a wave."</p><p>~ Jamie O'Brien</p></pre><p></p><p>Debugging code is like surfing, there are several ways to ride a wave. One of them is to take a look from a different angle. Code sometimes tells the story but it sometimes it traps you on it. Use optimiser tools to simplify and help you focus on what it matters and sometimes get direct to the point.</p><p></p><p>More information here:</p><p><a href="https://developers.google.com/closure/compiler/index" title="https://developers.google.com/closure/compiler/index">Closure Compiler   |   Google Developers</a></p><p><a href="http://www.wolframalpha.com/" title="http://www.wolframalpha.com/">Wolfram|Alpha: Computational Knowledge Engine</a></p><p><a href="https://www.toptal.com/javascript/10-most-common-javascript-mistakes" title="https://www.toptal.com/javascript/10-most-common-javascript-mistakes">The 10 Most Common Mistakes JavaScript Developers Make </a></p><p><a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/debugging/concept/c_ScriptSyntaxErrorChecking.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/debugging/concept/c_ScriptSyntaxErrorChecking.html">Docs -</a><a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/debugging/concept/c_ScriptSyntaxErrorChecking.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/debugging/concept/c_ScriptSyntaxErrorChecking.html">Script syntax error checking</a></p><p><a title="Performance considerations when using GlideRecord" __default_attr="4811" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Performance considerations when using GlideRecord" data-renderedposition="4831.39990234375_8_352_17" href="/community?id=community_blog&sys_id=620deaa5dbd0dbc01dcaf3231f961981">Performance considerations when using GlideRecord</a></p><p><a title="Community Code Snippets: Articles List to Date" __default_attr="4821" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Community Code Snippets: Articles List to Date" data-renderedposition="4852.39990234375_8_318_17" href="/community?id=community_blog&sys_id=289d6a69dbd0dbc01dcaf3231f9619f0">Community Code Snippets: Articles List to Date</a></p><p><a title="Mini-Lab: Using Ajax and JSON to Send Objects to the Server" __default_attr="5148" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Mini-Lab: Using Ajax and JSON to Send Objects to the Server" data-renderedposition="4873.39990234375_8_407_17" href="/community?id=community_blog&sys_id=cd1eae2ddbd0dbc01dcaf3231f9619df">Mini-Lab: Using Ajax and JSON to Send Objects to the Server</a></p><p><a title="ServiceNow Scripting 101: Two Methods for Code Development" __default_attr="4452" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="ServiceNow Scripting 101: Two Methods for Code Development" data-renderedposition="4894.39990234375_8_419_17" href="/community?id=community_blog&sys_id=b7ec22a5dbd0dbc01dcaf3231f961920">ServiceNow Scripting 101: Two Methods for Code Development</a></p><p><a title="Community Code Snippets - GlideRecord to Object Array Conversion" __default_attr="4705" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Community Code Snippets - GlideRecord to Object Array Conversion" data-renderedposition="4915.39990234375_8_453_17" href="/community?id=community_blog&sys_id=379c2225dbd0dbc01dcaf3231f961988">Community Code Snippets - GlideRecord to Object Array Conversion</a></p><p><a title="Community Code Snippets - Four Ways To Do An OR Condition" __default_attr="4470" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Community Code Snippets - Four Ways To Do An OR Condition" data-renderedposition="4936.39990234375_8_417_17" href="/community?id=community_blog&sys_id=d8cdaea9dbd0dbc01dcaf3231f96197c">Community Code Snippets - Four Ways To Do An OR Condition</a></p><p><a _jive_internal="true" href="/people/jonnyseymour/content?filterID=contentstatus%5Bpublished%5D~objecttype~objecttype%5Bblogpost%5D" title="https://community.servicenow.com/people/jonnyseymour/content?filterID=contentstatus%5Bpublished%5D~objecttype~objecttype%5Bblogpost%5D">My other blogs</a></p>