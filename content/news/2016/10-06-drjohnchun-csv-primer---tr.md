---
title: "CSV Primer  Troubleshooting Tips"
date: 2016-10-05T17:50:55.000Z
authors: ["drjohnchun"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=3f7c26e1dbd0dbc01dcaf3231f961930"
---
<p>I have come across several questions posted on the Community related to the CSV (comma-separated values) format and felt it might be helpful to review the specifications and some gotchas. You might ask what's so complicated about the CSV format. After all, it's simply field values separated by commas. While it's true, there are a few more details that might come handy if you ever have to troubleshoot CSV import/export issues.</p><p></p><p><strong>DEFINITION OF THE CSV FORMAT</strong></p><p></p><p>The CSV format is quite simple and defined in <a title="ww.ietf.org/rfc/rfc4180.txt" href="https://www.ietf.org/rfc/rfc4180.txt">IETF RFC 4180</a> Section 2. While I encourage you to read the original text, here's a condensed version:</p><p></p><ol><li>Each line is terminated by CRLF.</li><li>The last line doesn't need to be terminated by CRLF.</li><li>An optional header line is allowed in the first line, useful for adding field names.</li><li>Each line may contain one or more fields, separated by commas. All lines must contain the same number of fields.</li><li>Each field may be enclosed in double quotes (optional, but see below).</li><li><strong>Fields containing line breaks (CRLF), double quotes, and commas must be enclosed in double quotes.</strong></li><li><strong>If a field is enclosed in double quotes, all double quotes inside the field must be escaped by another double quote </strong>(replace all " with "")<strong>.</strong></li></ol><p></p><p>6 and 7 are in bold, as they tend to cause issues in malformed CSV data.</p><p></p><p><strong>GOTCHAS TO WATCH OUT FOR</strong></p><p></p><p>Here are some comments and gotchas to watch out for, in addition to 6 and 7 from above:</p><p></p><ol style="list-style-type: lower-alpha;"><li>Depending on locales, commas may be used as decimal points or thousand separators for the display values of numeric/currency fields. Be sure to account for those cases. This also applies to date fields.</li><li>If you're seeing more fields than expected, look for commas in unenclosed field values.</li><li>If field values are split across multiple lines, look for unenclosed CRLF.</li><li>While RFC 4180 only specifies commas, some CSV formats (including some cases in ServiceNow) allow other delimiters.</li><li>RFC 4180 Section 2 incudes this caveat: "While there are various specifications and implementations for the CSV format, there is no formal specification in existence, which allows for a wide variety of interpretations of CSV files.   This section documents the format that seems to be followed by most implementations."</li></ol><p></p><p><strong>escapeCSV FUNCTION</strong></p><p></p><p>Here's a simple JavaScript function based on RFC 4180 that can be used in processors or script includes for generating CSV data:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14756127439517435 jive_text_macro" data-renderedposition="782.15625_8_998_192" jivemacro_uid="_14756127439517435"><p>/**</p><p> * Takes raw field value and returns CSV escaped value</p><p> * based on RFC 4180 Common Format and MIME Type for CSV Files October 2005 <a title="ols.ietf.org/html/rfc4180" href="http://tools.ietf.org/html/rfc4180">http://tools.ietf.org/html/rfc4180</a></p><p> *</p><p> * @param {string} raw - raw field value</p><p> * @return {string} escaped CSV field value, if applicable per RFC 4180</p><p> */</p><p>function escapeCSV(raw) {</p><p>   var value = (raw + '').replace(/"/g,'""');   // escape all double quotes</p><p>   if (/[\r\n",]/.test(value)) value = '"' + value + '"';   // if value has special characters, enclose in double quotes</p><p>   return value;</p><p>}</p></pre><p></p><p><em>Please feel free to connect, follow, post feedback / questions / comments, share, like, bookmark, endorse.</em></p><p>John Chun, <span style="font-size: 8pt;">PhD PMP</span> <a href="http://linkedin.com/in/DrJohnChun"><img alt="see John's LinkedIn profile" class="image-2 jive-image" src="http://megaicons.net/static/img/icons_sizes/182/456/16/linkedin-icon.png" style="height: auto; vertical-align: -13px;" title="see John's LinkedIn profile"/></a></p><p><a href="http://snowaid.com/"><img alt="visit snowaid" class="image-1 jive-image" src="http://snowaid.com/images/signature.png" style="height: auto; margin-top: -9px;" title="visit snowaid"/></a></p>