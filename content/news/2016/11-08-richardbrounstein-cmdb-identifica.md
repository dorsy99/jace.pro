---
title: "CMDB Identification and Reconciliation"
date: 2016-11-07T09:24:58.000Z
authors: ["richardbrounstein"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=c33e22addbd0dbc01dcaf3231f96191a"
---
<p style="margin-top: 12.0pt;"><span style="font-size: 14.0pt;"><strong>The Configuration Management Database (CMDB)</strong></span></p>
<p style="margin-bottom: 6.0pt;">The <a title="w.servicenow.com/products/servicenow-platform/configuration-management-database.html" href="http://www.servicenow.com/products/servicenow-platform/configuration-management-database.html" rel="nofollow">CMDB</a> is a powerful single system of record of configuration items (CIs).   It is not just a database with information on all the CIs such as hardware, software, services, and more.   It provides a critical resource for essential IT Processes such as:</p>
<ul style="list-style-type: disc;"><li>IT Service Management</li><li>Operations Management</li><li>Asset Management</li><li>Configuration Management</li></ul>
<p style="margin-top: 12.0pt;"><span style="font-size: 14.0pt;"><strong>CMDB Problems with Inaccurate Data</strong></span></p>
<p style="margin-bottom: 6.0pt;">The most efficient way to populate the CMDB is with an <a title="w.servicenow.com/products/discovery.html" href="http://www.servicenow.com/products/discovery.html" rel="nofollow">Automated Discovery Mechanism</a>.     Yet, many CMDBs suffer from having inaccurate data.   If your CMDB data is inaccurate, the reports and processes which depend on the CMDB can fail and your organization will be at risk.</p>
<p style="margin-bottom: 6.0pt;">Two common inaccuracies that exist in a CMDB are:</p>
<ul style="list-style-type: disc;"><li>Duplicate CIs in the CMDB where one item exists in the data center</li><li>Compression: A single CI in the CMDB that represents multiple items in the data center</li></ul>
<p><span style="font-size: 12.0pt; font-family: Calibri;">Both of these problems occur when the attributes used to identify configuration items do not uniquely represent the identity of the CI. Consider the following scenarios.   The Data Center has two Linux Servers.   One Linux Server is running a single instance of a Tomcat Application Server. The other Linux Server is running multiple instances of Tomcat.   When written to the CMDB, the Tomcat Servers are being identified by their class and the name of their primary configuration file.   On the machine where 2 Tomcat servers exist, the name of the config files are identical so even though there are two CIs, only 1 entry is made in the CMDB for that one Tomcat Application Server on that particular Linux Server.  This is Compression.</span></p>
<p> </p>
<p><span style="font-size: 12.0pt; font-family: Calibri;"><img class="image-1 jive-image" style="width: 620px; height: 237px;" src="f111018edb9097049c9ffb651f9619cc.iix" alt="Picture1.png" /></span></p>
<p> </p>
<p> </p>
<p style="margin-bottom: 6.0pt;">Or consider the scenario where the version number is used to uniquely identify the Tomcat Application Server.   The version number can be a unique identifier as long as it stays the same. But once Tomcat is upgraded to a new version, it is then recognized as a new CI and a duplicate entry is made in the CMDB even though only one instance of Tomcat exists in the data center. These are the kinds of CI identification challenges that CMDB managers must deal with.</p>
<p><img class="image-2 jive-image" style="width: 620px; height: 242px;" src="e70e148edb5c9fc068c1fb651f9619f4.iix" alt="Picture2.png" /></p>
<p> </p>
<p style="margin-top: 12.0pt;"><span style="font-size: 14.0pt;"><strong>Choosing the Right Identification Methods</strong></span></p>
<p style="margin-bottom: 6.0pt;">Just as your drivers license or passport is a document that identifies you from other people, configuration items need their own unique identifiers. Identifiers are made up of attributes that are part of each configuration item.   For an identifier to be effective, it must satisfy two criteria:</p>
<ol style="list-style-type: decimal;"><li>The identifier must be unique to that configuration item</li><li>The identifier must not change for the life of the configuration item.</li></ol>
<p style="margin-bottom: 6.0pt;">Let&#39;s consider a typical identifier for a virtual or physical computer. Networks identify computers by their IP address.   IP addresses are unique.   In fact, if a computer joins a network with the same IP address as another computer, a warning is usually issued and that computer is not allowed to join the network. You might think that an IP address is the optimum choice as a unique identifier.   Yet it is not because IP addresses can easily change as a configuration setting in any computer&#39;s TCP/IP settings so they are not a reliable unique identifier in the CMDB.   The MAC (Media Access Control) address could be a better choice since MAC addresses are uniquely assigned to network cards and are burned into the hardware.   Yet, with virtual hardware, MAC addresses can now be assigned at random and can be duplicated throughout the network.</p>
<p style="margin-bottom: 6.0pt;">Since ServiceNow Geneva release, a facility exists to determine the attributes which are used to uniquely identify any CI type for hardware and software. Serial numbers make a much better choice as they are generated as unique ids for physical and virtual hardware and tend to not change for the life of a configuration item.   That is why ServiceNow Discovery uses a serial number as the default mechanism to identify hardware items.   However, it is possible that a serial number is not available for a piece of hardware. So, a fallback mechanism exists where the machine name or a combination of the IP/MAC Addresses can be used if the serial number does not exist.</p>
<p><span style="font-size: 12.0pt; font-family: Calibri;">It is important for the configuration management group in any organization to be familiar with the hardware and software in order to best determine which attributes should best be used to uniquely identify these components.   These are configured by class in a simple user interface the &#34;CI Identifiers&#34; section.</span></p>
<p> </p>
<p><span style="font-size: 12.0pt; font-family: Calibri;"><img class="image-3 jive-image" style="width: auto; height: auto;" src="a78dfb7ddb945fc03eb27a9e0f9619ef.iix" alt="Picture3.png" /></span></p>
<p><span style="font-size: 12.0pt; font-family: Calibri;"><img class="image-4 jive-image" style="width: 620px; height: 353px;" src="26236182db50d7049c9ffb651f961910.iix" alt="Picture4.png" /></span></p>
<p><span style="font-size: 8.0pt;"><strong>CI Identifier Rules for Hardware.   Sometimes the Serial Number may be blank so different identifiers are allowed</strong></span></p>
<p style="margin-top: 12.0pt;"><span style="font-size: 14.0pt;"><strong>Identification Methods for Software Applications</strong></span></p>
<p style="margin-bottom: 6.0pt;">Software applications don&#39;t necessarily have a unique serial number that can be applied as their identifier.   They can best be identified by the individual process that they run. However, since many applications allow for multiple instances of themselves to be run on a single machine, there may exists multiple different processes.   So we also want to identify an application by the &#34;installation directory&#34;, which should be different for each instance.   Multiple instances of the same software would have to be installed into different directories so this makes an effective identification method.</p>
<p><img class="image-5 jive-image" style="width: 620px; height: 135px;" src="cfa2410adb9013043eb27a9e0f9619e5.iix" alt="Picture5.png" /></p>
<p><img class="image-6 jive-image" style="width: 620px; height: 329px;" src="838fd84edb9c9fc068c1fb651f961963.iix" alt="Picture6.png" /></p>
<p><span style="font-size: 8.0pt;"><strong>CI Identifier Rule for Applications</strong></span></p>
<p style="margin-bottom: 6.0pt;"><span style="font-size: 14.0pt;"><strong>Configuration Item Reconciliation</strong></span></p>
<p style="margin-bottom: 6.0pt;">Just as an intelligent human is educated from multiple sources of knowledge and wisdom, your organization&#39;s <a title="w.servicenow.com/products/servicenow-platform/configuration-management-database.html" href="http://www.servicenow.com/products/servicenow-platform/configuration-management-database.html" rel="nofollow">CMDB</a> may not completely serve your use cases by being populated from just one source. When multiple use cases are served by a CMDB, multiple discovery methods are often needed.   Consider that ServiceNow Discovery is designed to gather information on all desktops, servers and network devices in your data center. Yet an asset discovery tool that recognizes licensable software programs from installed utilities may be better suited to identify the inventory of software on servers and desktops.   So, by having both discovery mechanisms running, the CMDB is more accurate.</p>
<p style="margin-bottom: 6.0pt;">This becomes a problem when different sources try to write information to the same records.   This has to be managed or changes to the CIs that are tracked in the CMDB history tables will negatively affect the change management process.</p>
<p style="margin-bottom: 6.0pt;">In order to detect a change that was made in the data center, ServiceNow compares discovered values exactly against the current value in the CMDB.   Data that has the same value may appear to be different.   For example, one discovery tool may identify the memory size as 2048 mb whereas another tool may identify the memory size as 2 gb. They are the same value but will be seen differently. The ServiceNow CMDB will record the values as different and will note that a change was made to that CI when in the data center no changes were actually made.</p>
<p style="margin-bottom: 6.0pt;">In order to prevent false change reports, we must prevent different automated discovery tools from overwriting the same configuration item fields in the CMDB. This means we must have reconciliation rules based on the different sources assigned to different configuration items.   For this to work, a single source of truth must be identified not just for each configuration item but for each attribute in each configuration item.</p>
<p><img class="image-7 jive-image" style="width: auto; height: auto;" src="508cb37ddb945fc068c1fb651f9619ff.iix" alt="Picture7.png" /></p>
<p><span style="font-size: 8.0pt;"><strong>Example of multiple sources of automated discovery updating the ServiceNow CMDB</strong></span></p>
<p><img class="image-8 jive-image" style="width: auto; height: auto;" src="2b3f9542db9cd344e9737a9e0f9619ff.iix" alt="Picture8.png" /></p>
<p><span style="font-size: 8.0pt;"><strong>Multiple sources of automated discovery assigned to individual attribute fields</strong></span></p>
<p style="margin-top: 12.0pt;"><span style="font-size: 14.0pt;"><strong>Single Source of Truth or Multiple Sources of Truth</strong></span></p>
<p style="margin-bottom: 6.0pt;">The CMDB is the single source of truth of information about the data center. For it to work effectively as a source of truth, each Configuration Item can only be populated by in the CMDB by a trustable source.   More accurately, each attribute (field) of the CI must have a primary source of truth.   This is a meant to be a source that we trust to populate the right values in the database.</p>
<p style="margin-bottom: 6.0pt;">While there should be a single source of truth, there may actually be multiple sources that can update the CI attribute.   If a discovery source is designated as the only source that can create or update CI fields, we are limiting our CMDB maintenance. What if a CI does not exist in the CMDB yet and a source that is not as trusted but is still valued provides the info on the new CI?   We want that update to happen because we don&#39;t want to wait until the next scheduled discovery scan of the fully trusted source.   That means we need to allow for multiple trusted discovery sources but need to make sure that some sources have higher precedence than others.</p>
<p style="margin-top: 6.0pt;"><span style="font-size: 14.0pt;"><strong>CI Reconciliation in ServiceNow</strong></span></p>
<p style="margin-bottom: 6.0pt;">In ServiceNow, starting with the Geneva release, there exists a simple facility to define CI Reconciliation.   In other words, there exists a facility that allows users to decide which attributes for which CI class a particular discovery Data Source is allowed to update after it has collected such data.</p>
<p><img class="image-9 jive-image" style="width: auto; height: auto;" src="1dbbf80edb1097049c9ffb651f961949.iix" alt="Picture9.png" /></p>
<p><img class="image-10 jive-image" style="width: 620px; height: 354px;" src="a4ec9842db5c9fc068c1fb651f9619e9.iix" alt="Picture10.png" /></p>
<p><span style="font-size: 8.0pt;"><strong>Definition of CI attributes allowed to be updated by ServiceNow Discovery for Windows Servers</strong></span></p>
<p><span style="font-size: 14.0pt;"><strong>Data Source Precedence</strong></span></p>
<p style="margin-bottom: 6.0pt;">As indicated in the above paragraph, we need to set an order of precedence for the discovery data sources.   A simple example is with ServiceNow Discovery and ServiceWatch (Service Mapping) discovery.   Setting the precedence simply under the &#34;Datasource Precedences&#34; for CI types allow you to define the Order in which different discovery sources are allowed to create and update CIs.   What this means is that if a discovery source of a lower precedence tries to insert a CI or update a field of a CI, it will only be allowed if the CI does not exist or, in the case that the CI does exist, it will only update the field of the CI if it is blank.</p>
<p> </p>
<p> </p>
<p><img class="image-11 jive-image" style="width: auto; height: auto;" src="e13fd1c2db1c130468c1fb651f961966.iix" alt="Picture11.png" /><img class="image-12 jive-image" style="width: 620px; height: 168px;" src="1edc14c6db9c9704ed6af3231f96194c.iix" alt="Picture12.png" /></p>
<p><span style="font-size: 8.0pt;"><strong>In this Example, the ServiceNow Discovery Data source has a higher precedence than ServiceWatch (Service Mapping)</strong></span></p>
<p> </p>
<p style="margin-bottom: 6.0pt;">Starting in the ServiceNow Helsinki release, changes to configuration items are tracked by individual changes to the attributes.   This is done in the <strong>Data Source History</strong> (<strong>cmdb_datasource_last_update</strong>) table.   This is how ServiceNow knows which attribute was updated by which discovery mechanism.</p>
<p><img class="image-15 jive-image" style="width: 620px; height: 173px;" src="9906e5cadb105b04ed6af3231f961924.iix" alt="Picture15.png" /></p>
<p style="margin-top: 6.0pt;"><span style="font-size: 14.0pt;"><strong>Testing CI Reconciliation </strong></span></p>
<p style="margin-bottom: 6.0pt;">One way to test that the CI Reconciliation is working is to run a script that tries to insert/update a new CI pretending to be one discovery source and then try to overwrite it with a different discovery source.   Below is an example of such a script.   Note the execution of the method call &#34;createOrUpdateCI&#34; that takes in a parameter of the particular discovery source.   The below example script simulates two updates from two different discovery sources.</p>
<p> </p>
<p><img class="image-13 jive-image" style="width: 620px; height: 525px;" src="54bafb39db545fc068c1fb651f96196d.iix" alt="Picture13.png" /><img class="image-14 jive-image" style="width: 620px; height: 70px;" src="5bab7cc2db1c9304b322f4621f9619e7.iix" alt="Picture14.png" /></p>
<p><span style="font-size: 8.0pt;"><strong>After running the script, a server is created.   Note the Discovery Source with the last update and the CPU Name only gets updated by ServiceWatch and CPU type is only updated by ServiceNow</strong></span></p>