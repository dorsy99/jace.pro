---
title: "ServiceNow Scripting  Encoded Query  A Breadcrumbs Issue"
date: 2016-05-21T18:06:06.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=006d6a29dbd0dbc01dcaf3231f96191c"
---
<p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>NOTE</strong></span>: ON APRIL 1, 2016 ACCENTURE COMPLETED THE ACQUISITION PROCESS OF CLOUDSHERPAS.   AT THAT TIME THE CLOUDSHERPAS BLOG SITES WERE DOWNED FOREVER.</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">THIS IS THE RE-PUBLICATION OF MY ARTICLE FROM <span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>July 14, 2015</strong></span> ON THE CLOUDSHERPAS SERVICENOW SCRIPTING 101 BLOG.</p><p style="font-family: arial, sans-serif; color: #666666;">____________________________________________________________________________</p><p style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr"></p><p dir="ltr" style="line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">I have worked with ServiceNow encoded queries for several years now, using them to express more complex query logic. I usually copy what I need from the list view query builder breadcrumbs, though I've also rolled my own from scratch. Despite all this experience, I noticed something odd recently that caught me a bit by surprise.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">To set the stage here, let me explain a couple of things about normal order of precedence.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">First, let's review the state table for AND and OR evaluation:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       TRUE AND TRUE:         TRUE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       TRUE AND FALSE:     FALSE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       FALSE AND TRUE:     FALSE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       FALSE AND FALSE:   FALSE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       TRUE OR TRUE:             TRUE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       TRUE OR FALSE:         TRUE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       FALSE OR TRUE:         TRUE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">                       FALSE OR FALSE:       FALSE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Next, let's note that the order of precedence for evaluation is always:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><ol start="1" style="margin-top: 0in; list-style-type: decimal;"><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l3 level1 lfo1; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">Inside the parenthesis</span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l3 level1 lfo1; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">AND</span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l3 level1 lfo1; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">OR</span></li></ol><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">So, for example:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; text-indent: .5in; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">(TRUE OR FALSE) AND (FALSE OR FALSE)</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Would evaluate to:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; text-indent: .5in; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">(FALSE) AND (FALSE)</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Would evaluate to: </span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; text-indent: .5in; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">FALSE</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Almost <span style="text-decoration: underline;">ALL</span> computer and database languages follow this paradigm.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Now that we've established that, let's get back to my recent revelation. I did my usual copying of an encoded query from query builder breadcrumbs, but this time I noticed that the copied query did not appear to reflect the correct order of precedence. Instead, it seemed to be evaluating the OR operators first and then the AND operators!</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">My query in query builder:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="color: #000000; font-size: 12pt; font-family: Arial;"><img alt="1. Building the query.JPG" class="jive-image" height="363" src="https://lh6.googleusercontent.com/1658_zf8oVQ1tH2djikssTl_LSEC2EM9o-UCmK-gsGzeTRg3tGIQKs9L5uYj_326WDKo-GAqZKvOGBAdBXgmTsAHhuuRCqPTjLMXpPWvR8mjwDeyK4o5h64NRmMOvEBEDgaZqHM" style="border-style: none; display: block; margin-left: auto; margin-right: auto;" width="624"/></span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Copying the query to use in an encoded query statement:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p align="center" class="MsoNormal" style="margin-bottom: .0001pt; text-align: center; line-height: normal;"><span style="color: #000000; font-size: 12pt; font-family: Arial;"><img alt="2. Copying the query.JPG" class="jive-image" height="218" src="https://lh4.googleusercontent.com/yp6eE_k5bXta3ERn2eNSEhdDqmKWREGcR1rE1LY3cJ0x9Tk_21ooDz0fyASTvRRKveGbijO-WVUtQCX7IgvIsCl5b4MgHRHI_DlnaOjaPXZJXhS6Sdb3FhL9owqO8HAewgdtknI" style="border-style: none;" width="432"/></span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-size: 12pt;"><span style="mso-fareast-font-family: 'Times New Roman'; color: black; font-family: 'Arial','sans-serif';"><strong>Some Notes:</strong></span><span style="font-family: 'Arial','sans-serif'; mso-fareast-font-family: 'Times New Roman'; color: black;"> </span></span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><ul style="margin-top: 0in; list-style-type: disc;"><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l1 level1 lfo2; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">I echoed out the encoded query after each of these examples to make sure that something wasn't being re-interpreted in each case. It was not. In every case used in this article, the query was echoed back as expected -- no surprise reconstructions.   </span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l1 level1 lfo2; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">I ran all of these queries using Scripts - Background, but they can also be executed just as easily using Fix Scripts.   </span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l1 level1 lfo2; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">Remember that with ServiceNow GlideRecords, if an error is encountered in an .addQuery, the statement is ignored.   </span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l1 level1 lfo2; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">If an error is encountered when evaluating an .addEncodedQuery, everything including and after the error is ignored.</span></li></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14638353806164479 jive_text_macro" data-renderedposition="1764.578125_8_1192_122" jivemacro_uid="_14638353806164479"><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">// Query as it was originally copied. This gives the correct result so it would appear that the order of precedence is backwards!!!</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('active=true^priority=2^ORpriority=3^state=1^ORstate=2');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('Original: ' + incidents.getRowCount());   // 7</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print(incidents.getEncodedQuery());</span></p></pre><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">I was a bit surprised that it returned the same number of records that my list view query had returned. This should not have been the case if the order of precedence was properly followed,   so I decided to slap a few parenthesis in to make it more readable and to force it to behave correctly.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14638353957418164 jive_text_macro" data-renderedposition="1954.578125_8_1192_122" jivemacro_uid="_14638353957418164"><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">// Query re-written with logical parenthesis to force the order.   This does something completely wonky!</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('active=true^(priority=2^ORpriority=3)^(state=1^ORstate=2)');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('Paren 1st: ' + incidents.getRowCount());</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print(incidents.getEncodedQuery());</span></p></pre><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">This should have worked, but instead it just returned a count of all Active records. It would appear that everything after the first "^" was ignored! Could it be that the parenthesis were causing an error in the encoded query?</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Next, I decided to rewrite the original encoded query as a true GlideRecord query.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1463835407672477 jive_text_macro" data-renderedposition="2178.578125_8_1192_158" jivemacro_uid="_1463835407672477"><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">// Query re-written in GlideRecord form to validate results. This is the correct precedence and actually mimics the original query builder.</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addActiveQuery();</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addQuery('priority','2').addOrCondition('priority','3');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addQuery('state','1').addOrCondition('state','2');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('GlideRecord: ' + incidents.getRowCount());   // 7</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print(incidents.getEncodedQuery());</span></p></pre><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">This came back with the same seven records. Since this query actually demonstrates the correct order of precedence, it confirmed that the encoded queries were being evaluated in reverse order of precedence.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Undaunted, I decided to break out the active query into its own line and isolate the parenthesis portion of the query.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14638354185816760" data-renderedposition="2438.578125_8_1192_154" jivemacro_uid="_14638354185816760"><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">// Query re-written with logical parenthesis to force the order.</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addActiveQuery();</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('(priority=2^ORpriority=3)^(state=1^ORstate=2)');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('Paren 2nd: ' + incidents.getRowCount());</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print(incidents.getEncodedQuery());</span></p></pre><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Bang! Confirmed! The encoded query was completely ignored, and the results returned all 29 active records. So it turns out that parenthesis are an illegal "operator" in encoded queries. They actually cause an error and everything from the first parenthesis on is ignored.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">I decided to do some more digging and check one more possibility. This time, I put parenthesis around my active check.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1463835436526458 jive_text_macro" data-renderedposition="2694.578125_8_1192_122" jivemacro_uid="_1463835436526458"><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">// Query re-written with logical parenthesis to force the order.   </span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('(active=true)^((priority=2^ORpriority=3)^(state=1^ORstate=2))');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('Paren 3rd: ' + incidents.getRowCount());</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print(incidents.getEncodedQuery());</span></p></pre><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">...and this caused the entire encoded query line to error out and all 54 records in the table were returned! So this second test confirmed, without a doubt, that parenthesis are illegal in encoded query statements. Wow!</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Okay, I thought, let's try this a different way and see if multiple encoded queries work. </span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14638354493132383" data-renderedposition="2918.578125_8_1192_158" jivemacro_uid="_14638354493132383"><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">// Query rewritten to force the ANDs to work correctly</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('active=true');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('priority=2^ORpriority=3');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="color: red; font-size: 12pt; font-family: 'Courier New';"><strong>incidents.addEncodedQuery('state=1^ORstate=2');</strong></span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('Forced: ' + incidents.getRowCount());   // 7</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print(incidents.getEncodedQuery());</span></p></pre><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">They did, and it stands to reason that, since there were no parenthesis, my order of precedence is obvious to a follow-on maintenance coder.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Finally, I had to verify if the records returned were actually REAL. I decided to break out the combination of queries represented by the original list view query.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_1463835508803140" data-renderedposition="3160.578125_8_1192_576" jivemacro_uid="_1463835508803140"><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addActiveQuery();</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('priority', '2');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('state', '1');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var one = incidents.getRowCount();   // zero</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addActiveQuery();</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('priority', '2');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('state', '2');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var two = incidents.getRowCount();   // 3</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addActiveQuery();</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('priority', '3');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('state', '1');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var three = incidents.getRowCount();   // zero</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var incidents = new GlideRecord('incident');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addActiveQuery();</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('priority', '3');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.addQuery('state', '2');</span></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">incidents.query();</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">var four = incidents.getRowCount();   // 4   for a total of 7</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-size: 12pt; font-family: 'Courier New'; color: black;">gs.print('Breakout: ' + (one+two+three+four));</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p></pre><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">There you go. Seven records were found. That test verified the list view AND confirmed in yet another way that the order of precedence in encoded queries is reversed.</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">At this point, I went back to the breadcrumbs and looked carefully, and I noticed something that had never caught my eye before: The breadcrumbs listing looks like this:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 0in; margin-right: 0in; margin-bottom: .0001pt; margin-left: .5in; line-height: normal;"><span style="font-family: 'courier new', courier; color: black; font-size: 12pt;">All&gt;Active = true&gt;Priority = 2 - High .or. Priority = 3 - Moderate&gt;State = New .or. State = Active</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Notice the "greater than" symbols? And how the order of precedence is preserved? OR is first, then the "&gt;" (which represent "AND")!</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">So, in summary, when using the encoded query breadcrumb builder in ServiceNow, you need to remember that:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><ol start="1" style="margin-top: 0in; list-style-type: decimal;"><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l2 level1 lfo3; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">The order of precedence is reversed (ORs are evaluated first, then ANDs).</span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l2 level1 lfo3; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;">Parenthesis cannot be used to change the order of precedence, and using parenthesis actually causes an error that does not manifest when running the GlideRecord query.</span></li></ol><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-top: 8.0pt; margin-right: 0in; margin-bottom: .0001pt; margin-left: 0in; line-height: normal; mso-outline-level: 3;"><span style="font-size: 12.0pt; font-family: 'Trebuchet MS','sans-serif'; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; color: #666666;">Learn More</span></p><p class="MsoNormal" style="margin-top: 8.0pt; margin-right: 0in; margin-bottom: .0001pt; margin-left: 0in; line-height: normal; mso-outline-level: 3;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-family: Arial, sans-serif; color: black; font-size: 12pt;">Check out these resources to learn more about order of precedence and ServiceNow encoded queries:</span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><ul style="margin-top: 0in; list-style-type: disc;"><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l0 level1 lfo4; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence"><span style="color: #1155cc;">JavaScript Operator Precedence</span></a></span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l0 level1 lfo4; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;"><a href="https://dev.mysql.com/doc/refman/5.0/en/operator-precedence.html"><span style="color: #1155cc;">MySQL Operator Precedence</span></a></span></li><li class="MsoNormal" style="color: black; margin-bottom: .0001pt; line-height: normal; mso-list: l0 level1 lfo4; tab-stops: list .5in; vertical-align: baseline;"><span style="font-family: Arial, sans-serif; font-size: 12pt;"><a href="http://wiki.servicenow.com/index.php?title=Encoded_Query_Strings"><span style="color: #1155cc;">ServiceNow Encoded Queries</span></a></span></li></ul><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"><span style="font-size: 12pt;"><span style="font-family: 'Arial','sans-serif'; mso-fareast-font-family: 'Times New Roman'; color: black;">The code for this article may be found at the following ServiceNow Share </span><span style="font-family: 'Times New Roman', serif;"><a href="https://share.servicenow.com/app.do#/detailV2/e42281ac551502007c3953512138ef55/overview"><span style="font-family: Arial, sans-serif; color: #1155cc;">link</span></a></span><span style="font-family: 'Arial','sans-serif'; mso-fareast-font-family: 'Times New Roman'; color: black;">.</span></span></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p class="MsoNormal" style="margin-bottom: .0001pt; line-height: normal;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">Steven Bell</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="color: purple; font-weight: inherit; font-size: 12pt; font-family: inherit; font-style: inherit;"><strong><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-5414-110061/accenture technology logo.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="accenture technology logo.png" class="image-1 jive-image" height="52" src="b4df914adb9c1b04ed6af3231f9619f0.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="277"/></a><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-5414-110062/sn-community-mvp.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="sn-community-mvp.png" class="image-2 jive-image" height="48" src="9999b8cedbd097041dcaf3231f961976.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="135"/></a></strong></span></p><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #666666;"><span style="font-style: inherit; font-family: inherit;"><strong>For a list of all of my articles:   <a title="" _jive_internal="true" data-containerid="1027" data-containertype="37" data-objectid="4821" data-objecttype="38" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/23/community-code-snippets-articles-list-to-date" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;">Community Code Snippets: Articles List to Date</a></strong></span></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #666666;"></p><p><span style="color: #eb7a3d; font-size: 12pt;">Please Share, Like, Bookmark, Mark Helpful, or Comment this blog if you've found it helpful or insightful.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="color: #eb7a3d; font-weight: inherit; font-size: 12pt; font-family: inherit; font-style: inherit;">Also, if you are not already, I would like to encourage you to become a member of our blog!</span></p><p></p><hr/><p><span style="color: #303030;">for Click for <a title="" _jive_internal="true" href="/community?id=community_forum&sys_id=a6299a2ddbd897c068c1fb651f961926">More Expert Blogs </a>and also Find <a title="" _jive_internal="true" href="/community?id=community_forum&sys_id=d6295a2ddbd897c068c1fb651f9619f1">Expert Events</a>!</span></p><hr/>