---
title: "Variables with a write role clashing with catalog UI policies  client scripts"
date: 2016-09-14T00:47:37.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ccbda6a9dbd0dbc01dcaf3231f9619a8"
---
<p>Lately, I've been writing about some pesky issues in Service Catalog, particularly with variables and UI policies. My most recent blog post was about an error that appeared after a <a title="" _jive_internal="true" href="/community/service-management/service-catalog/blog/2016/09/07/adding-a-new-variable-or-ui-policy-on-a-catalog-item-causes-error-on-existing-request-items">new variable or UI policy</a> was added to an existing catalog item with outstanding requests. In this blog post, I'd like to give you some more information about a Service Catalog issue where catalog UI policies and catalog client scripts can <a title="i.service-now.com/kb_view.do?sysparm_article=KB0594575" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0594575">fail when a write role is specified</a> on the variable.</p><p></p><p>For a little context, remember that the <a title="tps//docs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/topic/p_ServiceCatalogs.html" href="http://https//docs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/topic/p_ServiceCatalogs.html">Service Catalog</a> is an important part of many ServiceNow implementations. The Service Catalog gives users a menu of product and service options, such as ordering a laptop or requesting software installation. Variables allow you to offer choices when users order catalog items, such as selecting a phone color. UI policies enable you to dynamically change information on a form, such as hiding some questions on a form based on user responses.</p><p></p><h2>Clashing variable role, catalog UI policies, and catalog client scripts</h2><p>In certain patches of Eureka, Fuji, Geneva, and Helsinki, users are experiencing an issue where catalog UI policies and catalog client scripts fail when a write role is specified on the variable and the user views the record as a user that fails the role check (for example, ITIL user). This happens with catalog UI policies and catalog client scripts set to one or both of the following:</p><ul><li>Applies on Catalog Tasks</li><li>Applies on Requested Items</li></ul><p><span style="color: #666666; font-family: arial, sans-serif;">In the example below, the <strong>Disable type and details fields</strong> catalog UI policy (applied to the <strong>Packaging and Shipping</strong> catalog item) has both settings selected: </span></p><p style="text-align: center;"><img   alt="service_catalog_writerole1.png" class="image-1 jive-image" src="dc58704edbdcd704ed6af3231f9619d8.iix" style="width: 620px; height: 515px;"/></p><p></p><p>Symptoms of this issue include (but are not limited to):</p><ul><li>catalog client scripts not working</li><li>reference picker dialogs not opening</li></ul><p></p><p>You can verify the issue if you check the JavaScript console and see a script error:</p><p></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">js_includes_catalog.jsx:132</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;">Uncaught TypeError: container.getAttribute is not a function</span></p><p></p><p>We have seen the issue occurring on the sc_task and sc_req_item forms running a catalog client script that sets a filter on a list collector type variable. When the admin write role on the list collector variable was removed, the form was correct and the error did not appear.</p><p style="text-align: center;"></p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="1126.960205078125_7.997159004211426_1192_82"><p><span style="color: #666666; font-family: arial, sans-serif;">For the most current information about versions in which this issue has been seen and has been fixed, view the known error article associated with the problem: <a title="i.service-now.com/kb_view.do?sysparm_article=KB0594575" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0594575">KB0594575: Catalog UI policies are not applying to variables in a RITM / Catalog Task variable editor when read-only</a>. You can subscribe to the known error article and be automatically notified when there are changes (such as the addition of new "fixed in" versions) by clicking the <strong>Subscribe</strong> button in the upper right corner of the article.</span></p></pre><h2>Upgrade or use an onLoad Catalog Client Script</h2><p>Upgrading to <a title="i.service-now.com/kb_view.do?sysparm_article=KB0594575" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0594575">one of the versions</a> where the issue is fixed is your best bet, but if you cannot upgrade at this time, we have a workaround. Follow the steps below to create an onLoad catalog client script that applies only to RITM and Catalog Task.</p><p></p><ol><li>Navigate to <strong>Service Catalog &gt; Catalog Policies &gt; Catalog Client Scripts</strong>.</li><li>Click <strong>New</strong>.</li><li>In <strong>Type</strong>, select <strong>onLoad</strong>.</li><li>Select the <strong>Applies on Requested Items</strong> option.</li><li>Select the <strong>Applies on Catalog Tasks</strong> option.</li><li>In <strong>Script</strong>, add the appropriate code:<br/><br/>Use this script with Geneva Patch 4 and earlier versions:<br/><br/></li></ol><pre __default_attr="plain" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14737950258758074" data-renderedposition="1512.35791015625_7.997159004211426_1192_77" jivemacro_uid="_14737950258758074"><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">var isAdmin = g_user.hasRole('admin');</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">if (!isAdmin)</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">{</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">       $j('div[id^=label_ni\\.VE]').parent().attr('name', 'checkbox_container');</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">}</span></p></pre><p style="padding-left: 30px;"><br/>Use this script with Geneva Patch 5, Geneva Patch 6, and Geneva Patch 7:</p><p style="padding-left: 30px;"></p><pre __default_attr="plain" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1473795034187199 jive_text_macro" data-renderedposition="1649.630615234375_7.997159004211426_1192_108" jivemacro_uid="_1473795034187199"><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">var isAdmin = g_user.hasRole('admin'); </span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">if (!isAdmin) </span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">{</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">       $j('[name=checkbox_container_label]').filter(function() {</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">                 return this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute('name') != 'checkbox_container';</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">           }).removeAttr('name');</span></p><p style="padding-left: 60px;"><span style="font-family: 'courier new', courier;">}   </span></p></pre><p style="padding-left: 60px;"></p><p class="p1" style="color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px;"></p><p style="text-align: center;"><img   alt="service_catalog_writerole2.png" class="image-2 jive-image" src="7795d40adbd49fc03eb27a9e0f9619bf.iix" style="height: auto;"/></p><p></p><p>For more information about creating catalog client scripts, including details about each field, see <a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/client-scripts/task/t_CreateACatalogClientScript.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/script/client-scripts/task/t_CreateACatalogClientScript.html">Create a catalog client script</a> in the product documentation.</p><p></p><p><span style="font-size: 20px; font-weight: bold; line-height: 1.5;">Additional information</span></p><p>General information about Service Catalog variables and UI policies is available in the product documentation:</p><ul><li><a title="ocs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/concept/c_IntroductionToCatalogItems.html" href="https://docs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/concept/c_IntroductionToCatalogItems.html">Service catalog items</a></li><li><a title="ocs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/concept/c_ServiceCatalogVariables.html" href="https://docs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/concept/c_ServiceCatalogVariables.html">Service catalog variables</a></li><li><a title="ocs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/concept/c_ServiceCatalogUIPolicy.html" href="https://docs.servicenow.com/bundle/helsinki-it-service-management/page/product/service-catalog-management/concept/c_ServiceCatalogUIPolicy.html">Service catalog UI policy</a></li></ul>