---
title: "Saving RESTMessageV Responses as Attachments"
date: 2016-06-22T19:45:08.000Z
authors: ["josh.nerius"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=05fda22ddbd0dbc01dcaf3231f9619c8"
---
<p><strong>Applies to</strong>: Geneva, Helsinki and beyond.</p><p></p><p>Have you ever needed to:</p><p></p><ol><li>Retrieve something using RESTMessageV2</li><li>Save that thing as an attachment on a record</li><li>Do something with the newly generated attachment?</li></ol><p></p><p>This recently came up as a question over in the <a title="t.ly/28NbZdE" href="http://bit.ly/28NbZdE">sndevs slack channel</a>, and I realized that I knew how to accomplish #1 and #2, but didn't know how to actually identify the attachment to achieve #3 without some ugly hacks. But as it turns out, there's a <strong>right</strong> way to do this.</p><p></p><h2>First, some code</h2><p></p><p>Here's a quick refresher on steps 1 and 2: retrieving and saving an attachment.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14666038884704815 jive_text_macro" data-renderedposition="345.1875_8_1192_336" jivemacro_uid="_14666038884704815"><p>// This is where we'll save the attachment</p><p>var tablename     = 'incident';</p><p>var recordSysId = '8d6353eac0a8016400d8a125ca14fc1f';</p><p>var filename       = 'snlogo.png';</p><p></p><p>// Let's download the ServiceNow Logo</p><p><span>var logoUrl = '</span><a title="" _jive_internal="true" href="/instance.service-now.com/images/logos/logo_service-now.png';" rel="nofollow" target="_blank">https://instance.service-now.com/images/logos/logo_service-now.png';</a></p><p>var request = new sn_ws.RESTMessageV2();</p><p>request.setHttpMethod('get');</p><p>request.setEndpoint(logoUrl);</p><p></p><p>// Configure the request to save the response as an attachment</p><p>request.saveResponseBodyAsAttachment(tablename, recordSysId, filename);</p><p></p><p>// When we execute the request, the attachment will automatically be</p><p>// saved to the record we specified</p><p>var response = request.execute();</p><p>var httpResponseStatus = response.getStatusCode();</p><p>var httpResponseContentType = response.getHeader('Content-Type');</p><p>gs.debug("http response status_code: " + httpResponseStatus);</p><p>gs.debug("http response content-type: " + httpResponseContentType);</p></pre><p></p><h2>Now what?</h2><p></p><p>If all you're concerned about is saving the attachment data to a record, you're done. No further actions are necessary. But what if you want to do something <strong>else</strong> with the attachment you just generated? Copy it somewhere, process its contents, etc?</p><p></p><p>The call to <span style="color: #e23d39; font-family: 'andale mono', times;"><a title="t.ly/28NaEDs" href="http://bit.ly/28NaEDs">saveResponseBodyAsAttachment()</a></span> returns void, so we can't get a reference to the attachment from there. We could do something super ugly like go query the sys_attachment table and find the latest attachment associated with our target record, but this is far from ideal and prone to bugs.</p><p></p><p>I was happy to learn that there's a <strong>correct</strong> way to do this.</p><p></p><h2>Using getResponseAttachmentSysid()</h2><p></p><p><span>The <span style="font-family: 'andale mono', times; color: #e23d39;"><a title="t.ly/28OCHYt" href="http://bit.ly/28OCHYt">response</a></span> object returned by <span style="color: #e23d39; font-family: 'andale mono', times;"><a title="t.ly/28Naj3D" href="http://bit.ly/28Naj3D">request.execute()</a></span> provides a method called <span style="color: #e23d39; font-family: 'andale mono', times;"><a title="t.ly/28PmalB" href="http://bit.ly/28PmalB">getResponseAttachmentSysid()</a></span></span><span>. As the method name suggests, this returns the sys_id of the attachment generated by the REST call. </span></p><p></p><p>To use this, we simply call the method after executing the request. We can append the following lines of code to the earlier example:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14666042774584738 jive_text_macro" data-renderedposition="1079.1875_8_1192_192" jivemacro_uid="_14666042774584738"><p>// Get the sys_id of the newly created attachment</p><p>var newAttachmentSysId = response.getResponseAttachmentSysid();</p><p></p><p>// Do something useful with it</p><p>var grAttach = new GlideRecord('sys_attachment');</p><p>if (grAttach.get(newAttachmentSysId)) {</p><p>   // Note: we're using the scoped version of GlideSysAttachment</p><p>   // for this example.</p><p>   var gsa = new GlideSysAttachment()</p><p>   var content = gsa.getContent(grAttach);</p><p>   // Now we have the data...the rest is up to you</p><p>}</p></pre><p></p><p>You can view/download the complete script <a title="ist.github.com/jnerius/d2f28b845a64fa7e1d296c79f877a8c2" href="https://gist.github.com/jnerius/d2f28b845a64fa7e1d296c79f877a8c2">here</a>. This can be executed from <strong>Scripts - Background</strong>, just remember to update the instance URL and target table/record.</p><p></p><p>Happy attaching!</p>