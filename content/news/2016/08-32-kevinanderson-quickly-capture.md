---
title: "Quickly capture a catalog item and all associated components in an update set"
date: 2016-08-31T23:32:43.000Z
authors: ["kevinanderson"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=e16dea29dbd0dbc01dcaf3231f961913"
---
<p>We sometimes have issues where a catalog item just doesn't go into production correctly.</p><p></p><p>Whatever the issue is, the end result is we have to go back to the dev system, and recapture the missing or broken components.   For fairly complex catalog items, this could mean having to capture a large portion of variables, client scripts, and UI policies to ensure the catalog item is properly deployed.   This is a time consuming and tedious process.</p><p></p><p>I created a script, that will rip an entire catalog item and all its associated components into the current active update set.   It saves time, and guarantees the form is properly captured.</p><p></p><p>The script will force an update of each record captured to prevent update set errors (time stamp collisions) on the target system.</p><p></p><p>I borrowed very heavily from <a title="w.servicenowguru.com/system-definition/exporting-service-catalog-items-step/" href="http://www.servicenowguru.com/system-definition/exporting-service-catalog-items-step/">this SNGuru page.</a></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14726681944986678" data-renderedposition="239_8_1192_2896" jivemacro_uid="_14726681944986678"><p>// push a catalog item and all its components to the active update set </p><p>// in test mode, no records will be saved to update, only script output of matching records</p><p>var test_mode = true;</p><p>var catalog_item_sys_id = '{add sys_id here}'; // my catalog item</p><p></p><p></p><p>var captureVariables = function(p_sys_id, p_variable_set, p_test_mode) {</p><p>       if (typeof p_test_mode !== 'boolean') {</p><p>               p_test_mode = false;</p><p>       }</p><p>       if (typeof p_variable_set !== 'boolean') {</p><p>               p_variable_set = false;</p><p>       }</p><p>       if (JSUtil.notNil(p_sys_id)) {</p><p>               var item = new GlideRecord('item_option_new');</p><p>               if (p_variable_set) {</p><p>                       item.addQuery('variable_set', p_sys_id);</p><p>               } else {</p><p>                       item.addQuery('cat_item', p_sys_id);</p><p>               }</p><p>               item.query();</p><p>               while (item.next()) {</p><p>                       gs.print('add variable question to update set: ' + item.name)</p><p>                       if (!p_test_mode) {</p><p>                               item.setForceUpdate(true);</p><p>                               item.update();</p><p>                       }</p><p></p><p></p><p>                       // Query for question choices for variables</p><p>                       var qc = new GlideRecord('question_choice');</p><p>                       qc.addQuery('question', item.sys_id.toString());</p><p>                       qc.query();</p><p>                       while (qc.next()) {</p><p>                               //Add the variable question choice to the update set</p><p>                               gs.print('     add variable question choice to update set: ' + qc.text)</p><p>                               if (!p_test_mode) {</p><p>                                       qc.setForceUpdate(true);</p><p>                                       qc.update();</p><p>                               }</p><p>                       }</p><p>               }</p><p>       }</p><p>};</p><p></p><p></p><p></p><p></p><p>var captureUIPolicies = function(p_sys_id, p_variable_set, p_test_mode) {</p><p>       if (typeof p_test_mode !== 'boolean') {</p><p>               p_test_mode = false;</p><p>       }</p><p>       if (typeof p_variable_set !== 'boolean') {</p><p>               p_variable_set = false;</p><p>       }</p><p>       if (JSUtil.notNil(p_sys_id)) {</p><p>               var catpol = new GlideRecord('catalog_ui_policy');</p><p></p><p></p><p>               if (p_variable_set) {</p><p>                       catpol.addQuery('variable_set', p_sys_id);</p><p>               } else {</p><p>                       catpol.addQuery('catalog_item', p_sys_id);</p><p>               }</p><p>               catpol.query();</p><p>               while (catpol.next()) {</p><p>                       gs.print('add UI Policy to update set: ' + catpol.short_description)</p><p>                       if (!p_test_mode) {</p><p>                               catpol.setForceUpdate(true);</p><p>                               catpol.update();</p><p>                       }</p><p></p><p></p><p>                       //Query for ui policy actions</p><p>                       var uipact = new GlideRecord('catalog_ui_policy_action');</p><p>                       uipact.addQuery('ui_policy', catpol.sys_id.toString());</p><p>                       uipact.query();</p><p>                       while (uipact.next()) {</p><p>                               gs.print('     add UI Policy Action to update set: ' + uipact.variable + '-' + uipact.ui_policy.short_description)</p><p>                               if (!p_test_mode) {</p><p>                                       uipact.setForceUpdate(true);</p><p>                                       uipact.update();</p><p>                               }</p><p>                       }</p><p>               }</p><p>       }</p><p></p><p></p><p>};</p><p></p><p></p><p></p><p></p><p>var captureCatalogClientScripts = function(p_sys_id, p_variable_set, p_test_mode) {</p><p>       if (typeof p_test_mode !== 'boolean') {</p><p>               p_test_mode = false;</p><p>       }</p><p>       if (typeof p_variable_set !== 'boolean') {</p><p>               p_variable_set = false;</p><p>       }</p><p>       if (JSUtil.notNil(p_sys_id)) {</p><p>               var catclntscr = new GlideRecord('catalog_script_client');</p><p></p><p></p><p>               if (p_variable_set) {</p><p>                       catclntscr.addQuery('variable_set', p_sys_id);</p><p>               } else {</p><p>                       catclntscr.addQuery('cat_item', p_sys_id);</p><p>               }</p><p></p><p></p><p>               catclntscr.query();</p><p>               while (catclntscr.next()) {</p><p>                       gs.print('add catalog client scripts to update set: ' + catclntscr.name);</p><p>                       if (!p_test_mode) {</p><p>                               catclntscr.setForceUpdate(true);</p><p>                               catclntscr.update();</p><p>                       }</p><p>               }</p><p>       }</p><p>};</p><p></p><p></p><p></p><p></p><p>// 1. capture catalog item record</p><p>var gr1 = new GlideRecord('sc_cat_item');</p><p>if (gr1.get(catalog_item_sys_id)) {</p><p>       gs.print('add catalog item to update set: ' + gr1.name)</p><p>       if (!test_mode) {</p><p>               gr1.setForceUpdate(true);</p><p>               gr1.update();</p><p>       }</p><p></p><p></p><p></p><p></p><p>       captureVariables(catalog_item_sys_id, false, test_mode);</p><p></p><p></p><p>       captureUIPolicies(catalog_item_sys_id, false, test_mode);</p><p></p><p></p><p>       captureCatalogClientScripts(catalog_item_sys_id, false, test_mode);</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>       //5. capture related variable sets</p><p>       //Query for variable set relationships</p><p>       var vsrel = new GlideRecord('io_set_item');</p><p>       vsrel.addQuery('sc_cat_item', catalog_item_sys_id);</p><p>       vsrel.query();</p><p>       while (vsrel.next()) {</p><p>               gs.print('add variable set relationship to update set: ' + vsrel.variable_set.name);</p><p>               if (!test_mode) {</p><p>                       vsrel.setForceUpdate(true);</p><p>                       vsrel.update();</p><p>               }</p><p></p><p></p><p>               // capture variable set</p><p>               var vs = vsrel.variable_set.getRefRecord();</p><p>               if (JSUtil.notNil(vs)) {</p><p>                       //vs.sys_id);</p><p>                       captureVariables(vs.sys_id, true, test_mode);</p><p></p><p></p><p>                       captureUIPolicies(vs.sys_id, true, test_mode);</p><p></p><p></p><p>                       captureCatalogClientScripts(vs.sys_id, true, test_mode);</p><p>               }</p><p>       }</p><p></p><p></p><p>}</p></pre>