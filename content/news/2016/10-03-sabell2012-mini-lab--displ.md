---
title: "MiniLab Displaying all Affected CIs on a Business Service Form"
date: 2016-10-02T23:17:07.000Z
authors: ["sabell2012"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f78caae1dbd0dbc01dcaf3231f96195a"
---
<p style="margin-bottom: .0001pt;"><span style="color: #666666; background: white; font-size: 10.5pt; font-family: 'Arial',sans-serif;"><strong>NOTE</strong></span><span style="font-size: 10.5pt; font-family: 'Arial',sans-serif; color: #666666; background: white;">: MY POSTINGS REFLECT MY OWN VIEWS AND DO NOT NECESSARILY REPRESENT THE VIEWS OF MY EMPLOYER, ACCENTURE.</span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 11.0pt; font-family: 'Arial',sans-serif; color: #666666; background: white;">DIFFICULTY LEVEL:   </span><span style="color: #7f6000; background: white; font-size: 11.0pt; font-family: 'Arial',sans-serif;"><strong>INTERMEDIATE</strong></span></p><p style="margin-bottom: .0001pt;"><span style="font-size: 11.0pt; font-family: 'Arial',sans-serif; color: #666666; background: white;">Assumes basic knowledge and/or familiarity of ITIL, CMDB, and Business Services in ServiceNow.</span></p><p style="margin-bottom: .0001pt;"><span style="font-size: 10.5pt; font-family: 'Arial',sans-serif; color: #666666; background: white;">____________________________________________________________________________</span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">It is possible to have more than one Affected CI associated to an Incident.   One scenario where this could occur would be if a supporting server were to go offline. The upstream dependent CIs would then be affected.</span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Out-of-the-box (OOB) there is no related list displayed for the Incident record to show these.   It exists, but by default is not displayed.   Also, it would be nice to roll these up from all Incidents to an owning Business Service.   There is no OOB way provided to see these rollups.   </span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Additionally there is a little bit of a problem with the current Business Service to Incident related list.   It simply does not show all Incidents where the Business Service is an Affected CI.   BTW, this is a problem with not just Business Services, but also any CI that is in the Affected CIs (task_ci) table.</span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Requirements/Design</strong><br/></span></p><p></p><p style="padding-left: 30px;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">1. Add the existing Affected CIs related list to the Incident form.   </span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">2. Create a mechanism to roll up a Business Service's associated Incident's, and then those incident's Affected CIs and show them on the Business Service form.</span></p><p style="padding-left: 60px;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">a. Create a System Definition Relationship that relates the Business Service to all Incidents where it is listed as an Affected CI.</span></p><p style="padding-left: 60px;"><span style="font-weight: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif; font-style: inherit;">b. Create a System Definition Relationship that relates the Business Service to all Affected CIs in the related Incidents.</span></p><p style="padding-left: 60px;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">c. Add the new related lists (Relationship) to the Business Service form.</span></p><p style="padding-left: 60px;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 14pt; font-family: arial, helvetica, sans-serif; font-style: inherit;"><strong>Lab 1.1: Adding the Affected CIs Related List to the Incident Form</strong></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">OOB you will find that there is no related list shown of all CIs affected by an incident; even though there is minimum of one if the Affected CI field is filled in.   <span style="font-family: arial, helvetica, sans-serif; font-size: 16px;">BTW, I consider this to be a bit of an oversight.   This tab really should be already added to the form.</span></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">1. Navigate to Incidents -&gt; Open.   The open incident list view will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">2. Open one of the listed Incidents.   The incident form will be displayed.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">The related lists at the bottom of the Incident form.   Note the Affected CI related list is not present.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="Incident before.PNG" class="image-1 jive-image" src="c1879d82db5c9f048c8ef4621f961926.iix" style="width: 620px; height: 180px;"/></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">The form showing the Affected CI filled in:</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="Affected CI field Incident.jpg" class="image-2 jive-image" src="7905f48adb9cd704ed6af3231f96198a.iix" style="width: 620px; height: 430px;"/></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">3. Right-click on the form header to bring up the context menu and go to Configure -&gt; Related Lists.   The Related Links choice form will be displayed.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="configure - Related lists.jpg" class="image-3 jive-image" src="46b39402db5817049c9ffb651f961934.iix" style="width: 620px; height: 299px;"/></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">4. Find Affected CIs in the Available list and move it to the Selected list (left-side).</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="adding affected ci related list.PNG" class="image-4 jive-image" src="fce3b7f1dbdc1fc068c1fb651f961973.iix" style="width: 620px; height: 379px;"/></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">5. Click on the save button.   The Incident form will be redisplayed.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">6. Navigate to the bottom of the form again.   You will not that the Affected CIs related list is now displayed.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="affected ci related list in place.PNG" class="image-5 jive-image" src="6326b042dbdcd704ed6af3231f961945.iix" style="width: 620px; height: 181px;"/></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">That polishes off our first requirement.   Now to start on the next requirement by creating the Relationship!</span></p><p></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 14pt; font-family: arial, helvetica, sans-serif; font-style: inherit;"><strong>Lab 2.1: Creating a Relationship Between Business Services and Incidents</strong></span></p><p></p><p><span style="font-size: 12pt;">Now we need to create a relationship record that will allow us to display a related list of our Incidents on the Business Service form.</span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to System Definition -&gt; Relationships.   The Relationships List View will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">2. Click on the New button.   The New Relationship form will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">3. Fill out the form with the following:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">a. <strong>Name</strong>: Business Service to Incident</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">b. <strong>Applies to Table</strong>: Business Service [cmdb_ci_service]</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">c. <strong>Queries from Table</strong>: Incident [incident]</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">d. <strong>Query with</strong>:</span></p><p style="padding-left: 30px;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14754147109117012" data-renderedposition="3116_8_1179_384" jivemacro_uid="_14754147109117012"><p>(function refineQuery(current, parent) {</p><p></p><p>     var incidentList = _retrieveIncidentList();</p><p></p><p>     current.addQuery('sys_id', 'IN', incidentList);</p><p></p><p>})(current, parent);</p><p></p><p>// get all incidents where the business service is an Affected CI.</p><p>function _retrieveIncidentList() {</p><p>   var incidentList = [];</p><p></p><p>   var incidentRecords = new GlideRecord('task_ci');</p><p>   incidentRecords.addQuery('ci_item', parent.sys_id);</p><p>   incidentRecords.query();</p><p></p><p>   while (incidentRecords.next()) {</p><p>         incidentList.push(incidentRecords.getValue('task'));</p><p>   }</p><p></p><p>   incidentList = new ArrayUtil().unique(incidentList);</p><p></p><p>   return incidentList;</p><p>}</p></pre><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">e. Click the Submit button to save your work.</span></p><p></p><p><img   class="image-13 jive-image" src="3d87dd46db98d344e9737a9e0f961933.iix" style="max-width: 1200px; max-height: 900px;"/></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 12pt;">That completes requirement 2a.   This establishes a Related List association between the Incidents and the Business Service, and shows the correct Affected CI relationship.   </span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 14pt; font-family: arial, helvetica, sans-serif; font-style: inherit;"><strong>Lab 2.2: Creating a Relationship Between Business Services and Affected CIs</strong></span></p><p></p><p><span style="font-size: 12pt;">Now we need to create a relationship record that will allow us to display a related list of our Configuration Items (CIs) on the Business Service form.</span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to System Definition -&gt; Relationships.   The Relationships List View will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">2. Click on the New button.   The New Relationship form will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">3. Fill out the form with the following:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">a. <strong>Name</strong>: Business Service to Affected CIs</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">b. <strong>Applies to Table</strong>: Business Service [cmdb_ci_service]</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">c. <strong>Queries from Table</strong>: Configuration [cmdb_ci]</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">d. <strong>Query with</strong>:</span></p><p style="padding-left: 30px;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14754312174353930 jive_text_macro" data-renderedposition="4738.39990234375_8_1179_608" jivemacro_uid="_14754312174353930"><p>(function refineQuery(current, parent) {</p><p></p><p>       var affectedCIList = _retrieveaffectedCIList();</p><p></p><p>       current.addQuery('sys_id', 'IN', affectedCIList);</p><p></p><p>})(current, parent);</p><p></p><p>function _retrieveaffectedCIList() {</p><p>   // get all incidents where the business service is an Affected CI.</p><p>   var incidentList = [];</p><p></p><p>   var incidentRecords = new GlideRecord('task_ci');</p><p>   incidentRecords.addQuery('ci_item', parent.sys_id);</p><p>   incidentRecords.query();</p><p></p><p>   while (incidentRecords.next()) {</p><p>             incidentList.push(incidentRecords.getValue('task'));</p><p>   }</p><p></p><p>   incidentList = new ArrayUtil().unique(incidentList);</p><p></p><p>   // go back and get all Affected CIs for the incidents found</p><p>   var affectedCIList = [];</p><p></p><p>   var affectedCIRecords = new GlideRecord('task_ci');</p><p>   affectedCIRecords.addQuery('task', 'IN', incidentList);</p><p>   affectedCIRecords.query();</p><p></p><p>   while (affectedCIRecords.next()) {</p><p>             affectedCIList.push(affectedCIRecords.getValue('ci_item'));</p><p>   }</p><p></p><p>   affectedCIList = new ArrayUtil().unique(affectedCIList);</p><p></p><p>   return affectedCIList;</p><p>}</p><p style="padding-left: 30px;"></p></pre><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">e. Click the Submit button to save your work.</span></p><p></p><p><img   class="image-20 jive-image" src="f6b318c2db145304b322f4621f961918.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 12pt;">That completes requirement 2b.   This establishes a Related List association between the Affected CIs and the Business Service.</span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 12pt;">The final step will be to add our new Related List to the Business Service form.</span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 14pt; font-family: arial, helvetica, sans-serif; font-style: inherit;"><strong>Lab 2.3: Modifying the Business Service Form to Add the New Relationship</strong></span></p><p></p><p><span style="font-size: 12pt;">Finally let's add the new related list of Affected CIs to the Business Service form.   This will automatically filter it to only show Incidents/Affected CIs that belong to that particular Business Service (the roll-up).</span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to Configuration -&gt; Business Services.   The Business Services list view will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">2. Click on your favorite Business Service.   The Business Service form will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">3. Right-click on the form header to bring up the context menu, and click on Configure -&gt; Related Lists.   The Related List form will be displayed.</span></p><p></p><p><img   class="image-11 jive-image" src="6f1afbf9db50db048c8ef4621f961917.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p><span style="font-size: 12pt;">4. Search for, and move to the right the <span style="font-size: 16px;">Business Service to Incident, Business Service to Affected CIs related lists.   For comparison I will move the Incident-&gt;Business Service and Incident-&gt;Affected CI related lists as well, but this is not necessary for you to do.</span></span></p><p></p><p><img   class="image-15 jive-image" src="9605b8c6db1cdfc068c1fb651f96190c.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p><span style="font-size: 16px;">5. Click on the Save button.   The Business Service form will be redisplayed.</span></p><p></p><p><span style="font-size: 16px;">So now let's check to see that everything is working.</span></p><p></p><p><span style="font-size: 16px;">Steps for testing:</span></p><p></p><p><span style="font-size: 16px;">1. Create or make note of a Business Service.</span></p><p><span style="font-size: 16px;">2. Create or edit an Incident, and add the Business Service as an affected CI.   Add other affected CIs to the Incident.</span></p><p><span style="font-size: 16px;">3. Create or edit a second Incident, and add the Business Service as a secondary affected CI (not entered into the Affected CI field, but rather added via the Edit button on the Affected CI list of the Incident).</span></p><p><span style="font-size: 16px;">4. Re-edit the Business Service and note the Related Links tabs.</span></p><p></p><p><span style="font-size: 16px;">Mine looked like the following (remember I added the two Incidents tabs onto the end for comparison):</span></p><p></p><p><span style="font-size: 16px;">1. The Business Service to Incident related list show <span style="text-decoration: underline;">all</span> of the related incidents.</span></p><p></p><p><img   class="image-22 jive-image" src="136a95cadbd0d7041dcaf3231f9619f3.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p><span style="font-size: 12pt;">2. The Business Service to Affected CIs related list shows all actual CIs that were found in the two incident's Affected CIs list, and it has been de-duped.</span></p><p><img   class="jive-image image-21" src="25e3f379db505704ed6af3231f9619e0.iix" style="max-width: 1200px; max-height: 900px;"/></p><p><span style="font-size: 12pt;">3. The Incidents to Business Service OOB related list is empty.   Which is a bit of a mystery; that I have not bothered to dig out.   </span></p><p><img   class="image-23 jive-image" src="dd41308edbd85f048c8ef4621f96199a.iix" style="max-width: 1200px; max-height: 900px;"/></p><p><span style="font-size: 12pt;">4. The Incident to Affected CI OOB related list is odd in that it displays Incidents, and not the Affected CIs.   Regardless it only shows those Incidents where the Affected CI is the primary; which is the case in the scenario I set up.   Secondaries will not be displayed in this OOB related list.   Therefore, it is inaccurate.</span></p><p><img   class="image-24 jive-image" src="fc825c4edbd01f048c8ef4621f961934.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p><span style="font-size: 16px;">There you have it!   You now see how you can use a more advanced approach with the System Definition Relationships to create useful related lists that do not exist OOB.   The examples I present here should give you insight on how much more complex models can be approached.</span></p><p></p><p><span style="font-size: 16px;">Kind of a side-note:   Yes, I could have build a Database View to help with the gaps I am filling in with code here.   That also would have given me a way of reporting on the Affected CIs for all Business Services.   I went this route because I didn't need that reporting mechanism.   You always need to think of the balance.   What might be needed vs. what will accomplish the current need.</span></p><p></p><p><span style="font-size: 16px;">Have fun!</span></p><p></p><p><span style="font-size: 16px;">Steven Bell</span></p><p></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6014-179184/pastedImage_11.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   class="jive-image" height="92" src="953890cedb589fc068c1fb651f9619fa.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="340"/></a></span></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><span style="font-weight: bold; font-style: inherit;">For a list of all of my articles:   </span><a _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/23/community-code-snippets-articles-list-to-date" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><span style="font-weight: bold; font-style: inherit;">Community Code Snippets: Articles List to Date</span></a></span></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif; color: #eb7a3d;">Please Share, Like, Bookmark, Mark Helpful, or Comment this blog if you've found it helpful or insightful.</span></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif; color: #eb7a3d;">Also, if you are not already, I would like to encourage you to become a member of our blog!</span></p>