---
title: "Jelly  Phase   HTML escaping  CDATA  All your base are belong to us"
date: 2016-02-17T04:48:00.000Z
authors: ["Christopher.Maloy"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b62da6e5dbd0dbc01dcaf3231f9619a8"
---
<p style="font-family: 'Helvetica Neue';">Whenever I get a question about Jelly I start to sweat nervously. Then you throw in a question about phase 1 and phase 2 idiosyncrasies and I start to mumble like a crazy person.   So, here's a little story I've got to tell - &lt;/end-beastie-boy-impression&gt;</p><p style="font-family: 'Helvetica Neue';"></p><p style="font-family: 'Helvetica Neue';">Stephan Nolan, an employee working with me at RMIT, asked the question:</p><p style="font-family: 'Helvetica Neue';">"We have a dynamic content block with the following:</p><p></p><div style="color: #000000;">&lt;?xml version="<span style="color: #008c00;">1.0</span>" encoding="utf-<span style="color: #008c00;">8</span>" ?&gt;<br/> <span style="color: #a65700;">&lt;</span><span style="color: #5f5035;">j:jelly</span><span style="color: #274796;"> trim</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"false"</span><span style="color: #274796;"> </span><span style="color: #074726;">xmlns</span><span style="color: #274796;">:j</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"jelly:core"</span><span style="color: #274796;"> </span><span style="color: #074726;">xmlns</span><span style="color: #274796;">:g</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"glide"</span><span style="color: #274796;"> </span><span style="color: #074726;">xmlns</span><span style="color: #274796;">:j2</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"null"</span><span style="color: #274796;"> </span><span style="color: #074726;">xmlns</span><span style="color: #274796;">:g2</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"null"</span><span style="color: #a65700;">&gt;</span><br/>         <span style="color: #a65700;">&lt;</span><span style="color: #800000; font-weight: bold;">h1</span><span style="color: #a65700;">&gt;</span>Hello World<span style="color: #a65700;">&lt;/</span><span style="color: #800000; font-weight: bold;">h1</span><span style="color: #a65700;">&gt;</span><br/> <br/>         <span style="color: #a65700;">&lt;</span><span style="color: #800000; font-weight: bold;">script</span><span style="color: #274796;"> </span><span style="color: #074726;">id</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"template"</span><span style="color: #274796;"> </span><span style="color: #074726;">type</span><span style="color: #808030;">=</span><span style="color: #0000e6;">"text/x-handlebars-template"</span><span style="color: #a65700;">&gt;</span><br/>                 <span style="color: #808030;">&lt;</span>!<span style="color: #808030;">[</span>CDATA<span style="color: #808030;">[</span><br/>                         <span style="color: #808030;">&lt;</span>label<span style="color: #808030;">&gt;</span><br/>                                 <span style="color: #808030;">&lt;</span><span style="color: #797997;">input</span><br/>                                         name<span style="color: #808030;">=</span><span style="color: #800000;">"</span><span style="color: #0000e6;">example</span><span style="color: #800000;">"</span><br/>                                         type<span style="color: #808030;">=</span><span style="color: #800000;">"</span><span style="color: #0000e6;">radio</span><span style="color: #800000;">"</span><br/>                                         value<span style="color: #808030;">=</span><span style="color: #800000;">"</span><span style="color: #0000e6;">1</span><span style="color: #800000;">"</span><br/>                                         <span style="color: #800080;">{</span><span style="color: #800080;">{</span>#<span style="color: #800000; font-weight: bold;">if</span> blah<span style="color: #800080;">}</span><span style="color: #800080;">}</span>checked<span style="color: #808030;">=</span><span style="color: #800000;">"</span><span style="color: #0000e6;">checked</span><span style="color: #800000;">"</span><span style="color: #800080;">{</span><span style="color: #800080;">{</span><span style="color: #800000;">/</span><span style="color: #0000e6;">if}}</span><br/> <span style="color: #0000e6;">                             </span> <span style="color: #800000;">/</span><span style="color: #808030;">&gt;</span><br/>                                 <span style="color: #808030;">&lt;</span>span<span style="color: #808030;">&gt;</span>Radio button<span style="color: #808030;">&lt;</span><span style="color: #808030;">/</span>span<span style="color: #808030;">&gt;</span><br/>                         <span style="color: #808030;">&lt;</span><span style="color: #808030;">/</span>label<span style="color: #808030;">&gt;</span><br/>                 <span style="color: #ffffff; background-color: #dd0000; font-weight: bold; font-style: italic;">]</span><span style="color: #ffffff; background-color: #dd0000; font-weight: bold; font-style: italic;">]</span><span style="color: #808030;">&gt;</span><br/>         <span style="color: #808030;">&lt;</span><span style="color: #808030;">/</span>script<span style="color: #808030;">&gt;</span><br/> <span style="color: #808030;">&lt;</span><span style="color: #808030;">/</span>j<span style="color: #800080;">:</span>jelly<span style="color: #808030;">&gt;</span><br/><p></p></div><p></p><p style="font-family: 'Helvetica Neue';"></p><p style="font-family: 'Helvetica Neue';">Which works fine when two phase is turned off.   However when we turn it on, the <span style="font-family: monospace, monospace;"> &lt;![CDATA[]]&gt;</span> tags are being ignored and the following error is thrown<br clear="none"/> <br clear="none"/> <span style="font-family: monospace, monospace;">Element type "input" must be followed by either attribute specifications, "&gt;" or "/&gt;".: org.xml.sax.SAXParseException: Element type "input" must be followed by either attribute specifications, "&gt;" or "/&gt;".:</span></p><p style="font-family: 'Helvetica Neue';"></p><p style="font-family: 'Helvetica Neue';">We need two phase turned on to enable HTML escaping.   Currently our only solution is to replace the '<span style="font-family: monospace, monospace;">&lt;</span>' of the input with <span style="font-family: monospace, monospace;">&amp;lt;</span> to bypass jelly parsing."</p><p style="font-family: 'Helvetica Neue';"></p><p style="font-family: 'Helvetica Neue';">I couldn't figure out a nice an simple answer for him on this, but much to my delight he figured out a nice solution later on and shared the fact that if you have this requirement, wrap your script in a UI Macro and use an inline template. Example &lt;g2:inline template="uimacro.xml".   It looks like the first phase eats up the CDATA tags and when we go into phase two we get the above error.   If we inline in the second phase we get to keep the CDATA tag and there is no need to escape all those pesky &lt; &gt; brackets.   Thanks Stephen for the tip.   I hope it helps someone else out there in Jelly hell, I mean land.   <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="789_257.21875_16_16" src="/8.0.1.35b65d4/images/emoticons/happy.png"></span></p><p style="font-family: 'Helvetica Neue';"></p><p style="font-family: 'Helvetica Neue';"><a href="http://wiki.servicenow.com/index.php?title=Extensions_to_Jelly_Syntax#.3Cg:insert.3E_Versus_.3Cg:inline.3E_Versus_.3Cg:call.3E" title="http://wiki.servicenow.com/index.php?title=Extensions_to_Jelly_Syntax#.3Cg:insert.3E_Versus_.3Cg:inline.3E_Versus_.3Cg:call.3E">Extensions to Jelly Syntax - ServiceNow Wiki</a></p>