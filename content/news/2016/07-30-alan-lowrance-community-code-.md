---
title: "Community Code Snippet Dependent ChoicesLookup Select Boxes on Record Producers"
date: 2016-07-30T00:13:57.000Z
authors: ["alan.lowrance"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=3ddda6e9dbd0dbc01dcaf3231f9619fc"
---
<p>For those of you working with Category + Subcategory fields, you know how much of a pain it was to initially set them up.   Your Category choices are defined in the sys_choice table by table, element ("category"), value... and then you create other entries for table, element ("u_subcategory"), value, dependent value.   Then you relate which thing it's looking to for that dependent value on the dictionary entry for the subcategory item.</p><p></p><p>Anyways, once you have a Category + Subcategory, if you want those to show up and actually filter the Subcategory down dynamically on a Record Producer, you'll need to use AJAX in client scripts to make server calls since a Record Producer usually only submits info to the server upon submission.</p><p>The category variable on the Record Producer should work fine without any tweaking cause it's looking at the correct table &amp; element in the choice list table.   The problem arises when you look at the subcategory and it shows ALL choices because it doesn't dynamically query the choices against the dependent value.</p><p></p><p>Stay with me, so you can make a reference qualifier on the Subcategory variable to limit the choices based on a dependency... but since the record producer isn't a real "living record" yet you have to force it to update.   Once the variables are attached to a real record, this reference qualifier should work normally so your client script isn't going to need to run on Requested Items or Catalog Tasks or anything... just in the Catalog Item View.</p><p>The Subcategory variable (lookup select box) should be looking at the sys_choice table and have a reference qualifier similar to:</p><p><strong>javascript:'name=incident^element=u_subcategory^dependent_value=' + current.variables.category</strong></p><p></p><p>Then an onChange client script that runs whenever category is changed will feed variables to a script include and you might want to use this same script include for multiple tables so lets make the script include first:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14698184744771986" data-renderedposition="365_8_1192_400" jivemacro_uid="_14698184744771986"><p>var DenburyAjax = Class.create();</p><p>DenburyAjax.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p>     getSubcategories: function() {</p><p>       var table = this.getParameter('sysparm_table');</p><p>       var element = this.getParameter('sysparm_element');</p><p>       var category = this.getParameter('sysparm_category');</p><p>     </p><p>       var choice = new GlideRecord('sys_choice');</p><p>       choice.addQuery('name',table);</p><p>       choice.addQuery('element',element);</p><p>       choice.addQuery('dependent_value',category);</p><p>       choice.orderBy('sequence');</p><p>       choice.query();</p><p></p><p></p><p>     while(choice.next()) {</p><p>         if (!choice.inactive) {</p><p>                   var item = this.newItem("item");</p><p>                         item.setAttribute('label', choice.label);</p><p>                         item.setAttribute('value', choice.value);</p><p>         }</p><p>     }</p><p>}</p><p>     </p><p>});</p></pre><p>Make sure you check the "Client Callable" box.</p><p></p><p>Now to feed the category value to that and build the choices on subcategory, your catalog client script should run onChange of the category variable and only the Catalog Item View:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_146981891531847 jive_text_macro" data-renderedposition="828_8_1192_336" jivemacro_uid="_146981891531847"><p>function onChange(control, oldValue, newValue, isLoading) {</p><p>   if ((isLoading) || (newValue == ''))</p><p>   return;</p><p>   var aj = new GlideAjax("DenburyAjax");</p><p>   aj.addParam("sysparm_name", "getSubcategories");</p><p>   aj.addParam("sysparm_table", "incident");</p><p>   aj.addParam("sysparm_element","u_subcategory");</p><p>   aj.addParam("sysparm_category", newValue);</p><p>   aj.getXML(getResponse);</p><p>}</p><p>function getResponse(response) {</p><p>   var items = response.responseXML.getElementsByTagName("item");</p><p>   g_form.clearOptions('u_subcategory'); //has to clear previous buildout   </p><p>   g_form.addOption('u_subcategory','','-- None --');</p><p>   for (var i = 0; i &lt; items.length; i++) {</p><p>     var item = items[i];</p><p>     var value = item.getAttribute("value");</p><p>     var label = item.getAttribute("label");</p><p>     g_form.addOption('u_subcategory', value, label);</p><p>   }</p><p>}</p></pre><p></p><p>Make sense? Any questions?</p>