---
title: "MiniLab Using Ajax and JSON to Send Objects to the Server"
date: 2016-01-26T19:29:10.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=cd1eae2ddbd0dbc01dcaf3231f9619df"
---
<p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Here is a neat trick I thought I would pass on.   How to push an object such as an object array to the server using Ajax and JSON.   With this example I will also be demonstrating usage of the Ajax pattern I described in my last <a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2016/01/24/pragmatic-patterns-ajax-architecting-your-code">article</a>.</span></p><p></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 18pt;"><strong>Lab 1.1:   Using JSON and Ajax to Transmit a Complex Object to the Server</strong></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">So let's do this right, and follow the development process.   We will need a requirement statement, a design (we can skip the analysis for such a short demonstration), and development.   Then finally test.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 14pt;"><strong>Requirements</strong></span></p><p></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Create a button on the Incident form that transmits the incident's watch list emails to the system log.</span></li></ol><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 14pt;"><strong>Design</strong></span></p><p></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">New non-client enabled Script Include Function Library. </span><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Name: ArrayHandlingUtils.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Client: Not checked.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Method: getEmailsFromSysIDs.   Will take a list of user sys_ids and return a list of their respective names and emails.   Make sure to take into account the possibility of no email being present for a given user.   This must be generic.</span></li></ul></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">New client enabled Script Include. </span><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Name: AjaxUtilsServer.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Client: Checked.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Method: pushListToSysLog.   Will take an Ajax parameter that is a JSON encoded object that contains a "location" field that represents the calling UI Action/UI Policy/Client Script, and an array of watch list sys_ids garnered from any form, and then push this list to the System Log.   Notice this MUST be generic.</span></li></ul></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">New UI Script to contain generic functions for reuse. </span><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Name: AjaxUtilsClient.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Method: sendListToSysLog.   Will take a location parameter, and a comma delimited list of sys_ids (this can also be an array of sys_ids).   The location parameter will contain a string representing name of the calling control (UI Action/UI Policy/Client Script).   The list of sys_ids can be any list of comma delimited sys_ids (or an array of sys_ids).   The comma delimited list of sys_ids will be converted into an array.   The location, and array will be placed into a listInfo object and using JSON and Ajax will be sent to the AjaxUtilsServer.pushListToSysLog method.</span></li></ul></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">New UI Action associated to the Incident form. </span><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Name:   Transfer Watchlist.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Table:   Incident.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Client: Checked.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Method:   sendWatchList.   This will pull the watch list from the Incident form and call the UI Script method AjaxUtilsClient.sendListToSysLog.</span></li></ul></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Unit Test</span><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Navigate to Incidents -&gt; Open.   The list view of open Incidents will be displayed.</span></li><li><span style="line-height: 1.5; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Open one of the Incidents.   You should have a new button labeled: Transmit Watchlist.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Make sure there are four or five people on the watchlist.   Add some if you have to.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Click on the Transmit Watchlist button.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Navigate to System Log.   Order by Created date descending.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Expected Result:   A list of names and emails matching the watchlist should be present as a log entry.</span></li></ol></li></ol><p></p><p><img   class="image-6 jive-image" src="44b523f1db10df04e9737a9e0f96198b.iix" style="width: auto; height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 14pt;"><strong>Development</strong></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">So we have a couple of ways to do this:   1) Top-down,   or 2) Bottom-up.   Either way will work.   I will use top-down for this lab.</span></p><p></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Navigate to Incidents -&gt; Open.   A list of open incidents will appear.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Click on any Incident number to edit that incident.   The incident form will appear.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Right-click on the form header to bring up the form context menu.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Pick Configure -&gt; UI Actions from the menu.   The Incident UI Action list view will be displayed.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Click on the New button.   The New UI Action form will be displayed.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Fill out the form with the following:</span><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name</strong>: Transfer Watchlist</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Table:</strong> Incident</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Show Insert</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Show Update</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Client</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Form Button</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>OnClick</strong>: sendWatchList()</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Code</strong>:</span></li></ul></li></ol><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14537336601757887" data-renderedposition="2130.034912109375_7.986111640930176_1191_62" jivemacro_uid="_14537336601757887"><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">function sendWatchList() {</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">   sendListToSysLog(g_form.getValue('watch_list'), 'UIA:Transfer Watch List');</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">}</span></p><p></p></pre><p></p><p><img   class="image-2 jive-image" src="7211a7f5db1093049c9ffb651f96196a.iix" style="width: 620px; height: 480px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">   7.   Click the Submit button to save your work.   <strong>[Design element #4 is complete]</strong></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">   8.   Navigate to System UI -&gt; UI Scripts.   The UI Scripts list view will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">   9.   Click on the New button.   The New UI Script form will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">10.   Fill out the form with the following:</span></p><ul><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name</strong>: AjaxUtilsClient</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Global:</strong> checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Code</strong>:</span></li></ul></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14538131135898774 jive_macro_code jive_text_macro" data-renderedposition="2960.225830078125_7.986111640930176_1191_420" jivemacro_uid="_14538131135898774"><p>// Transmits a list of sys_ids to the server to be pushed to the System Log.</p><p>function sendListToSysLog(list, location) {</p><p></p><p>   // build the object to be transmitted to the server-side. </p><p>   var infoOnList = {};</p><p>   infoOnList.location = location;</p><p></p><p>   // we are turning this into an array just for demonstration purposes</p><p>   // it really isn't necessary to do this.</p><p>   infoOnList.list = list.split(','); // turn it into an array</p><p></p><p></p><p>   // set up the Ajax call to the server.</p><p>   var systemLogger = new GlideAjax('AjaxUtilsServer');</p><p>   // the first parameter is always the name of the function we are calling</p><p>   systemLogger.addParam('sysparm_name','pushListToSysLog');</p><p>   // here is the secret sauce!   </p><p>   // JSON.stringify will package up your object and allow it to be </p><p>   // transmitted to the server where it will be re-constituted into the same object!</p><p>   systemLogger.addParam('sysparm_listInfo', JSON.stringify(infoOnList));</p><p></p><p>   // this is one way of creating an Asynch call with a do-nothing callback.</p><p>   systemLogger.getXML(function(result){ });   // no callback action</p><p>}</p><p></p><p></p><p></p></pre><p></p><p><img   class="image-1 jive-image" src="4eb00802db585fc03eb27a9e0f9619d5.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 329px;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">11.   Click the Submit button to save your work. <span style="font-family: arial, helvetica, sans-serif; font-size: 16px;"><strong>[Design element #3 is complete]</strong></span></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">12.   Navigate to System Definition -&gt; Script Includes.   The list view of Script Includes will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">13.   Click the New button.   The New Script Include form will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">14.   Fill out the form with the following:</span></p><ul><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name</strong>: AjaxUtilsServer</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Client callable</strong>: checked.   When you check this box the code template will switch to extending the AbstractAjaxProcessor.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Accessible from</strong>: all application scopes</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Code</strong>:</span></li></ul></ul><p></p><p></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14538135111474610 jive_macro_code jive_text_macro" data-renderedposition="4081.093994140625_7.986111640930176_1191_498" jivemacro_uid="_14538135111474610"><p>var AjaxUtilsServer = Class.create();</p><p>AjaxUtilsServer.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p></p><p>   // method for decoding the passed JSON object and writing it to the system log</p><p>   pushListToSysLog: function() {</p><p>         // this is how you re-constitute a JSON encoded object.</p><p>         // This will rebuild our listInfo object from the front-end (browser)</p><p>         var listInfo = JSON.parse(this.getParameter('sysparm_listInfo'));</p><p></p><p>         // use a message variable to package up our log message.</p><p>         var message = '---&gt; \n';</p><p>         message += 'Location: ' + listInfo.location + '\n';</p><p></p><p>         // call our function to go retrieve an object list of names </p><p>         // and emails for the given list of sys_ids</p><p>         var userList = ArrayHandlingUtils.getEmailsFromSysIDs(listInfo.list);</p><p></p><p>         // loop through our object array and build the log entry</p><p>         for (var i=0; i &lt; userList.length; i++) {</p><p>               message += 'EMail[' + i + ']: ' </p><p>               + userList[i].name + ' - ' </p><p>               + userList[i].email + '\n';</p><p>         }</p><p>       </p><p>         // Write everything to the system log!</p><p>         gs.log(message, 'SI:AjaxUtilsServer.pushListToSysLog');</p><p>   },</p><p></p><p>   type: 'AjaxUtilsServer'</p><p>});</p><p></p><p></p></pre><p></p><p><img   class="image-3 jive-image" src="83eb0946db5c97041dcaf3231f961953.iix" style="width: 620px; height: 325px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">15.   Click the Submit button to save your work.   The list view of Script Includes will be re-displayed. <span style="font-family: arial, helvetica, sans-serif; font-size: 16px;"><strong>[Design element #2 is complete]</strong></span></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">16.   Click on the New button again.   The New Script include form will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">17.   Fill out the form with the following:</span></p><ul><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name</strong>: ArrayHandlingUtils</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Client callable</strong>: un-checked. </span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Accessible from</strong>: all application scopes</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Code</strong>:</span></li></ul></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14538137413743590 jive_macro_code jive_text_macro" data-renderedposition="5194.6357421875_7.986111640930176_1191_373" jivemacro_uid="_14538137413743590"><p>var ArrayHandlingUtils = Class.create();</p><p></p><p>ArrayHandlingUtils.getEmailsFromSysIDs = function(sysIDList) {</p><p>       // retrieve all user records in the list of sys_ids</p><p>       var userRecords = new GlideRecord('sys_user');</p><p>       userRecords.addQuery('sys_id', 'IN', sysIDList);</p><p>       userRecords.query();</p><p></p><p>       var userList = [];</p><p>       // loop through all the user records and break out the name </p><p>       // and email into the user object. </p><p>       while (userRecords.next()) {</p><p>             var user = {}; // always initialize your object before using!</p><p>             user.name = userRecords.name + '';</p><p>             var email = userRecords.email + '';</p><p>             user.email = JSUtil.notNil(email) ? email : 'no email found';</p><p></p><p>             // place the user object into the object array</p><p>             userList.push(user);</p><p>   }</p><p></p><p>   return userList;</p><p>};</p><p></p></pre><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   class="jive-image image-4" src="4dbae802dbd09344e9737a9e0f961974.iix" style="width: 620px; height: 322px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">18.   Click the Submit button to save your work. <span style="font-family: arial, helvetica, sans-serif; font-size: 16px;"><strong>[Design element #1 is complete]</strong></span></span></p><p></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 14pt;"><strong>Unit Test</strong></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Our unit test should be pretty much what we had in our design <strong>[element #5]</strong>:</span></p><p></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Navigate to Incidents -&gt; Open.   The list view of open Incidents will be displayed.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Open one of the Incidents.   You should have a new button labeled: <strong>Transfer Watchlist</strong>.<br/><br/><img   class="image-9 jive-image" src="b1bae44adb1857049c9ffb651f961958.iix" style="max-width: 1200px; max-height: 900px;"/><br/><br/></span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Make sure there are four or five people on the watchlist.   Add some if you have to.<br/><br/><img   class="jive-image image-8" src="f7eb418adbd497049c9ffb651f96194b.iix" style="max-width: 1200px; max-height: 900px;"/><br/><br/></span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Click on the Transfer Watchlist button.   Observe that the spinner (activity indicator) in the upper right of the form activates for a second or two then goes away.   That is your only indicator that something happened.   I guess we could always go back and put in an alert that things have finished, but this is supposed be a lab that emulates something you might do for real!   <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="6605.13916015625_343.54168701171875_16_16" src="/8.0.1.35b65d4/images/emoticons/happy.png"></span></span><br/><br/><img   class="image-7 jive-image" src="2711a775db585b048c8ef4621f961995.iix" style="max-width: 1200px; max-height: 900px;"/><br/><br/></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Navigate to System Log -&gt; All.   Order by Created date descending.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Expected Result:   A list of names and emails matching the watchlist should be present as a log entry.</span></li></ol><p></p><p><img   class="image-5 jive-image" src="bcd8048adb9c5fc03eb27a9e0f9619de.iix" style="width: 620px; height: 112px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">And there you have it!   We created the code based on the Ajax pattern to organize everything nicely.   The code is generic enough that the UI Script through the Script Include function can be reused and expanded at a later time (extensibility).   Nothing present is hard-coded, but rather data driven.   Finally we demonstrated the method for JSON encoding an object on the front-end (browser), transmitting that object via Ajax to the back-end (server), and JSON decoding the object for use.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Best Practices employed:</span></p><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Maintainability</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Reusability</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Extensibility</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Efficient code</span></li></ul><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">For more information on JavaScript JSON <a title="eveloper.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">stringify </a>and <a title="eveloper.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">parse</a>.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Steven Bell</span></p><p></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666; background: white;"><span style="color: purple; font-weight: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif; font-style: inherit;"><strong>If you find this article helps you, don't forget to log in and "like" it!</strong></span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666; background: white;"><span style="color: purple; font-weight: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif; font-style: inherit;"><strong>Also, if you are not already, I would like to encourage you to become a member of our blog!</strong></span></p>