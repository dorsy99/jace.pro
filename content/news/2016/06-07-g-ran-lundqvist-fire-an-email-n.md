---
title: "Fire an email notification from a schedule job"
date: 2016-06-06T23:15:31.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f71ee26ddbd0dbc01dcaf3231f96191a"
---
<p>I wrote this on my personal blog before ending that and start writing here. I noticed that people still wonder about this and thought I might as well post it here.</p><p>This started from a community question which was <span style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">how you could check if the valid to date is 30 days from now and then send a notification to the KB managers.</span></p><p></p><p><span style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">Now. The functionality that was wanted: When valid date is 30 days from now, the KB Managers should receive an email notification about it.</span></p><p><span style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">This can be solved with a schedule job which runs once a day and triggers an event for each KB article that matches the conditions and finally a notification is trigger of that event.</span></p><p></p><h4 style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">1. Register the event</h4><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">First we need to register the event that we are going to put in the queue. This is done by going to the System Policy-&gt;Events-&gt;Registry.</p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">Here we create a new event that looks like this:</p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"><img class="jive-image" src="http://3.bp.blogspot.com/-1QbQ5kJXE2I/Vt9AhLQVekI/AAAAAAAAAa0/mic-rcwCVbU/s1600/sche%2Bkb%2Bman%2B1.GIF"/></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">That was pretty easy, so let's head to the list view to get the encoded query.</p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><h4 style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">2. Encoded Query</h4><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">Quickest way is just to type kb_knowledge.list in the navigator and you get the to the list view of the KB articles. Set up the conditions and when you're done, right click and copy the query.</p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"><img class="jive-image" src="http://1.bp.blogspot.com/-G0OHefizHbA/Vt9BK0zkGlI/AAAAAAAAAa8/793iFfO7l6k/s1600/sche%2Bkb%2Bman%2B2.GIF"/></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><h4>3. Scheduled Job</h4><p></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">Now we need to create the scheduled job which should once every day to see if there is any knowledge articles which is get close to the valid to date. This job goes through the encoded query and for each record it finds that matches the query it will fire of an event so the notifications can be sent. It looks like this and the code is below the picture.</p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"><img class="jive-image" src="http://4.bp.blogspot.com/-VF0BaKZMQr0/VuVuTge2lGI/AAAAAAAAAbQ/U424ST2ktv8NAa-WgOPIaQzcqy6edQsXg/s1600/sche%2Bkb%2Bman%2B3.GIF"/></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><div><span style="font-size: x-small;"><em>var gr = new GlideRecord('kb_knowledge');</em></span><p></p><p><span style="font-size: x-small;"><em>gr.addEncodedQuery('workflow_state=published^active=true^valid_toRELATIVEEE@dayofweek@ahead@1');</em></span></p><p><span style="font-size: x-small;"><em>gr.query();</em></span></p><p></p><p><span style="font-size: x-small;"><em>while (gr.next()) {</em></span></p><p><span style="font-size: x-small;"><em>gs.eventQueue("knowledge.expiring", gr);</em></span></p><p><span style="font-size: x-small;"><em>}</em></span></p></div><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">As you can see in the gs.eventQueue we only have "<em>gs.eventQueue("knowledge.expiring", gr)</em>" in many cases you also specify parameters 1 &amp; 2 like this: "<em>gs.eventQueue("incident.commented", current, gs.getUserID(), gs.getUserName());</em>". But since we don't need those, we just skip them.</p><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;"></p><h4 style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">4. Notification</h4><p style="color: #333333; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 14.85px;">Now we only have the notification left. Its pretty, simple. set that it will fire on the event and specify who will recieve it and finally the text for the notification. I'm just showing the section with the "when". The rest is purely case specified, but if there is any questions about it, just post a comment and I'll get back to you.</p><p></p><p><img class="jive-image" src="http://2.bp.blogspot.com/-RmSRLWaVgWA/VuZm4jcL_8I/AAAAAAAAAbw/wqcCZGmNBDwrZDLgp6H4zCtRah-Y3_bqg/s1600/sche%2Bkb%2Bman%2B4.GIF"/></p><p></p><p>Well, that it. =)</p><p></p><p>//GÃ¶ran</p><p></p><p></p><p><img  alt="Symfoni Logo Color Box.jpg" class="image-1 jive-image" height="58" src="92fb00cadb1c1344e9737a9e0f961964.iix" style="width: 198px; height: 57.6px;" width="198"/><img  alt="sn-community-mvp.png" class="image-2 jive-image" src="49917379db9c1fc03eb27a9e0f961962.iix" style="width: auto; height: auto;"/></p>