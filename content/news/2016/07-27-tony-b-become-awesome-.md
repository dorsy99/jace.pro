---
title: "Become Awesome with Event Rules"
date: 2016-07-26T05:42:31.000Z
authors: ["Tony B"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=6f8caae1dbd0dbc01dcaf3231f961914"
---
<p>In my last <a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=bacca265dbd0dbc01dcaf3231f961975">blog</a>, I described how you could use Event Rules to create meaningful alerts, while also introducing flexibility to cater for some variations.   The example in the blog was fairly simple, so in this blog we'll up the difficulty factor and push the Event Rule Transform operation further.</p><p></p><p>In order to demonstrate this I'm going to enlist the services of our tame Solution Consultant.</p><p></p><p>Some say that he wanted to start a rock band called Woven Cries before music was invented, and that he inhales nitrous oxide to clear his nasal passages.   All we know is that he's called The Scid!</p><p></p><p>Possibly a distant relative of <em>The Stig</em> from BBC's <em>Top Gear</em> TV show, The Scid starts off by looking at raw events in the <strong>All Events</strong> list view, and finds one that's particularly nasty.   Nasty as in: no description, no event type, no severity... does it get any worse than this??   It's almost as if the event was created just so a blog could be written...</p><p><img   alt="event-1.png" class="image-1 jive-image" src="8f7bc88adb9cdb048c8ef4621f9619a0.iix" style="width: 620px; height: 135px;"/></p><p>Anyhoo, he opens the event to see what he's got to work with.   The <em>Node</em> field should be a hostname, there's no value for <em>Type</em>, <em>Resource</em> or <em>Severity</em> and the event <em>State</em> is "<strong>Error</strong>".</p><p><img   alt="event-2.png" class="image-2 jive-image" src="4fa077f5db5c93041dcaf3231f961921.iix" style="width: 620px; height: 464px;"/></p><p>If he was able to speak, The Scid might utter a four letter obscenity... like "SNMP!".   Fortunately the <strong>Description</strong> and <strong>Additional information</strong> fields contain information that could be useful.   <strong>Additional information</strong> contains an <em>itemName</em> field with a <em>Synthetic Transaction Check</em> value that would be a good choice for an alert Type, while the <em>status</em> field could be mapped to Severity as The Scid knows it can be either <em>PROBLEM</em> or <em>OK</em>.</p><p></p><p>Scid can beat this nasty event into submission through the judicious application of <span style="text-decoration: line-through;">a sledgehammer</span> an Event Rule.   He reaches for the keyboard and cunningly turns to <a title="egex101.com/" href="https://regex101.com/">regex101.com</a> which he will use to build what he needs to produce an awesome Event Rule.     Taking the text from the event's <em>Description</em> field, he pastes it into <strong>Regular Expression</strong> and <strong>Test String</strong> sections of the regex101 web page:</p><p><img   alt="regex101-1.png" class="image-3 jive-image" src="55fc094adb54130468c1fb651f96197a.iix" style="width: 620px; height: 355px;"/></p><p>Regex101 allows you to build and test regular expressions using sample text and show the results in the Match Information section, plus it includes a useful quick reference guide for commonly used tokens.   Regex101 is showing our Scid that there's an error caused by unescaped delimiters, but this barely registers on his care factor scale.   The Scid wants to extract the correct Node and a Resource from the description field, so he uses a capture group:</p><p><img   alt="regex101-2.png" class="image-4 jive-image" src="415ee8cadb18dfc068c1fb651f961971.iix" style="width: 620px; height: 198px;"/></p><p>That gives him what looks like a big URL, but he really wants to split that into FQHN and resource, so he first tries matching the forward slash (escaping it with a backslash):</p><p><img   alt="regex101-3.png" class="image-5 jive-image" src="27ea00cadb5017041dcaf3231f961974.iix" style="width: 620px; height: 202px;"/></p><p>The Match Information shows the result... have to try <em>harder</em>, Sciddy!   That earns a chilling stare from the man in the mask and he comes up with a regex that gives the desired result:</p><p><img   alt="regex101-4.png" class="image-6 jive-image" src="3a0eaf31db1c93049c9ffb651f961981.iix" style="width: 620px; height: 228px;"/></p><p>The Scid has seen many things over the aeons including an event whose description ends in "<em>returned</em> an ok state".   The regex will be changed to accommodate a description that contains either "not return" or "return", however capturing this group greatly displeases The Scid so he wields the non-capture   "?:" magik:</p><p><img   alt="regex101-6.png" class="image-10 jive-image" src="82a15146db581b04ed6af3231f9619e9.iix" style="width: 620px; height: 214px;"/></p><p></p><p>Thank you, Regex101, Google and all those awesome <span style="text-decoration: line-through;">nerds</span> regex gurus!   While he may be able to Google fast, can the Scid put this regex to any use?   He returns to his ServiceNow instance, goes to <strong>Event Management &gt; Rules &gt; Event Rules</strong> and clicks on the <strong>New</strong> action button.   Gloved fingers fly over the keyboard and before long an Event Rule has been created:</p><p><img   alt="event_rule_1a.png" class="image-11 jive-image" src="1f2f284adb949344e9737a9e0f9619da.iix" style="width: 620px; height: 540px;"/></p><p>The Scid pastes the regex he devised in regex101.com into the <em>Regular expression</em> column for the description field in the <strong>Event Match Fields</strong> section.   He maps the matching capture groups in the regex to the <em>node</em> and <em>resource</em> fields.   Event Rules allow you to map <em>multiple</em> capture groups to <em>multiple</em> fields (OOTB alert fields, or <em>non</em>-OOTB fields stored as JSON pairs in the <em>additional_info</em> field).   The Scid then composes the <em>type</em> field to use the itemName value extracted from the a<em>dditional_info</em> field.   To make sure the Event Rule is applied to the correct events, he adds itemName to the <strong>Additional Filter</strong> and sets it to match <em>Synthetic Transaction Check</em>.</p><p></p><p>But he's not done yet - astute readers will recall that the State of the processed event was <em>Error</em>.   That's not good.   So the Scid creates an <strong>Event Field Mapping Rule</strong> by navigating to <strong>Event Management &gt; Rules &gt; Event Field Mapping Rule</strong> and clicking on <strong>New</strong>:</p><p><img   alt="event_field_mapping_rule_1.png" class="image-8 jive-image" src="62331986dbd89f048c8ef4621f961946.iix" style="width: 620px; height: 302px;"/></p><p>When an event occurs that contains a <em>status</em> field set to PROBLEM, the <em>severity</em> will be set to 2 (i.e. Major) and when an OK is received <em>severity</em> will be set to zero (i.e. Clear).   Let's get out the stopwatch and test The Scid's awesomeness.   Sending event... <em>GO!!!</em></p><p><img   alt="alert-1.png" class="image-9 jive-image" src="3f347ff9db10d3049c9ffb651f961932.iix" style="width: 620px; height: 221px;"/></p><p>... a-a-a-n-n-d the <em>alert</em> crosses the finish line!   Not only is the event successfully processed, but the resulting Alert now contains the correct <em>Node</em>, <em>Type</em> and <em>Resource</em> and a <em>Severity</em>.</p><p>When a clearing event arrives (it's not made up, right?), the Event Rule ensures the event is correctly matched to and closes the alert:</p><p><img   alt="alert-3.png" class="image-12 jive-image" src="816dc00edb509fc03eb27a9e0f96191d.iix" style="width: 620px; height: 226px;"/></p><p></p><p>The Scid may give nothing away when it comes to facial expressions (he wears a mask), but he does like sharing his <span style="text-decoration: line-through;">tool</span> (ahem)... <em>tools</em> of the trade.   With the aid of cattle prods The Scid is packed back into into his cozy cryotube ready for the next blog.</p><p></p><p>So the next time you're confronted by a nasty raw event, remember that you too can become awesome with event rules... just like The Scid <span __jive_emoticon_name="cool" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="4270_881.640625_16_16" src="/8.0.4.21bdc7e/images/emoticons/cool.png"></span>.</p>