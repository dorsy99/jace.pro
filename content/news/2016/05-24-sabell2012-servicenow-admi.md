---
title: "ServiceNow Admin  How to Do a UNION Query Using GlideRecord"
date: 2016-05-23T17:18:33.000Z
authors: ["sabell2012"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=a6dc2a65dbd0dbc01dcaf3231f961973"
---
<p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>NOTE</strong></span>: ON APRIL 1, 2016 ACCENTURE COMPLETED THE ACQUISITION PROCESS OF CLOUDSHERPAS.   AT THAT TIME THE CLOUDSHERPAS BLOG SITES WERE DOWNED FOREVER.</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">THIS IS THE RE-PUBLICATION OF MY ARTICLE FROM <span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>December 11, 2014</strong></span> ON THE CLOUDSHERPAS SERVICENOW SCRIPTING 101 BLOG.</p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="color: #e23d39;">WITH THE IMPLEMENTATION OF GENEVA <strong>gs.sql</strong> IS <span style="text-decoration: underline;">NO LONGER AVAILABLE</span>.</span></p><p style="font-family: arial, sans-serif; color: #666666;">____________________________________________________________________________</p><p></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">In my previous article (<span style="font-size: 16px; font-family: arial, helvetica, sans-serif; color: #666666;"><strong><a title="" _jive_internal="true" data-containerid="1007" data-containertype="37" data-objectid="5418" data-objecttype="38" href="/community?id=community_blog&sys_id=412d26e5dbd0dbc01dcaf3231f96198e" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8; text-decoration: underline;">ServiceNow Admin 101: You Too Can Do DISTINCT Queries Using GlideRecord</a></strong></span>) I demonstrated how to do a variety of DISTINCT queries using GlideRecord.   Now let me show how you can do something similar to do a UNION query.</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">So, what is a UNION query?   It is where you take data from two unrelated tables and bring them together into a single record set. </span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">For example to do this in SQL you might write something like this to obtain a list of Assigned To users from both the Asset and CMDB CI tables.   Notice that these fields are not linked in any way.   In other words the final list contains two different lists combined.   Both of these fields are reference fields to the sys_user table.     I put in the "type" field to show what table the user name is coming from.</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'courier new', courier;">SELECT DISTINCT user1.name as name, 'ASSET' as type <br/> FROM <strong>alm_asset</strong> asset JOIN <strong>sys_user</strong> user1 ON asset.assigned_to = user1.sys_id <br/> WHERE asset.assigned_to IS NOT NULL <br/> GROUP BY user1.name<br/> <strong>UNION</strong><br/> SELECT DISTINCT user2.name, 'CI' as type <br/> FROM <strong>cmdb_ci</strong> ci JOIN <strong>sys_user</strong> user2 ON ci.assigned_to = user2.sys_id   <br/> WHERE ci.assigned_to IS NOT NULL <br/> GROUP BY user2.name</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">Now using Scripts — Background (don't forget to elevate your privs to Security Admin) this can be modeled using gs.sql thusly:</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">var sql = "(SELECT DISTINCT user1.name as name, <span style="color: #3d3d3d;">'ASSET' as type FROM alm_asset asset JOIN sys_user user1 ON asset.assigned_to = user1.sys_id WHERE asset.assigned_to IS NOT NULL GROUP BY user1.name ) ";</span><br/> <br/> </span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console'; color: #3d3d3d;">sql += 'UNION ';<br/> <br/> </span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';"><span style="color: #3d3d3d;">sql += "(SELECT DISTINCT user2.name, 'CI' as type FROM cmdb_ci ci JOIN sys_user user2 ON ci.assigned_to = user2.sys_id   WHERE ci.assigned_to IS NOT NULL GROUP BY user2</span>.name ) ";<br/> <br/> </span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">sql += 'ORDER BY name';<br/> <br/> gs.sql(sql);</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">And produces something like the following list:</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;"><img   class="image-3 jive-image" src="cdd7d042dbd89704ed6af3231f9619e0.iix" style="max-width: 1200px; max-height: 900px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">If we take the "type" field off we get a nicely DISTINCT'ed list of user names from both tables:</span></p><p></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14636742652223073 jive_macro_code jive_text_macro" data-renderedposition="1649_8_1192_144" jivemacro_uid="_14636742652223073"><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">var sql = "(SELECT DISTINCT user1.name as name FROM alm_asset asset JOIN sys_user user1 ON asset.assigned_to = user1.sys_id WHERE asset.assigned_to IS NOT NULL GROUP BY user1.name ) ";<br/>   </span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">sql += 'UNION ';<br/>   </span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">sql += "(SELECT DISTINCT user2.name FROM cmdb_ci ci JOIN sys_user user2 ON ci.assigned_to = user2.sys_id   WHERE ci.assigned_to IS NOT NULL GROUP BY user2.name ) ";</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';"> sql += 'ORDER BY name';<br/> <br/> gs.sql(sql);</span></p></pre><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;"><img   class="jive-image image-4" src="dce87731db145fc068c1fb651f961992.iix" style="max-width: 1200px; max-height: 900px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">Unfortunately the <strong>gs.sql</strong> statement does us no good as it does not return a result set we can use like GlideRecord does.</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">So, now we have to translate all of this into GlideRecord script like this:</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14636741611816407 jive_text_macro" data-renderedposition="2423_8_1192_448" jivemacro_uid="_14636741611816407"><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">// final result list</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">var userList = [];</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">// Asset names</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">var asset = new GlideRecord('alm_asset');</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">asset.addNotNullQuery('assigned_to');</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">asset.query();</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">while (asset.next()) {</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">     userList.push(asset.assigned_to.name + '');</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">}</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">// CMDB_CI names</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">var cmdbCI = new GlideRecord('cmdb_ci');</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">cmdbCI.addNotNullQuery('assigned_to');</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">cmdbCI.query();</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">while (cmdbCI.next()) {</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">     userList.push(cmdbCI.assigned_to.name + '');</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">}</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">// now sort (order by name) the array and DISTINCT the name list</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">userList = new ArrayUtil().unique(userList.sort());</span></p><p></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">// now print off the results</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">for (var i = 0; i &lt; userList.length; i++) {</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">     gs.print(userList[i]);</span></p><p style="margin-left: .5in; margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: 'Lucida Console';">}</span></p></pre><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">This nicely re-produces our desired list:</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;"><img   class="image-5 jive-image" src="a24d91cadbdc9f048c8ef4621f961940.iix" style="max-width: 1200px; max-height: 900px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">Obviously this is just one of many possible UNION queries.   Some other possibilities are:</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">A combined list of:</span></p><p></p><ul style="list-style-type: disc;"><li><span style="font-size: 12pt;">IP Phones, and Printers using the cmdb_ci_ip_phone and cmdb_ci_printer tables</span></li><li><span style="font-size: 12pt;">Business Systems and Applications using the cmdb_ci_systems and cmdb_ci_appl tables</span></li><li><span style="font-size: 12pt;">Routers and Switches using cmdb_ci_ip_router and cmdb_ci_ip_switch</span></li></ul><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">And so on!</span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">BTW, ArrayUtil has a "union" function where you can join two arrays together. Check it out: <a title="ki.servicenow.com/index.php?title=ArrayUtil" href="http://wiki.servicenow.com/index.php?title=ArrayUtil">ArrayUtil Wiki</a>   </span></p><p></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">Also, a couple of best practices concerning gs.sql:</span></p><p></p><ol style="list-style-type: decimal;"><li><span style="font-size: 12pt;">Do not use it for anything but modeling SQL statements in Scripts — Background.   It makes a great way to verify counts.</span></li><li><span style="font-size: 12pt;">It does not return a resultset you can use in your code.</span></li><li><span style="font-size: 12pt;">If you use a table upstream you have to join in every table in the hierarchy (sic. cmdb_ci_computer has to be joined with cmdb_ci to get ALL fields into the query — this is a pain compared to GlideRecord which pulls everything in the hierarchy automatically for you).</span></li></ol><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">Steven Bell</span></p><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="color: purple; font-weight: inherit; font-size: 12pt; font-family: inherit; font-style: inherit;"><strong><a _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="110061" data-objecttype="111" href="/servlet/JiveServlet/downloadImage/38-5414-110061/accenture technology logo.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="accenture technology logo.png" class="image-1 jive-image" height="52" src="e9d7d882db589fc03eb27a9e0f9619d7.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="277"/></a><a _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="110062" data-objecttype="111" href="/servlet/JiveServlet/downloadImage/38-5414-110062/sn-community-mvp.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="sn-community-mvp.png" class="image-2 jive-image" height="48" src="ea665042db189fc03eb27a9e0f961913.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="135"/></a></strong></span></p><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>For a list of all of my articles:   <a title="" _jive_internal="true" data-containerid="1027" data-containertype="37" data-objectid="4821" data-objecttype="38" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/23/community-code-snippets-articles-list-to-date" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;">Community Code Snippets: Articles List to Date</a></strong></span></p><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit; color: #eb7a3d;">Please Share, Like, Bookmark, Mark Helpful, or Comment this blog if you've found it helpful or insightful.</span></p><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit; color: #eb7a3d;">Also, if you are not already, I would like to encourage you to become a member of our blog!</span></p><p></p><hr/><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #303030;">Click for <a title="" _jive_internal="true" href="/community?id=community_forum&sys_id=a6299a2ddbd897c068c1fb651f961926" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;">More Expert Blogs </a>and also Find <a title="" _jive_internal="true" class="jivecontainerTT-hover-container jive-link-community-small" data-containerid="2059" data-containertype="14" data-objectid="2037" data-objecttype="14" href="/community?id=community_forum&sys_id=d6295a2ddbd897c068c1fb651f9619f1" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;">Expert Events</a>!</span></p><hr/>