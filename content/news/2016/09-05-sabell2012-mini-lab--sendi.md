---
title: "MiniLab Sending a JSON Object to a Workflow"
date: 2016-09-04T18:24:11.000Z
authors: ["sabell2012"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=5d5d6629dbd0dbc01dcaf3231f961932"
---
<p dir="ltr"><span style="font-size: 8pt;"><span style="font-family: 'Times New Roman'; color: #666666; font-weight: bold;">NOTE</span><span style="font-family: Arial; color: #666666;">: </span><span style="font-family: 'Times New Roman'; color: #666666;">MY POSTINGS REFLECT MY OWN VIEWS AND DO NOT NECESSARILY REPRESENT THE VIEWS OF MY EMPLOYER, ACCENTURE. </span></span></p><p dir="ltr"></p><p dir="ltr"><span style="font-size: 12pt;"><span style="font-family: 'Times New Roman'; color: #666666;">DIFFICULTY LEVEL:   </span><span style="font-family: 'Times New Roman'; color: #ff0000; font-weight: bold;">ADVANCED <span style="color: #303030;">to</span> <span style="color: #7a0000;">EXPERT</span></span></span></p><p dir="ltr"><span style="font-family: 'Times New Roman'; color: #666666;">Assumes <span style="text-decoration: underline;">very</span> <span style="text-decoration: underline;">good</span> knowledge and/or familiarity of scripting, and workflows in ServiceNow.</span></p><p dir="ltr"><span style="font-family: Arial; color: #666666;">____________________________________________________________________________</span></p><p></p><p dir="ltr" style="margin-bottom: 7pt;"><span style="font-size: 16px; font-family: Arial; color: #485563;">Recently I had the need to port a large JSON object (not a GlideRecord) from code to a called Workflow.   Simple, I said, I will just pass it through the variables parameter of my startFlow command.   Not.   startFlow, it appears, replaces all sorts of important characters in the object; scrambling it and making it garbage on the receiving end!   It helps you!   Arrrgh! - a technical term expressing frustration.   Well, a need-is-a-need and I had to have a solution.   Here is what I came up with.</span></p><p></p><p dir="ltr" style="margin-bottom: 7pt;"><span style="font-size: 16px; font-family: Arial; color: #485563; font-weight: bold;">Caveat:</span></p><ol><li><span dir="ltr" style="margin-bottom: 7pt; font-size: 12pt;">DO NOT BOTHER USING THIS METHOD TO SEND A CONVERTED GLIDERECORD.   You can just go get this via a GlideRecord call from the workflow.   We ARE all server-side here after all!   So in my examples...what did I do?   I converted a couple of GlideRecords to give me some test data.   Do as I say, not as I do!   :-)</span></li><li><span dir="ltr" style="margin-bottom: 7pt; font-size: 12pt;">Remember to play with these techniques in a sandbox or in your personal developer instance.   Please don't play with code like this in Production!   Seriously.</span></li></ol><p><span><span><br/><span style="color: #485563; font-weight: bold; font-size: 16px; font-family: Arial; margin-bottom: 7pt;">Design:</span></span></span></p><p></p><p><span style="color: #485563; font-size: 16px; font-family: Arial; margin-bottom: 7pt;">So the process will be to take our object, convert it to JSON, convert THAT to a string, then URL encode it (the secret).   However, you still have to tweak the encode a bit to get it to work (some character replacement).   Then on the workflow side-of-things we reverse the process.   Think Star Trek Transporter!   :-)</span></p><p></p><p><span style="color: #485563; font-size: 12pt; font-family: Arial; margin-bottom: 7pt;">From the calling script:</span></p><p></p><ol><li><span dir="ltr" style="font-size: 12pt;">Create an object, or object array</span></li><li><span dir="ltr" style="font-size: 12pt;">Convert the object to JSON</span></li><li><span dir="ltr" style="font-size: 12pt;">JSON Stringify the object</span></li><li><span dir="ltr" style="font-size: 12pt;">URL Encode the string</span></li><li><span dir="ltr" style="margin-bottom: 7pt; font-size: 12pt;">Fix up the encoded URL</span></li></ol><p><span style="font-size: 12pt;"><br/><span style="color: #485563; font-family: Arial; margin-bottom: 7pt;">From the workflow:</span></span></p><p></p><ol><li><span dir="ltr" style="font-size: 12pt;">URL Decode the string</span></li><li><span dir="ltr" style="font-size: 12pt;">Unfix the decoded string </span></li><li><span dir="ltr" style="font-size: 12pt;">JSON Parse the object</span></li><li><span dir="ltr" style="margin-bottom: 7pt; font-size: 12pt;">Begin using the object</span></li></ol><p></p><p><span><span><br/><span style="color: #485563; font-weight: bold; font-size: 14pt; font-family: Arial; margin-bottom: 7pt;">Lab 1.1: The Calling Script</span></span></span></p><p></p><p><span style="color: #485563; font-size: 16px; font-family: Arial; margin-bottom: 7pt;">The following code can be run on any server-side script (Business Rules, Script Includes, Scheduled Jobs, Script Actions; to name a few).   We will be using a Fix Script to do the work for us.   I will be incorporating a couple of other articles I had written some time back to give us some test data to play with.</span></p><p></p><p><span style="color: #1155cc; text-decoration: underline; font-size: 16px; font-family: Arial; margin-bottom: 7pt;"><a title="Community Code Snippets - Current Factory" __default_attr="4508" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Community Code Snippets - Current Factory" data-renderedposition="993.0397338867188_7.997159004211426_334_18" href="/community?id=community_blog&sys_id=9bcda2e9dbd0dbc01dcaf3231f9619e5">Community Code Snippets - Current Factory</a> </span></p><p><span style="color: #1155cc; text-decoration: underline; font-size: 16px; font-family: Arial; margin-bottom: 7pt;"><a title="Mini-Lab: Extending the GlideRecord Object" __default_attr="4752" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Mini-Lab: Extending the GlideRecord Object" data-renderedposition="1016.6760864257812_7.997159004211426_330_18" href="/community?id=community_blog&sys_id=b96c2ea1dbd0dbc01dcaf3231f9619b9">Mini-Lab: Extending the GlideRecord Object</a> </span></p><p></p><p><span style="color: #485563; font-size: 12pt; font-family: Arial; margin-bottom: 7pt;">I have attached the code for both of these to this article.   I would suggest reading both if you want to understand how they actually work, but it is not necessary if you just want focus on this article.   Import the attached files to bring these libraries into your developer instance.</span></p><p></p><ol><li><span dir="ltr" style="font-size: 12pt;">Navigate to Fix Scripts.   The Fix Scripts List View will be displayed.</span></li><li><span dir="ltr" style="font-size: 12pt;">Click on the New button.   This will display a New Fix Script form.</span></li><li><span dir="ltr" style="font-size: 12pt;">Fill out the form with the following:</span><ol><li><span dir="ltr" style="font-size: 12pt;"><strong>Name</strong>: Send JSON to Workflow</span></li><li><span dir="ltr" style="font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span dir="ltr" style="font-size: 12pt;"><strong>Description</strong>: Example of sending a JSON object to a workflow</span></li><li><span dir="ltr" style="margin-bottom: 7pt; font-size: 12pt;"><strong>Script</strong>:</span></li></ol></li></ol><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14729549266055718 jive_macro_code jive_text_macro" data-renderedposition="1335.4261474609375_7.997159004211426_1192_881" jivemacro_uid="_14729549266055718"><p>gs.include('ACNTableUtils'); // currentFactory, listFactory</p><p>// this has been improved since the article was written</p><p>gs.include('ACNGlideRecordExtensions'); // toObject, toObjectList</p><p></p><p>// get a single incident record and convert it to an object</p><p>var current = ACNTableUtils.currentFactory('incident').toObject();</p><p></p><p>// got get a bunch of records and convert it to an object array</p><p>var order = {};</p><p>order.type = 'descending';</p><p>order.field = 'number';</p><p>// just showing off here - the toObjectList part isn't really necessary   :-)</p><p>var incidentList = ACNTableUtils.listFactory('incident', 5, order).toObjectList();</p><p></p><p>// there is a LOT of stuff in a GlideRecord so let's pick off a couple of things</p><p>// we could pass across for a test</p><p>var incidents = [];</p><p>for (var i=0; i &lt; incidentList.length; i++) {</p><p>       var incident = {};</p><p>       incident.number = incidentList[i].number;</p><p>       incident.sys_id = incidentList[i].sys_id.toString();</p><p>       incident.short_description = global.JSUtil.notNil(incidentList[i].short_description) ? incidentList[i].short_description : 'nuttin here';</p><p>       incidents.push(incident);</p><p>}</p><p>// end of test data setup</p><p></p><p>var short_description = current.short_description;</p><p>var number = current.number + '';</p><p>var testList = ['cows', 'chickens', 'pigs', 'horses'];</p><p></p><p>// From this point is where we set up the send</p><p>var payload = {};</p><p>payload.short_description = short_description;   // single value</p><p>payload.number = number; </p><p>payload.testList = testList; // simple array</p><p>payload.incident = current; // complex object</p><p>payload.incidentList = incidents; // object array</p><p></p><p>// turn the payload into a JSON object and stringify it</p><p>payload = global.JSON.stringify(payload); </p><p></p><p>var workflow = new Workflow();</p><p>var workflowID = workflow.getWorkflowFromName('Send JSON to Workflow');</p><p></p><p>var vars = {};</p><p>// now we encode it and fix it up before startFlow can destroy it</p><p>// colens and brackets are problems. Oddly you have to reconstitute the brackes here,</p><p>// and replace the colens.   startFlow has a lot to answer for</p><p>// place the string into our inbound variable.</p><p>vars.u_payload = encodeURI(payload).replace(/%5b/g, '[').replace(/%5D/g, ']').replace(/:/g, '%3A');</p><p></p><p>// now call the workflow and pass our object</p><p>workflow.startFlow(workflowID, null, null, vars);</p><p></p><p></p><p></p><p></p></pre><p><span><span><br/><span style="margin-left: 36pt; color: #485563; text-indent: 36pt; font-size: 16px; font-family: Arial; margin-bottom: 7pt;">5. Save your work.</span></span></span></p><p></p><p><span><span><span style="color: #485563; font-size: 16px; font-family: Arial; margin-bottom: 7pt;"><img   class="image-1 jive-image" src="dc70444edb185fc03eb27a9e0f96190e.iix" style="max-width: 1200px; max-height: 900px;"/></span><br/></span></span></p><p></p><p><span style="color: #485563; font-weight: bold; font-size: 14pt; font-family: Arial; margin-bottom: 7pt;">Lab 1.2: The Workflow</span></p><p></p><p style="padding-left: 30px;"><span dir="ltr" style="font-size: 12pt;">1. Navigate to Workflow -&gt; Workflow Editor</span></p><p style="padding-left: 30px;"><span dir="ltr" style="font-size: 12pt;">2. Create a new Workflow</span></p><ol><ol><li><span dir="ltr" style="font-size: 12pt;"><strong>Name</strong>: Send JSON to Workflow</span></li><li><span dir="ltr" style="font-size: 12pt;"><strong>Table</strong>: Global</span></li></ol></ol><p></p><p style="padding-left: 30px;"><span dir="ltr" style="font-size: 12pt;">3. Create a new input variable: u_payload, length 8000.   </span></p><p style="padding-left: 60px;"><span dir="ltr" style="font-size: 12pt;"><strong>NOTE</strong>: you might want to make this bigger if you have a lot of data you are bringing across!   Otherwise your string gets truncated and you get strange conversion errors from the JSON decode!</span></p><p></p><p style="padding-left: 30px;"><span dir="ltr" style="font-size: 12pt;">4. Pull out a Run Script Activity</span></p><ol><ol><li><span dir="ltr" style="font-size: 12pt;"><strong>Name</strong>: Initialize</span></li><li><span dir="ltr" style="font-size: 12pt;"><strong>Script</strong>:</span></li></ol></ol><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1472955007096820 jive_text_macro" data-renderedposition="3400.397705078125_7.997159004211426_1192_680" jivemacro_uid="_1472955007096820"><p>var location = context.name + '.' + activity.name;</p><p>var payloadDecode = decodeURI(workflow.variables.u_payload);</p><p>// prep the string prior to reconstituting the JSON. </p><p>// Colens are the only issue, all the rest get handled by the decodeURI</p><p>payloadDecode = payloadDecode.replace(/%3A/g, ':');   </p><p></p><p>// we can now parse the string into a JSON object</p><p>var payload = JSON.parse(payloadDecode);</p><p></p><p>// now we can start using the values</p><p>var short_description = payload.short_description;</p><p>var number = payload.number;</p><p>var testList = payload.testList; // simple array</p><p>var incident = payload.incident; // complex object</p><p>var incidentList = payload.incidentList; // object array</p><p></p><p>var message = '---&gt;\n';</p><p></p><p>message += '\tshort_description: ' + short_description + '\n';</p><p>message += '\tNumber: ' + number + '\n';</p><p>message += '\tTestList length: ' + testList.length + '\n';</p><p></p><p>for (var i=0; i &lt; testList.length; i++) {</p><p>   message += '\t- ' + testList[i];</p><p>}</p><p>message += '\n';</p><p></p><p>message += '--- incident\n';</p><p>message += 'number: ' + incident.number;</p><p>message += '\tsys_id: ' + incident.sys_id + '\n';</p><p></p><p>message += '--- incidentList\n';</p><p>for (var j=0; j &lt; incidentList.length; j++) {</p><p>   var incident = incidentList[j];</p><p>   message += 'number: ' </p><p>   + incident.number </p><p>   + '\t- short_description: ' </p><p>   + incident.short_description.replace(/~/g,' ') + '\n';</p><p>}</p><p></p><p>gs.log(message, location);</p><p></p><p></p><p></p></pre><p></p><p><span><span><br/><span dir="ltr"><span style="font-size: 16px; font-family: Arial; color: #000000;">   </span><span style="font-size: 16px; font-family: Arial; color: #000000;">   </span><span style="font-size: 16px; font-family: Arial; color: #000000;">5. Click update.</span></span></span></span></p><p></p><p><span><span><span style="color: #000000; font-size: 16px; font-family: Arial;"><img class="jive-image" height="436" src="https://lh6.googleusercontent.com/UL_KqGWB460U-tCwfanohvzX-XeCNbbpfuNJSIJIPfQvJGRvGX5y2-c_pU-voBvby58hXeHQTF4PvNm_hwqdscosqtK6sO6maX3TKp6t34uKpo1lzgyGgvz9PZtLWg4KvjkR5B22" style="border-style: none; display: block; margin-left: auto; margin-right: auto;" width="624"/></span><br/></span></span></p><p></p><p><span style="color: #485563; font-weight: bold; font-size: 14pt; font-family: Arial; margin-bottom: 7pt;">Lab 1.3: Test</span></p><p></p><ol><li><span dir="ltr" style="font-size: 12pt;">Go back to your fix script, and run it.   You should see something like the following results:</span></li></ol><p></p><p dir="ltr"><span style="font-size: 16px; font-family: Arial; color: #000000;"><img class="jive-image" height="489" src="https://lh6.googleusercontent.com/5YjA1uUC4FfFUnFCQ7mlkIMfgke56Y79fpGclZzTcCd4kb5pZH3GJLEAK1_LLob4z0xo7J6Wb6uoMY37c8Ve8hdQSTg40tXwgmT4F0V48qvBBonHdNtrk0VKegJvf_JLdYTA1MNt" style="border-style: none; display: block; margin-left: auto; margin-right: auto;" width="624"/></span></p><p></p><p dir="ltr"><span style="font-size: 16px; font-family: Arial; color: #000000;">And there you go!   Remember:   If you get strange conversion errors in the workflow code it is probably because you overran 8000 characters in your string.   Just increase the u_payload size to correct the issue.</span></p><p></p><p dir="ltr"><span style="font-size: 16px; font-family: Arial; color: #000000;">Steven Bell</span></p><p></p><p dir="ltr"><span style="font-size: 14.6667px; font-family: Arial; color: #000000;"><img class="jive-image" height="39" src="https://lh3.googleusercontent.com/vVCH66Dx2rdmb0Kcbp7gEbNZIpE9lbP4k6ZY8m8FGkUOpwOq4jXQmUcT7unaRAUAaIKRYxNjgwlHUR7lAFa4_bkLT7EiMPQ9zmLjKwnDo_9hVNCKI6Jhlp0gM_A3Ti75H_NI-83Z" style="border-style: none;" width="208"/></span></p><p dir="ltr"><span style="font-size: 14.6667px; font-family: Arial; color: #000000;"><img class="jive-image" height="36" src="https://lh6.googleusercontent.com/q4fEgaOsabj9CnHhfOoT8K8v9dz1HXnCUCkpeQSX_1ne0S_sFpY1W2MZM4utRZ5X4VOoTo3WXWhC6TVT1zlpt9YRSVK0rdDwgfKuvz4XbEWENB3h2f7DPvAwy7CVJdyjyBYj1cFt" style="border-style: none;" width="102"/></span><span style="font-size: 14.6667px; font-family: Arial; color: #000000;"><img class="jive-image" height="36" src="https://lh3.googleusercontent.com/LfFtywpI2YC2ivH6nxLA6UieUjYQLeMekI7qSbgM-8JroIQVmM1JJgQkGTzYI8O3N8noFWc-VfqACg7h2FuaClL51-TKzMT-3yOSggmx6nkRHxjaxQRGKD09bu0SQpVPpgIg-LcH" style="border-style: none;" width="102"/></span><span style="font-size: 14.6667px; font-family: Arial; color: #000000;"><img class="jive-image" height="36" src="https://lh6.googleusercontent.com/tuw0Tbct30Q7cpdvL-cjTEbWvH3KtoIHRwJfSMQ5ftvSSbEjtbUsVWnKfBPslmVYK_46RXc_9DdSsh6mLvs86FIWxKdMsaNqPGZj_uD5BhDLOpJmovPqHaNqHcX3DLxSjbJKdilo" style="border-style: none;" width="102"/></span></p><p dir="ltr"></p><p dir="ltr"><span style="font-family: Arial; color: #666666; font-weight: bold;">For a list of all of my articles:   </span><a _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/23/community-code-snippets-articles-list-to-date"><span style="font-family: Arial; color: #266fc8; font-weight: bold;">Community Code Snippets: Articles List to Date</span></a></p><p dir="ltr"></p><p dir="ltr"><span style="font-size: 16px; font-family: Arial; color: #eb7a3d;">Please Share, Like, Bookmark, Mark Helpful, or Comment this blog if you've found it helpful or insightful.</span></p><p dir="ltr"></p><p dir="ltr"><span style="font-size: 16px; font-family: Arial; color: #eb7a3d;">Also, if you are not already, I would like to encourage you to become a member of our blog!</span></p>