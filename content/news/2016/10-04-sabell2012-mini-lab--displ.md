---
title: "MiniLab Displaying all Affected CIs on a Problem Form"
date: 2016-10-03T05:00:41.000Z
authors: ["sabell2012"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=543eaa6ddbd0dbc01dcaf3231f9619ff"
---
<p style="margin-bottom: 0.0001pt;"><span style="color: #666666; background: white; font-size: 10.5pt; font-family: Arial, sans-serif;"><strong>NOTE</strong></span><span style="font-size: 10.5pt; font-family: Arial, sans-serif; color: #666666; background: white;">: MY POSTINGS REFLECT MY OWN VIEWS AND DO NOT NECESSARILY REPRESENT THE VIEWS OF MY EMPLOYER, ACCENTURE.</span></p><p style="margin-bottom: 0.0001pt;"></p><p style="margin-bottom: 0.0001pt;"></p><p style="margin-bottom: 0.0001pt;"><span style="font-size: 11pt; font-family: Arial, sans-serif; color: #666666; background: white;">DIFFICULTY LEVEL:   </span><span style="color: #7f6000; background: white; font-size: 11pt; font-family: Arial, sans-serif;"><strong>INTERMEDIATE</strong></span></p><p style="margin-bottom: 0.0001pt;"><span style="font-size: 11pt; font-family: Arial, sans-serif; color: #666666; background: white;">Assumes basic knowledge and/or familiarity of ITIL, CMDB, and Business Services in ServiceNow.</span></p><p style="margin-bottom: 0.0001pt;"><span style="font-size: 10.5pt; font-family: Arial, sans-serif; color: #666666; background: white;">____________________________________________________________________________</span></p><p></p><p><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif;">In my last <a title="" _jive_internal="true" href="/community/service-management/configuration/blog/2016/10/02/mini-lab-displaying-all-affected-cis-on-a-business-service-form">article</a> I showed how you can roll up Affected CIs to the Business Service form.   These were associated through the Business Service Incidents (if any).   This was done using a System Definition Relationship record.   </span></p><p></p><p><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif;">This same type of issue exists for the Problem records as well.   There is no OOB mechanism that exists where all of the Affected CIs from the associated Incidents can be displayed on the Problem form.   In this article I will be showing how a mechanism can be created to provide this desired functionality.</span></p><p></p><p><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif;">The primary component we will be using to create this roll-up and association is a System Definition Relationship record.</span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-size: 12pt; font-family: inherit; font-style: inherit;"><strong>Requirements/Design</strong></span></p><p></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-family: Arial, sans-serif; font-size: 12pt; color: #3d3d3d;">1. Add the existing Affected CIs related list to the Incident form (we did this in the previous article, but I am repeating it here for those who don't care about Business Services!   If you have done Lab 1.1 previously you can simply skip to Lab 1.2).</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif;">2. Create a mechanism to roll up a Problem's associated Incident's Affected CIs and display them as a related list on the Problem form.</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12.0pt; font-family: 'Arial',sans-serif;">3. Add the new related list to the Problem form.</span></p><p></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-size: 18.6667px; font-family: inherit; font-style: inherit;"><strong>Lab 1.1: Adding the Affected CIs Related List to the Incident Form</strong></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">OOB you will find that there is no related list shown of all CIs affected by an incident; even though there is minimum of one if the Affected CI field is filled in.   <span style="font-weight: inherit; font-style: inherit;">BTW, I consider this to be a bit of an oversight.   This tab really should be already added to the form.</span></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">1. Navigate to Incidents -&gt; Open.   The open incident list view will be displayed.</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">2. Open one of the listed Incidents.   The incident form will be displayed.     </span><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">Scroll to the bottom of the form and note that the Affected CI related list is not present.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6032-180660/Incident before.PNG" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="Incident before.PNG" class="image-1 jive-image" height="459" src="2d2d78c6db1013043eb27a9e0f961999.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="1579"/></a></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">At this point you might want to fill in the Affected CI field of this particular Incident (so that you have the minimum set of data to be displayed in the Affected CIs related list).</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6032-180661/Affected CI field Incident.jpg" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="Affected CI field Incident.jpg" class="image-2 jive-image" height="521" src="bbd61042db589fc068c1fb651f961975.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="752"/></a></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-family: arial, helvetica, sans-serif; font-size: 12pt;">3. Right-click on the form header to bring up the context menu and go to Configure -&gt; Related Lists.   The Related Links choice form will be displayed.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6032-180662/configure - Related lists.jpg" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="configure - Related lists.jpg" class="image-3 jive-image" height="581" src="4df777bddb905fc03eb27a9e0f9619da.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="1204"/></a></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">4. Find Affected CIs in the Available list and move it to the Selected list (left-side).</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6032-180663/adding affected ci related list.PNG" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="adding affected ci related list.PNG" class="image-4 jive-image" height="543" src="9011a146db50df048c8ef4621f9619eb.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="889"/></a></span></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">5. Click on the save button.   The Incident form will be redisplayed.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">6. Navigate to the bottom of the form again.   You will note that the Affected CIs related list is now displayed.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6032-180664/affected ci related list in place.PNG" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   alt="affected ci related list in place.PNG" class="image-5 jive-image" height="378" src="3e26f88edb9c57049c9ffb651f96191c.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="1292"/></a></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: arial, helvetica, sans-serif;">That polishes off our first requirement.   Now to start on the next requirement by creating the Relationship!</span></p><p></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-size: 18.6667px; font-family: inherit; font-style: inherit;"><strong>Lab 1.2: Creating a Relationship Between Problem and Affected CIs</strong></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">Now we need to create a Relationship record that will allow us to display a related list of our Affected CIs on the Problem form.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">1. Navigate to System Definition -&gt; Relationships.   The Relationships List View will be displayed.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">2. Click on the New button.   The New Relationship form will be displayed.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">3. Fill out the form with the following:</span></p><p></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">a. <span style="font-style: inherit; font-family: inherit;"><strong>Name</strong></span>: Problem to Affected CIs</span></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">b. <span style="font-style: inherit; font-family: inherit;"><strong>Applies to Table</strong></span>: Problem [problem]</span></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">c. <span style="font-style: inherit; font-family: inherit;"><strong>Queries from Table</strong></span>: CIs Affected [task_ci]</span></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">d. <span style="font-style: inherit; font-family: inherit;"><strong>Query with</strong></span>:</span></p><p style="margin-bottom: .0001pt;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14754439208019430 jive_text_macro" data-renderedposition="4085.60009765625_8_1179_400" jivemacro_uid="_14754439208019430"><p>(function refineQuery(current, parent) {</p><p></p><p>       var incidentList = _retrieveincidentList();</p><p></p><p>       current.addQuery('task', 'IN', incidentList);</p><p></p><p>})(current, parent);</p><p></p><p>// Pull in all incidents related to a problem</p><p>function _retrieveincidentList() {</p><p>   var incidentList = [];</p><p></p><p>   var incidentRecords = new GlideRecord('incident');</p><p>   incidentRecords.addQuery('problem_id', parent.sys_id);</p><p>   incidentRecords.query();</p><p></p><p>   while (incidentRecords.next()) {</p><p>           incidentList.push(incidentRecords.getValue('sys_id'));</p><p>   }</p><p></p><p>   incidentList = new ArrayUtil().unique(incidentList);</p><p></p><p>   return incidentList;</p><p>}</p><p></p></pre><p></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><strong>Note</strong>:   The purpose of this code is to allow for a specific refinement of what actually gets displayed in the related list view.   The beauty of the Relationship record is that it allows the developer to do a coded relationship and then specify which records will actually be displayed.   The displayed records must be matchable to a value inside of the Queries From Table.   I highly encourage you to investigate all that this mechanism is capable of!</span></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"></p><p style="padding-left: 30px; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">e. Click the Submit button to save your work.</span></p><p></p><p><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><img   class="image-6 jive-image" src="8c82d4c6db505344e9737a9e0f961942.iix" style="max-width: 1200px; max-height: 900px;"/></span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">That completes requirement 2.   This establishes a Related List association between the Affected CIs and Problem.</span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">The final step will be to add our new Related List to the Problem form.</span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-size: 18.6667px; font-family: inherit; font-style: inherit;"><strong>Lab 1.3: Adding the Related List to the Problem Form</strong></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">1. Navigate to Problem -&gt; Open, and open up any Problem that appears on the list view.</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;">2. Right-Click on the Problem form to display the context menu, and choose Configure -&gt; Related Lists.   This will display the Related Lists form.</span></p><p></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><img   class="jive-image image-8" src="5bcb954adb1cd344e9737a9e0f961951.iix" style="max-width: 1200px; max-height: 900px;"/></span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-size: 12pt;">3. Scroll down on the Available (left) side of the slush-bucket control, and find Problem to Affected CIs.   Move this to the Selected (right) side.</span></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"></p><p style="margin-bottom: 0.0001pt; font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 12pt; font-family: inherit;"><img   class="image-7 jive-image" src="8e4f2bfddb189b048c8ef4621f961958.iix" style="max-width: 1200px; max-height: 900px;"/></span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">4. Click the Save button to save the form.   The Problem form will be redisplayed.   </span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">5. Scroll to the bottom of the form to verify that the new Problem to Affected CIs related list is displayed.</span></p><p style="margin-bottom: .0001pt;"></p><p style="font-family: arial, sans-serif; color: #666666;"><strong style="font-size: 16px; font-family: inherit; font-style: inherit;">Steps for testing:</strong></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 16px; font-family: inherit;">1. Navigate to Incidents -&gt; Open, and choose a couple of incidents to work with.   Edit each incident and add a couple of Affected CIs to the the List View at the bottom of the form (use the Edit button).   Take note of the Incident numbers.   One of these could be that first incident you were working with back in lab 1.1.</span></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 16px; font-family: inherit;">2. Navigate to Problems -&gt; Open, and choose a single Problem to work with.   Edit the problem, and in the Incidents Related List add the two Incidents to the Problem (use the Edit button).</span></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 16px; font-family: inherit;">3. Right-Click on the Problem form to display the context menu and choose Reload Form.</span></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 16px; font-family: inherit;">4. Scroll to the bottom of the form and note the Problem to Affected CIs related list.   You should now see it populated with all Affected CIs that have been associated to the Incidents.   You may see duplicates.   If so, note that they are due to the same CI associated to two different Incident records.</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 16px; font-family: inherit;">Here were my results:</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 16px; font-family: inherit;"><img   class="image-9 jive-image" src="7e1abb35dbdcdf04e9737a9e0f96197b.iix" style="max-width: 1200px; max-height: 900px;"/></span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;"><strong>Note</strong>:   As an Admin I modified the List View to only show the Configuration Items, and their respective task numbers <span style="font-size: 16px;">(Incident inherits from Task)</span>.</span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">And that finishes up requirement number 3 and our unit test.   It's ready for QA to take over now!   Ship it!</span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt;">Again, in this article, it was my intention to show the power and usefulness of the System Definition Relationship record.   Cool, huh?!</span></p><p style="margin-bottom: .0001pt;"></p><p style="margin-bottom: .0001pt;"><span style="font-size: 12pt; font-family: Arial, sans-serif; color: black; background: white;">Steven Bell</span></p><p style="margin-bottom: .0001pt;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/38-6014-179184/pastedImage_11.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><img   class="jive-image" height="92" src="e438d40edbd817041dcaf3231f96192f.iix" style="margin: 10px 10px 10px 0; border-width: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="340"/></a></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: bold; font-style: inherit; font-family: Arial;">For a list of all of my articles:   </span><a _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/23/community-code-snippets-articles-list-to-date" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #266fc8;"><span style="font-weight: bold; font-style: inherit; font-family: Arial;">Community Code Snippets: Articles List to Date</span></a></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 14.6667px; font-family: Arial; color: #eb7a3d;">Please Share, Like, Bookmark, Mark Helpful, or Comment this blog if you've found it helpful or insightful.</span></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"></p><p dir="ltr" style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-size: 14.6667px; font-family: Arial; color: #eb7a3d;">Also, if you are not already, I would like to encourage you to become a member of our blog!</span></p>