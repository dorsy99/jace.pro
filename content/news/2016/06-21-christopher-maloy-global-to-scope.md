---
title: "Global to Scoped App Helper Script"
date: 2016-06-21T04:15:13.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b29d6e69dbd0dbc01dcaf3231f9619d5"
---
<p><span>I am working on a plan to help those that have apps in the global namespace convert those apps into a scoped app.   I'd be willing to hear any thoughts that the community wants to share (either post on this thread and / or email me </span><a title="k-email-small" class="jive-link-email-small" href="mailto:chris.maloy@servicenow.com">chris.maloy@servicenow.com</a><span>).   There are many difficult steps in this process (like migrating to a similar, but different data model as well as identifying which API calls you may be using that need to change because they are not accessible to other scopes).</span></p><p></p><p>For this reason I am going to start writing a bunch of scripts that can help in the conversion process.</p><p>This is a rough first draft for a helper script that can be called to help identify some global dependencies that will change during your conversion process.   Don't be too critical I wrote this while on a phone call and I don't multi-task well.   I am sure there are better ways to use regular expressions (instead of splitting strings like I am doing - welcome to any feedback).</p><p></p><p>You will need to call scanScript passing in the sysId of the script you want to scan (including the type if it is not a script include). If you are in a domain separated environment you will need to query with NoDomain.   </p><p></p><p><span style="color: #800000; font-weight: bold; font-family: 'Helvetica Neue';">var</span><span style="font-family: 'Helvetica Neue';"> siNameCalls </span><span style="color: #808030; font-family: 'Helvetica Neue';">=</span><span style="font-family: 'Helvetica Neue';"> scanScript</span><span style="color: #808030; font-family: 'Helvetica Neue';">(</span><span style="color: #800000; font-family: 'Helvetica Neue';">'</span><span style="color: #0000e6; font-family: 'Helvetica Neue';">ca4033c1d7110100fceaa6859e610326</span><span style="color: #800000; font-family: 'Helvetica Neue';">'</span><span style="color: #808030; font-family: 'Helvetica Neue';">)</span><span style="color: #800080; font-family: 'Helvetica Neue';">;</span></p><p><span style="font-family: 'Helvetica Neue';"><span style="color: #696969;">//gs.print("" + identifySIDependencies());</span><br/><br/><span style="color: #696969;">//default script type will be a script include (no need to pass in type unless it is not a script include)</span><br/><span style="color: #800000; font-weight: bold;">function</span> scanScript<span style="color: #808030;">(</span>scriptSysId<span style="color: #808030;">,</span> type<span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                 <span style="color: #800000; font-weight: bold;">var</span> lgr <span style="color: #808030;">=</span> <span style="color: #800000; font-weight: bold;">new</span> GlideRecord<span style="color: #808030;">(</span><span style="color: #800000;">'</span><span style="color: #0000e6;">sys_script_include</span><span style="color: #800000;">'</span><span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/><br/>                 <span style="color: #800000; font-weight: bold;">switch</span> <span style="color: #808030;">(</span>type<span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                                 <span style="color: #800000; font-weight: bold;">case</span> <span style="color: #800000;">'</span><span style="color: #0000e6;">businessrule</span><span style="color: #800000;">'</span><span style="color: #800080;">:</span><br/>                                                 <span style="color: #800000; font-weight: bold;">var</span> lgr <span style="color: #808030;">=</span> <span style="color: #800000; font-weight: bold;">new</span> GlideRecord<span style="color: #808030;">(</span><span style="color: #800000;">'</span><span style="color: #0000e6;">sys_script</span><span style="color: #800000;">'</span><span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/>                                                 <span style="color: #800000; font-weight: bold;">break</span><span style="color: #800080;">;</span><br/>                                 <span style="color: #800000; font-weight: bold;">default</span><span style="color: #800080;">:</span><br/>                                                 <span style="color: #800000; font-weight: bold;">break</span><span style="color: #800080;">;</span><br/>                 <span style="color: #800080;">}</span><br/><br/>                 lgr<span style="color: #808030;">.</span>get<span style="color: #808030;">(</span>scriptSysId<span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/>                 <span style="color: #800000; font-weight: bold;">if</span> <span style="color: #808030;">(</span>lgr<span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                                 <span style="color: #800000; font-weight: bold;">var</span> txt <span style="color: #808030;">=</span> lgr<span style="color: #808030;">.</span>script<span style="color: #808030;">,</span><br/>                                                 ans <span style="color: #808030;">=</span> txt<span style="color: #808030;">.</span><span style="color: #800000; font-weight: bold;">split</span><span style="color: #808030;">(</span><span style="color: #800000;">"</span><span style="color: #0000e6;">new</span><span style="color: #800000;">"</span><span style="color: #808030;">)</span><span style="color: #808030;">,</span><br/>                                                 anslength <span style="color: #808030;">=</span> ans<span style="color: #808030;">.</span><span style="color: #800000; font-weight: bold;">length</span><span style="color: #800080;">;</span><br/><br/><br/>                                 <span style="color: #800000; font-weight: bold;">while</span> <span style="color: #808030;">(</span>anslength<span style="color: #808030;">--</span><span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                                                 <span style="color: #800000; font-weight: bold;">var</span> parsedData <span style="color: #808030;">=</span> ans<span style="color: #808030;">[</span>anslength<span style="color: #808030;">]</span><span style="color: #800080;">;</span><br/>                                                 <span style="color: #800000; font-weight: bold;">var</span> dependency <span style="color: #808030;">=</span> parsedData<span style="color: #808030;">.</span><span style="color: #800000; font-weight: bold;">substr</span><span style="color: #808030;">(</span><span style="color: #008c00;">0</span><span style="color: #808030;">,</span> parsedData<span style="color: #808030;">.</span><span style="color: #800000; font-weight: bold;">indexOf</span><span style="color: #808030;">(</span><span style="color: #800000;">"</span><span style="color: #0000e6;">(</span><span style="color: #800000;">"</span><span style="color: #808030;">)</span><span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/>                                                 <span style="color: #696969;">//gs.print(dependency);</span><br/>                                                 <span style="color: #800000; font-weight: bold;">var</span> result <span style="color: #808030;">=</span> identifySIDependencies<span style="color: #808030;">(</span>dependency<span style="color: #808030;">)</span><span style="color: #800080;">;</span> <span style="color: #696969;">//ItomJSONParser is public //JSONParser set to not public unit test values</span><br/><br/>                                                 <span style="color: #800000; font-weight: bold;">if</span> <span style="color: #808030;">(</span>result <span style="color: #808030;">===</span> <span style="color: #008c00;">0</span><span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                                                                 gs<span style="color: #808030;">.</span>print<span style="color: #808030;">(</span>dependency <span style="color: #808030;">+</span> <span style="color: #800000;">"</span><span style="color: #0000e6;"> is invalid script include usage. Not accessible in app scope.</span><span style="color: #800000;">"</span><span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/>                                                 <span style="color: #800080;">}</span><br/>                                 <span style="color: #800080;">}</span><br/>                 <span style="color: #800080;">}</span><br/><span style="color: #800080;">}</span><br/><br/><span style="color: #800000; font-weight: bold;">function</span> identifySIDependencies<span style="color: #808030;">(</span>dependency<span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                 <span style="color: #800000; font-weight: bold;">var</span> sigr <span style="color: #808030;">=</span> <span style="color: #800000; font-weight: bold;">new</span> GlideRecord<span style="color: #808030;">(</span><span style="color: #800000;">'</span><span style="color: #0000e6;">sys_script_include</span><span style="color: #800000;">'</span><span style="color: #808030;">)</span><span style="color: #808030;">,</span><br/>                                 enc <span style="color: #808030;">=</span> <span style="color: #800000;">'</span><span style="color: #0000e6;">active=true^name=</span><span style="color: #800000;">'</span> <span style="color: #808030;">+</span> dependency<span style="color: #808030;">.</span>trim<span style="color: #808030;">(</span><span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/><br/>                 <span style="color: #696969;">//build the lookup query</span><br/>                 sigr<span style="color: #808030;">.</span>addEncodedQuery<span style="color: #808030;">(</span>enc<span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/>                 sigr<span style="color: #808030;">.</span>query<span style="color: #808030;">(</span><span style="color: #808030;">)</span><span style="color: #800080;">;</span><br/><br/>                 <span style="color: #800000; font-weight: bold;">if</span> <span style="color: #808030;">(</span>sigr<span style="color: #808030;">.</span>next<span style="color: #808030;">(</span><span style="color: #808030;">)</span><span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                                 <span style="color: #696969;">//check if public access</span><br/>                                 <span style="color: #800000; font-weight: bold;">if</span> <span style="color: #808030;">(</span>sigr<span style="color: #808030;">.</span>access <span style="color: #808030;">==</span> <span style="color: #800000;">'</span><span style="color: #0000e6;">public</span><span style="color: #800000;">'</span><span style="color: #808030;">)</span> <span style="color: #800080;">{</span><br/>                                                 <span style="color: #800000; font-weight: bold;">return</span> <span style="color: #008c00;">1</span><span style="color: #800080;">;</span> <span style="color: #696969;">//public</span><br/>                                 <span style="color: #800080;">}</span><br/><br/>                                 <span style="color: #800000; font-weight: bold;">return</span> <span style="color: #008c00;">0</span><span style="color: #800080;">;</span> <span style="color: #696969;">//private</span><br/>                 <span style="color: #800080;">}</span><br/><br/>                 <span style="color: #800000; font-weight: bold;">return</span> <span style="color: #808030;">-</span><span style="color: #008c00;">1</span><span style="color: #800080;">;</span> <span style="color: #696969;">//not found</span><br/><span style="color: #800080;">}</span></span></p>