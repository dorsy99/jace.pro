---
title: "Accessing public  private sites created through CMS with SSO"
date: 2016-11-18T23:25:01.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=a90eaa2ddbd0dbc01dcaf3231f96191f"
---
<p>This week I was working on a very interesting requirement - a customer wanted multiple CMS sites, but some public and others requiring login. After extensive searching, I figured I would create my own step-by-step guide on how to access a private and a public site created through CMS with Single Sign-on.</p><p></p><p>Why have some sites public and some private? For example, if your company wants to allow the public to interact with them through the ServiceNow pages, to read knowledge articles, submit product ideas, etc. this should be done through a public facing site that does not require login. To read internal knowledge articles, submit an incident with the IT department etc., login should be required and this requires a private site.</p><p></p><p>The prerequisite to this step-by-step guide, is that you have all your sites, pages, and content created and working. See <a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/integrate/single-sign-on/task/t_SettingUpMultiProviderSSO.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/integrate/single-sign-on/task/t_SettingUpMultiProviderSSO.html">Set up multi-provider SSO</a> for details. SSO should be set up including the property that automatically redirects all users to the Identity Provider (glide.authenticate.sso.redirect.idp as described in <a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/integrate/single-sign-on/task/t_ModifyThePrimaryAndDefaultIdP.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/integrate/single-sign-on/task/t_ModifyThePrimaryAndDefaultIdP.html">Modify the primary and default IdP</a>   )</p><p></p><h3><span style="color: #303030; font-family: arial, sans-serif;">To create public and private CMS sites you need to complete these three steps:</span></h3><ol><li>Make CMS content publicly visible to all users</li><li>Create a login page for sites that require authentication</li><li>Modify the login dynamic content block to redirect to the default identity provider</li></ol><p></p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="351.1875_8_1192_64"><p><span style="color: #505050;">If you are looking for more detail on</span> <a title="Public pages asking for authentication" __default_attr="4885" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Public pages asking for authentication" data-renderedposition="364.1875_266.0625_258_16" href="/community?id=community_blog&sys_id=b86ceaa1dbd0dbc01dcaf3231f96193f">Public pages asking for authentication</a> <span style="color: #505050;">read this post from</span> <a title="jonnyseymour" __default_attr="45437" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="jonnyseymour" data-renderedposition="364.1875_649.90625_107_16" href="/community?id=community_user_profile&user=b0035ee1db1c1fc09c9ffb651f9619d1">jonnyseymour</a> <span style="color: #505050;">- it also talks about the property</span> <span style="color: #2873ee; font-family: arial, sans-serif;">glide.ui.cms.enforce_public_pages </span><span style="color: #505050;">that introduces an extra level of security on your public pages.</span></p></pre><p></p><h2>How to create multiple private and public CMS sites accessible with SSO</h2><p></p><h3>1. Make Content Management content publicly visible to all users</h3><p>To perform this step, go to <strong>System Definition &gt; Public Pages</strong> (or sys_public.list in the navigation filter text) and ensure that the entry for the page named "view_content" is set to be active.</p><p><img   alt="cms content public.png" class="image-5 jive-image" src="00bbb80edb1097049c9ffb651f9619a2.iix" style="width: 620px; height: 61px; display: block; margin-left: auto; margin-right: auto;"/></p><p>The page "view_content" is used for any CMS application, custom or out of box. Setting the page to active in the public pages application allows any user to access these pages without the need to log in.</p><p></p><p>Now that all pages on all CMS sites are publicly available, we have to undo this step for any site that should require authentication.</p><p></p><h3>2. Create a login page for sites that require authentication</h3><p>As soon as a login page is set for a site in the content management application, the user will be prompted for login every time this site is accessed.</p><p><img   alt="CMS login.png" class="image-6 jive-image" src="badcdc86dbdc17041dcaf3231f96199b.iix" style="width: 620px; height: 259px; display: block; margin-left: auto; margin-right: auto;"/></p><p>Out of the box, we have the Portal - Login Page, that you can copy to create your custom Login Page. Once you have your custom login page, associate it to the site as shown above.</p><p></p><h3>3. Modify the login dynamic content block to redirect to the default identity provider</h3><p>To determine into which dynamic content block to enter the below code, click on the i-Icon next to the login page.</p><p><img   alt="dynamic block.jpg" class="image-7 jive-image" src="812369c6dbd4d7041dcaf3231f961916.iix" style="width: 620px; height: 330px; display: block; margin-left: auto; margin-right: auto;"/></p><p>On this screen, click on <strong>Edit Page.</strong></p><p><img   alt="CMS clean login.png" class="image-8 jive-image" src="56a2c10adb9013043eb27a9e0f961984.iix" style="width: 620px; height: 213px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>You will see the content block that contains the login screen. On the upper right corner, click on the <strong>pencil icon</strong> to edit this content block.</p><p></p><p>The original code will be similar to this:</p><pre __default_attr="xml" __jive_macro_name="code" class="_jivemacro_uid_14792525063523493 jive_macro_code jive_text_macro" data-renderedposition="1850.1875_8_1192_160" jivemacro_uid="_14792525063523493"><p>&lt;?xml version="1.0" encoding="utf-8" ?&gt;</p><p>&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;</p><p>   &lt;j2:set var="jvar_login_url" value="$[jvar_RP.getReferringURL()]" /&gt;</p><p>&lt;center&gt;</p><p>&lt;div style="width:900px;text-align:left;"&gt;</p><p>   &lt;g:insert_form name="login" /&gt;</p><p>   &lt;g:inline template="welcome_content.xml"/&gt;</p><p>&lt;/div&gt;</p><p>&lt;/center&gt;</p><p>&lt;/j:jelly&gt;</p></pre><p>I got the code snippet to redirect to the IdP from this great post by <a title="goranlundqvist" __default_attr="30807" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="goranlundqvist" data-renderedposition="2012.1875_426.5625_111_16" href="/community?id=community_user_profile&user=eb4f86e5db181fc09c9ffb651f961907">goranlundqvist</a> <a title="A mix of Service Portal, public pages and SSO" __default_attr="5928" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="A mix of Service Portal, public pages and SSO" data-renderedposition="2012.1875_542.28125_310_16" href="/community?id=community_blog&sys_id=606e6eaddbd0dbc01dcaf3231f96193a">A mix of Service Portal, public pages and SSO</a></p><p></p><p></p><pre __default_attr="xml" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14792541409909132 jive_text_macro" data-renderedposition="2073.1875_8_1192_96" jivemacro_uid="_14792541409909132"><p>&lt;j:set var="jvar_user_loggedin" value="${ gs.isLoggedIn() }"/&gt;</p><p>&lt;j:if test="${jvar_user_loggedin == false}"&gt;</p><p>   &lt;script&gt;</p><p>   top.location.href = "../saml_redirector.do?sysparm_uri=/&lt;your site URL suffix&gt;/&lt;initial page, such as home.do&gt;";</p><p>   &lt;/script&gt;</p><p>&lt;/j:if&gt;</p></pre><p></p><p>Merging this code snippet with the original code:</p><pre __default_attr="xml" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14792541553967360" data-renderedposition="2211.1875_8_1192_256" jivemacro_uid="_14792541553967360"><p>&lt;?xml version="1.0" encoding="utf-8" ?&gt;</p><p>&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;</p><p>   &lt;j2:set var="jvar_login_url" value="$[jvar_RP.getReferringURL()]" /&gt;</p><p>&lt;j:set var="jvar_user_loggedin" value="${ gs.isLoggedIn() }"/&gt;</p><p>&lt;j:if test="${jvar_user_loggedin == false}"&gt;</p><p>   &lt;script&gt;</p><p>   top.location.href = "../saml_redirector.do?sysparm_uri=/&lt;your site URL suffix&gt;/&lt;initial page, such as home.do&gt;";</p><p>   &lt;/script&gt;</p><p>&lt;/j:if&gt;</p><p>&lt;center&gt;</p><p>&lt;div style="width:900px;text-align:left;"&gt;</p><p>   &lt;g:insert_form name="login" /&gt;</p><p>   &lt;g:inline template="welcome_content.xml"/&gt;</p><p>&lt;/div&gt;</p><p>&lt;/center&gt;</p><p>&lt;/j:jelly&gt;</p></pre><p></p><p><span>If the user is not yet logged in, this code will redirect to the SAML IdP defined in the system, and then have that IdP redirect back tot eh sysparm URI, such as </span><a title="" _jive_internal="true" href="https://" rel="nofollow" target="_blank">https://</a><span>&lt;instance&gt;/ess/home.do</span></p><p></p><p>Following these outlined steps, you can have some sites that require login, while other sites and their underlying pages are completely publicly accessible. This will give you better control over what your customers can see and do with and without authentication.</p>