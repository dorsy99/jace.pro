---
title: "Catalog shopping carts Requested For"
date: 2016-02-02T23:01:11.000Z
authors: ["alan.lowrance"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=563eae6ddbd0dbc01dcaf3231f96195b"
---
<p>Have you ever needed to be able to view or change the current cart's "Requested For" while on a catalog item page?</p><p>In the past we have needed to make sure that a person is not requesting something for themselves, or can only request for a direct report of theirs, etc.   So we created a client-callable Script Include to push a new "Requested For" field from the item back up to the cart.</p><p>Catalog Client Script (OnSubmit)</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14544308682908364 jive_text_macro" data-renderedposition="92_8_1192_224" jivemacro_uid="_14544308682908364"><p>callCartPush();</p><p>function callCartPush(){</p><p>   var uid = g_user.userID;</p><p>   var rf;</p><p>   if (g_form.getValue("whatever user reference variable")!="")</p><p>         rf = g_form.getValue("<span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">whatever user reference variable</span>");</p><p>   else</p><p>         rf = uid; // or use alternative variable field</p><p>   var ga = new GlideAjax('ReqForPush'); // ASYNC call to a server-side script</p><p>   ga.addParam('sysparm_name','reqForPush');</p><p>   ga.addParam('sysparm_uid',uid); // sysparm_uid = sysid of current logged on user, to find the cart</p><p>   ga.addParam('sysparm_rf',rf); // sysparm_rf = who the new requested_for should be</p><p>   ga.getXML(); // we don't actually need to wait for any data back from the server for this to work</p><p>}</p></pre><p>And the client-callable Script Include named "ReqForPush":</p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14544307416444374 jive_macro_code jive_text_macro" data-renderedposition="337_8_1192_208" jivemacro_uid="_14544307416444374"><p>var ReqForPush = Class.create();</p><p>ReqForPush.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p>   reqForPush: function() {</p><p>   var rfr = new GlideRecord("sc_cart");</p><p>   rfr.addQuery("name", "DEFAULT");</p><p>   rfr.addQuery('user',this.getParameter('sysparm_uid')); // will locate any currently open carts with the currently logged in user</p><p>   rfr.query();</p><p>   if (rfr.next()) {</p><p>   rfr.requested_for = this.getParameter('sysparm_rf'); // updates the requested_for on the cart to the value passed by the client script</p><p>   rfr.update();</p><p>   }</p><p>   }</p><p>});</p></pre><p></p><p>Then later we had a requirement where we are needing a person to choose a specific computer from cmdb_ci_computer that is owned by or last logged in by the requested for person, so we needed to pull who the current cart's requested_for was and display it on the item page, and if they change it, it needed to push that back up to the server immediately so the dynamic reference qualifiers would filter the computer list again.</p><p>So we did the same as before except did the ReqForPush call in an OnChange so it can update live... but to get the initial cart's requested_for in case it was changed before they chose an item, the Default field of that variable pulls it for us.</p><p>Item Variable default value: <strong>javascript:ReqForPull(gs.getUserID())</strong></p><p>And the Script Include named "ReqForPull":</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14544321154444349" data-renderedposition="713_8_1192_160" jivemacro_uid="_14544321154444349"><p>function ReqForPull(usr){</p><p>   var person = '';</p><p>   var rfr = new GlideRecord('sc_cart');</p><p>   rfr.addQuery('name','DEFAULT');</p><p>   rfr.addQuery('user',usr);</p><p>   rfr.query();</p><p>   if (rfr.next())</p><p>         person = rfr.requested_for.sys_id;</p><p>   return person;</p><p>}</p></pre>