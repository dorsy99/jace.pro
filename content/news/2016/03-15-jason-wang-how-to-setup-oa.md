---
title: "How to setup OAuth authentication for RESTMessageV integrations"
date: 2016-03-15T02:13:34.000Z
authors: ["Jason Wang"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=a1fce2a5dbd0dbc01dcaf3231f961939"
---
<p style="font-family: arial, sans-serif; color: #666666;">Hey there, I recently was being asked by a client how to setup OAuth2 authentication for ServiceNow web services integrations. After searching online, I couldn't find anything that's straightforward to explain the configuration/test process. So after I figure this out, I think I should share what I did in here so people can reference this topic in the future.</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">What I experimented are between ServiceNow instances. When work with third party application, it could be a slight different but the concept remains the same. Both OAuth consumer and OAuth provider can be a third party or ServiceNow.</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">Here we go.</p><p></p><p class="p1" style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit; font-size: 14pt;"><strong>1. Configure OAuth provider on instance 1 (OAuth Application Registry -&gt; Create an OAuth API endpoint for external clients)</strong></span></p><ol class="ol1" style="font-family: arial, sans-serif; color: #666666;"><li>Create unique provider profile name.</li><li>We need to generate client ID along with Client Secret. Both can be generated by system normally.</li><li>Token lifespan are optional, generated by default system policy.</li></ol><p><span style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90395/pastedImage_5.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><img   class="image-1 jive-image" height="233" src="2d50a94adb1c130468c1fb651f9619c6.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="921"/></a></span><span style="font-family: arial, sans-serif; color: #666666;"> </span><span style="font-family: arial, sans-serif; color: #666666;"> </span></p><p></p><p><span class="p1" style="color: #666666; font-family: inherit; font-style: inherit; font-size: 14pt;"><strong>2. Configure OAuth consumer on instance 2 (OAuth Application Registry -&gt; Connect to a third party OAuth Provider)</strong></span></p><ol class="ol1" style="font-family: arial, sans-serif; color: #666666;"><li>Create unique consumer profile name. (very important, script will need pass in this consumer profile name as parameter)</li><li>Client ID and Client secret are the values were generated from step 1.</li><li>Grant type. Value can be either "password" or "refresh_token". Suggest to use password since you won't have refresh_token info initially. This refresh_token only will be generated during first time when access token is generated.</li><li>Token URL will be provided by OAuth provider. In this example, it would be the <a title="" _jive_internal="true" href="/oauth_provider_instance1.service-now.com/oauth_token.do" rel="nofollow" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;" target="_blank">https://oauth_provider_instance1.service-now.com/oauth_token.do</a></li></ol><p><span style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90396/pastedImage_11.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><img   class="image-2 jive-image" height="409" src="d475bc4adb1cdfc068c1fb651f961957.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="914"/></a></span><span style="font-family: arial, sans-serif; color: #666666;"> </span><span style="font-family: arial, sans-serif; color: #666666;"> </span></p><p></p><p><span class="p1" style="color: #666666; font-family: inherit; font-style: inherit; font-size: 14pt;"><strong>3. Test tokens generation script to OAuth provider instance 1 (from OAuth consumer instance 2).</strong></span><span class="p1" style="font-family: arial, sans-serif; color: #666666;"></span><span class="p1" style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90397/pastedImage_14.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><br/></a></span></p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">var oAuthClient = new sn_auth.GlideOAuthClient();</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">var params = {grant_type:"password", username:'user_id from provider that will grant OAuth access', password:'user_pwd from provider that will grant OAuth access'};</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">var json = new global.JSON();</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">var text = json.encode(params);</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">var tokenResponse = oAuthClient.requestToken('<span style="font-weight: inherit; font-family: inherit;"><em>unique consumer profile name from step 2.1</em></span>', text);</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">var token = tokenResponse.getToken();</p><p class="p1"></p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">gs.log("AccessToken:" + token.getAccessToken());</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">gs.log("AccessTokenExpiresIn:" + token.getExpiresIn());</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">gs.log(" RefreshToken:" + token.getRefreshToken());</p><p class="p1" style="font-family: arial, sans-serif; color: #666666;">//You should be getting proper Access Token long with Refresh Token info. This token will be used in future web service request.</p><p><span class="p1" style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90397/pastedImage_14.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><img   class="image-3 jive-image" height="136" src="ef77988edb189fc03eb27a9e0f9619b6.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="922"/></a></span><span class="p1" style="font-family: arial, sans-serif; color: #666666;"> </span><span style="font-family: arial, sans-serif; color: #666666;"> </span></p><p></p><p><span class="p1" style="color: #666666; font-family: inherit; font-style: inherit; font-size: 14pt;"><strong>4. Setup proper outbound message on consumer instance 2 to the endpoint on provider instance 1.</strong></span></p><ol style="font-family: arial, sans-serif; color: #666666;"><li>In this REST example, choose OAuth 2.0 as authentication type.</li><li>You may use UI action "Get OAuth Token" to test you are able to get token info successfully.</li></ol><p style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90398/pastedImage_19.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><img   class="image-5 jive-image" height="384" src="171533b9dbd8df04e9737a9e0f961922.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="924"/></a></p><p style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90405/pastedImage_17.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><img   class="jive-image image-4" height="239" src="8ec6d982db9813043eb27a9e0f961971.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="552"/></a></p><p></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit; font-size: 14pt;"><strong><span class="s1" style="font-weight: inherit; font-style: inherit; font-family: inherit;">5. </span>Test outbound REST message along with token generation script to Web Service provider/OAuth provider instance 1 (from OAuth consumer instance 2).</strong></span></p><p>var r = new sn_ws.RESTMessageV2('P2 Incidents', 'get');</p><p>r.setStringParameter('priority', '2');</p><p>r.setStringParameter('active', 'true');</p><p>r.setStringParameter('sysparm_fields', 'number,state,priority');</p><p></p><p>//override authentication profile</p><p>//authentication type ='basic'/ 'oauth2'</p><p>//This line below is optional if you have configured OAuth as authentication type in your outbound REST</p><p>r.setAuthentication('oauth2', 'OAuth_Client1');</p><p></p><p>var response = r.execute();</p><p>var responseBody = response.getBody();</p><p>var httpStatus = response.getStatusCode();</p><p></p><p>gs.log(responseBody);</p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;"><a _jive_internal="true" href="/servlet/JiveServlet/downloadImage/102-4815-4-90406/pastedImage_21.png" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;"><img   class="image-6 jive-image" height="230" src="1d28f00edbdcd704ed6af3231f9619be.iix" style="margin: 10px 10px 10px 0; border: 0px; font-weight: inherit; font-style: inherit; font-family: inherit;" width="942"/></a></p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit; font-size: 14pt;"><strong><span class="s1" style="font-weight: inherit; font-style: inherit; font-family: inherit;">6. Special</span> Case 1: In Fuji or earlier version, user doesn't have same menu as my Geneva screenshot</strong></span></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">In this case, you can use REST OAuth API to call in to get issue token embedded, see my highlights.</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var r = new sn_ws.RESTMessageV2('P2 Incidents', 'get');</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">r.setStringParameter('priority', '2');</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">r.setStringParameter('active', 'true');</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">r.setStringParameter('sysparm_fields', 'number,state,priority');</p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">/*override authentication profile</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">authentication type ='basic'/ 'oauth2'</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">line below is optional if you have configured OAuth as authentication type in your outbound REST*/</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit;"><strong>r.setAuthentication('oauth2', 'OAuth_Client1');</strong></span></p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var response = r.execute();</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var responseBody = response.getBody();</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var httpStatus = response.getStatusCode();</p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">gs.log(responseBody);</p><p class="p2"></p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit; font-size: 14pt;"><strong>7. Special Case 2: OAuth grant type is not '<span style="color: #333333; font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>password' or '<span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>refresh_token'</strong></span></strong></span></strong></span></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">ServiceNow only support 2 mentioned above grant type at the moment this document is created. In this case, you will have to work with OAuth provider to figure out what grant type can be used per provider, and then setup a separate WS call to request for token issuance. And then you can embed token string in your subsequent WS call's header till this token expires.</p><p class="p2"></p><p style="font-family: arial, sans-serif; color: #666666;">//Calling REST to get oauth token and type issued.</p><p style="font-family: arial, sans-serif; color: #666666;">function requestToken() {</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">   var r = new sn_ws.RESTMessageV2('Oauth Token Request', 'post');</p><p style="font-family: arial, sans-serif; color: #666666;">   var response = r.execute();</p><p style="font-family: arial, sans-serif; color: #666666;">   var responseBody = response.getBody();</p><p style="font-family: arial, sans-serif; color: #666666;">   var httpStatus = response.getStatusCode();</p><p style="font-family: arial, sans-serif; color: #666666;">   var authString;</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">   if (httpStatus == 200 &amp;&amp; responseBody != " ") {</p><p style="font-family: arial, sans-serif; color: #666666;">   var obj = new JSON.parse(responseBody);</p><p style="font-family: arial, sans-serif; color: #666666;">   var token = obj.access_token;</p><p style="font-family: arial, sans-serif; color: #666666;">   var token_type = obj.token_type;</p><p style="font-family: arial, sans-serif; color: #666666;">   authString = token_type + " " + token;</p><p style="font-family: arial, sans-serif; color: #666666;">   } else {</p><p style="font-family: arial, sans-serif; color: #666666;">   gs.print("Cannot acquire token");</p><p style="font-family: arial, sans-serif; color: #666666;">   }</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">   gs.print("Token Type + Token:\n" + authString);</p><p></p><p style="font-family: arial, sans-serif; color: #666666;">   return authString;</p><p style="font-family: arial, sans-serif; color: #666666;">}</p><p></p><p></p><p style="font-family: arial, sans-serif; color: #666666;">//Use tokenString to setup header</p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit;"><strong>var tokenString = requestToken();</strong></span></p><p></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var r = new sn_ws.RESTMessageV2('P2 Incidents', 'get');</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">r.setStringParameter('priority', '2');</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">r.setStringParameter('active', 'true');</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">r.setStringParameter('sysparm_fields', 'number,state,priority');</p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;"><span style="font-style: inherit; font-family: inherit;"><strong>r.setRequestHeader('Authorization', tokenString);</strong></span></p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var response = r.execute();</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var responseBody = response.getBody();</p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">var httpStatus = response.getStatusCode();</p><p class="p2"></p><p class="p2" style="font-family: arial, sans-serif; color: #666666;">gs.log(responseBody);</p><p></p><p></p><p style="font-family: arial, sans-serif; color: #666666;">This document was generated from the following discussion: <a title="" _jive_internal="true" data-containerid="2009" data-containertype="14" data-objectid="214956" data-objecttype="1" href="/community?id=community_question&sys_id=75f74f2ddb1cdbc01dcaf3231f961944" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;">How to Setup OAuth2 authentication for outbound RESTMessageV2 integrations</a></p>