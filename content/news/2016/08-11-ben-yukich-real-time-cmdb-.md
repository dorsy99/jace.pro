---
title: "Realtime CMDB Identification and Reconciliation API"
date: 2016-08-11T01:28:08.000Z
authors: ["ben.yukich"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=3cbc6a25dbd0dbc01dcaf3231f961977"
---
<p>The identification and Reconciliation API is a relatively new capability in the ServiceNow platform that often goes (tragically) unnoticed, and under appreciated. This must end. It's one of the most important capabilities to be aware of if you're driving any part of your CMDB from an external source. Have you ever wondered how Discovery and Service Mapping are so good at NOT creating duplicate CIs in the CMDB? Have you ever noticed on your Discovery Status records the Devices tab has a status of "Created CI" or "Updated CI" for each device scanned? This capability has existed for quite some time behind the scenes, but now you can use the exact same framework from any piece of script and any external REST call!</p><p></p><p>So, let's break this down and figure out how to make it useful. There are two ways you can use the I&amp;R API: direct from SN script; from a REST web services call. Either way, the way you communicate with the API is going to be the same: you'll be using a JSON payload to describe configuration items and relationships. So, let's start with a simple example payload and script runnable in Scripts - Background:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14708577896883754 jive_text_macro" data-renderedposition="176_8_1192_240" jivemacro_uid="_14708577896883754"><p>var payload = {</p><p>       items: [{</p><p>               className: 'cmdb_ci_win_server',</p><p>               values: {</p><p>                       name: 'Win Server 100',</p><p>                       ip_address: '10.20.30.40',</p><p>                       mac_address: 'ABCD1234',</p><p>                       ram: '2048'</p><p>               }</p><p>       }]</p><p>};</p><p></p><p>var input = new JSON().encode(payload);</p><p>var output = SNC.IdentificationEngineScriptableApi.createOrUpdateCI('ServiceNow', input);</p><p>gs.print(output);</p></pre><p></p><p>I get a response about what action was taken:</p><pre __default_attr="html" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14708579097302539" data-renderedposition="458_8_1192_16" jivemacro_uid="_14708579097302539"><p>*** Script: {"items":[{"className":"cmdb_ci_win_server","operation":"INSERT","sysId":"1d848b174fc12a40fd2bfc5f0310c775","identifierEntrySysId":"Unknown","identificationAttempts":[{"identifierName":"Hardware Rule","attemptResult":"SKIPPED","attributes":["serial_number"],"searchOnTable":"cmdb_ci_hardware"},{"identifierName":"Hardware Rule","attemptResult":"NO_MATCH","attributes":["name"],"searchOnTable":"cmdb_ci_hardware"}]}],"relations":[]}</p></pre><p></p><p>So, that's a long line, but you get a lot of great detail in there about precisely which identifier matched, and what record was inserted (an easier to read example will be included below).</p><p></p><p>Now let's say we want to update this same server (perhaps we doubled the memory), but this time we wan to do it via the REST API... easy! Just navigate to the REST API Explorer and select the "Identification and Reconciliation API" in the API Name field (within the "now" namespace). You'll see that there is only ONE action you can take: a Create or Update CI POST operation. To call this successfully, you must provide a parameter that I glossed over in the script example, the data source, to indicate where the data is coming from (this must be a valid entry in the discovery_source field of the cmdb_ci table, you can extend this of course - it is used for important capabilities like datasource precedence). You must also provide a JSON payload of the same form shown earlier. Let's try with one that has an update to the ram value:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14708587649503838" data-renderedposition="642_8_1192_146" jivemacro_uid="_14708587649503838"><p>{"items":[<span style="line-height: 1.5;">{</span></p><p>       "className":"cmdb_ci_win_server",</p><p>       "values": {</p><p>               "name":"Win Server 100",</p><p>               "ip_address":"10.20.30.40",</p><p>               "mac_address":"ABCD1234",</p><p>               "ram":"4096"</p><p>       }</p><p>}]}</p></pre><p></p><p>Once this is executed we should receive a 200 response with a slightly different response payload than we saw before, indicating an UPDATE rather than an INSERT:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14708588704706993 jive_text_macro" data-renderedposition="830_8_1192_496" jivemacro_uid="_14708588704706993"><p>{</p><p>   "result": {</p><p>       "items": [</p><p>           {</p><p>               "className": "cmdb_ci_win_server",</p><p>               "operation": "UPDATE",</p><p>               "sysId": "1d848b174fc12a40fd2bfc5f0310c775",</p><p>               "identifierEntrySysId": "556eb250c3400200d8d4bea192d3ae92",</p><p>               "identificationAttempts": [</p><p>                   {</p><p>                       "identifierName": "Hardware Rule",</p><p>                       "attemptResult": "SKIPPED",</p><p>                       "attributes": [</p><p>                           "serial_number"</p><p>                       ],</p><p>                       "searchOnTable": "cmdb_ci_hardware"</p><p>                   },</p><p>                   {</p><p>                       "identifierName": "Hardware Rule",</p><p>                       "attemptResult": "MATCHED",</p><p>                       "attributes": [</p><p>                           "name"</p><p>                       ],</p><p>                       "searchOnTable": "cmdb_ci_hardware"</p><p>                   }</p><p>               ]</p><p>           }</p><p>       ],</p><p>       "relations": []</p><p>   }</p><p>}</p></pre><p></p><p>So, I get excited about odd things... but there is no denying that this is SWEET! In the past, I've stepped through how to trigger a full discovery via web services (<a title="Real-time CMDB: Disco as a Service" __default_attr="5556" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Real-time CMDB: Disco as a Service" data-renderedposition="1349_8_1192_37" href="/community?id=community_blog&sys_id=bacda2e9dbd0dbc01dcaf3231f961942">Real-time CMDB: Disco as a Service</a>). Now, you can add to your bag of tricks - imagine calling the I&amp;R API as the first step in populating your CMDB, or perhaps to augment the CMDB with devices that would not ordinarily be discoverable (hello, IoT).</p><p></p><p>Worth noting that this can be used for an array of items, not just one at a time, and also relationships. For example, here's how you would include an application and the fact that it runs on a specific server:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14708603067569630" data-renderedposition="1473_8_1192_336" jivemacro_uid="_14708603067569630"><p>{"items":[{</p><p>       "className":"cmdb_ci_app_server_tomcat",</p><p>       "values":{</p><p>               "name":"tomcat",</p><p>               "running_process_command":"xyz",</p><p>               "running_process_key_parameters":"abc",</p><p>               "tcp_port":"8087"</p><p>       }</p><p>},{</p><p>       "className":"cmdb_ci_win_server",</p><p>       "values":{</p><p>               "name":"Win Server 100",</p><p>               "ip_address":"10.20.30.40",</p><p>               "mac_address":"ABCD1234",</p><p>               "ram":"4096"</p><p>       }</p><p>}],"relations":[{</p><p>       "child":1,</p><p>       "parent":0,</p><p>       "type":"Runs on::Runs"</p><p>}]}</p></pre><p></p><p>There are a ton of details glossed over here (like configuring identification rules). To go deeper, take advantage of some of the great content out there by <a title="manishgupta" __default_attr="67134" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="manishgupta" data-renderedposition="1832_958.625_100_16" href="/community?id=community_user_profile&user=da3316e5db1c1fc09c9ffb651f9619ad">manishgupta</a> <a title="richardbrounstein" __default_attr="54127" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="richardbrounstein" data-renderedposition="1832_1062.6875_128_16" href="/community?id=community_user_profile&user=254f0ea5db181fc09c9ffb651f9619f4">richardbrounstein</a> and <a title="mikebuckner" __default_attr="63660" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="mikebuckner" data-renderedposition="1854_35.484375_100_16" href="/community?id=community_user_profile&user=12c1d2eddb981fc09c9ffb651f9619c8">mikebuckner</a> (<strong>NOTE:</strong> these are K16 resources which are only available to full conference attendees who are logged in):</p><p><a __default_attr="5214" __jive_macro_name="document" class="jive_macro jive_macro_document" data-orig-content="Identification &amp;amp; Reconciliation (repeat 1 of 2)" data-renderedposition="1875_8_294_16" href="/community?id=community_article&sys_id=b75d2a29dbd0dbc01dcaf3231f961980" modifiedtitle="true" title="Identification &amp;amp; Reconciliation (repeat 1 of 2)">Identification &amp; Reconciliation (repeat 1 of 2)</a></p><p><a title="Use CMDB APIs for Identification &amp; Reconcilation" __default_attr="5374" __jive_macro_name="document" class="jive_macro jive_macro_document" data-orig-content="Use CMDB APIs for Identification &amp;amp; Reconcilation" data-renderedposition="1896_8_329_16" href="/community?id=community_article&sys_id=b5dca665dbd0dbc01dcaf3231f9619af">Use CMDB APIs for Identification &amp; Reconcilation</a></p><p></p><p>Here are several publicly accessible resources that are related for those without access to K16 content:</p><p><a title="ocs.servicenow.com/bundle/geneva-it-service-management/page/product/configuration_management/concept/c_CMDBIdentifyandReconcile.html" href="https://docs.servicenow.com/bundle/geneva-it-service-management/page/product/configuration_management/concept/c_CMDBIdentifyandReconcile.html">Product Documentation</a></p><p><a title="eveloper.servicenow.com/app.do#!/api_doc?v=helsinki&type=server&scoped=false&to=class__unscoped_identificationenginescriptableapi__helsinki" href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;type=server&amp;scoped=false&amp;to=class__unscoped_identificationenginescriptableapi__helsinki">createOrUpdateCI Scriptable API</a></p><p><a title="ocs.servicenow.com/integrate/inbound_rest/concept/c_IdentifyReconcileAPI.html" href="https://docs.servicenow.com/integrate/inbound_rest/concept/c_IdentifyReconcileAPI.html">IdentifyReconcile REST API</a></p><p><a title="eveloper.servicenow.com/app.do#!/api_doc?v=helsinki&type=server&scoped=false&to=constructor_class__unscoped_cmdbtransformutil___cmdbtransformutil__helsinki" href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;type=server&amp;scoped=false&amp;to=constructor_class__unscoped_cmdbtransformutil___cmdbtransformutil__helsinki">CMDBTransformUtil — identifyAndReconcile() API</a></p>