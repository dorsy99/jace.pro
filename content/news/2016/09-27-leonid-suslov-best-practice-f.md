---
title: "Best practice for configuring UNIX sudoers file for ServiceMapping and Discovery"
date: 2016-09-26T21:37:39.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=4a1d22e5dbd0dbc01dcaf3231f9619d1"
---
<p><span style="font-family: calibri, verdana, arial, sans-serif; font-size: 12pt;"> <span style="color: black;">In the following of the @<a title="Importance of Credential Management" __default_attr="5758" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Importance of Credential Management" data-renderedposition="10_169.34375_273_19" href="/community?id=community_blog&sys_id=b7bcae25dbd0dbc01dcaf3231f9619ac">Importance of Credential Management</a>   published by my colleagues <a __default_attr="3071" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="Anders" data-renderedposition="10_630.359375_65_19" href="/community?id=community_user_profile&user=44ae422ddbd41fc09c9ffb651f961957" modifiedtitle="true" title="Anders">Anders</a> and <a __default_attr="61440" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="Angelo Nappi" data-renderedposition="10_726.65625_106_19" href="/community?id=community_user_profile&user=e6629a69dbd81fc09c9ffb651f9619c0" modifiedtitle="true" title="Angelo Nappi">Angelo Nappi</a> about the importance of Credential Management, I want to share the best practice for configuring UNIX sudoers file for agentless ServiceMapping and Discovery</span></span></p><p></p><p><span style="color: black; font-size: 12pt; font-family: Calibri;"><strong>Let's see what is a sudoers file for Unix/Linux from @Wikipedia</strong></span></p><p><span style="font-family: Calibri; color: black; font-size: 12pt;">The /etc/sudoers file controls who can run what commands as what users on what machines, and can also control special things such as whether you need a password for particular commands. The file is composed of aliases (basically variables) and user specifications (which control who can run what).</span></p><p><span style="font-family: Calibri; color: black; font-size: 12pt;">And, what is very important from agentless discovery and mapping perspective, the <strong>sudo</strong> command offers a mechanism for providing<span class="apple-converted-space"> <span style="text-decoration: underline;">trusted users with administrative access to a system without sharing the password of the <strong>root</strong> user.</span></span></span></p><p></p><p><span style="color: #303030; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">The best way to understand the "sudo" command, and the rules in sudoers file, the funny way is by this comic.</span></p><p><img   alt="sudo-sudoers-make-me-sandwich.png" class="image-1 jive-image" src="4c76ef3ddb541fc068c1fb651f9619fd.iix" style="height: auto;"/></p><p></p><p><span style="color: #303030; font-family: calibri, verdana, arial, sans-serif; font-size: 12pt;">As you can see from this funny picture, using <span style="background: #F8F8F8;">"SUDO"</span> command, makes the system obey any given order.</span></p><p><span style="color: #303030; font-family: calibri, verdana, arial, sans-serif; font-size: 12pt;">The two best advantages about using "<span style="background: #F8F8F8;">sudo</span>" command are:</span></p><ul style="list-style-type: disc;"><li><span style="color: black; font-family: calibri, verdana, arial, sans-serif; font-size: 12pt;">Restricted privileges</span></li><li><span style="color: black; font-family: calibri, verdana, arial, sans-serif; font-size: 12pt;">Logs of the actions taken by users</span></li></ul><p><span style="font-family: calibri, verdana, arial, sans-serif; color: black; font-size: 12pt;">I'm sure you are now fully aware of the advantages of using SUDO command in a daily basis,<span class="apple-converted-space"> <strong>So... what do we need to do?</strong></span></span></p><p></p><p><span style="color: black;">In order to perform agentless Mapping/Discovery tasks with customer provided <strong>non-root</strong> user credentials, we should add necessary Linux commands into sudoers file, which will allow us to execute these commands with root privileges, w</span><span style="color: black;">hich will allow us to execute these commands with root<span class="apple-converted-space"> </span>privileges.</span></p><p></p><p><span style="color: black;">And here is the list of commands necessary for Mapping:</span></p><p><span style="color: black;"><a href="https://docs.servicenow.com/bundle/helsinki-it-operations-management/page/product/service-mapping/reference/r_CommandsnCredentials.html" title="https://docs.servicenow.com/bundle/helsinki-it-operations-management/page/product/service-mapping/reference/r_CommandsnCredentials.html"><span style="color: black;">Service Mapping commands requiring</span> <span style="color: black;">sudo</span>-level credentials</a></span></p><p><span style="color: black;">and for Discovery </span></p><p><span style="color: black;"><a href="https://docs.servicenow.com/bundle/helsinki-it-operations-management/page/product/discovery/reference/r_CmdsReqRootDiscoAndOrch.html#r_CmdsReqRootDiscoAndOrch" title="https://docs.servicenow.com/bundle/helsinki-it-operations-management/page/product/discovery/reference/r_CmdsReqRootDiscoAndOrch.html#r_CmdsReqRootDiscoAndOrch"><span style="color: black;">UNIX and Linux</span> <span style="color: black;">commands</span> <span style="color: black;">requiring root privileges for Discovery and Orchestration</span></a> </span></p><p><br/><br/></p><p><span style="; color: black; font-family: Calibri;"><strong>L<span style="font-family: calibri, verdana, arial, sans-serif; font-size: 12pt;">et's see examples of sudoers file part relevant to Mapping/Discovery</span></strong></span></p><p></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Example 1 - </span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Adding single username for ServiceNow and allowing it to run a limited set of commands</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">ServiceNow ALL = NOPASSWD: /bin/cat, /bin/ls, /bin/lsof, /usr/sbin/dmidecode, /bin/netstat</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Example 2 -</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Creating Command Alias for group/user and applying permission to run commands to user.</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">## ServiceNow account permissions</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Cmnd_Alias PRTG = /bin/cat, /bin/ls, /bin/lsof, /usr/sbin/dmidecode, /bin/netstat</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">ServiceNow ALL = NOPASSWD: PRTG</span></p><p></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">After changes made to sudoers file and then running "sudo —l" command should provide next output:</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">User ServiceNow may run the following commands on this host:</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">(ServiceNow) NOPASSWD: /bin/netstat, /bin/cat, /bin/ls, /usr/sbin/dmidecode, /bin/lsof</span></p><p></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;"><strong>And please remember <span style="color: #272e37;">Never edit this file with a normal text editor! Always use the visudo command instead!!!</span></strong></span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Because improper syntax in the /etc/sudoers file can leave you with a system where it is impossible to obtain elevated privileges, it is important to use the visudo command to edit the file.</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">The visudo command opens a text editor like normal, but it validates the syntax of the file upon saving.</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">This prevents configuration errors from blocking sudo operations, which may be your only way of obtaining root privileges.</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Traditionally, visudo opens the /etc/sudoers file with the vi text editor. Ubuntu, however, has configured visudo to use the nano text editor instead.</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">On CentOS, you can change this value by adding the following line to your ~/.bashrc:</span></p><ul style="list-style-type: disc;"><li><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;"><span style="color: #212121;">export EDITOR=`which</span> <span style="color: #d7182c;">name_of_editor</span><span style="color: #212121;">`</span></span></li></ul><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Source the file to implement the changes:</span></p><ul style="list-style-type: disc;"><li><span style="color: #212121; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">. ~/.bashrc</span></li></ul><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">After you have configured visudo, execute the command to access the /etc/sudoers file:</span></p><ul style="list-style-type: disc;"><li><span style="font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;"><span style="color: black;"> · </span><span style="color: #212121;">sudo visudo</span></span></li></ul><p></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Aforementioned example of the sudoers file is only for guidelines purposes only.</span></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">Customer's environment could be highly customized and permission from IT Security Department of the customer could be needed in order to make any changes to sudoers file.</span></p><p></p><p><span style="color: black; font-size: 12pt; font-family: calibri, verdana, arial, sans-serif;">If you enjoyed the article, please share it</span></p><p></p><p><span style="color: black; font-size: 12pt;"><span style="color: #666666; font-family: arial, sans-serif;">Co-Author </span><a title="" _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="3071" data-objecttype="3" href="/community?id=community_user_profile&user=44ae422ddbd41fc09c9ffb651f961957" style="font-family: arial, sans-serif; color: #3778c7;">Anders</a></span></p>