---
title: "Service Portal getting familiar with advanced widget options"
date: 2016-10-04T22:50:40.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=134da229dbd0dbc01dcaf3231f961966"
---
<p>Let's talk a bit more about Widget options! <a title="b-rad" __default_attr="2204" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="b-rad" data-renderedposition="10_277.96875_53_16" href="/community?id=community_user_profile&user=90e1da21dbd81fc09c9ffb651f961977">b-rad</a> already published a <a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=6a6c6ea1dbd0dbc01dcaf3231f961980">great article</a> about the usage of options, which I always like to compare to System Properties. Those can hold values to design content a bit more dynamic, rather than hard-coding values.</p><p></p><p>The available option types, as of today, are:</p><ul><li>Integer</li><li>String</li><li>Boolean</li><li>Choice</li><li>Field name &amp; Field List (both dependent on the "table" option on the according Widget instance)</li><li>Reference</li></ul><p></p><p>Within this post we want to look a bit more into the <strong>Reference </strong>option type.</p><p></p><p><strong>Use Case #1 - Understanding the Reference option</strong></p><p>Before we start with advanced options, let's just have a look what you could do with a standard reference type option. Assume we would want to build a Menu block based off the <strong>Instance with Menu [sp_instance_menu]</strong> table. Instead of writing a Widget for each and every Menu block, how about we just "optionize" (yes, I think that should be a word moving forward in the Service Portal context <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="366.578125_149.796875_16_16" src="/8.0.4.21bdc7e/images/emoticons/happy.png"></span>) in a way, that an SP Admin can simply pick the Menu from a reference field, rather than changing the sys_id in the Widget?</p><p></p><p>Here's what we could do (no need to rebuild this yourself, it's more about how to use the reference option - you will build a widget later on):</p><ol><li>Let's assume we'll create a widget called "Menu Block"</li><li>Then we will create a reference option in the widget pointing to the Instance [sp_instance_menu] table</li><li>Have the Server Script utilize the newly created option value to retrieve the menu record, which will be defined in the widget instance. Retrieve the basic values of that menu with the <strong>$sp </strong>server-side API and have the HTML display the values within the data object</li><li>Create a new Menu record (for demo purposes I added an Image field to the sp_instance_menu table, that we'll pull into the Widget)</li><li>Create a widget instance by dragging &amp; dropping the widget onto a page &amp; define a menu</li><li>Modify the Menu of an existing widget instance by <strong>Ctrl + right-clicking </strong>on the widget instance (this does not work in the Designer, you'd have to be on the actual <strong>page</strong>)</li><li>Voila, we changed the instance of that menu block to a different menu.</li></ol><p><img   alt="output_9zFFN7.gif" class="image-13 jive-image" src="1a73c9c6db5897041dcaf3231f9619c5.iix" style="width: 620px; height: 171px;"/></p><p>This example is not meant to be particularly pretty, it should more explain the concept of how to effectively utilize reference options.</p><p>I also refrained from providing the code to evaluate the child items for this very reason.</p><p></p><p>So far so good - now that we know how to use Reference options, let's move on to the advanced use-case.</p><p>Probably almost everybody of you has used <strong>Reference Qualifiers</strong> in the platform view/backend (you name it), to filter down the results of a reference field - e.g. just return all operational CI's on a configuration item reference field or just display active callers on a user reference field.</p><p></p><p>Now, how would we apply those to a service portal option? The bad news: <em>not at all</em>. The option schema does not accept reference qualifiers. The good news: you can create your own "Option <strong>tables</strong>". You might have come across the <strong>Data Table </strong>field, which is defined on the Widget record itself. Per default you will mostly find Instance [sp_instance], but you'll also find e.g. Instance of Simple List [sp_instance_vlist], which is used by the Simple List Widget. All <strong>fields</strong> on the table defined as the data table, are available options for the widget that uses this table <span __jive_emoticon_name="alert" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="1008.953125_1178.21875_16_16" src="/8.0.4.21bdc7e/images/emoticons/alert.png"></span>.</p><p><img   alt="Report1.png" class="image-2 jive-image" src="4050244adbd85344e9737a9e0f96190a.iix" style="width: 620px; height: 281px;"/></p><p></p><p>In addition, you will still be able to define options via the Widget Options. Be aware that those are not automatically fields on the according instance table, those will be transformed into options represented in the JSON format - here is an example how this would look like based on the first use-case described in this post.</p><p><img   alt="JSONOptions.png" class="image-1 jive-image" src="8c36748edb1cdfc068c1fb651f9619a6.iix" style="width: 620px; height: 265px;"/></p><p></p><p>This is great for multiple reasons:</p><ol><li>As this is a "real" field, no JSON option, we can apply <strong>Reference Qualifiers</strong>!</li><li>Looks like a form doesn't it? Well, it is! That also means that we can leverage<strong> UI Policies to conditionally hide &amp; show options</strong>. Sweet! Something else, that we would not be able to achieve, if we would stick to the default Option Schema.</li></ol><p></p><p><strong>Use-Case #2 - Creating your own Instance Table to apply Reference Qualifiers &amp; leverage UI Policies</strong></p><p>Enough talk, let's create a custom "options" table.</p><ol><li>Navigate to <strong>System Definition &gt; Tables</strong>, click <strong>Create New</strong></li><li>Pick a Name &amp; Label for your new table, given the naming convention of all existing tables I'd suggest something along those lines: "<strong>Instance of xyz"</strong> / <strong>"Instance with xyz"</strong>. Personally I always went for <strong>SP &lt;Name of the Widget&gt; Instance </strong>so far.</li><li>Extend the new table from <strong>Instance [sp_instance] </strong></li><li>If you want create a new Module for it within the Service Portal application. Make sure to disable the role creation, numbering etc. - we don't really need this in the context of options.</li><li>Click <strong>Submit</strong></li><li>The table will inherit all fields from the Instance table, so make sure you do not create duplicate fields for something that's already there (e.g. HREF/URL, Bootstrap Color etc.).</li><li>Now you can go ahead and create whatever field you want from the Tables view, via the Form Designer or Form Layout - I created the following fields for the demo:<ol><li>Reference - to Business Services [cmdb_ci_service]</li><li>Override Styles - Boolean</li><li>Font Color - Color</li><li>Border Color - Color</li></ol></li></ol><p><img   alt="Report3.png" class="image-3 jive-image" src="a5318082db98d3041dcaf3231f961905.iix" style="width: 620px; height: 209px;"/></p><p></p><p>If you navigate to the form of that table, you will most likely see the following (unless you directly created and formatted the form via Form Designer / Layout).</p><p><img   alt="Report4.png" class="image-4 jive-image" src="bb952582dbd0df048c8ef4621f9619a0.iix" style="width: 620px; height: 127px;"/></p><p></p><p>At this point we can start applying our UI Policies and the Reference Qualifier on the Reference field. Let's start with the UI Policy, which should hide the color fields if <strong>Override Styles</strong> is not checked.</p><p><img   alt="Report5.png" class="image-5 jive-image" src="d76db48adbdcdfc068c1fb651f9619e8.iix" style="width: 620px; height: 344px;"/></p><p></p><p>For the reference qualifiers you can <strong>Right-click </strong>on the label of the reference field and then choose <strong>Configure Dictionary</strong>.</p><p>If you switch into the <strong>Advanced View </strong>of the dictionary record you will also be able to define an Advanced Reference Qualifier (e.g. calling your own filter function defined in a Script Include), rather than only a Simple Reference Qualifier.</p><p><img   alt="output_L1AD2u.gif" class="image-6 jive-image" src="08addc8adb585344e9737a9e0f96193e.iix" style="width: 620px; height: 307px;"/></p><p></p><p></p><p>At this point we have prepared our option/instance table: once you've done this, you will be able to choose from the fields on that table right below Data Table, by using the <strong>Fields </strong>field list.</p><p>The Option Schema will <strong>not </strong>automatically expose all fields as options - quite the contrary: it will <strong>only </strong>use the fields that you pick within that field list and expose them as options in the widget instance. Another thing that I found is, that the field will <strong>have to be on the Widget Instance <span style="text-decoration: underline;">form</span> </strong>- only selecting it within the <strong>Fields</strong> won't work.</p><p></p><p>Let's create a new widget to test our new instance table. Open the Widget editor via <strong>Service Portal &gt; Service Portal Configuration </strong>or <strong><a title="" _jive_internal="true" href="https://yourInstance.service-now.com/sp_config" rel="nofollow" target="_blank">https://yourInstance.service-now.com/sp_config</a></strong></p><p>Give your new widget a name, e.g. "Widget Option Test" - if you create a <strong>Test Page, </strong>be aware that you will have to delete the widget instance on the page and re-add the widget after you changed the Data Table, otherwise it will still point to <strong>Instance</strong>, rather than to your new table.</p><p>Once the widget is created navigate to the platform view/backend and open up the widget.</p><p></p><p><img   alt="Report9.png" class="image-7 jive-image" src="c99af7b1db54d3049c9ffb651f961943.iix" style="width: 620px; height: 230px;"/></p><p></p><p>Scroll down to <strong>Data Table &amp; Fields</strong> and define your new option table. Also select the fields (and essentially now options) we created.</p><p></p><p><img   alt="output_cJFAyE.gif" class="image-8 jive-image" src="887d344adb1013043eb27a9e0f96197a.iix" style="width: 620px; height: 220px;"/></p><p></p><p>Now we are almost done - but at this point we have a blank widget, that wouldn't display anything, so let's just add some HTML and data based on the selected service.</p><p>Again, this widget will not really make a whole lot of sense, but should rather convey what you will be able to do.</p><p></p><p>Go back to the <strong>Widget Editor</strong>. If you had your Widget Editor open when you associated the new data table with your widget record, make sure to reload the widget editor so that it has the correct context, i.e. the new data table.</p><p></p><p>Write the following code into the Server Script:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14755496081696879 jive_text_macro" data-renderedposition="4399.90625_8_1192_288" jivemacro_uid="_14755496081696879"><p>function() {</p><p></p><p>   //initialize serviceValues object within the data object</p><p>   data.serviceValues = {};</p><p></p><p>   //Business Criticality has indeed only one "s" in the tech field name, no error.</p><p>   var fields = "name, owned_by, busines_criticality, version, used_for, location";</p><p></p><p>   //the option name is going to be the technical field name on the table</p><p>   var service = options.u_business_service; </p><p>   var grService = new GlideRecord("cmdb_ci_service");</p><p>   if(grService.get(service)) {</p><p>             data.serviceValues = $sp.getFieldsObject(grService, fields);</p><p>   }</p><p></p><p></p><p>})();</p><p></p></pre><p></p><p>If you are curious what <strong>$sp.getFieldsObject() </strong>does, I suggest doing a <strong>Ctrl + Right-click </strong>on the Widget instance and then do a <strong>Log to Console: $scope.data</strong>.</p><p></p><p>Open the developer tools of your browser, go to <strong>Console </strong>and review the <strong>serviceValues </strong>object, which will contain e.g. the display values and labels of all the fields we defined.</p><p><img   alt="Debug.png" class="image-17 jive-image" src="634429cedb5c130468c1fb651f96194a.iix" style="width: 620px; height: 149px;"/></p><p></p><p><strong>Note: </strong>you can also use <strong>$sp.log()</strong>, which only outputs if the user has the sp_admin role or is impersonating. You can even use <strong>console.log()</strong> in the server script to debug objects, variables etc. If you are debugging an object make sure <strong>not to prefix </strong>it with a string (i.e. console.log("This is my serviceValue object: " + data.serviceValues)), since that would convert it into a string and you would not be able to move through the hierarchy within the console.</p><p></p><p></p><p>Now, we write the following HTML:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1475559925075837 jive_text_macro" data-renderedposition="5095.90625_8_1192_224" jivemacro_uid="_1475559925075837"><p>&lt;div&gt;</p><p>   &lt;div class="panel panel-default"&gt;</p><p>       &lt;div class="panel-heading" ng-style="{'background-color': options.u_border_color}"&gt;</p><p>           &lt;h3 class="panel-title"&gt;{{data.serviceValues.name.display_value}}&lt;/h3&gt;</p><p>       &lt;/div&gt;</p><p>       &lt;div&gt;</p><p>           &lt;dl&gt;</p><p>               &lt;!-- Because the &lt;dt&gt; tag closes we have to extend the ng-repeat range by using ng-repeat-start, otherwise the &lt;dd&gt; tag could not access the values --&gt;</p><p>               &lt;dt ng-repeat-start="item in data.serviceValues" ng-style="{'color': options.u_font_color}"&gt;{{item.label}}&lt;/dt&gt;</p><p>               &lt;dd ng-repeat-end&gt;{{item.display_value}}&lt;/dd&gt;</p><p>           &lt;/dl&gt;</p><p>       &lt;/div&gt;</p><p>   &lt;/div&gt;</p><p>&lt;/div&gt;</p></pre><p></p><p>Save your Widget and go to <strong>Service Portal &gt; Service Portal Configuration </strong>and open up the <strong>Designer </strong>or the platform view of the Widget Instance.</p><p>Navigate to your test page and modify the Widget Instance Options by providing a title to the widget, picking a service and providing a font color via the color picker (another great side effect of using real fields instead of JSON options) + a border color, that we'll use for the panel heading (slight misusage of the name, but you get the idea <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="5383.90625_931.265625_16_16" src="/8.0.4.21bdc7e/images/emoticons/happy.png"></span>). We are not using it within the widget, but it's always good to have a title if you go to the list of widget instances - helps distinguishing between instances based of the same widget.</p><p><img   alt="Report12.png" class="image-14 jive-image" src="e022a4cedb50d704ed6af3231f96196e.iix" style="width: 620px; height: 321px;"/></p><p></p><p>Go to your test page and reload it. It should now look like this, most likely it would contain different data dependent on the service that you chose:</p><p><img   alt="Report13.png" class="image-15 jive-image" src="11914c8edb941304b322f4621f96197a.iix" style="width: 620px; height: 161px;"/></p><p></p><p>At this point you have successfully created a new Widget Instance table, added fields to be used as options on that particular table and you made use of them within the Widget. I hope you found this article useful and that it will help you to create more dynamic widgets in the future.</p>