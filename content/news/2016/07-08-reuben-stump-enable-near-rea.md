---
title: "Enable Near Real Time CMDB Updates in AWS"
date: 2016-07-07T05:26:09.000Z
authors: ["reuben.stump"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=002ee26ddbd0dbc01dcaf3231f961923"
---
<p><span style="color: #000000; font-family: Helvetica;">In a standard configuration of Cloud Management with Amazon Web Services, a discovery schedule is configured to run daily or semi-daily.   However, things move quickly in the cloud and an organization's need for accurate Change and Configuration Management are paramount to both Service Management and IT Operations.   </span><span style="color: #000000; font-family: Helvetica;">Because of this, it is often necessary to receive updates on changes within your AWS environment between discovery schedules.</span></p><p></p><p><span style="color: #000000; font-family: Helvetica;">Cloud Management and Change Management actually have the same needs, but for their own reasons. <span class="Apple-converted-space"> </span>Cloud Management needs the latest information on machines for placement and other operational decisions, while Change Management needs this information for Audit and Control. <span class="Apple-converted-space"> However, both domains increasingly</span> require this information at near real time speeds. <span class="Apple-converted-space"> </span>It is important to note that while Cloud Management does not track the intended state of a Configuration Item in AWS, the ServiceNow platform tracks changes to all Configuration Items and allows Change Managers to make decisions accordingly (unauthorized change, etc).</span></p><p></p><p><span style="color: #000000; font-family: Helvetica;">Cloud Management has supported SNS notifications from AWS Config since Geneva, but the powerful feature often gets overlooked in the larger context of a customer's implementation.</span>   AWS Config notifications are received through an AWS SNS topic that is created with a subscription to your ServiceNow instance, which processes each notification and drives updates directly to the CMDB view of the Amazon Web Services environment.   The setup and integration with AWS Config is <a title="ocs.servicenow.com/bundle/helsinki-it-operations-management/page/product/amazon-ec2-cloud-provisioning/task/t_AWSConfigIntegration.html" href="https://docs.servicenow.com/bundle/helsinki-it-operations-management/page/product/amazon-ec2-cloud-provisioning/task/t_AWSConfigIntegration.html">documented</a> in the ServiceNow documentation, but the following steps will provide additional detail around the configuration in Helsinki.</p><p></p><p>The first step is to create a user with the <strong>aws</strong><strong>_integration </strong>role on your instance.   The <strong>aws_integration </strong>role is available once the AWS Cloud Management plugin is enabled.</p><p><img   alt="UserAccount.png" class="image-1 jive-image" src="8c55e50edb50d7049c9ffb651f961969.iix" style="width: 620px; height: 411px;"/></p><p></p><p>Next, we'll create the SNS topic and subscription for your ServiceNow instance.   From the AWS Console, navigate to <strong>SNS &gt; Topics</strong>.   If you have an existing topic you'd like to use for the subscription, feel free to use it, otherwise select "Create new topic".   Specify the "Topic name" and "Display name" inputs.   Once the topic is created, click on the topic name and then select "Create subscription".</p><p></p><p><strong>Note</strong>: The <strong>Topic ARN</strong>, and <strong>Topic Owner</strong> fields are masked in the screenshots; yours will be populated with appropriate values generated by AWS.</p><p><img  alt="CreateSubscription.png" class="image-9 jive-image" src="197e7bb1db185fc068c1fb651f961980.iix" style="width: 620px; height: 243px;"/></p><p></p><p><img   alt="CreateSubscription2.png" class="image-3 jive-image" src="e52dbccedb1c9304b322f4621f961995.iix" style="width: 620px; height: 238px;"/></p><p></p><p>Select <strong>HTTPS</strong> for <strong>Protocol </strong>and use your instance's fully-qualified domain name for <strong>Endpoint</strong>.   The password portion of the URI will be masked by AWS SNS automatically when the subscription is created.   Once the subscription is submitted, the status will change to "PendingConfirmation".   Confirmation will happen automatically from your ServiceNow instance and should complete within a few seconds if the URI was entered correctly.</p><p><img   alt="PendingConfirmation.png" class="image-4 jive-image" src="ae5d1886db5c9fc068c1fb651f961991.iix" style="width: 620px; height: 140px;"/></p><p>You can use the refresh button in the <strong>Subscriptions</strong> panel to update the subscription status.   If successful, the subscription should look like the following screenshot.</p><p><img   alt="ConfirmedSubscription.png" class="image-5 jive-image" src="46ac7f71db185704ed6af3231f96194f.iix" style="width: 620px; height: 125px;"/></p><p></p><p>AWS Config should now be sending SNS notifications to the AWS Event Processor on your instance.   ServiceNow CMDB update behavior depends on the <strong>changeType</strong> property of the SNS notification payload.</p><ul><li><strong>changeType</strong>: <strong>CREATE</strong>; new record is created in the CMDB for that resource</li><li><strong>changeType</strong>: <strong>UPDATE</strong>; update existing record in the CMDB, or create a new record if matching record is not found</li><li><strong>changeType</strong>: <strong>DELETE</strong>; record is not deleted from the CDMB, but is instead marked "Terminated"</li></ul><p></p><p>Events from AWS Config are not quite "real-time" and can be delayed by up to fifteen (15) minutes.</p><p><img   alt="sys_properties.png" class="image-6 jive-image" src="75316186db50df048c8ef4621f9619df.iix" style="width: 620px; height: 139px;"/></p><p></p><p>In addition, logging of received SNS notifications is disabled by default, but can be enabled by an admin of the instance.   To enable logging, update the <strong>sys_properties</strong> table record <strong>itom.aws.logEvent </strong>to <strong>true</strong>.   The events will be logged to the table <strong>aws_sns_event </strong>and can be reviewed here to validate the configuration is working.   You may not want to keep this on after initial configuration testing and it can be safely disabled without impacting the updates.   Also, allow for the AWS Config event notification delay when watching the <strong>aws_sns_event</strong> table.</p><p></p><p><img   alt="aws_sns_events.png" class="image-7 jive-image" src="cfcb3002db509f048c8ef4621f9619a1.iix" style="width: 620px; height: 103px;"/></p><p>In this example, a tag value was changed on an EC2 instance from "TestTag=TestValue" to "TestTag=TestValue2".   If we navigate to our EC2 instance record in <strong>Amazon AWS Cloud &gt; Managed Resources &gt; Virtual Machine Instances</strong>, we can observe the change was processed and the tag value updated in advance of our daily discovery schedule.</p><p></p><p><img   alt="UpdatedTagValue.png" class="image-8 jive-image" src="f62ad8c2db5c17041dcaf3231f9619b4.iix" style="width: 620px; height: 182px;"/></p><p></p><p>The increased rate of updates through integration with AWS Config provides a more accurate and timely CMDB view of your Cloud Management assets in AWS.   Similar integrations are also available in the <a title="ocs.servicenow.com/bundle/helsinki-it-operations-management/page/product/discovery/concept/c_VCenterEventProcessorExtension.html" href="https://docs.servicenow.com/bundle/helsinki-it-operations-management/page/product/discovery/concept/c_VCenterEventProcessorExtension.html">VMware vCenter Event Collector</a> feature.   Azure support for event based CMDB updates is currently being developed.</p>