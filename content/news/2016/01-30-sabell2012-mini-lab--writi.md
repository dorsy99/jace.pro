---
title: "MiniLab Writing Entries Into the System Log Using Ajax and JSON"
date: 2016-01-29T09:57:49.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=1d2e666ddbd0dbc01dcaf3231f961961"
---
<p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Have you ever wanted to be able to send errors to the System Log from a Client Script?   a UI Action?   a UI Policy?   Well, in this mini-lab article I will show you a method for doing so.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">I had been wanting gs.log on the Client (i.e. Browser) for some time when one day it occurred to me that I could write a simple reusable UI Script / Ajax Script Include combo that would give me that capability.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">I will be using techniques that I described in my previous two articles:</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2016/01/24/pragmatic-patterns-ajax-architecting-your-code" style="font-size: 15px; font-family: arial, sans-serif; color: #266fc8; background-color: #f8fbfe;">Pragmatic Patterns: Ajax - Architecting Your Code</a></span></p><p style="padding-left: 30px;"><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2016/01/26/mini-lab-using-ajax-and-json-to-send-objects-to-the-server" style="font-size: 15px; font-family: arial, sans-serif; color: #266fc8; text-decoration: underline; background-color: #f8fbfe;">Mini-Lab: Using Ajax and JSON to Send Objects to the Server</a></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong><a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/12/08/community-code-snippets-requirements-best-practices-for-developers">Requirements</a></strong></span></p><p></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Ability to write to the system log from a Client Script, UI Action, or UI Policy script.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Must be re-usable from any of those mechanisms (i.e. emulate gs.log/gs.info on the server side)</span></li></ol><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong><a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/12/18/community-code-snippets-design-best-practices-for-developers">Design</a></strong></span></p><p></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt; line-height: 1.5;">Create an Ajax Script Include with a function that will take a "message" string and write it to the System Log using gs.log, gs.info, gs.debug, gs.error, or gs.warn.</span><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">The gs.log part will be straight forward, we simply do something like log(string, location) and translate that on the server side to gs.log(string, location).</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">The gs.info et. al. part is a bit trickier.   Here we will have to be a bit innovative.   Something like logextended(string, [array of values], type) may need to be done.</span></li></ul></li><li><span style="line-height: 1.5; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Create a UI Script with a function that will take a string and communicate it via Ajax to an Ajax Script Include.</span><ul><li><span style="line-height: 1.5; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Make this a Function Library that will be callable similar to gs.</span></li></ul></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Write an example onLoad Client Script that will call the UI Script function.   This will be used in testing.</span></li></ol><p></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>NOTE</strong>: In examining the design I determined that a Script Include Function Library would be overkill as the number of code lines needed to write to the System Log would be too few to warrant extraction.</span></p><p></p><p><span style="font-size: 12pt; font-family: arial, helvetica, sans-serif;"><img   class="image-5 jive-image" src="33a7ac0edb14dfc03eb27a9e0f96198e.iix" style="width: auto; height: auto; display: block; margin-left: auto; margin-right: auto;"/></span></p><p></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 18pt;"><strong>Lab 1.1:   Writing Log Entries Into The System Log From the Browser</strong></span></p><p></p><p><strong style="font-size: 12pt; font-family: arial, helvetica, sans-serif;"><a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/12/24/community-code-snippets-development-standards-and-best-practices-for-developers">Development</a></strong></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">We will start with a bottom up development approach.</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Ajax Script Include (Design Element #1)</strong></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">1. Navigate to System Definition -&gt; Script Includes.   This will display the Script Includes list view.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">2. Click on the New button.   This will display a blank Script Include form.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">3. Fill in the form with the following:</span></p><ul><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name</strong>: SystemLoggerAjax</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Client Callable</strong>: Checked (this will cause the Ajax template to be added to the Script field).</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Accessible from</strong>: All application scopes</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Description</strong>:   System Logging functions</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Script</strong>:</span></li></ul></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14540329627187876 jive_text_macro" data-renderedposition="1544.6007080078125_7.986111640930176_1191_622" jivemacro_uid="_14540329627187876"><p>var SystemLoggerAjax = Class.create();</p><p>SystemLoggerAjax.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p></p><p>       // simple logging function</p><p>       systemLog: function() {</p><p>               var message = this.getParameter('sysparm_message');</p><p>               var loggingSource = this.getParameter('sysparm_logging_source');</p><p>               </p><p>               gs.log(message, loggingSource);</p><p>       },</p><p></p><p>       // complex logging function</p><p>       systemLogExtended: function() {</p><p>               var message = this.getParameter('sysparm_message');</p><p>               // convert the JSON object back to our array</p><p>               var messageArgs = JSON.parse(this.getParameter('sysparm_args'));</p><p>               // type of log message to be executed</p><p>               var messageType = this.getParameter('sysparm_type').toLowerCase();</p><p>               </p><p>               switch (true) {</p><p>                       case messageType == 'info':</p><p>                               gs.info(message, messageArgs);</p><p>                               break;</p><p>                       case messageType == 'debug':</p><p>                               gs.debug(message, messageArgs);</p><p>                               break;</p><p>                       case messageType == 'warn':</p><p>                               gs.warn(message, messageArgs);</p><p>                               break;</p><p>                       case messageType == 'error':</p><p>                               gs.error(message, messageArgs);</p><p>                               break;</p><p>               }</p><p>       },</p><p></p><p>     type: 'SystemLoggerAjax'</p><p></p><p>});</p><p></p><p></p></pre><p></p><p><img  class="jive-image image-10" src="5dd6a7fddb5493041dcaf3231f9619ab.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 356px;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>UI Script (Design Element #2)</strong></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong> </strong></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">1. Navigate to System UI -&gt; UI Scripts.   This will display the UI Scripts list view.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">2. Click on the New button.   This will display a blank UI Script form.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">3. Fill in the form with the following:</span></p><ul><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name:</strong> LoggingUtils</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Global</strong>: Checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: Checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Description</strong>: System Logging Functions</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Script</strong>:</span></li></ul></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14540332282012867 jive_macro_code jive_text_macro" data-renderedposition="2860.2431640625_7.986111640930176_1191_856" jivemacro_uid="_14540332282012867"><p>var log = Class.create();</p><p></p><p>// Simple logging function</p><p>log.log = function(message, loggingSource) {</p><p>       loggingSource = '[BROWSER] ' + loggingSource; // spiff up the source a bit</p><p></p><p>       var systemLogger = new GlideAjax('SystemLoggerAjax');</p><p>       systemLogger.addParam('sysparm_name','systemLog');</p><p>       systemLogger.addParam('sysparm_message', message);</p><p>       systemLogger.addParam('sysparm_logging_source', loggingSource);</p><p>       systemLogger.getXML(function(result){ });   // no callback action</p><p>};</p><p></p><p>// Complex logging functions - can probably be refactored</p><p>log.info = function(message) {</p><p>       _syslogExt(message, _toArray(arguments), 'info');</p><p>};</p><p></p><p>log.warn = function(message) {</p><p>       _syslogExt(message, _toArray(arguments), 'warn');</p><p>};</p><p></p><p>log.debug = function(message) {</p><p>       _syslogExt(message, _toArray(arguments), 'debug');</p><p>};</p><p></p><p>log.error = function(message) {</p><p>       _syslogExt(message, _toArray(arguments), 'error');</p><p>};</p><p></p><p>// Transmit complex logging task to server side</p><p>function _syslogExt(message, messageArgs, messageType) {</p><p>       message = '[BROWSER] ' + message; // spiff up the message</p><p>       </p><p>       var systemLogger = new GlideAjax('SystemLoggerAjax');</p><p>       systemLogger.addParam('sysparm_name','systemLogExtended');</p><p>       systemLogger.addParam('sysparm_message', message);</p><p>       // method for transmitting complex objects to the server</p><p>       systemLogger.addParam('sysparm_args', JSON.stringify(messageArgs));</p><p>       systemLogger.addParam('sysparm_type', messageType);</p><p>       systemLogger.getXML(function(result){ });   // no callback action</p><p>}</p><p></p><p>// Simple function to convert "argument" arrays into a true array for manipulation</p><p><span style="font-size: 9pt; line-height: 12pt;">function _toArray(source) {</span></p><p>       var target = [];</p><p>       // shave off the first argument - this is our message line</p><p>       for (var i=1; i &lt; source.length; i++) {</p><p>               target.push(source[i] + '');</p><p>       }</p><p>       return target;</p><p>}</p><p></p><p></p><p></p></pre><p></p><p><img  class="image-11 jive-image" src="3b2709c2db1413043eb27a9e0f961968.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 354px;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Client Script (Design Element #3)</strong></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong> </strong></span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">1. Navigate to System Definition -&gt; Client Scripts.   This will display the Client Script List View.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">2. Click on the New button.   This will display a blank Client Script form.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">3. Fill in the form with the following:</span></p><ul><ul><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Name</strong>: syslog Example</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Table</strong>: Incident</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>UI Type</strong>: Desktop</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Type</strong>: onLoad</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Active</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Inherited</strong>: unchecked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Global</strong>: checked</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Description</strong>:   System Logger Example</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>Script</strong>:</span></li></ul></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_1454033440122388" data-renderedposition="4511.736328125_7.986111640930176_1191_202" jivemacro_uid="_1454033440122388"><p>function onLoad() {</p><p>       var incidentNumber = g_form.getValue('number');</p><p>       var userName = g_user.userName;</p><p>       </p><p>       // Test the simple logging function</p><p>       log.log('---&gt; The form has finished loading and is ready for user input. Incident: ' + incidentNumber, 'CS:syslog example');</p><p>       </p><p>       // Test the complex logging function</p><p>       log.info('---&gt; Test {0}: form has finished. userID = {1}, incident = {2}', '1', userName, incidentNumber);</p><p>       log.error('---&gt; Test {0}: form has finished. userID = {1}, incident = {2}', '2', userName, incidentNumber);</p><p>}</p><p></p><p></p></pre><p></p><p><img  class="image-12 jive-image" src="6f3560c2dbdc5344e9737a9e0f961962.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 353px;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;"><strong>UNIT TESTING</strong></span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">1. Navigate to Incident -&gt; Open.   The Open Incident list view will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">2. Choose an open Incident (click on the incident number to open the form).</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">3. Navigate to System Logs -&gt; System Log -&gt; All.   The System Log will be displayed.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">4. Order by Created Date descending.</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">5. Filter the Message column with: *---&gt;</span></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">6. Note the two new entries.</span></p><p></p><p><img   class="image-9 jive-image" src="73160486db5c5fc068c1fb651f96199d.iix" style="width: 620px; height: 205px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt; line-height: 1.5;">And there you have it!   A way to write entries to the System Log from the Client (browser) side!</span></p><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Best practices demonstrated:</span></p><ol><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Maintainability.   </span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Extensibility.</span></li><li><span style="font-family: arial, helvetica, sans-serif; font-size: 12pt;">Coding Best Practice: Another method of logging unit test results.</span></li></ol><p></p><p><span style="font-family: arial, helvetica, sans-serif; font-style: inherit; font-weight: inherit; color: #666666; line-height: 1.5; font-size: 12pt;">Steven Bell</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: bold; font-style: inherit; font-family: arial, helvetica, sans-serif; color: #800080; font-size: 12pt;">If you find this article helps you, don't forget to log in and "like" it!</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="font-weight: bold; font-style: inherit; font-family: arial, helvetica, sans-serif; color: #800080; font-size: 12pt;">Also, if you are not already, I would like to encourage you to become a member of our blog!</span></p>