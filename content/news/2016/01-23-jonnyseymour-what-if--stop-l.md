---
title: "What if Stop Listener fails on your LDAP Server"
date: 2016-01-23T00:05:38.000Z
authors: ["jonnyseymour"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=be6d2e29dbd0dbc01dcaf3231f96199b"
---
<p>A <a title="ki.servicenow.com/?title=LDAP_Integration#LDAP_Listener" href="http://wiki.servicenow.com/?title=LDAP_Integration#LDAP_Listener">LDAP listener</a> is a dedicated process that periodically searches for changes to users and groups on the <a title="ki.servicenow.com/?title=LDAP_Integration#gsc.tab=0" href="http://wiki.servicenow.com/?title=LDAP_Integration#gsc.tab=0">LDAP server</a>. This feature based on your <a title="ww.ietf.org/proceedings/50/I-D/ldapext-psearch-03.txt" href="https://www.ietf.org/proceedings/50/I-D/ldapext-psearch-03.txt">LDAP persistent search</a> is rare to be stopped. Even more rare for the "stop listener" to hang.   As rare as hens' teeth, the LDAP listener can fail to shutdown. Here is a quick workaround to make LDAP Listener work again.</p><p></p><p>You would like to stop the listener if you are performing changes on the LDAP server or LDAP OU Definitions. Normally, when stopped, the listener will go to Inactive. Very rarely, when stopping the listener, it changes to "Active (Shutting down...)" indefinitely.</p><p></p><p><img  alt="win7-mute2.png" class="image-12 jive-image" height="136" src="cd6694cedb941f048c8ef4621f9619e1.iix" style="display: block; margin-left: auto; margin-right: auto; width: 136px; height: 136px;" width="136"/></p><p></p><p>Below are the main steps to force stop your listener:</p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="392_8_917_169"><p>There are six (6) steps to ensure the<a title="ki.servicenow.com/?title=LDAP_Integration#gsc.tab=0" href="http://wiki.servicenow.com/?title=LDAP_Integration#gsc.tab=0"> LDAP server </a>stops:</p><p>1. Stop Listeners on all LDAP Servers. If using mid-server, please also stop the mid-server.</p><p>2. Confirm that the <a title="ki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0">"LDAP monitor"</a> does not show the ldap listener as running.</p><p>3. If LDAP listener is still running, create a new Scheduled job on demand and execute.</p><p>4. Delete all entries from sys_status_list.do with 'name' starting with "glide.ldap.listener"</p><p>5. Confirm that the <a title="ki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0">"LDAP monitor"</a> list does not show the ldap listener as running.</p><p>6. If a mid-server is used, start the mid-server. Start the LDAP listeners.</p></pre><p></p><h3>1. Stop Listeners on all LDAP Servers. If using mid-server, please also stop the mid-server.</h3><p>To avoid side effects with other listeners running, please ensure to use the 'Stop Listener' on all the active LDAP Server. Please note that stopping the listeners will not affect the user authentication for existing users. If using mid-server, you will need to stop the mid-server.</p><p></p><p>Here is how it looks like to open each <a title="ki.servicenow.com/?title=LDAP_Integration#gsc.tab=0" href="http://wiki.servicenow.com/?title=LDAP_Integration#gsc.tab=0">LDAP server </a>entry and click on "Stop Listener":</p><p><img   alt="stop ldap listener.jpg" class="image-7 jive-image" src="b6f97842dbdcdfc03eb27a9e0f9619e2.iix" style="width: 620px; height: 499px; display: block; margin-left: auto; margin-right: auto;"/></p><h3></h3><h3>2. Confirm that the "LDAP monitor" does not show the ldap listener as running.</h3><p>Go to the <a title="ki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0">LDAP server monitor </a>page and validate the LDAP listeners are stopped. You will know if they have stopped because the status will be 'Inactive'</p><p></p><h3>3. If LDAP listener is still running, create a new Scheduled job on demand and execute.</h3><p>This is an advanced task. You can use a background script if you have access to them. Otherwise, create a scheduled job.</p><pre __default_attr="warning" __jive_macro_name="alert" alert="warning" class="jive_text_macro jive_macro_alert" data-renderedposition="1397_8_917_43"><p>On this example, I will stop the listener for LDAP Server with sys_id = bdca2a7d4f8c92002f97fdb28110c786.</p></pre><p>Here is an example of the job to create.</p><p></p><table border="1" cellpadding="0" cellspacing="0" height="110" style="padding: 0px 5.4pt; height: 73px; width: 290px;"><tbody><tr><td colspan="3" style="border: solid windowtext 1.0pt; background: #FDE9D9; padding: 0 5.4pt 0 5.4pt;" valign="top" width="185"><p>Scheduled Job</p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="68"><p>Name</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="24"><p>=</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="93"><p>stop Ldap Listener</p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="68"><p>Active</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="24"><p>=</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="93"><p>checked</p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="68"><p>Run</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="24"><p>=</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="93"><p>On Demand</p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="68"><p>Trigger type</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="24"><p>=</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="93"><p>On Demand</p></td></tr></tbody></table><p></p><p>Script =</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14502957561365240" data-renderedposition="1650_8_917_112" jivemacro_uid="_14502957561365240"><p>stopLdapListener("bdca2a7d4f8c92002f97fdb28110c786");</p><p></p><p>function stopLdapListener (ldap_server_sys_id) {</p><p>       var ldapConfig = new GlideLDAPConfig().get(ldap_server_sys_id);</p><p>       ldapConfig.stopListener();</p><p>       gs.log('LDAP listener for: ' + ldapConfig.getName() + ' (' + ldap_server_sys_id +   ') has been stopped.', "stopLdapListener")</p><p>}</p></pre><p><img   alt="scheduled script execution.jpg" class="image-8 jive-image" src="0875d84adbd05344e9737a9e0f96190b.iix" style="width: 620px; height: 320px; display: block; margin-left: auto; margin-right: auto;"/></p><p>The logs should show the following entries:</p><p><img   alt="execution ldap log.jpg" class="image-9 jive-image" src="8bb4bb7ddbdc1fc068c1fb651f961990.iix" style="width: 620px; height: 150px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><h3>4. Delete all entries from sys_status_list.do with 'name' starting with "glide.ldap.listener"</h3><p>Open &lt;instance&gt;/sys_status_list.do?sysparm_query=nameSTARTSWITHglide.ldap.listener and delete all the entries. They will get recreated once the listeners are started.</p><p><img   alt="delete ldap sys status.jpg" class="image-10 jive-image" src="76f7dd0edb1c97049c9ffb651f96199b.iix" style="width: 620px; height: 244px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><h3>5. Confirm that the "LDAP monitor" list does not show the ldap listener as running.</h3><p>Go to the <a title="ki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0">LDAP monitor page </a>and validate the listener statuses. They should be 'Inactive'</p><p></p><h3>6. If a mid-server is used, start the mid-server. Start the LDAP listeners.</h3><p>Finally, if you are using mid-server, then start the mid-server.</p><p>Then for each LDAP Server active record with a LDAP listener you want to start, click 'Start Listener' (or 'Stop Listener' if available first).</p><p>To validate if they have started correctly, go to the <a title="ki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=LDAP_Monitor#gsc.tab=0">LDAP monitor page </a>and validate the listener statuses. They should be 'Active' for the ones started.</p><p></p><p><img   alt="start listener.jpg" class="image-11 jive-image" src="20d7f846dbdc5f048c8ef4621f96196b.iix" style="width: 620px; height: 388px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>In a nutshell, there is a few advanced steps to perform if you need to stop the LDAP listener that is too temperamental to shutdown. Pay additional attention if you are using mid-servers as they also need to be restarted.</p><p></p><p>I've tested this on Fuji with Chrome as browser.</p><p></p><p>More information found here:</p><ul><li><a href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0546974" title="https://hi.service-now.com/kb_view.do?sysparm_article=KB0546974">Authentication Resources (KB0546974)</a></li><li><a href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0552689" title="https://hi.service-now.com/kb_view.do?sysparm_article=KB0552689">PRB633319: LDAP listeners stop functioning (KB0552689)</a></li><li><a ___default_attr="159816" data-orig-content="LDAP Listener Question" data-renderedposition="3483.64990234375_38_169_17" href="javascript:;" jivemacro="thread">LDAP Listener Question</a></li><li><a ___default_attr="175628" data-orig-content="LDAP Help" data-renderedposition="3507.449951171875_38_88_17" href="javascript:;" jivemacro="thread">LDAP Help</a></li><li><a ___default_attr="799871" data-orig-content="Re: Remove deleted Groups/Users (LDAP import)" data-renderedposition="3531.25_38_328_17" href="javascript:;" jivemacro="message">Re: Remove deleted Groups/Users (LDAP import)</a></li><li><a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/integrate/ldap/concept/c_LDAPIntegration.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/integrate/ldap/concept/c_LDAPIntegration.html">Docs: LDAP integration</a></li><li><a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/integrate/ldap/concept/c_LDAPIntegrationSetup.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/integrate/ldap/concept/c_LDAPIntegrationSetup.html">Docs: LDAP integration setup</a></li><li><a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/integrate/ldap/concept/c_LDAPAuthentication.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/integrate/ldap/concept/c_LDAPAuthentication.html">Docs: LDAP authentication</a></li><li><a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/integrate/ldap/concept/c_LDAPListener.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/integrate/ldap/concept/c_LDAPListener.html">Docs: LDAP listener</a></li><li><a title="" _jive_internal="true" href="/search.jspa?q=jonnyseymour&amp;type=post">My other blogs</a></li></ul>