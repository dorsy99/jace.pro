---
title: "Roll up time worked to parent table"
date: 2016-08-05T16:08:42.000Z
authors: ["Göran Lundqvist"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=437da269dbd0dbc01dcaf3231f961965"
---
<p>First, I really had a hard time coming up with a good headline for this, so forgive me <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="8_540_16_16" src="/8.0.4.21bdc7e/images/emoticons/happy.png"></span></p><p></p><p>I had a community member asking me a question and wanted me to explain it in a blog post, so here we go.</p><p></p><p>Background:</p><p>I'm using the related list "Time worked" on incidents. Now, whenever someone adds a new record in that related list or updates a existing one it should calculate the totalt time in a custom field on the incident record. And this should happen right after the time worked record is saved.</p><p></p><p>Now, there is 2 ways to do this, depending on what you want to do with the data. If it's only for show on the incident record I recommend using list control on the related list. and this is how you do that:</p><p></p><p>Right-click on the column you want to calculate and choose "List Calculations".</p><p></p><p><img   class="image-1 jive-image" src="35787371db9cdf04e9737a9e0f9619db.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p>There you can choose the Total value and vola, you got the data at the bottom.</p><p><img   class="image-2 jive-image" src="2b6a198adbd813043eb27a9e0f9619e1.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p><img   class="image-3 jive-image" src="832a3cc6db9cdfc068c1fb651f9619f7.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p>But then, if you might want to do reports on this value or something else, you want to put this data in a field on the incident form instead.</p><p>And here is an example how to do that with an after Business rule.</p><p></p><h3><strong>1. Create the field on the incident form.</strong></h3><p>I have chosen to create a duration field called "Total time worked" on the incident form and it gets the name u_total_time_worked. I also set the attribute max_unit=hours so I get the duration in hours and not the version where it involves days etc. more of a personal taste and you don't need to do it.</p><p><img   class="jive-image image-4" src="21c995cadbd8d344e9737a9e0f9619b6.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><h3><strong>2. Getting the data in there</strong></h3><p>Since the Time worked isn't on the incident record we need to make an After Business Rule on the Time worked table that update the field on the incident. I made a condition on the Business Rule so that it should only run when the record is connected to an incident.</p><p></p><p><img   class="image-5 jive-image" height="564" src="f807fccedb9c5f048c8ef4621f96198c.iix" style="max-width: 1200px; max-height: 900px; width: 1018px; height: 563.946px;" width="1018"/></p><p></p><p>And here comes the script part that calculates and updates the incident record</p><p></p><pre __default_attr="java" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14703946881806929 jive_text_macro" data-renderedposition="1350_8_1192_432" jivemacro_uid="_14703946881806929"><p>(function executeRule(current, previous /*null when async*/) {</p><p></p><p>   //Get the incident which this time worked record is connected to</p><p>   var gr = new GlideRecord('incident');</p><p>   gr.get(current.task);</p><p></p><p>   //Now get all the time worked records connected to this incident</p><p>   var gr1 = new GlideRecord('task_time_worked');</p><p>   gr1.addQuery('task', current.task);</p><p>   gr1.query();</p><p></p><p>   var sec = 0;</p><p>   //Lets count all the seconds time has worked on the inciddent</p><p>   while (gr1.next()){</p><p>   sec = sec + gr1.time_in_seconds;</p><p>   }</p><p>   //Since GlideDuration wants milliseconds we need to transform it from secs to millisecs.</p><p>   sec = sec * 1000;</p><p>   //And lets update the field on the incident</p><p>   gr.u_total_time_worked = new GlideDuration(sec);</p><p>   //We don't want any BRs etc. to run when we set this field</p><p>   gr.setWorkflow(false);</p><p>   //We also dont want to lasted updated by and last updated on the field to set after this.</p><p>   gr.autoSysFields(false);</p><p>   gr.update(); </p><p></p><p>})(current, previous);</p></pre><p></p><p></p><p>And now you can see on the incident form how long time you have worked on it:</p><p></p><p><img   class="image-6 jive-image" height="586" src="99e4904edb5817049c9ffb651f961926.iix" style="max-width: 1200px; max-height: 900px; width: 982px; height: 585.927px;" width="982"/></p>