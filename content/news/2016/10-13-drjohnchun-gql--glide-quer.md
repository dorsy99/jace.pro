---
title: "GQL Glide Query Language Part  The Design"
date: 2016-10-12T21:10:15.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f04ee2addbd0dbc01dcaf3231f961902"
---
<p><a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=a63eee6ddbd0dbc01dcaf3231f96194e">Last time</a>, we discussed the concept behind GQL as being a web service with SQL-like syntax and listed use cases along with high-level requirements. We want to use it similar to <a title="ki.servicenow.com/index.php?title=JSONv2_Web_Service" href="http://wiki.servicenow.com/index.php?title=JSONv2_Web_Service">JSONv2</a> by sending a command using GET and retrieve a result set in JSON. This time, let's look at some design considerations.</p><p></p><p><strong>DESIGN COMPONENTS</strong></p><p></p><p>Here are some components we need to consider:</p><p></p><ol><li><strong>GQL syntax</strong> - define GQL syntax to be used</li><li><strong>Processor</strong> - handle bidirectional HTTP traffic</li><li><strong>Parser</strong> - parse GQL query for processing</li><li><strong>Retriever</strong> - query and retrieve result set</li><li><strong>Encoder</strong> - encode result set for output</li></ol><p></p><p>Let's also add that this will be a <strong><a title="ki.servicenow.com/?title=Application_Scope#Private_Application_Scope" href="http://wiki.servicenow.com/?title=Application_Scope#Private_Application_Scope">scoped application</a></strong>. The design will evolve over time as we start simple and refactor as needed.</p><p></p><p><strong>GQL SYNTAX</strong></p><p></p><p>Under the hood, we know that all database transactions in ServiceNow are being done in SQL. However, we don't have direct access to it. Even if we did, it may not prove to be useful in all cases. For example, selecting a display value may require joins or subqueries and the SQL statement may quickly become unwieldy. Instead, we'll use <a title="ki.servicenow.com/?title=GlideRecord" href="http://wiki.servicenow.com/?title=GlideRecord">GlideRecord </a>or, more specifically, <a title="ki.servicenow.com/?title=Scoped_GlideRecord_API_Reference" href="http://wiki.servicenow.com/?title=Scoped_GlideRecord_API_Reference">Scoped GlideRecord</a>. This means GQL will be constrained by what we can do with Scoped GlideRecord.</p><p></p><p>In Part 1, our requirements called for</p><p></p><ol start="5" style="list-style-type: lower-alpha;"><li>Focus on SELECT for now.</li><li>Don't need complex Subqueries or CTEs (Common Table Expressions) for now.</li><li>Select the raw and/or display value of a field.</li><li>Be able to rename column headings.</li><li>Support dot walking of reference fields.</li><li>Be able to filter the result set.</li><li>Be able to sort by one or more columns.</li></ol><p></p><p>In its simplest form, we have</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14762077971953058 jive_text_macro" data-renderedposition="748.15625_8_981_32" jivemacro_uid="_14762077971953058"><p>SELECT *</p><p>FROM table</p></pre><p></p><p>This returns all columns from <em>table</em>; we'll define what "all" means later when we discuss raw values vs. display values. Since we'd also like to embed this in a query string and use GET, we may rewrite this as</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14762080317002513 jive_text_macro" data-renderedposition="864.15625_8_981_16" jivemacro_uid="_14762080317002513"><p>SELECT * FROM table</p></pre><p></p><p>Let's further stipulate that <strong>white spaces are optional</strong> and <strong>all keywords must be in caps</strong>. This also helps with readability since ServiceNow table and column names are in lowercase. So the above can be rewritten as</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14762086794206579" data-renderedposition="964.15625_8_981_16" jivemacro_uid="_14762086794206579"><p>SELECT*FROMtable</p></pre><p></p><p>In this article, for readability, we'll continue using white spaces, though. Now, let's add the optional <strong>WHERE</strong> clause. Instead of reinventing it, we can just use <a title="ki.servicenow.com/?title=Encoded_Query_Strings" href="http://wiki.servicenow.com/?title=Encoded_Query_Strings">Encoded Query Strings</a>, which I've always found to be compact and powerful:</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="_jivemacro_uid_14762106314054748 jive_macro_code jive_text_macro" data-renderedposition="1064.15625_8_981_48" jivemacro_uid="_14762106314054748"><p>SELECT *</p><p>FROM table</p><p>WHERE encoded_query_string</p></pre><p></p><p>Encoded Query Strings may also contain one or more <strong>ORDERBY</strong> clauses for descending or ascending order, so we can sort the result set using them. We'll look at Encoded Query Strings and the syntax in more detail later.</p><p></p><p>Let's also add optional <strong>LIMIT</strong>, which we'll borrow from MySQL:</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14762126230421870" data-renderedposition="1238.15625_8_981_64" jivemacro_uid="_14762126230421870"><p>SELECT *</p><p>FROM table</p><p>WHERE encoded_query_string</p><p>LIMIT [offset,] row_count</p></pre><p></p><p>Now, let's turn to the field list instead of the asterisk. One or more columns may be listed, using <a title="iki.servicenow.com/?title=Dot-walking" href="https://wiki.servicenow.com/?title=Dot-walking">dot-walking</a>, if needed. Dot-walking allows access to related tables through reference fields (although dot-walking can be nested multiple levels, recommended limit is three levels). We'll also optionally allow renaming column headings by enclosing a new name in square brackets (this is not the same as aliases in SQL since the renamed column headings don't act as new column names that can be used in queries):</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="_jivemacro_uid_14762190939472957 jive_macro_code jive_text_macro" data-renderedposition="1428.15625_8_981_64" jivemacro_uid="_14762190939472957"><p>SELECT column_1, column_2 [column_2_heading], column_3</p><p>FROM table</p><p>WHERE encoded_query_string</p><p>LIMIT [offset,] row_count</p></pre><p></p><p>Lastly, let's allow for comments, using double dashes, as in SQL, in multi-line mode:</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14762410604826111" data-renderedposition="1555.15625_8_981_64" jivemacro_uid="_14762410604826111"><p>SELECT column_1, column_2 [column_2_heading], column_3   -- this is a comment</p><p>FROM table</p><p>WHERE encoded_query_string</p><p>LIMIT [offset,] row_count</p></pre><p></p><p>Summing it all up, here's an example:</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="_jivemacro_uid_14762413681305945 jive_macro_code jive_text_macro" data-renderedposition="1682.15625_8_981_160" jivemacro_uid="_14762413681305945"><p>SELECT   -- sample GQL statement</p><p>   number [Number]</p><p>   , short_description [Title]</p><p>   , state [State]</p><p>   , caller_id.email [Caller Email]</p><p>   , caller_id.manager.email [Manager Email]</p><p>   , cmdb_ci</p><p>FROM incident</p><p>WHERE active=true^priority&lt;2^EQ^ORDERBYpriority^ORDERBYDESCnumber</p><p>LIMIT 5,10</p></pre><p></p><p>Without white spaces, which may be useful for including in a GET query string, it is</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="_jivemacro_uid_14762414505263557 jive_macro_code jive_text_macro" data-renderedposition="1905.15625_8_981_16" jivemacro_uid="_14762414505263557"><p>SELECTnumber[Number],short_description[Title],state[State],caller_id.email[Caller Email],caller_id.manager.email[Manager Email],cmdb_ciFROMincidentWHEREactive=true^priority&lt;2^EQ^ORDERBYpriority^ORDERBYDESCnumberLIMIT5,10</p></pre><p></p><p>Let's work with what we have so far for now and discuss other features later. If you'd like anything specific, please leave a comment below.</p><p></p><p><strong>RAW VALUE VS. <strong>DISPLAY </strong>VALUE</strong></p><p></p><p>Some fields have both raw and display values. The State field for Incident, for example, has numeric raw values while the display value might say "Resolved". Other field types, such as date, duration, etc., also have both raw and display values. Also, a reference field's raw value is the sys_id from the related table while the display value is from the display value field of the related table.</p><p></p><p>In our SELECT statement, we'd like to specify raw and/or display value of each field. <a title="ki.servicenow.com/?title=JSONv2_Web_Service#displayvalue" href="http://wiki.servicenow.com/?title=JSONv2_Web_Service#displayvalue">JSONv2</a>, by default, returns raw values unless the "displayvalue" option is set to "true" (display, not raw, values are returned) or "all" (both raw and display values are returned and the display column names are prefixed with "dv_").</p><p></p><p>In GQL, let's return raw values unless column names start with "dv_", keeping consistent with JSONv2 (the same convention also applies to <a title="ki.servicenow.com/?title=Using_the_ODBC_Driver#Display_Values" href="http://wiki.servicenow.com/?title=Using_the_ODBC_Driver#Display_Values">ODBC SQL</a>). Since what we want in most cases are display values, this will add a bit of extra typing, forcing us to rewrite the above GQL as (see "dv_" for state and cmdb_ci)</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14762850047554410" data-renderedposition="2278.15625_8_981_160" jivemacro_uid="_14762850047554410"><p>SELECT   -- sample GQL statement</p><p>   number [Number]</p><p>   , short_description [Title]</p><p>   , dv_state [State]</p><p>   , caller_id.email [Caller Email]</p><p>   , caller_id.manager.email [Manager Email]</p><p>   , dv_cmdb_ci</p><p>FROM incident</p><p>WHERE active=true^priority&lt;2^EQ^ORDERBYpriority^ORDERBYDESCnumber</p><p>LIMIT 5,10</p></pre><p></p><p>For</p><p></p><pre __default_attr="sql" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14762852674385917 jive_text_macro" data-renderedposition="2501.15625_8_981_32" jivemacro_uid="_14762852674385917"><p>SELECT *</p><p>FROM table</p></pre><p></p><p>we'll return both raw and display values with the column names of the display values starting with "dv_", similar to JSONv2 with "displayvalue" set to "all".</p><p></p><p><a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=71ed6ee9dbd0dbc01dcaf3231f96197e">Next time</a>, we'll continue with the rest of the design. Please note that the design may change over time, especially with your input/feedback.</p><p></p><p><em>Please feel free to connect, follow, post feedback / questions / comments, share, like, bookmark, endorse.</em></p><p>John Chun, <span style="font-size: 8pt;">PhD PMP</span> <a href="http://linkedin.com/in/DrJohnChun"><img alt="see John's LinkedIn profile" class="image-2 jive-image" src="http://megaicons.net/static/img/icons_sizes/182/456/16/linkedin-icon.png" style="height: auto; vertical-align: -13px;" title="see John's LinkedIn profile"/></a></p><p><a href="http://snowaid.com/"><img alt="visit snowaid" class="image-1 jive-image" src="http://snowaid.com/images/signature.png" style="height: auto; margin-top: -9px;" title="visit snowaid"/></a></p>