---
title: "Custom Scatter Plot Use Multiple Data Channels to Show The Bigger Picture"
date: 2016-11-01T19:44:15.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=6a8c2ae1dbd0dbc01dcaf3231f96197b"
---
<p>In this post, I am going to outline how I created an interactive scatter plot in a Service Portal widget by leveraging D3.js. For this example, we are going to create the scatter plot using project records that are stored in our ServiceNow instance. What I would really like to highlight in this post is how you can use different data channels to tell different stories.</p><p></p><p>This particular scatter plot uses the following channels (how a particular shape can visually display data) to demonstrate different project attributes:</p><ol><li>X-axis displays the planned duration of the project</li><li>Y-axis displays the planned cost of the project</li><li>The size of each circle displays the planned effort of the project relative to the other projects displayed</li><li>The color of each circle displays the priority of the project</li><li>The line of best fit displays where the project sits in relation to the other projects in terms of planned duration vs. planned cost</li></ol><p></p><p>Here is a full screenshot of this scatter plot to give a better idea of how these channels are being used:</p><p><img   alt="Post 6 Scatter Plot.png" class="image-1 jive-image" height="384" src="86d5590edb18130468c1fb651f96193a.iix" style="height: 384px; width: 987.884px;" width="988"/></p><p></p><p>Since there are <a title="" _jive_internal="true" href="/people/mitchellstutler/content?filterID=contentstatus%5Bpublished%5D~objecttype~objecttype%5Bblogpost%5D">previous posts</a> giving a more in-depth introduction to using D3 and Service Portal together, I won't go into much detail with the code. Here is the pasted code for my HTML, CSS, Client Script, and Server Script:</p><p></p><h1>HTML</h1><p></p><p>&lt;div class="centered-chart row"&gt;</p><p>   &lt;div id="chart"&gt;&lt;/div&gt;</p><p>&lt;/div&gt;</p><p></p><h1>CSS</h1><p></p><p>.axis path,</p><p>.axis line {</p><p>   fill: none;</p><p>   stroke: #000;</p><p>   shape-rendering: crispEdges;</p><p>}</p><p></p><p>.dot {</p><p>   stroke: gray;</p><p>}</p><p></p><p>.dot:hover {</p><p>   stroke: black;</p><p>}</p><p></p><p>.centered-chart {</p><p>   text-align: center;</p><p>   font: 10px sans-serif;</p><p>}</p><p></p><p>.p1 {</p><p>   fill: #FF6347;</p><p>}</p><p></p><p>.p2 {</p><p>   fill: #FFA500;</p><p>}</p><p></p><p>.p3 {</p><p>   fill: #FFD700;</p><p>}</p><p></p><p>.p4 {</p><p>   fill: #87CEFA;</p><p>}</p><p></p><p>.p5 {</p><p>   fill: #90EE90;</p><p>}</p><p></p><h1>Client Script</h1><p></p><p>function() {</p><p>                       /* widget controller */</p><p>                       var c = this;</p><p>                 </p><p>                       var data = c.data.projects;</p><p>                 </p><p>                       var margin = {top: 20, right: 75, bottom: 75, left: 75},</p><p>                       width = 1170 - margin.left - margin.right,</p><p>                       height = 500 - margin.top - margin.bottom,</p><p>                       minCircle = 2, maxCircle = 20;</p><p>                 </p><p>                       var maxDuration = d3.max(data, function(d) { return d.duration; });</p><p>                       var minDuration = d3.min(data, function(d) { return d.duration; });</p><p>                 </p><p>                       // Set the colors used for each priority</p><p>                       var priorities = [{"priority": 1, "color": "#FF6347"},</p><p>                       {"priority": 2, "color": "#FFA500"},</p><p>                       {"priority": 3, "color": "#FFD700"},</p><p>                       {"priority": 4, "color": "#87CEFA"},</p><p>                       {"priority": 5, "color": "#90EE90"}];</p><p>                 </p><p>                       // Set the scale for the x-axis</p><p>                       var x = d3.scaleLinear()</p><p>                       .range([0, width])</p><p>                       .domain([d3.min(data, function(d) { return d.duration; }) - 2, d3.max(data, function(d) { return d.duration; }) + 2]);</p><p>                 </p><p>                       // Set the scale for the y-axis</p><p>                       var y = d3.scaleLinear()</p><p>                       .range([height, 0])</p><p>                       .domain([d3.min(data, function(d) { return d.cost; }) - 10000, d3.max(data, function(d) { return d.cost; }) + 10000]);</p><p>                 </p><p>                       // Set the scale for the circle size</p><p>                       var r = d3.scaleLinear()</p><p>                       .domain([ 0, d3.max(data, function(d) {return d.effort;}) ]).range([ minCircle, maxCircle ]);</p><p>                 </p><p>                       var xAxis = d3.axisBottom().scale(x);</p><p>                       var yAxis = d3.axisLeft().scale(y);</p><p>                 </p><p>                       // Create an svg canvas for our chart</p><p>                       var svg = d3.select("#chart").append("svg")</p><p>                       .attr("id", "chart-container")</p><p>                       .attr("width", width + margin.left + margin.right)</p><p>                       .attr("height", height + margin.top + margin.bottom)</p><p>                       .append("g")</p><p>                       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");</p><p>                 </p><p>                       // Create a circle for each of the project records</p><p>                       function generateCircles() {</p><p>                                               svg.selectAll(".dot")</p><p>                                               .data(data)</p><p>                                               .enter().append("circle")</p><p>                                               .attr("class", function(d) { return "dot p" + d.priority; })</p><p>                                               .attr("r", function(d) { return r(d.effort); })</p><p>                                               .attr("cx", function(d) { return x(d.duration); })</p><p>                                               .attr("cy", function(d) { return y(d.cost); })</p><p>                                               .on("mouseover",function(d,i){</p><p>                                                                       this.parentNode.appendChild(this);</p><p>                                                                       d3.select("#tooltip").attr("transform", "translate("+(x(d.duration)+20)+","+(y(d.cost)+20)+")");</p><p>                                                                       d3.select("#duration").text("Duration: " + d.duration);</p><p>                                                                       d3.select("#cost").text("Cost: $" + d.cost);</p><p>                                                                       d3.select("#effort").text("Effort: " + d.effort + ' hours');</p><p>                                               })</p><p>                                               .on("mouseout",function(d,i){</p><p>                                                                       d3.selectAll(".tooltip-attribute").text("");</p><p>                                               });</p><p>                       }</p><p>                 </p><p>                       // Create the priority legend</p><p>                       function generatePriorityLegend() {</p><p>                                               var legend = svg.selectAll(".legend")</p><p>                                               .data(priorities)</p><p>                                               .enter().append("g")</p><p>                                               .attr("class", "legend")</p><p>                                               .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });</p><p>                                         </p><p>                                               legend.append("rect")</p><p>                                               .attr("x", width + 20)</p><p>                                               .attr("width", 18)</p><p>                                               .attr("height", 18)</p><p>                                               .style("fill", function(d) { return d.color; });</p><p>                                         </p><p>                                               legend.append("text")</p><p>                                               .attr("x", width + 14)</p><p>                                               .attr("y", 9)</p><p>                                               .attr("dy", ".35em")</p><p>                                               .style("text-anchor", "end")</p><p>                                               .text(function(d) { return d.priority; });</p><p>                                         </p><p>                                               var priorityLabel = d3.select("#chart-container")</p><p>                                               .append("g")</p><p>                                               .attr("transform", "translate(1130,55)")</p><p>                                               .append("text")</p><p>                                               .attr("transform", "rotate(-90)")</p><p>                                               .attr("y", 6)</p><p>                                               .attr("dy", ".71em")</p><p>                                               .style("text-anchor", "end")</p><p>                                               .text("Priority");</p><p>                       }</p><p>                 </p><p>                       // Create initial tooltip</p><p>                       function generateTooltip() {</p><p>                                               var tooltip = svg.append("g")</p><p>                                               .append("g")</p><p>                                               .attr("id", "tooltip");</p><p>                                         </p><p>                                               tooltip.append("text")</p><p>                                               .attr("id", "duration")</p><p>                                               .attr("class", "tooltip-attribute");</p><p>                                         </p><p>                                               tooltip.append("text")</p><p>                                               .attr("id", "cost")</p><p>                                               .attr("y", 15)</p><p>                                               .attr("class", "tooltip-attribute");</p><p>                                         </p><p>                                               tooltip.append("text")</p><p>                                               .attr("id", "effort")</p><p>                                               .attr("y", 30)</p><p>                                               .attr("class", "tooltip-attribute");</p><p>                       }</p><p>                 </p><p>                       // Add the x and y axes and their labels</p><p>                       function generateAxes() {</p><p>                                               svg.append("g")</p><p>                                               .attr("class", "x axis")</p><p>                                               .attr("transform", "translate(0," + height + ")")</p><p>                                               .call(xAxis);</p><p>                                         </p><p>                                               svg.append("text")</p><p>                                               .attr("x", width)</p><p>                                               .attr("y", height - 6)</p><p>                                               .style("text-anchor", "end")</p><p>                                               .text("Duration (Days)");</p><p>                                         </p><p>                                               svg.append("g")</p><p>                                               .attr("class", "y axis")</p><p>                                               .call(yAxis);</p><p>                                         </p><p>                                               svg.append("text")</p><p>                                               .attr("transform", "rotate(-90)")</p><p>                                               .attr("y", 6)</p><p>                                               .attr("dy", ".71em")</p><p>                                               .style("text-anchor", "end")</p><p>                                               .text("Cost ($)");</p><p>                       }</p><p>                 </p><p>                       // Create the line of best fit</p><p>                       function generateLine() {</p><p>                                               var linReg =     linearRegression(data);</p><p>                                         </p><p>                                               var myLine = svg.append("svg:line")</p><p>                                               .attr("x1", x(minDuration))</p><p>                                               .attr("y1", y(minDuration*linReg.slope + linReg.intercept))</p><p>                                               .attr("x2", x(maxDuration))</p><p>                                               .attr("y2", y( (maxDuration*linReg.slope) + linReg.intercept ))</p><p>                                               .style("stroke", "#A9A9A9");</p><p>                                         </p><p>                                               function linearRegression(projects){</p><p>                                                                       var lr = {};</p><p>                                                                       var n = projects.length;</p><p>                                                                       var sum_x = 0;</p><p>                                                                       var sum_y = 0;</p><p>                                                                       var sum_xy = 0;</p><p>                                                                       var sum_xx = 0;</p><p>                                                                       var sum_yy = 0;</p><p>                                                                 </p><p>                                                                       for (var i = 0; i &lt; projects.length; i++) {</p><p>                                                                                               sum_x += projects[i].duration;</p><p>                                                                                               sum_y += projects[i].cost;</p><p>                                                                                               sum_xy += (projects[i].duration*projects[i].cost);</p><p>                                                                                               sum_xx += (projects[i].duration*projects[i].duration);</p><p>                                                                                               sum_yy += (projects[i].cost*projects[i].cost);</p><p>                                                                       }</p><p>                                                                 </p><p>                                                                       lr.slope = (n * sum_xy - sum_x * sum_y) / (n*sum_xx - sum_x * sum_x);</p><p>                                                                       lr.intercept = (sum_y - lr.slope * sum_x)/n;</p><p>                                                                       lr.r2 = Math.pow((n*sum_xy - sum_x*sum_y)/</p><p>                                                                       Math.sqrt((n*sum_xx-sum_x*sum_x)*(n*sum_yy-sum_y*sum_y)),2);</p><p>                                                                 </p><p>                                                                       return lr;</p><p>                                               }</p><p>                       }</p><p>                 </p><p>                       generateCircles();</p><p>                       generatePriorityLegend();</p><p>                       generateTooltip();</p><p>                       generateAxes();</p><p>                       generateLine();</p><p>}</p><p></p><h1>Server Script</h1><p></p><p>(function() {</p><p>                       var projData = [];</p><p>                 </p><p>                       // Grab projects in the IT porfolio</p><p>                       var projGR = new GlideRecord('pm_project');</p><p>                       projGR.addQuery('primary_portfolio', '30e14b3beb131100b749215df106fe0f');</p><p>                       projGR.addEncodedQuery("resource_planned_cost&gt;javascript:getCurrencyFilter('pm_project','resource_planned_cost', 'USD;0')^effort&gt;javascript:gs.getDurationDate('0 0:0:0')");</p><p>                       projGR.orderByDesc('start_date');</p><p>                       projGR.query();</p><p>                 </p><p>                       // Push each project record into an array to pass to the client script</p><p>                       while (projGR.next()) {</p><p>                                               var dc = new DurationCalculator();</p><p>                                               var hours = dc.calcScheduleDuration('1970-01-01 00:00:00', projGR.effort)/60/60;</p><p>                                               var duration = dc.calcScheduleDuration('1970-01-01 00:00:00', projGR.duration)/60/60/24;</p><p>                                               projData.push({</p><p>                                                                       "name": projGR.short_description+'',</p><p>                                                                       "cost": +projGR.cost,</p><p>                                                                       "duration": +duration,</p><p>                                                                       "effort": +hours,</p><p>                                                                       "priority": projGR.priority+''</p><p>                                               });</p><p>                       }</p><p>                 </p><p>                       data.projects = projData;</p><p>                 </p><p>})();</p><p></p><p></p><p>Mitch Stutler</p><p>VividCharts Founder</p><p><a title="vidcharts.com/" href="http://vividcharts.com/">vividcharts.com</a></p><p><a title="nkedin.com/in/mitchellstutler/" href="http://linkedin.com/in/mitchellstutler/">linkedin.com/in/mitchellstutler</a></p><p><a title="itter.com/mitchstutler" href="http://twitter.com/mitchstutler">twitter.com/mitchstutler</a></p><p></p><h1>Sources</h1><ul><li><a title=" data-attached-link=" class="wz-link" data-attached-link="{&quot;type&quot;:&quot;Web&quot;,&quot;url&quot;:&quot;https://bl.ocks.org/mbostock/3887118&quot;,&quot;title&quot;:&quot;https://bl.ocks.org/mbostock/3887118&quot;,&quot;target&quot;:&quot;_blank&quot;}" href="https://bl.ocks.org/mbostock/3887118" style="color: #1968d3; text-decoration: underline;" target="_blank">Scatter Plot</a></li><li><a title=" data-attached-link=" class="wz-link" data-attached-link="{&quot;type&quot;:&quot;Web&quot;,&quot;url&quot;:&quot;https://d3js.org/&quot;,&quot;title&quot;:&quot;https://d3js.org/&quot;,&quot;target&quot;:&quot;_blank&quot;}" data-cke-saved-href="https://d3js.org/" href="https://d3js.org/" style="color: #1968d3; text-decoration: underline;" target="_blank">https://d3js.org/</a></li><li><a title=" data-attached-link=" class="wz-link" data-attached-link="{&quot;type&quot;:&quot;Web&quot;,&quot;url&quot;:&quot;http://trentrichardson.com/2010/04/06/compute-linear-regressions-in-javascript/&quot;,&quot;title&quot;:&quot;http://trentrichardson.com/2010/04/06/compute-linear-regressions-in-javascript/&quot;,&quot;target&quot;:&quot;_blank&quot;}" href="http://trentrichardson.com/2010/04/06/compute-linear-regressions-in-javascript/" style="color: #4393ff; text-decoration: underline; font-family: 'Open Sans';" target="_blank">Compute Linear Regressions in Javascript</a></li></ul>