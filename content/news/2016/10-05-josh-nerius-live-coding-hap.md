---
title: "Live Coding Happy Hour Recap for September    OAuth Part "
date: 2016-10-04T06:37:28.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=afada6a9dbd0dbc01dcaf3231f961932"
---
<h1><strong>YouTube video</strong>: <a title="ww.youtube.com/watch?v=NyFooBktJNE" href="https://www.youtube.com/watch?v=NyFooBktJNE">https://www.youtube.com/watch?v=NyFooBktJNE</a></h1><p></p><p><strong>The Live Coding Team</strong>: <a title="josh.nerius" __default_attr="17477" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="josh.nerius" data-renderedposition="68_163.28125_87_16" href="/community?id=community_user_profile&user=1b1e4ee1dbd41fc09c9ffb651f96195f">josh.nerius</a>, <a title="dave.slusher" __default_attr="17468" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="dave.slusher" data-renderedposition="68_257.734375_98_16" href="/community?id=community_user_profile&user=34225265dbd81fc09c9ffb651f96194b">dave.slusher</a>, <a title="ctomasi" __default_attr="2218" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="ctomasi" data-renderedposition="68_363.59375_68_16" href="/community?id=community_user_profile&user=7ae05a61db981fc09c9ffb651f9619a2">ctomasi</a></p><p></p><p><a title="ww.youtube.com/watch?v=NyFooBktJNE" href="https://www.youtube.com/watch?v=NyFooBktJNE">In last week's Live Coding Happy Hour</a>, we picked up <a title="ww.youtube.com/watch?v=6KPhLYIDchU" href="https://www.youtube.com/watch?v=6KPhLYIDchU">where we left off previous week</a> and figured out how to programmatically get an OAuth Access Token from the <span style="font-family: 'andale mono', times;"><strong>oauth_credential</strong></span> table for our Bit.ly integration.</p><p></p><h2>Video Index</h2><p></p><ul><li><a title="ww.youtube.com/watch?feature=player%5C_embedded&v=NyFooBktJNE#t=244" href="https://www.youtube.com/watch?feature=player%5C_embedded&amp;v=NyFooBktJNE#t=244">04:04 - Quick recap of what we did last week</a></li><li><a title="ww.youtube.com/watch?feature=player_embedded&v=NyFooBktJNE#t=419" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NyFooBktJNE#t=419">06:59 - We want to get the token dynamically</a></li><li><a title="ww.youtube.com/watch?feature=player_embedded&v=NyFooBktJNE#t=553" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NyFooBktJNE#t=553">09:13 - Exploring the oauth_credential table</a></li><li><a title="ww.youtube.com/watch?feature=player_embedded&v=NyFooBktJNE#t=1336" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NyFooBktJNE#t=1336">22:16 - We have a working script to retrieve the token!</a></li><li><a title="ww.youtube.com/watch?feature=player_embedded&v=NyFooBktJNE#t=1475" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NyFooBktJNE#t=1475">24:35 - Update our Bit.ly Business Rule to use the new token logic</a></li><li><a title="ww.youtube.com/watch?feature=player_embedded&v=NyFooBktJNE#t=1507" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NyFooBktJNE#t=1507">25:07 - We discuss current.update() in an async business rule</a></li><li><a title="ww.youtube.com/watch?feature=player_embedded&v=NyFooBktJNE#t=1637" href="https://www.youtube.com/watch?feature=player_embedded&amp;v=NyFooBktJNE#t=1637">27:17 - Update the REST Message to use a parameterized Access Token</a></li><li><a title="outu.be/NyFooBktJNE?t=1744" href="https://youtu.be/NyFooBktJNE?t=1744">29:04 - YouTube Analytics API and working with OAuth Scopes</a></li><li><a title="outu.be/NyFooBktJNE?t=2203" href="https://youtu.be/NyFooBktJNE?t=2203">36:43 - Configure OAuth Provider in ServiceNow including Entity Profile Scopes</a></li><li><a title="outu.be/NyFooBktJNE?t=2582" href="https://youtu.be/NyFooBktJNE?t=2582">43:02 - Asking Google for a Refresh Token</a></li><li><a title="outu.be/NyFooBktJNE?t=3178" href="https://youtu.be/NyFooBktJNE?t=3178">52:58 - Recap and beer ratings</a></li></ul><h2></h2><p></p><h2>Useful Resources</h2><p></p><ul><li><a title="ev.bitly.com/api.html" href="https://dev.bitly.com/api.html">Bit.ly API documentation</a></li><li><a title="ww.getpostman.com/" href="https://www.getpostman.com/">Postman API Testing Tool</a></li><li><a title="eveloper.servicenow.com/app.do#!/api_doc?v=helsinki&type=server&scoped=true" href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;type=server&amp;scoped=true">GlideOAuthClient Docs on Developer Portal</a></li></ul><h2></h2><p></p><h2>Corrections</h2><p></p><h3>A Better Approach for Getting Access Tokens</h3><p></p><p>In the Live Coding session, we used a manual approach to query the <span style="font-family: 'andale mono', times;"><strong>oauth_credential</strong></span> able to get an Access Token using GlideRecord, but there's actually a much better way to accomplish this using <span style="font-family: 'andale mono', times;"><strong>GlideOAuthClient</strong></span>.</p><p></p><p><strong>Before (manual GlideRecord lookup)</strong></p><pre><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14755443145795745" data-renderedposition="907.75_8_1192_240" jivemacro_uid="_14755443145795745"><code>function getToken(profile, user) {     <br/>       var gr = new GlideRecord('oauth_credential');       <br/>       gr.addQuery('oauth_requestor_profile.oauth_entity_profile', profile);       <br/>       gr.addQuery('user', user);<br/>       gr.query();             <br/><br/>       if (gr.next()) {           <br/>               gs.debug('found it');             <br/>               return gr.getValue('token');     <br/>       } else {           <br/>               gs.debug(':(');       <br/>       }<br/>}<br/><br/>var token = getToken(oauthProfileId, userId); </code></pre></pre><p></p><p><strong>After (using GlideOAuthClient API)</strong></p><pre><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14755443218804754 jive_text_macro" data-renderedposition="1217.75_8_1192_80" jivemacro_uid="_14755443218804754"><code><strong>// Initialize client and get a token object   </strong><br/>var oauthClient = new sn_auth.GlideOAuthClient();<br/>var tokenObject = oauthClient.getToken(restMessageId, oauthProfileId);   <br/>var accessToken = tokenObject.getAccessToken();   <br/>gs.debug('Access Token: ' + accessToken);</code></pre></pre><h3></h3><p></p><p></p><h3>Handling a non-expiring token</h3><p></p><p>I mentioned that I'd show you how to handle the non-expiring token sent by Bit.ly, but didn't get around to it during the broadcast.</p><p>To accomplish this, we need to add a single line to the <span style="font-family: 'andale mono', times;"><strong>postProcessAccessToken</strong></span> method in our custom <span style="font-family: 'andale mono', times;"><strong>OAuthBitlyHandler</strong></span> Script Include:</p><p></p><pre><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14755443292279430 jive_text_macro" data-renderedposition="1499.75_8_1192_32" jivemacro_uid="_14755443292279430"><code><strong>// Manually set the expire time to 1 year in seconds (60 * 60 * 24 * 365) </strong><br/>paramMap.put('expires_in', '31536000'); </code></pre></pre><p></p><p>In this example, I've set the expiration time to 1 year, but you should set this to whatever value makes sense for you and your password rotation schedule (you should go and regenerate this periodically for security reasons, even if the the API doesn't enforce token rotation).</p>