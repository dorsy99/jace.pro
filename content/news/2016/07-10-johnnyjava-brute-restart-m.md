---
title: "Brute Restart MID Server UI Action"
date: 2016-07-09T20:10:43.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=246d6a29dbd0dbc01dcaf3231f9619d8"
---
<p>Having a background in System Engineering helps when it comes to administering MID Servers. I wrote a comment the other day about how to configure the wrapper program to auto-restart the JVM based on specific error messages. <a _jive_internal="true" href="/community/operations-management/discovery/blog/2016/06/02/mid-server-crashing-due-to-socket-timeout-http-202-errors#comment-23498" title="https://community.servicenow.com/community/operations-management/discovery/blog/2016/06/02/mid-server-crashing-due-to-socket-timeout-http-202-errors#comment-23498">https://community.servicenow.com/community/operations-management/discovery/blog/2016/06/02/mid-server-crashing-due-to-so…</a></p><p></p><p>Sometimes it is necessary to start or restart the MID Server. Looking at the MID Server form, you will find the provided UI Action: "Restart MID" (green arrow below). This UI Action sends a command to the ecc_queue for that MID Server (ecc_agent) to pick up and execute just like any other probe or task.</p><p></p><p><img   alt="MID Server Form.png" class="image-1 jive-image" src="c125e146db18d7041dcaf3231f961948.iix" style="width: 620px; height: 349px;"/></p><p>But what if the MID Server isn't picking up work from the ecc_queue? If something has gone awry, networking issues, storage problems - including brief disruptions - the MID Server application can end up in a bad state where the work isn't getting picked up from the ecc_queue. Symptoms of this would be log statements in the agent\logs\agent.log.0 file saying that xml is being enqueued or even SEVERE errors contacting your SN instance. In these cases and others, there is good reason to restart the Windows Service entirely.</p><p></p><p>Remoting into the Windows host is time consuming, should require some level of access control including group memberships that must be maintained for employees and contractors and is just all around tedious in nature. You could use the sc.exe command in Windows and structure the command to remotely restart the service from your workstation. I've used that for a good while and it's not a bad workaround. Writing the wrapper script for doing it inside Cygwin was just difficult enough to make things interesting. This solution has portability problems for people not used to using Cygwin and it still requires group memberships and access controls for your employees and contractors to access the MID Server host and restart services.</p><p></p><p>Enter the "Brute Restart MID" UI Action.</p><p></p><p>Thanks to <a __default_attr="2636" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="PowerShell Probe Script Utility" data-renderedposition="779.8153076171875_73.60794830322266_211_16" href="/community?id=community_blog&sys_id=04fd622ddbd0dbc01dcaf3231f9619c2" modifiedtitle="true" title="PowerShell Probe Script Utility">PowerShell Probe Script Utility</a> and a standard Windows Service naming convention (see line 4 below), it is possible to script this as a UI Action. Be sure that you have your condition set on this to limit access to your ITOM admins.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14680754608168806 jive_text_macro" data-renderedposition="840.7244262695312_7.997159004211426_1145_216" jivemacro_uid="_14680754608168806"><p>var target_agent_name = current.name.replace(/'/g, "\\'");</p><p>var target_host = current.host_name;</p><p>var ps_script = 'restart-service -inputobject (get-service -computername '+ target_host</p><p>+' -name snc_mid.'+ target_agent_name + ')';</p><p>var orch_host = gs.getProperty('mid.server.rba_default', 'NONE');</p><p>if (orch_host == 'NONE'){</p><p>   gs.addErrorMessage('Please set mid.server.rba_default sys_property.');</p><p>} else {</p><p>   var powerShellProbe = new PowershellProbeES(orch_host);</p><p>   powerShellProbe.setScript(ps_script);</p><p>   powerShellProbe.create();</p><p>   gs.addInfoMessage('Remote Service Restart Issued.');</p><p>}</p><p>action.setRedirectURL(current);</p></pre><p></p><p>I also added a Business Rule to ecc_queue to move attachments from the "Grab MID logs" action to the MID Server record.</p><p></p><p><img   alt="MID Server Attachments.png" class="image-2 jive-image" src="73f241cadb50130468c1fb651f961984.iix" style="height: auto;"/></p><p></p><p>Together these small enhancements simplify the routine tasks associated with MID Server administration. They also allow us to keep access to the MID Server host machines more tightly controlled, which is good practise anyways. They also allow those of us with access to stay off our VPN clients which is a definite win.</p>