---
title: "Use GlideAjax to get info from call to Catalog item"
date: 2016-08-21T19:54:27.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=c90e6a2ddbd0dbc01dcaf3231f961980"
---
<p>I promised a community user that I would help her with how to get information from a call record to the catalog item that they wanted to create.</p><p></p><p>There is a couple of ways to do this and what I personally prefer and by experience worked best is to take advantage of GlideAjax.</p><p>You could just put the info in the URL or use clientData, but there are limitations and possible user mishaps with those that can lead to errors.</p><p></p><p>Now, scenario would be this. From a call, I want to create a catalog item and populate the calls description into a variable on the item.</p><p></p><p>The short version would be like this:</p><ul><li>Put the sys_id of the call in the url that opens up the catalog item</li><li>Use a GlideAjax in a catalog client script to get call description</li><li>Use the result from GlideAjax to populate whatever variable you want.</li></ul><p></p><h4>Lets fix the URL:</h4><p>Now this is all done in a OOB Business rule called "CallTypeChanged to Request". On line 8(if you haven't done any modifications earlier, you can find:</p><p><span style="font-size: 8pt;"><em>var url = 'com.glideapp.servicecatalog_cat_item_view.do?sysparm_id=' + reqItem + '&amp;sysparm_user=' + reqFor + '&amp;sysparm_location=' + location + '&amp;sysparm_comments=' + comments;</em></span></p><p></p><p>This gives you to url for the catalog item and it also puts a few sysparm for you to pick up later as well. Since all of them points at the call record and you only need the sys_id of the call, you can just have a sysparm_call_id like this:</p><p></p><p><span style="font-size: 8pt;"><em>var url = 'com.glideapp.servicecatalog_cat_item_view.do?sysparm_id=' + reqItem + '&amp;sysparm_call_sysid =' + current.sys_id;</em></span></p><p></p><p>This will send with the call id and then we can use that with a GlideAjax to get the whole call record and use what ever data we need.</p><p></p><p>Something like this:</p><p></p><p><img   class="jive-image image-4" height="299" src="7ec4c802db581304b322f4621f9619ac.iix" style="width: 626px; height: 298.865px;" width="626"/></p><p></p><p></p><p>Now we have the made so all parameters that we want comes along with the url, if you try it out. You will get a url like this when you see the item</p><p></p><p><img   class="image-5 jive-image" height="82" src="57c92331db94dfc0b322f4621f9619eb.iix" style="width: 624px; height: 81.5226px;" width="624"/></p><p></p><p>when you are at this screen you can press Shift+Ctrl+Alt+J to get the JavaScript Executor. Not sure what to press on a Mac <span __jive_emoticon_name="sad" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="1066.1875_788.21875_16_16" src="/8.0.4.21bdc7e/images/emoticons/sad.png"></span></p><p>This little popup will let you run client code, but you wont have access to the current object thou. You can also choose "browse vars" and see what variables you got available to you.</p><p></p><p><img   class="image-3 jive-image" src="6c56644adb109304b322f4621f9619e4.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p>If you like, you can test here and see if you can get the sysparm_value. Paste in the following code in the executor:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14717691434662885" data-renderedposition="1399.1875_8_1192_320" jivemacro_uid="_14717691434662885"><p>var callSysID = getParmVal('sysparm_call_sysid');</p><p></p><p></p><p>alert(callSysID);</p><p></p><p></p><p>function getParmVal(name){</p><p>   var url = document.URL.parseQuery();</p><p>   if(url[name]){</p><p>   return decodeURI(url[name]);</p><p>   }</p><p>   else{</p><p>   return;</p><p>   }</p><p>}</p><p></p><p></p><p></p><p></p><p></p></pre><p></p><p>Press "Run my code" and you should get an alert like this:</p><p></p><p><img   class="image-6 jive-image" src="711e410edb189f048c8ef4621f9619e9.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p>So now we know that we got all the info we are at the item. Lets start doing the client script:</p><p></p><h3>Making of the onLoad Catalog Client Script:</h3><p></p><p>For this example I added a variable here that i named "callDescription" and this is where I want the magic to happen.</p><p><img   class="image-7 jive-image" height="274" src="a8dde80adb549344e9737a9e0f9619a0.iix" style="width: 528px; height: 274.128px;" width="528"/></p><p></p><p>So, back to the client script. Here is the code that is going in there and remember this is a onLoad script.</p><p></p><p><img   class="jive-image image-8" height="373" src="216a008edb509704ed6af3231f96193e.iix" style="height: 373px; width: 651.437px;" width="651"/></p><p></p><p>And the code:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14717905927395035 jive_text_macro" data-renderedposition="3089.1875_8_1192_400" jivemacro_uid="_14717905927395035"><p>function onLoad() {</p><p></p><p>   var callSysID = getParmVal('sysparm_call_sysid');</p><p></p><p>   var ga = new GlideAjax('getInfoFromCall');</p><p>   ga.addParam('sysparm_name','getDescription');</p><p>   ga.addParam('sysparm_callSysID', callSysID);</p><p>   ga.getXML(handleResponse);</p><p></p><p>   function handleResponse(response){</p><p>   var answer = response.responseXML.documentElement.getAttribute("answer");</p><p>   g_form.setValue('callDescription',answer);</p><p>   }</p><p></p><p>   function getParmVal(name){</p><p>   var url = document.URL.parseQuery();</p><p>   if(url[name]){</p><p>   return decodeURI(url[name]);</p><p>   }</p><p>   else{</p><p>   return;</p><p>   }</p><p>   }</p><p>}</p><p></p></pre><p></p><p></p><h3>Lets take a look at the Script Include that is used:</h3><p></p><p><img   class="image-9 jive-image" src="e6e2f842db589344e9737a9e0f9619f3.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p>Code:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14717907426271210" data-renderedposition="4211.1875_8_1192_288" jivemacro_uid="_14717907426271210"><p>var getInfoFromCall = Class.create();</p><p>getInfoFromCall.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p></p><p>   getDescription: function() {</p><p>//Get the sys_ID for the call</p><p>   var callSysID = this.getParameter('sysparm_callSysID');</p><p></p><p>   var gr = new GlideRecord('new_call');</p><p>   gr.get(callSysID);</p><p></p><p>   var description = gr.getDisplayValue('description');</p><p>   return description;</p><p>   },</p><p></p><p>   type: 'getInfoFromCall'</p><p>});</p><p></p><p></p></pre><p></p><p>That's it, not need to do more than this to have a functional GlideAjax working. In other cases a display Business rule might save the day, but sadly they don't work in the catalog. Then I would use the display rule to put stuff in the scratchpad and then fetch them with the client script. Then we don't need to do call the server with the GlideAjax to get the info.</p><p></p><p>This is a very simple way, but good enough if you just want a single field on the call record.</p><p></p><p>If you want more fields from the call, I would recommend reading this post I wrote earlier: <a __default_attr="5660" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Lets make GlideAjax a little more dynamic&lt;br&gt;" data-renderedposition="4627.1875_574_284_16" href="/community?id=community_blog&sys_id=884d6ee5dbd0dbc01dcaf3231f9619c0" modifiedtitle="true" title="Lets make GlideAjax a little more dynamic&lt;br/&gt;">Lets make GlideAjax a little more dynamic<br></a></p>