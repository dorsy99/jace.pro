---
title: "A Better Best Practice Client Script"
date: 2013-06-26T10:10:19.000Z
authors: ["Jim Coyne"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=3aedeee9dbd0dbc01dcaf3231f96193a"
---
<p>Out of the cloud, there are 2 "onChange" Client Scripts that fire when the Caller field is changed, "(BP) Set Location to User" and "Highlight VIP Caller". That's really not a good idea if you want to maximize performance. Now, I'll admit both are individually optimized in that they are using "g_form.getReference" with a callback function, but the problem is 2 individual calls are being made back to the server for a change to the same field. We also need to think of the form as a whole and optimize its performance as well.<br /><!--break--><br />What we should do instead is consolidate both scripts into just one so we can do things more efficiently. We will also add a Display Business Rule to tell us if the Caller on an existing record is a VIP or not - no point going back to the server to find out if the Caller is a VIP or not, lets just send the info along with the record in the first place.<br /><br />Business Rule:<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />Name: Custom - Is Caller a VIP<br />Table: Incident<br />When: display<br />Script:<br />(function(){<br />   g_scratchpad.u_vip = current.caller_id.vip;<br />})();</pre><br /><br />The Business Rule simply creates a new Scratchpad variable with "true" or "false" based on the user record.<br /><br />Client Script:<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />Name: Custom - Set Caller Info<br />Type: onChange<br />Table: Incident<br />Field: Caller<br />Script:<br />function onChange(control, oldValue, newValue, isLoading) {<br />   if (isLoading) {<br />      if (!g_form.isNewRecord()) {<br />         u_highlightVipCaller(g_scratchpad.u_vip);<br />      }<br />      return;<br />   }<br />   if (!newValue) {<br />      u_highlightVipCaller(false);<br />      g_form.setValue("location", "");<br />      return;<br />   }<br />   //get a reference to the new caller<br />   g_form.getReference("caller_id", u_setCallerInfo);<br /><br />   function u_setCallerInfo(newCaller) {<br />      //check for VIP status<br />      u_highlightVipCaller(newCaller.vip);<br />      //set Location info<br />      g_form.setValue("location", newCaller.location);<br />   }<br /><br />   function u_highlightVipCaller(vipCaller) {<br />      try {<br />         var callerLabel = $("label.incident.caller_id");<br />         var callerField = $("sys_display.incident.caller_id");<br />         if (vipCaller == "true") {<br />            callerLabel.setStyle({backgroundImage: "url(images/icons/vip.gif)", backgroundRepeat: "no-repeat", backgroundPosition: "95% 55%"});<br />            callerField.setStyle({color: "red"});<br />         } else {<br />            callerLabel.setStyle({backgroundImage: ""});<br />            callerField.setStyle({color: ""});<br />         }<br />      } catch(err){}<br />   }<br />}</pre><br /><br />The Client Script will:<br />- drop out for new records<br />- use the Scratchpad if loading an existing record<br />- clear the VIP highlighting and Location field if the Caller field is cleared<br />- go back to the server if the Caller field is populated with a valid entry<br /><br />And that's it - we now have 1 optimized Client Script for when the Caller field is changed. You can use the same principle for multiple Client Scripts that you may have that fire when the same field is changed on any form.<br /><br />You can see them running in <a title="emo019.service-now.com" href="https://demo019.service-now.com">demo019</a> at the moment and I've attached the XML files for both the Busines Rule and Client Script so you can import into your instances (just remove the txt extension).</p>