---
title: "Single Page CMS AppsUI pages with Backbonejs in Service Now"
date: 2013-04-22T11:24:18.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=a33e62addbd0dbc01dcaf3231f96199f"
---
<p>This will be the first post of the series on getting <a title="ckbonejs.org/" href="http://backbonejs.org/">Backbone.js</a> for designing better Single page apps and UI Pages in Service Now.</p><p></p><p>Back in 2010-2011, When I started working on Service Now,We were struggling to learn Jelly to code UI pages in Service Now.Now in 2013, most of us already know the best practices in Jelly, and there are lots and lots of material/blogs/support/videos available on Jelly. So in a way, we're lot better that what we were(at least I) back on 2011.What Jelly doesn't do is, it doesn't separate your DOM from the Data.And this series of posts on Backbone.js will concentrate on separating your DOM from your data, and easily attach events/modify DOM and touch base on some good features of Backbone worth mentioning.</p><p></p><p></p><p><br/><strong><br/>Why Backbone?<br/></strong></p><ul><li><br/>To store the data you are working with in to objects, so you can modify them, move them, store them into tables, without muddling with jQuery/Prototype DOM Selectors.</li><li><br/>We will introduce something called MVC Javascript framework, for managing your apps/UI pages better.</li></ul><p></p><p></p><p></p><p></p><p></p><p><br/><strong><br/>What's effect on the page load as we are loading many Custom libraries:<br/></strong><br/>There definitely will be an increase in Page load time,because you will be loading jQuery.min,,underscore.js and backbone.js. Users will see a very tiny lag of about 1000 ms.But believe me, If you are okay with this lag, your huge UI Page will become 10x manageable and extensible.</p><p></p><p>So the rule is, If you are writing a small UI page, better not to use MVC, but you are writing something huge in your CMS, or a UI Page, using backbone.js might help.</p><p></p><p></p><p>Today, we will see a very simple UI Page written using Backbone.js MVC. I'll in this post discuss:</p><p></p><p></p><div style="margin-left: 2em;"><br/> [*] How to get Backbone.js,Underscore.js and Handlebars.js to Service Now, and how to make them point to jQuery on the page.<br/>[*] A comparison between initializing your models and rendering the data against rendering the data using<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14036343754119787" jivemacro_uid="_14036343754119787"><br/>&lt;g:evaluate&gt;</pre>.</div><p></p><p></p><p>I won't however discuss on What a model is, what a collection is and how they are related. There are excellent tutorials all over the internet.</p><p></p><p>Getting <strong>Backbone.js</strong> into Service Now:</p><div style="margin-left: 2em;"><br/><span>[*] Download backbone.min.js from here : </span><a title="k-external-small" class="jive-link-external-small" href="http://backbonejs.org/backbone-min.js" rel="nofollow" target="_blank">http://backbonejs.org/backbone-min.js</a><br/>[*] Copy it to a UI Script.<br/>[*] Modify the<pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14036343754074596" jivemacro_uid="_14036343754074596"><br/>$</pre>to point to jQuery like this :<pre __default_attr="plain" __jive_macro_name="code" class="_jivemacro_uid_14036343754042978 jive_text_macro jive_macro_code" jivemacro_uid="_14036343754042978"><br/>a.$=t.jQuery||t.$j||t.Zepto||t.ender||t.$</pre></div><p><br/>Getting <strong>Underscore.js</strong> into Service Now:</p><div style="margin-left: 2em;"><br/><span>[*] Download Underscore.min.js from here : </span><a title="k-external-small" class="jive-link-external-small" href="http://underscorejs.org/underscore-min.js" rel="nofollow" target="_blank">http://underscorejs.org/underscore-min.js</a><br/>[*] Copy it to a UI Script.<br/>Underscore.js doesn't have any dependency on jQuery.So you need not do any change to UI Script.</div><p><br/>Getting <strong>HandleBars.js</strong> into Service Now:</p><p></p><p>Those who already worked with Underscore.js might ask me why I'm going with Handlebars, when Underscore has a templating function too. The reason is ServiceNow's HTML field doesn't allow</p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14036343754003472" jivemacro_uid="_14036343754003472"><br/> &lt;% %&gt;</pre><p>. I know what you are thinking:"We can escape it right?" Yes, we can, and the HTML field will allow this, but templating won't work.Hence I had to fall back to Handlebars, which is excellent btw, and uses</p><pre __default_attr="plain" __jive_macro_name="code" class="_jivemacro_uid_14036343753967845 jive_text_macro jive_macro_code" jivemacro_uid="_14036343753967845"><br/> {{ }}</pre><p>, that doesn't create any issues.</p><div style="margin-left: 2em;"><br/><span>[*] Download Handlebars.js from here : </span><a title="k-external-small" class="jive-link-external-small" href="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0-rc.3/handlebars.min.js" rel="nofollow" target="_blank">http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0-rc.3/handlebars.min.js</a><br/>[*] Copy it to a UI Script.</div><p></p><p></p><p>Once you have set everything up, Let's get our UI Page running.</p><p></p><p></p><pre __default_attr="plain" __jive_macro_name="code" class="_jivemacro_uid_1403634375378464 jive_text_macro jive_macro_code" jivemacro_uid="_1403634375378464"><br/><br/>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br/>&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;<br/><br/>&lt;!-- Import all our UI Scripts --&gt;<br/>&lt;script&gt;&lt;/script&gt;<br/>&lt;script&gt;&lt;/script&gt;<br/>&lt;script&gt;&lt;/script&gt;<br/>&lt;script&gt;&lt;/script&gt;<br/><br/>&lt;head&gt;<br/>&lt;style&gt;<br/><br/>             .done{<br/>               border:0;<br/>               readonly : true;<br/>               }<br/>           <br/><br/>&lt;/style&gt;<br/>&lt;/head&gt;<br/><br/><br/>&lt;body&gt;<br/><br/><br/><br/>&lt;table width="772" style="margin-left:100px" id="ghours"&gt;<br/>   &lt;tr style="background-color:#64AFEB; border :1px solid white; height:30px"&gt;<br/>       &lt;th width="195" scope="col"&gt;Group Name&lt;/th&gt;<br/>       &lt;th width="195" scope="col"&gt;Number of Hours&lt;/th&gt;<br/>       &lt;th width="194" scope="col"&gt;Month&lt;/th&gt;<br/>       &lt;th width="82" scope="col"&gt;$[sp]&lt;/th&gt;<br/>       &lt;th width="82" scope="col"&gt;$[sp]&lt;/th&gt;<br/>   &lt;/tr&gt;<br/> &lt;g:evaluate&gt;<br/>gr = new GlideRecord("u_estimate_table");<br/>gr.query();<br/>&lt;/g:evaluate&gt;<br/><br/>&lt;input type="hidden" value="${gr.getTableName()}" id="tableName"/&gt;<br/><br/><br/>&lt;script&gt;<br/>&lt;th   width="195" &gt;&lt;input type="text"   value ="{{ Group }}" class="done" &gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;th width="195" &gt;&lt;input type="text" value = "{{ Hours }}" class="done" &gt;&lt;/input&gt;&lt;/th&gt;<br/>               &lt;th   width="194" &gt;&lt;input type = "text" value = "{{ Month }}" class="done" &gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;th width="82" &gt;&lt;input type = "button" class="editT" value="Edit"&gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;th   width="82" &gt;&lt;input type = "button"   class="removeT" value ="Remove" &gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;/script&gt;<br/><br/><br/> &lt;&lt;j:while test="${gr.next()}"&gt;<br/>&lt;tr class="old" id="${gr.sys_id}"&gt;<br/><br/>&lt;th   width="195" &gt;&lt;input class="done" type="text"   value ="${gr.u_group.name}" &gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;th width="195" &gt;&lt;input type="text" value = "${gr.u_hours}" class="done"&gt;&lt;/input&gt;&lt;/th&gt;<br/>               &lt;th   width="194" &gt;&lt;input class="done" type = "text" value = "${gr.u_month}"&gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;th width="82" &gt;&lt;input   type = "button" class="editT" value="Edit" &gt;&lt;/input&gt;&lt;/th&gt;<br/>&lt;th   width="82" &gt;&lt;input   type = "button"   class="removeT" value ="Remove"&gt;&lt;/input&gt;&lt;/th&gt;<br/><br/>&lt;/tr&gt;<br/>&lt;/j:while&gt;<br/><br/><br/><br/><br/>&lt;/table &gt;</pre><p></p><p></p><p><br/>I'm not very good at CSS, so bear with me and my tables. The above HTML doesn't nothing but to set up 3 columns, By the names Group, Hours and Months.We are retrieving these values from a table called u_estimate_table, which has a Group reference, the number of Hours the Group worked and the month.</p><p></p><p>As I mentioned earlier, our focus today will be on retrieving the data from table u_estimate_table and display it using Jelly and Backbone.js.</p><p></p><p><strong>Let's first do it using Jelly</strong> -</p><p></p><p>In Jelly, you write a Glide Evaluate tag, and Iterate using a   loop, which is exactly what I'm doing in the UI Page.</p><p></p><p>Two, We need to register all the rows created because of Jelly as Models, and fill our Collections from the models. This is done in the Client Script of UI page like this :</p><p></p><p></p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14036343753515736" jivemacro_uid="_14036343753515736"><br/><br/>(function($){<br/>   <br/>     window.App = {<br/>         <br/>           Models : {},<br/>           Collections : {},<br/>           Views : {}<br/>     };<br/>   <br/>   <br/>   <br/>     //A single estimate<br/>     App.Models.Estimate = Backbone.Model.extend({<br/>         <br/>         <br/>         <br/>         <br/>         <br/>         <br/>         <br/>     });<br/>   <br/>     //A collection of estimates which takes a model "estimate"<br/>     App.Collections.Estimates   = Backbone.Collection.extend({<br/>         <br/>         <br/>           model : App.Models.Estimate,<br/>         <br/>         <br/>           initialize: function() {<br/>                 console.clear();<br/>                 _.each(<br/>               <br/>                 $('#ghours .old'),<br/>                 function(a){<br/>                     <br/>                     <br/>                     <br/>                       // Create the model<br/>                       var est = new App.Models.Estimate();<br/>                     <br/>                       var gname = $(a).find('input')[0];<br/>                       $(gname).attr('readonly', true);<br/>                       var hours = $(a).find('input')[1];<br/>                       $(hours).attr('readonly', true);<br/>                       var month = $(a).find('input')[2];<br/>                       $(hours).attr('readonly', true);<br/>                       var sys_id = $(a).children()[0];<br/><br/>                     <br/>                       // set the model correctly<br/>                       est.set({<br/>                             Group: $(gname).val(),<br/>                             Hours: $(hours).val(),<br/>                             Month:$(month).val(),<br/>                             table: $('#tableName').val(),<br/>                             sys_id:$(a).attr('id'),<br/>                           <br/>                           <br/>                       });<br/>                     <br/>                       var estView     = new App.Views.Estimate({<br/>                             model: est,<br/>                             el: a<br/>                       });<br/>                       // Add this new model to the collection<br/>                       this.add(estView);<br/>                     <br/>                 },<br/>                 this<br/>                 );<br/>           }<br/>         <br/>         <br/>     });<br/>   <br/>   <br/>     //The collection view.To paint the big picture.<br/>     App.Views.Estimates = Backbone.View.extend({<br/>         <br/>           render : function(){<br/>               <br/>                 this.collection.each(this.addTo,this);<br/>               <br/>                 return this;<br/>               <br/>           },<br/>           addTo:function(estimate){<br/>               <br/>               <br/> var dir = new App.Views.Estimate({model:estimate});<br/><br/>               <br/>               <br/>               <br/>                 $('#ghours &gt; tbody:last').append(dir.render().el);<br/>               <br/>           }<br/>         <br/>         <br/>         <br/>         <br/>         <br/>     });<br/>   <br/>   <br/>     //An individual model view.<br/>     App.Views.Estimate   = Backbone.View.extend({<br/>           tagName: 'TR',<br/>   defaults: {<br/> sys_id : '-1'<br/>   },<br/>         <br/>           initialize:function(){<br/>                 this.model.on('change',this.render,this);<br/>                 this.model.on('destroy',this.destroy,this);<br/>               <br/>           },<br/>         <br/>           destroy:function(){<br/>               <br/>               <br/>                 this.$el.remove();<br/>           },<br/>         <br/>           events: {<br/>               <br/>                 'click .editT':'editAll',<br/>                 'dblclick .done' : 'edit',<br/>               <br/>                 'blur .editTab': 'doneOne',<br/>                 'click .removeT':'removeRow'<br/>               <br/>               <br/>               <br/>           },<br/>         <br/>       <br/>         <br/>         <br/>           render :function(){<br/>               <br/>           <br/>                 var   source     = $("#taskTemplate").html();<br/>                 var template = Handlebars.compile(source);<br/>               <br/>                 var src =   template(this.model.toJSON());<br/>                 var a = this.$el.html(src);<br/>               <br/>               <br/>               <br/>               <br/>               <br/>               <br/>                 this.$el.attr('id', this.model.get('sysId'));<br/>               <br/>                 return this;<br/>           }<br/>         <br/>         <br/>     });<br/>   <br/>   <br/>   <br/><br/>         <br/>         <br/>           var estimates = new App.Collections.Estimates();<br/>           console.log(estimates.toJSON());<br/>     } <br/>         <br/> })($j);<br/>   </pre><p></p><p></p><p><br/>Notice the last line where we write</p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14036343753487937" jivemacro_uid="_14036343753487937"><br/>     var estimates = new App.Collections.Estimates();</pre><p>which will initialize the collection, called estimate. Scroll up to the initialize method, in which I'm reading all the rows, on the page and then converting them to Models and adding them to collection. Now all the rows rendered using</p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14036343753449760" jivemacro_uid="_14036343753449760"><br/>&lt;g:evaluate&gt; </pre><p>are converted into a collection.</p><p></p><p><strong>Handle everything using Backbone:</strong></p><p></p><p>Now,Let's comment the Jelly g:evaluate and j:while , and handle it using Backbone.js Collection initialization by passing a JSON Object.</p><p></p><p></p><pre __default_attr="plain" __jive_macro_name="code" class="_jivemacro_uid_14036343753337894 jive_text_macro jive_macro_code" jivemacro_uid="_14036343753337894" modifiedtitle="true">
<p><br/><br/>   <br/>//Call a script Include, as we are on Client Side, for an Asyc call -<br/>   var ga = new GlideAjax('HelloWorld');<br/>//Call my super super Script Include which returns the table data in JSON format -<br/><br/><br/>   ga.addParam('sysparm_name','sendToClient');<br/>   ga.addParam('sysparm_tbl','u_estimate_table');<br/>   ga.addParam('sysparm_opt','u_group,u_hours,u_month');<br/>   <br/>   ga.addParam('sysparm_bool','true');<br/>   <br/>   ga.getXML(HelloWorldParse);<br/>   <br/>   function HelloWorldParse(response) {<br/>       <br/>           var answer = response.responseXML.documentElement.getAttribute("answer");<br/>       <br/>           //Getting a JSON Object, as answer will be a JSON String<br/>           var jsonArray = $.parseJSON(answer);<br/>       <br/>           <br/> <br/>//Notice the difference here, In the earlier method, we just initialize the new App.Collections.Estimates(jsonArray);</p>
<p>//Object, But here we pass a JSON object. When you pass a JSON object to a collection, it will automatically convert them into Models..</p>
<p>// and render it. In the render will be using HandleBars.js to template it. I'll expand on this templating more   in   my next post.</p>
<p></p>
<p class="p1">var estimates = new App.Collections.Estimates(jsonArray);</p>
<p class="p1">       var tasksView = new App.Views.Estimates({collection:estimates}).render();</p>
<p class="p1">     </p>
<p class="p1">   }</p>

</pre><p><span style="font-size: 10pt; line-height: 1.5em;"><br/></span></p><p><span style="font-size: 10pt; line-height: 1.5em;"><span class="s1">More on my Script Include : <a title="tp//servicenowdiary.com/2013/04/sendjson-a-script-include-to-change-your-data-to-json/" href="http://http//servicenowdiary.com/2013/04/sendjson-a-script-include-to-change-your-data-to-json/">SendJSON2</a></span></span></p><p><span style="font-size: 10pt; line-height: 1.5em;"><br/></span></p><p class="p1">Comparison :</p><p class="p2"></p><p class="p1">Let's compare both the methods and see which one is better. For comparison, I used a simple Chrome extension called test benchmark-</p><p class="p3"><img alt="speedtest.png" class="image-0 jive-image" src="http://servicenowdiary.com/wp-content/uploads/2013/04/speedtest.png" style="max-width: 620px; height: auto;"/></p><p class="p2"><span style="font-size: 10pt; line-height: 1.5em;">In the graph above, </span></p><p class="p1"></p><p class="p1">[list]</p><p class="p2"></p><p class="p1">[*]A - represents the Page Load time when I ran the UI page with Method 1, using Jelly and registering Models.</p><p class="p1">[*]B - represents the Page Load time when I ran the UI page with Method 2,completely using Backbone.</p><p class="p2"></p><p class="p1">Notice that, The Method 1   loads 2000 ms faster than Method 2. Hence I would go by using Method1.</p><p><span style="font-size: 10pt; line-height: 1.5em;"><br/></span></p><p><span style="font-size: 10pt; line-height: 1.5em;"><strong>Take Away:</strong></span></p><p><span style="font-size: 10pt; line-height: 1.5em;"><br/></span></p><p><span style="font-size: 10pt; line-height: 1.5em;">When you are working with Backbone.js, always use the super &lt;g:evaluate&gt;, </span><span style="font-size: 10pt; line-height: 1.5em;">Don't use the native Backbone.js JSON initialization.</span></p><p></p><p><span style="font-size: 10pt; line-height: 1.5em;">The above are the two ways to initialize a Model and a collection and bring Backbone.js to Service Now. We've barely scratched the surface.There is lots to come on events, and views which I'll slowly introduce in my next posts, along with the best ways you can define your Attributes of a model so that they integrate seamlessly with Service Now!</span></p><p></p><p>Note: You can also get the JSON array using an AJAX call. But I don't want to involve another processor in the middle. So the Script Include.</p>