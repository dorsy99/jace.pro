---
title: "Data driven workflowless workflow field"
date: 2013-01-13T11:47:38.000Z
authors: ["john.roberts"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=791d22e5dbd0dbc01dcaf3231f961924"
---
<p>I haven't had my hands in code for a while so I was looking for a reason to have a good ol' fashion geeky relapse. This past week one of my favorite customers (ok, so they're all my favorite) gave me that opportunity. They asked about using the workflow field for a use that didn't have anything to do with an automated workflow, a custom data driven workflow field.<br />They wanted to display the standard workflow stage widget but have the stages custom built from data related to each record. I didn't know off the top of my head so I did a little digging and came up with the following. <br /><img  alt="" class="jive-image" src="57ab708adb5497041dcaf3231f96191f.iix" style="width: 281px; height: auto;" /><br /><!--break--><br /><br />Here's my sample use case.<br />As a project manager…. (yeah, I've been a PO for almost a year now so I actually start all my sentences in this form)<br />I would like to display a summary of who the project reviewers are for a given project and what the state of their review is (requested, completed, not needed). Each project could have unique reviewers and reviewer states. This information should be visible in the project list view.<br /><br /><b>Solution:</b><br />We could solve this a number of ways including possibly using a real workflow and approvals, but in order to show you how generic this could be I avoided both of those. Plus, the customer already has the related data populated so they'd be able to just start displaying it instead of having to migrate data to a new structure.<br /><br /><b>What's needed:</b><br /><u>Data</u> - let's start by creating the table that will be used to drive the workflow widget values<br />* Table name: u_project_review<br />* Field: u_project, reference to pm_project<br />* Field: u_reviewer, reference to sys_user<br />* Field: u_state, choice (drop down w/none)<br />* Add choices to u_state (Requested, Completed, Not Needed)<br /><br /><u>New workflow field on Project (pm_project) table</u><br />* Field: u_review_status, type=workflow, choice=drop down w/none, set to read only since it's managed dynamically<br />* Add this field to the project list view <br /><br /><u>Logic</u><br />Now we need a way to drive the workflow field list widget from the related project reviewer data.<br />* Create New Business Rule<br />* Name (must be precise based on table and field names) = pm_project_u_review_statusGetChoices<br />* Table: global<br />* Active: true<br />* Script:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />//build a dynamic workflow field choice list based on related data<br /><br />//this function will be called by the workflow field during rendering<br />function pm_project_u_review_statusGetChoices() {<br />    //get related project review records for this project (current)<br />    var gr = new GlideRecord("u_project_review");<br />    gr.addQuery("u_project", current.getUniqueValue());<br />    //probably want to set an order that makes sense to you, we'll use reviewer<br />    gr.orderBy("u_reviewer");<br />    gr.query();<br /><br />    if (!gr.hasNext()) {<br />       //no reviewers show let it be known<br />       answer.add("not_needed", gs.getMessage("No reviewers needed")).image = "images/workflow_complete.gifx";<br />    }<br />    while (gr.next()) {<br />       //set default icon to pending<br />       var icon = "images/workflow_pending.gifx";<br />       var text = "Requested";<br />       //set other image based on state value<br />       var stateValue = gr.getValue("u_state");<br />       if (stateValue == "Completed") {<br />          icon = "images/workflow_complete.gifx";<br />          text = "Complete";<br />       }<br />       else if (stateValue == "Not Needed") {<br />          icon = "images/workflow_skipped.gifx";<br />          text = "Not Needed";<br />       }<br />       //build text for choice label <br />       var display = gr.getDisplayValue("u_reviewer") + " (" + text + ")";<br />       //add the choice to the list, and set the icon<br />       answer.add(gr.getUniqueValue(), display).image = icon;<br />    }<br />}</pre><br /><br /><b>Reviewer Data</b><br />* Add the project review related list to the project form<br />* Go ahead and create some project reviewer records with valid project, reviewer, and state values.<br /><img __jive_id="5679" alt="" class="jive-image" src="ManagerApproval04.jpg" style="width: 800px; height: auto;" /><br /><br /><b>And we're done</b><br />Checkout the project list now that we have values<br /><img  alt="" class="jive-image" src="5fcb1986db58d304b322f4621f961900.iix" style="width: 800px; height: auto;" /><br /><b>Other thoughts….</b><br />The field value of u_review_status doesn't really make sense at all since it's a collection of data, for that reason I would leave the field off the form and not use it for reporting (it doesn't really have a value stored in the record at this point). I'm sure there's plenty of clever folks out there that could take this to the next level. <i>My $0.02, I'd have the updating of project review records set the actual value of the review status field on project, this would be a summary of all reviewer states. This value would be completely independent from the rendering of the workflow widget.</i></p>