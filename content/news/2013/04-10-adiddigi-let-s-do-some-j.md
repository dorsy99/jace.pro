---
title: "Lets do some JSON today"
date: 2013-04-09T20:15:04.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=64fc62a5dbd0dbc01dcaf3231f9619b0"
---
<p>I won't lie, I'm obsessed with JSON. I've been working with it and MongoDB for a couple of weeks now.JSON is Simple, portable and with REST protocol it is very easy to use.<br /><br />The entire post is written thinking we can't pass an Object from a Script Include to a Client side, If you know any ways to pass an entire Glide Object, do let me know. But because of Mozilla Rhino sitting in the middle, I am positive we cannot pass an Object/Array as Arrays will be converted into Native array. Nevertheless, I think sending the data in a JSON is a nice way of exchanging data.<br /><br />Two reasons to write this post:<br /><ul><li><br />I wanted to retrieve more than one value from a table using GlideAjax. You would probably direct me to <a title="mmunity.servicenow.com/blog/johnroberts/returning-multiple-values-glideajax" href="http://community.servicenow.com/blog/johnroberts/returning-multiple-values-glideajax">this</a> post here by John Roberts,where he explains how to pass more than one variables from Server side, encoding it as an XML.<br />Now, what if I want to access the entire Glide Record as-is. That would require you to encode all the columns, data into an XML and pass it, then on the Client side you will have to probably use XMLDocument or any XML parser to get the data.<br />We will be doing the same using JSON, and you will see how easy it is.I'll start with encoding your GlideRecord in JSON on server side, and retrieve it in a Business Rule / another script include.<br /></li><li><br />I'm also working on getting structure and MVC to UI Pages/Macros in Service Now,as I don't want to completely attach my data to DOM. So I'm using handlebars.js template engine(don't get me wrong here - Jelly is a powerful template engine in itself, but to use backbone.js to its full potential, you might want to use a client side template engine like handlebars) which is compatible with Backbone.js and underscore.js, as we cannot use the templating function of underscore.js, because of XML restrictions. If you retrieve your data in JSON format, it will be very easy to template it and fill in the DOM easily.I'm going to post that too.<br /></li><li style="list-style: none"><br /><br />Okay, without delay lets get started:<br /><br /><b><em>Let's first encode the JSON data on Server Side, and retrieve it-</em></b><br />(but that you won't be using much - as GlideRecord object will probably give you everything you need. You might ask me, that you can still use the entire GlideRecord in the client script too.Yes! but that is a sync call which will freeze your page)<br /><br />We'll retrieve a Glide Record object in two formats : As a JSON Object, and as a JSON String.<br />Name : SendJSON<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />/* We will have two functions - sendJSON which will encode your table data into a JSON object, and sendJSONAsString which will encode your object into a string */<br /><br />/* We will have two functions - sendJSON which will encode your table data into a JSON object, and sendJSONAsString which will encode your object into a string */<br /><br />var SendJSON_temp = Class.create();<br />SendJSON_temp.prototype = {<br />   sendJSON: function(base_table,enc){<br />     <br />      var finalEncoding = {};<br />      var retArr = [];<br />     <br />      var gr = new GlideRecord(base_table);<br />      gr.addEncodedQuery(enc);<br />      gr.query();<br />      var grA = new GlideRecord(base_table);<br />      grA.newRecord();<br />      var fields = new  GlideRecordUtil().getFields(grA);<br />     <br />      var i=0;<br />      while(gr.next()){<br />         var o = {};<br />        <br />         i=0;<br />         while(fields&lt;i&gt;){<br />           <br />           <br />            columnName = fields&lt;i&gt;;<br />           <br />            o[columnName] = gr.getValue(columnName);<br />            i++;<br />           <br />         }<br />        <br />        <br />         retArr.push(o);<br />      }<br />      finalEncoding['records'] = retArr;<br />     <br />      return finalEncoding;<br />     <br />   },<br />   sendJSONO: function(base_table,enc,opt){<br />     <br />     <br />     <br />     <br />      var optA = opt.split(',');<br />      gs.log("Array was " + opt);<br />      var finalEncoding = {};<br />      var retArr = [];<br />     <br />      var gr = new GlideRecord(base_table);<br />      gr.addEncodedQuery(enc);<br />      gr.query();<br />      var grA = new GlideRecord(base_table);<br />      grA.newRecord();<br />      var fields = new  GlideRecordUtil().getFields(grA);<br />     <br />      var i=0;<br />      while(gr.next() ){<br />         var o = {};<br />        <br />         i=0;<br />         while(optA&lt;i&gt;){<br />            columnName = optA&lt;i&gt;;<br />            if(optA&lt;i&gt;.indexOf('.') != -1){<br />               gs.log(optA&lt;i&gt;);<br />              <br />            }<br />           <br />           <br />            o[columnName] = gr.getValue(columnName);<br />            i++;<br />           <br />         }<br />        <br />        <br />         retArr.push(o);<br />      }<br />      finalEncoding['records'] = retArr;<br />     <br />      return finalEncoding;<br />     <br />   },<br />  <br />  <br />   sendJSONAsString:function(base_table,enc,opt){<br />     <br />      var encObj;<br />      if(opt == ''){<br />         encObj  = this.sendJSON(base_table,enc);<br />      }<br />      else{<br />         gs.log("IN ELSE" + base_table+enc+opt);<br />        <br />         encObj = this.sendJSONO(base_table,enc,opt);<br />         gs.log(base_table+enc+opt);<br />      }<br />     <br />      var json = new JSON();<br />      var text = json.encode(encObj);<br />      return text;<br />     <br />   }<br />};<br /><br /><br /></pre><br /><br />Usage : From any Script Include/Business rule, you can call this Script Include method by using <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /> new SendJSON().&lt;function_name&gt;</pre>.<br /><br />example:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var HelloWorld = Class.create();<br />HelloWorld.prototype = Object.extendsObject(AbstractAjaxProcessor, {<br />    sendToClient:function(){<br />     <br />      var enc = 'your encoded query';<br />      var table = 'incident';<br />     <br />        <br />     <br />         var text =new SendJSON().sendJSONAsString(table,enc);<br />     <br />         return text;<br />        <br />     <br />     <br />     <br />   }<br /><br />});<br /></pre><br /><br /><b><em>Client Side is easy:</em></b><br />(I'm using the above Script Include, passing in the values from Client side)<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var HelloWorld = Class.create();<br />HelloWorld.prototype = Object.extendsObject(AbstractAjaxProcessor, {<br />    sendToClient:function(){<br /><br />      var enc = this.getParameter('sysparm_enc');<br />      var table = this.getParameter('sysparm_tbl');<br />     <br />        <br />       <br />         var text =new SendJSON().sendJSONAsString(table,enc);<br />       <br />         return text;<br />        <br />     <br />     <br />     <br />   }<br /><br />});<br /></pre><br /><br />Now on the client side, you can call this Script Include. A sample will be something like this :<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var ga = new GlideAjax('HelloWorld');<br />   ga.addParam('sysparm_name','sendToClient');<br />   ga.addParam('sysparm_tbl','incident');<br />   ga.addParam('sysparm_enc','sys_idSTARTSWITH75c5752ac46c4500b2fbeb58d4daf38e');<br />   ga.addParam('sysparm_opt','str');<br />   ga.getXML(HelloWorldParse);<br />  <br />   function HelloWorldParse(response) {<br />   <br />  var answer = response.responseXML.documentElement.getAttribute("answer");<br />    <br />  console.log(answer);// Console log the string - using Firefox/Chrome  - For me, I use Chrome.<br /> <br /> <br />  /*Converting string into JSON Object with evalJSON(), and then each with iterate over the Array of Objects - Then you can use the columns  directly*/      <br /><br />/* Prototype.js provides this beauty, evalJSON() which converts your JSON string into an Object.<br />     Check it out here http://prototypejs.org/learn/json */<br />  answer.evalJSON().records.each(function(obj){  <br />  console.log(obj.number);<br /> <br /> <br /> <br />  });<br />   }<br />  <br />  <br />}<br /></pre><br /><br /><br />I'm encoding this in the exact same format that Service Now's JSON Processer sends the JSON format. I'll in some time post on getting MVC into Service Now.<br /><br />References : <a title="mmunity.servicenow.com/users/slightlyloony" href="http://community.servicenow.com/users/slightlyloony">Tom's</a> Utility Script Includes. Check them out, they are really well "expressed" :)<br /><br />Edit: I've improved the code a little bit, and also added a new parameter called opt, into which you can pass comma separated columns names you want to retrieve(only), and you will get only those columns encoded rather than all columns. If you leave it blank, then you will get the data of entire columns.</li></ul></p>