---
title: "Fetching Attachments Via Scripted Web Services or Processor"
date: 2013-01-12T04:41:45.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=4c7ceea1dbd0dbc01dcaf3231f96190d"
---
<p>I recently had a customer want to get the attachments from an incident but in a "pull" fashion rather than ServiceNow pushing them to the third party software we were integrating with. This presented a new challenge. Chris Maloy helped me come up with a solution in two different ways that I wanted to share. I also share this so I can look it up later since I will forget it and when I find my own blog, I will think, "I wrote this?" <br /><br /><b>Scripted Web Service</b><br /><br />The advantage of using a scripted web service is that you can use the common tools to issue your SOAP request but you can control what is returned.<br /><ol><li>Create a new Scripted Web Service</li><li style="list-style: none"><br /> <ol><li>Click on System Web Services | Scripted Web Services</li><li>Click New button</li><li>Set the Name (This will determine what the WSDL URL will be). In my example we will name it FetchAttachment.</li><li>Type in a description</li><li>You can choose to leave the one function named "execute" and leave it or name your function something you want. In my example we will leave it as "execute"</li><li>In the Script put this:</li><li style="list-style: none"><br /> <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />count = 1;<br />var StringUtil = Packages.com.glide.util.StringUtil;<br /><br />var  gr = new GlideRecord("sys_attachment");<br />gr.addQuery("table_sys_id", request.sys_id);<br />gr.query();<br /><br />//Starting to create the XML Document Response<br />var xmldoc = new XMLDocument("&lt;executeResponse&gt;&lt;/executeResponse&gt;");<br /><br />while (gr.next()){<br />   //Getting the file and encoding it with Base 64 encoding<br />   var sa = new  Packages.com.glide.ui.SysAttachment();<br />   var binData =  sa.getBytes(gr);<br />   var encData =  StringUtil.base64Encode(binData);<br />   //Creating the XML document elements for each attachcment<br />   xmldoc.createElement("file_name_" + count, gr.file_name);<br />   xmldoc.createElement("encodedAttachment_" + count, encData);<br /><br />   count += 1;<br />}<br />//Sending the XML Document as the SOAP response<br />response.soapResponseElement = xmldoc.getDocumentElement();<br /></pre><br /><img src="http://www.hobbycache.com/images/servicenow/ScriptedWebServiceAttachments.png" width="600" height="300" /><br /></li><li>As you can see, the SOAP Web Service takes a "sys_id" of the incident and will return an XML document with an entry for file_name_1, and encodedAttachment_1, then file_name_2, encodedAttachment_2 with the attachment content in an base64 encoded string.</li></ol><br /></li><li>The third party that is issuing this SOAP request can then parse this response and do what they need with it.</li></ol><br /><br /><br /><b>Processor</b><br />The advantage of using a processor is that you can just go to a URL on a browser and get returned what you want in the browser<br /><br /><ol><li>Create a new Processor</li><li style="list-style: none"><br /> <ol><li>Click on System Definition | Processors</li><li>Click on the New button</li><li>Set the Name</li><li>Set the Type to "Script"</li><li>Set the Path parameter. (This will be what your URL will be when you call it later)</li><li>In the Script put this:</li><li style="list-style: none"><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var incidentNumber = g_request.getParameter("incident");<br />var incidentInfo = new GlideRecord("incident");<br />incidentInfo.addQuery("number", "=", incidentNumber);<br />incidentInfo.query();<br />while (incidentInfo.next()){<br />   var incidentSysID = incidentInfo.sys_id;<br />}<br /><br />count = 1;<br />var StringUtil = Packages.com.glide.util.StringUtil;<br /><br />var  gr = new GlideRecord("sys_attachment");<br />gr.addQuery("table_sys_id", incidentSysID);<br />gr.query();<br /><br />//Starting to create the XML Document Response<br />var xmldoc = new XMLDocument("&lt;executeResponse&gt;&lt;/executeResponse&gt;");<br /><br />while (gr.next()){<br />   //Getting the file and encoding it with Base 64 encoding<br />   var sa = new  Packages.com.glide.ui.SysAttachment();<br />   var binData =  sa.getBytes(gr);<br />   var encData =  StringUtil.base64Encode(binData);<br />   //Creating the XML document elements for each attachcment<br />   xmldoc.createElement("file_name_" + count, gr.file_name);<br />   xmldoc.createElement("encodedAttachment_" + count, encData);<br /><br />   count += 1;<br />}<br />//Sending the XML Document as the SOAP response<br />g_processor.writeOutput(xmldoc);<br /></pre><br /><img src="http://www.hobbycache.com/images/servicenow/Processor.png" width="600" height="600" /><br /></li><li>As you can see this code takes one parameter the ?incident=incident_number. It then does a glide record lookup of that incident, gets the sys_id, then looks up the attachments for that incident in the sys_attachment table and returns them in an XML document with an entry for file_name_1, and encodedAttachment_1, then file_name_2, encodedAttachment_2 with the attachment content in an base64 encoded string.</li></ol><br /></li><li>To kick this off you type in this URL: https://<i>instanceURL</i>/incidentAttachments.do?incident=INC0019185</li></ol></p>