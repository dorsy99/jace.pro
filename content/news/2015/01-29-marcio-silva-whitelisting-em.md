---
title: "Whitelisting emails sent from the ServiceNow infrastructure"
date: 2015-01-28T22:26:45.000Z
authors: ["Marcio Silva"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=4acd62e9dbd0dbc01dcaf3231f961958"
---
<p><span style="font-size: 10pt; line-height: 1.5em;">Have you noticed that some emails sent from ServiceNow never reach their destination? There are many reasons <a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=e16dea29dbd0dbc01dcaf3231f961915">why it may seem like your emails are disappearing</a> into cyberspace but sometimes the issue and the solution are simple. </span></p><p></p><p>A reason could be as simple as the emails being sent from your instance are being blocked by the end recipient's SPAM filter solution. If this is the case, depending on the configuration of the instance, a customer can guarantee that the emails arrive at their destination by whitelisting the source destinations of the emails.</p><p></p><p>An instance can be configured to send emails in two different ways.</p><ol><li>When a customer uses ServiceNow infrastructure for their SMTP configuration. This means that all SMTP traffic will be sent from ServiceNow Relay's located in each one of our DataCenters.</li><li>When a customer uses their own SMTP server to relay emails to there instance users.</li></ol><p></p><p></p><p style="text-align: center;">I will address how to whitelist emails sent from ServiceNow's own email infrastructure.</p><p><span style="font-size: 10pt; line-height: 1.5em;"><br/></span></p><h2>Identify if an instance is configured to use the ServiceNow email infrastructure:</h2><p></p><p>If you are using email accounts plugin it will be defined on the server field on the active SMTP record as relay, it should look like this:</p><p><img   alt="service automation 1.jpg" class="image-0 jive-image" src="8429c54adb949f048c8ef4621f961970.iix" style="height: 320px; width: 620px; display: block; margin-left: auto; margin-right: auto;"/></p><p>If you are not using the email accounts plugin you can check the email property glide.email.server is set to relay. Also make sure your <a title="w.ietf.org/rfc/rfc4408.txt" href="http://www.ietf.org/rfc/rfc4408.txt">infrastructure is configured to industry standard</a>.</p><p></p><p>When we are using ServiceNow email infrastructure we need to consider the fact that the emails will be sent from the domain service-now.com even though we set the SMTP default account username to be in a different domain (glide.email.user).</p><p></p><p><strong>For example:</strong></p><p><a title="k-email-small" class="jive-link-email-small" href="mailto:servicedesk@mycompanydomain.com">servicedesk@mycompanydomain.com</a><span>.</span></p><p></p><p>The issue here is that most email servers will consider this as <a title=".wikipedia.org/wiki/Email_spoofing" href="http://en.wikipedia.org/wiki/Email_spoofing">Spoofing</a>. The emails are coming from a different domain than the one we set the client to send from (@mycompanydomain.com), and will result in blocked emails. To make sure this email reaches its destination we need to whitelist the source of this emails to allow delivery to its recipients.</p><p></p><p>Whitelisting the IP's from ServiceNow's relay servers would not be effective. It would result in a redundant email infrastructure that is constantly changing. Meaning that the IP addresses would be changing on a regular basis, without any pre warning from ServiceNow team.</p><p></p><p>To ensure emails from ServiceNow to be delivered at all times even when the infrastructure changes, we should be whitelisting based on the <a title=".wikipedia.org/wiki/Sender_Policy_Framework" href="http://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF records</a> for service-now.com. If you speak with your email admin they can whitelist based on SPF records. <span style="font-size: 10pt; line-height: 1.5em;">If your admin is not able to do so, your only alternative would be to whitelist based on the SPF records the service-now.com resolves to; however, this is a bad practice, and it is strongly not advisable, and should only be used as a last resort.</span></p><p></p><p>In case you are not able to whitelist based on SPF you can get the IP's addresses from resolving the SPF record service-now.com and all sub SPF records, you can get this information from any web resource that resolves SPF records available on the Internet. I would suggest <a title="toolbox.com/spf.aspx" href="http://mxtoolbox.com/spf.aspx">Sender Policy Framework (SPF) Record Lookup - SPF Check - MxToolBox.</a></p><p><span style="font-size: 10pt;"><br/></span></p><h3><span style="font-size: 10pt;">To get your SPF records from MxToolBox:</span></h3><ol><li>Go to <a title="toolbox.com/spf.aspx" href="http://mxtoolbox.com/spf.aspx">Sender Policy Framework (SPF) Record Lookup - SPF Check - MxToolBox</a></li><li>Type service-now.com in the Domain name box and click SPF record lookup.</li><li>Once you click the button, you will need make sure you note down all the IP addresses</li><li>Repeat steps from 1 through 3 for all entries that have type include _spfinc1.service-now.com, _spfinc2.service-now.com</li><li>Write down the IP's for all of the sub SPF records that are not already recorded on step 3.</li></ol><p><img   alt="spf records ip.jpg" class="image-1 jive-image" src="fd81a08edbd057041dcaf3231f961972.iix" style="height: 310px; width: 620px; display: block; margin-left: auto; margin-right: auto;"/></p><p>For more information on this workaround can be found in <a title="k-external-small" class="jive-link-external-small" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0535456&amp;ni.dependent.topic=kb_knowledge.category&amp;prd_chk=64d4111a85ef0500f6596ad46389742a&amp;sysparm_category=&amp;sysparm_ck=d53d74b66fdde50056fbbe4c2c3ee4cdb28de9db7585178238094085d0a530ea18d64183&amp;sysparm_nameofstack=&amp;sysparm_product=b7b4111a85ef0500f6596ad463897423%2C64d4111a85ef0500f6596ad46389742a&amp;sysparm_search=Using+SPF+Records+to+Whitelist+ServiceNow+Email+Servers.&amp;sysparm_topic=" rel="nofollow" style="font-size: 12.7272720336914px; font-family: arial, sans-serif; color: #000000;" target="_blank">Enabling Email Delivery Using SPF Records to Whitelist ServiceNow Email Servers (KB0535456)</a><span style="color: #666666; font-family: arial, sans-serif; font-size: 12.7272720336914px;">.</span></p><p></p><p>Once you gather all the IP's this will be the IP's you would have to whitelist. I do not recommend this method though, this is not good practice. If you can, please please please whitelist based on SPF records. Whitelisting on SPF records is good practice as it is not subject to change like using IP addresses.</p>