---
title: "MiniLab Adding a Select field to the Extended GlideRecord"
date: 2015-10-26T20:24:12.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=bf5e2eaddbd0dbc01dcaf3231f961991"
---
<p><span style="font-size: 12pt;">While pondering all the modifications I had made to date I realized that I still had not arrived at all of my targeted functionality.   I still wanted the same ability as I would get in a true SQL SELECT statement.   Namely to specify which fields were returned.   In other words proper SQL SELECT capability.   While <strong>SELECT *</strong> was fine I wanted <strong>SELECT field1, field2, ..., fieldn</strong>!</span></p><p></p><p><span style="font-size: 12pt;">I played around trying to get a <em>.addSelect(field1, etc.);</em>, but was unable to come up with something I liked; let alone worked right!</span></p><p></p><p><span style="font-size: 12pt;">I settled for something not as nice, but that still worked.   I ended up adding a new prototype method to my GlideRecordExtensions Script Include to do the deed.</span></p><p></p><p><span style="font-size: 12pt;">This is the format:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><em>var &lt;&lt;object array&gt;&gt; = &lt;&lt;glideRecord&gt;&gt;.select('field1, field2, ..., fieldn');</em></span></p><p style="padding-left: 30px;"></p><p><span style="font-size: 12pt;">The select method will return an object array containing each record, but with only the fields specified.</span></p><p></p><p><span style="font-size: 12pt;">What follows is how to add this functionality.</span></p><p></p><p></p><p><span style="font-size: 12pt;"><strong>Prerequisites:</strong></span></p><p></p><p><span style="font-size: 12pt;">1. Do the <a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/13/mini-lab-extending-servicenow-javascript-using-ecmascript-6-polyfills">JavaScriptExtended lab</a> if you have not already done so.   We will be adding new functionality to the ServiceNow JavaScript code base.</span></p><p></p><p><span style="font-size: 12pt;">2. Do the <a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/10/06/mini-lab-extending-the-gliderecord-object">GlideScriptExtended lab</a>.   This will be the Script Include we will be extending to give us the new functionality for GlideRecord.</span></p><p></p><p><span style="font-size: 12pt;">3. Familiarity with Scripts - Background to run a simple test.   <a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/08/07/servicenow-scripting-101-two-methods-for-code-development">Article</a>.</span></p><p></p><p><span style="font-size: 12pt;">4. Familiarity with Fix Scripts to run our final test.<span style="font-size: 16px;">   </span><a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/08/07/servicenow-scripting-101-two-methods-for-code-development" style="font-size: 16px;">Article</a><span style="font-size: 16px;">.</span></span></p><p></p><p></p><p><span style="font-size: 18pt;"><strong>Lab 1.1 - Add Array.indexOf to the JavaScriptExtended class.</strong></span></p><p></p><p><span style="font-size: 12pt;">We need a way to search a one-dimensional array for a specific value.   Array.indexOf added in ECMAScript 5 does what we want.   Since indexOf for arrays is missing from the ServiceNow code base (remember it is ECMAScript 3) we will need to add it to our JavaScriptExtended Script Include.</span></p><p></p><p><span style="font-size: 12pt;">1. In your browser go to the MDN definition page for Array.indexOf:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><a title="" _jive_internal="true" href="/developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf">Array.indexOf</a><br/></span></p><p></p><p><span style="font-size: 12pt;">2. Copy out the Polyfill definition code (scroll down a bit to see it on the page, and copy only the code).</span></p><p></p><p><span style="font-size: 12pt;"><img   alt="2.polyfill.JPG" class="image-2 jive-image" src="4341e77ddb5093041dcaf3231f9619cb.iix" style="width: 620px; height: 461px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p></p><p><span style="font-size: 12pt;">3. In ServiceNow navigate to Script Includes and edit the JavaScriptExtended Script Include.</span></p><p></p><p><span style="font-size: 12pt;">4. Paste the Polyfill into the end of the script and save your work.</span></p><p></p><p><span style="font-size: 12pt;"><img   alt="3.javascriptextensions array.indexof.JPG" class="image-3 jive-image" src="a9d9098edb949f048c8ef4621f961900.iix" style="width: 620px; height: 409px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p></p><p><span style="font-size: 12pt;">5. Raise your security level to Security Admin, navigate to Scripts - Background and run the following test to verify the functionality has been added to the language base.</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_1445864814378120" data-renderedposition="2018_8_1192_112" jivemacro_uid="_1445864814378120"><p><span style="font-size: 12pt;">   gs.include('JavaScriptExtensions');</span></p><p></p><p><span style="font-size: 12pt;">   var fieldList = ['cmdb_ci_server', 'cmdb_ci_moose', 'cmdb_ci'];</span></p><p></p><p><span style="font-size: 12pt;">   var findField = fieldList.indexOf('cmdb_ci');</span></p><p></p><p><span style="font-size: 12pt;">   gs.print(findField);   // result should be 2</span></p></pre><p></p><p></p><p><img   alt="1.Scripts-Background.JPG" class="image-1 jive-image" src="86c20c4adb1c5704ed6af3231f961960.iix" style="width: 620px; height: 377px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-size: 12pt;">Now we are ready to extend GlideRecord!</span></p><p></p><p></p><p><span style="font-size: 18pt;"><strong>Lab 1.2 - Add Select to GlideRecordExtension</strong></span></p><p></p><p><span style="font-size: 12pt;">With this lab we will be adding our new select method to the existing GlideRecordExtension Script Include.</span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to Script Includes and edit the GlideRecordExtension Script Include.</span></p><p></p><p><span style="font-size: 12pt;">2. Add the following new function to the end of the Script Include.</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>: I have introduced a new wrinkle in functionality.   If you add a variable to the "this" object in a prototype method it becomes a global variable to the GlideRecord object (or any object where this is done) when the new function (.select) is called the first time.   When we assign a value to such a variable; that value is now available to all following function calls.   So in this case isSelect and selectFields will be available later to other functions called inside of GlideRecordExtended.</span></p><p></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14458648906124019" data-renderedposition="2990_8_1192_128" jivemacro_uid="_14458648906124019"><p><span style="font-size: 12pt;">   GlideRecord.prototype.select = function(selectFields) {</span></p><p><span style="font-size: 12pt;">           this.selectFields = [];   // initialize our global array</span></p><p><span style="font-size: 12pt;">   <span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif;">       </span>this.isSelect = true;   // turn on the filter</span></p><p><span style="font-size: 12pt;">           this.selectFields = selectFields;</span></p><p><span style="font-size: 12pt;">           var selectList = this.toObjectList();</span></p><p><span style="font-size: 12pt;">           this.isSelect = false;   // turn off the filter</span></p><p><span style="font-size: 12pt;">           return selectList;</span></p><p><span style="font-size: 12pt;">   };</span></p></pre><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>:   It is considered a best practice to initialize your this variables (or any variables for that matter).</span></p><p></p><p><span style="font-size: 12pt;">3. Modify the GlideRecord.prototype.toObject function to the following in the Script Include.</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14458649734879561 jive_text_macro" data-renderedposition="3229_8_1192_208" jivemacro_uid="_14458649734879561"><p><span style="font-size: 12pt;">GlideRecord.prototype.toObject = function(recordToPackage) {</span></p><p><span style="font-size: 12pt;">       var packageToSend = {};</span></p><p><span style="font-size: 12pt;">       for (var property in recordToPackage) {</span></p><p><span style="font-size: 12pt;">               try {</span></p><p><span style="font-size: 12pt;">                       if ((this.isSelect &amp;&amp; this.selectFields.indexOf(property) &gt; -1) || !this.isSelect) {</span></p><p><span style="font-size: 12pt;">                               packageToSend[property] = recordToPackage[property].getDisplayValue();</span></p><p><span style="font-size: 12pt;">                       }</span></p><p><span style="font-size: 12pt;">               }</span></p><p><span style="font-size: 12pt;">               catch(err){}</span></p><p><span style="font-size: 12pt;">       }</span></p><p></p><p><span style="font-size: 12pt;">       return packageToSend;</span></p><p><span style="font-size: 12pt;">};</span></p></pre><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">This new "if" check looks to see if we are doing a "select" AND if the specific field is one we are wanting, otherwise retain our old functionality.</span></p><p></p><p><img   alt="4.gliderecordextensions array.indexof.JPG" class="image-4 jive-image" src="a0e0a002db10dfc03eb27a9e0f96193e.iix" style="width: 620px; height: 359px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p></p><p><span style="font-size: 12pt;">Now we are ready to test our new select function!</span></p><p></p><p></p><p><span style="font-size: 18pt;"><strong>Lab 1.3 - Test the Gliderecord.select Function</strong></span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to Fix Scripts and create a new Fix Script</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">a. <strong>Name</strong>: GlideRecord Select Test</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">b. <strong>Active</strong>: Checked</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">c. <strong>Run Once</strong>: Checked</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">d. <strong>Description</strong>: This Fix Script is for testing the GlideRecord.select function</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">e. <strong>Script</strong>:</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14458651542263521 jive_text_macro" data-renderedposition="4216_8_1192_544" jivemacro_uid="_14458651542263521"><p><span style="font-size: 12pt;">gs.include('GlideRecordExtensions');   // include our library of new functions</span></p><p></p><p><span style="font-size: 12pt;">// this is our test recordset of 10 records</span></p><p><span style="font-size: 12pt;">var incidents = new GlideRecord('incident');</span></p><p><span style="font-size: 12pt;">incidents.addActiveQuery();</span></p><p><span style="font-size: 12pt;">incidents.setLimit(10);</span></p><p><span style="font-size: 12pt;">incidents.query();</span></p><p></p><p><span style="font-size: 12pt;">// Execute our new select function. Ask for just the sys_id and number fields.</span></p><p><span style="font-size: 12pt;">var incidentList = incidents.select('sys_id, number');</span></p><p></p><p><span style="font-size: 12pt;">// Loop through and print out our resultant object array</span></p><p><span style="font-size: 12pt;">for (var i=0; i &lt; incidentList.length; i++) {</span></p><p><span style="font-size: 12pt;">       gs.info('{0} - {1}, {2}', </span></p><p><span style="font-size: 12pt;">               incidentList[i].number,</span></p><p><span style="font-size: 12pt;">               incidentList[i].sys_id, </span></p><p><span style="font-size: 12pt;">               incidentList[i].assigned_to /* not in select list */);</span></p><p><span style="font-size: 12pt;">}</span></p><p></p><p><span style="font-size: 12pt;">gs.print(' ');</span></p><p></p><p><span style="font-size: 12pt;">// Execute the toObjectList function to retrieve ALL fields</span></p><p><span style="font-size: 12pt;">var incidentFullList = incidents.toObjectList();</span></p><p></p><p><span style="font-size: 12pt;">// Loop through and print out our resultant object array</span></p><p><span style="font-size: 12pt;">for (var i=0; i &lt; incidentFullList.length; i++) {</span></p><p><span style="font-size: 12pt;">       gs.info('{0} - {1}, {2}', </span></p><p><span style="font-size: 12pt;">               incidentFullList[i].sys_id, </span></p><p><span style="font-size: 12pt;">               incidentFullList[i].number,</span></p><p><span style="font-size: 12pt;">               incidentFullList[i].assigned_to);</span></p><p><span style="font-size: 12pt;">}</span></p><p></p><p><span style="font-size: 12pt;">incidents = null;   // Drop our heavy object from memory</span></p><p></p></pre><p style="padding-left: 30px;"></p><p style="padding-left: 60px;">Your script should look something like this:</p><p></p><p><img   alt="5.test array.indexof.JPG" class="image-5 jive-image" src="db4000c6db585fc068c1fb651f961991.iix" style="width: 620px; height: 464px; display: block; margin-left: auto; margin-right: auto;"/></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>: You will notice I added a line to the end of the test.   This shows how to get rid of the GlideRecord object from memory as it is no longer needed.   See the following article for more on <a title="" _jive_internal="true" href="/groups/servicenow-user-group-us-tx-north-texas/blog/2015/09/08/community-code-snippets--scripting-memory-management">memory management</a>.</span></p><p style="padding-left: 30px;"></p><p></p><p><span style="font-size: 12pt;">2. Run the Fix Script.</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Results:</span></p><p></p><p><span style="font-size: 12pt;"><img   alt="6.indexof test results.JPG" class="image-6 jive-image" src="e6b02bb1db1093049c9ffb651f961928.iix" style="width: 620px; height: 500px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">The first part of the test verifies that our new function is working correctly.   The select method goes out and only retrieves the specified fields and nothing else.   Since assigned_to was not in our select fields list then it was not retrieved and returns "org.mozilla.javascript.Undefined".</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">The second part of the test verifies we have not broken our old functionality and that everything is returned.   The assigned_to field will be properly filled in.</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt; line-height: 1.5;">End of testing!</span></p><p></p><p><span style="font-size: 12pt;">There you have it!   Not a perfect solution, but the best we can do for the moment.   If you DO figure out a way to implement a GlideRecord.addSelect as part of the actual GlideRecord query let me know!   I promise to do the same if I figure out a better way.   :-)</span></p><p></p><p><span style="font-size: 12pt;">BTW, I have updated the <a title="hare.servicenow.com/app.do#/detailV2/3076bd9ae15302007c390227ffa71e98/overview" href="https://share.servicenow.com/app.do#/detailV2/3076bd9ae15302007c390227ffa71e98/overview">Share</a> with these latest modifications.</span></p><p></p><p><span style="font-size: 12pt;">Steven Bell</span></p><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit;"><span style="color: #800080; font-size: 12pt; font-style: inherit; font-family: arial, helvetica, sans-serif; font-weight: inherit;"><strong>If you find this article helps you, don't forget to log in and "like" it!   I would also like to encourage you to become a member of our blog!</strong></span></p><p style="margin-bottom: .0001pt; background: white;"><span style="color: purple; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><strong><a _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="86661" data-objecttype="111" href="/servlet/JiveServlet/downloadImage/38-4985-86661/CS_logo.jpg"><img  alt="CS_logo.jpg" class="image-18 jive-image" height="60" src="e19b414edbd0d344e9737a9e0f96192a.iix" width="151"/></a></strong></span><span style="color: purple; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><strong><a _jive_internal="true" data-containerid="2061" data-containertype="14" data-objectid="2273" data-objecttype="102" href="/community?id=community_article&sys_id=330d6ea5dbd0dbc01dcaf3231f961965"><img  alt="MVP-logo.jpeg" class="image-17 jive-image" height="48" src="47bb2c4adbd4dfc03eb27a9e0f96192f.iix" width="135"/></a></strong></span></p><p><span style="color: #eb7a3d;">Please Share, Like, Comment this blog if you've found it helpful or insightful.</span></p><p></p><hr/><p><span style="color: #eb7a3d;"><span style="color: #303030;">for Click for <a title="" _jive_internal="true" href="/community?id=community_forum&sys_id=a6299a2ddbd897c068c1fb651f961926">More Expert Blogs </a>and also Find <a title="" _jive_internal="true" class="jivecontainerTT-hover-container jive-link-community-small" data-containerid="2059" data-containertype="14" data-objectid="2037" data-objecttype="14" href="/community?id=community_forum&sys_id=d6295a2ddbd897c068c1fb651f9619f1">Expert Events</a>!</span><br/></span></p><hr/>