---
title: "MiniLab Email Notification Scripts"
date: 2015-11-09T02:25:28.000Z
authors: ["sabell2012"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=0b5eeaaddbd0dbc01dcaf3231f96198c"
---
<p><span style="font-size: 12pt;">I thought I would use this and the next article to tackle advanced email notifications.   In this article I will be modifying an existing notification template to use an email notification script.   Notifications scripts are used to dynamically modify the content of an email, and can be really useful in listing additional information pertaining to the record that triggered the </span><span style="font-size: 16px; line-height: 26.6667px;">notification</span><span style="font-size: 12pt;">.</span></p><p></p><p><span style="font-size: 12pt;"><strong>Prerequisites</strong>:</span></p><p></p><p><span style="font-size: 12pt;">1. Familiarity with how to edit forms to add fields not currently showing.</span></p><p><span style="font-size: 12pt;">2. Familiarity with email notifications, how to add them, how to modify them.</span></p><p></p><p><span style="font-size: 12pt;">For those of you using a personal instance you will have to do a couple of things prior to being able to get emails to fire.</span></p><p></p><p><span style="font-size: 12pt;">1. Make sure that the users that you will be working with have Notification set to Enable.   </span></p><p><span style="font-size: 12pt;">2. Make sure that the Admin account has Notification set to Enable.</span></p><p><span style="font-size: 12pt;">3. If you want to send emails to yourself (your own account) then navigate to System Properties -&gt; Email, and fill in the field labeled: "Send all mail to this test email address".   Only after you have this filled in should you check the field labeled: "Mail sending enabled".   This will send emails to the account you specify instead of trying to send them to the user's example.com account (which is bogus).   When you have done these two things you can click the Save button to save your work.</span></p><p></p><p><span style="font-size: 12pt;">Quick diagram of Notification dependencies</span></p><p></p><p><span style="font-size: 12pt;"><img   class="jive-image image-8" src="61b62b31db181704ed6af3231f961920.iix" style="display: block; margin-left: auto; margin-right: auto; width: auto; height: auto;"/></span></p><p></p><p><span style="font-size: 12pt;">You don't <span style="text-decoration: underline;">need</span> a template or a script, but they help in code reuse (a best practice).</span></p><p></p><p></p><p><span style="font-size: 14pt;"><strong>Lab 1.1: Email Notification Script</strong></span></p><p></p><p><span style="font-size: 12pt;">We will be modifying an existing Email Notification that contains a Mail Script tag and moving that code down a level to be a </span><span style="font-size: 16px; line-height: 26.6667px;">Notification</span><span style="font-size: 12pt;"> Script that will be included in the </span><span style="font-size: 16px; line-height: 26.6667px;">notification</span><span style="font-size: 12pt;">.   We will be saving all of this down as our own and deactivating the original out-of-the-box version (another best practice).</span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to System Policy -&gt; Email -&gt; Email Templates.   The Email Templates List View will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">2. Search for the template named <strong>ess.incident.resolve</strong>, and edit that template up.</span></p><p></p><p><span style="font-size: 12pt;">3. Change the following:</span></p><p></p><p><span style="font-size: 12pt;">   a. <strong>Name</strong>: incident.ess.resolve.<strong>css</strong></span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>: We are using css because we will be expanding on this example to pretty it up in the next article.</span></p><p><span style="font-size: 12pt;">       </span></p><p><span style="font-size: 12pt;">   b. <strong>Message</strong>:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Your incident ${number} has been resolved and will automatically close <span style="color: #e23d39;">${mail_script:autoCloseStatement}</span>. If you feel the issue is not resolved, please click the following link to reopen your incident:</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">${mailto:mailto.unsatisfied}</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Short description: ${short_description}</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Priority: ${priority}</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Category: ${category}</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Comments:</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Additional comments: ${comments}</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">&lt;hr/&gt;</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Click here to view Incident: ${URI_REF}</span></p><p></p><p><span style="font-size: 12pt;">   c. <strong><span style="color: #e23d39;">IMPORTANT</span>:</strong>   Right-click on the form header and pick Insert.   Do NOT update or save as this will update the out-of-the-box version.</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>: All we did here was rip out everything (including the tags) that were between the &lt;mail_script&gt; tags and replace it all with a call to our new Notification Script, um, which we haven't written yet.   That's next!</span></p><p></p><p><img   class="image-2 jive-image" src="e2c5154edb981b04ed6af3231f96193f.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 300px;"/></p><p></p><p><span style="font-size: 12pt;">4. Navigate to System Policy -&gt; Email -&gt; Notification Email Scripts.   The Nofication Email Scripts list view will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">5. Click the New button.   This will display an empty Email Script form.</span></p><p></p><p><span style="font-size: 12pt;">6. Fill in the form with the following:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">a. <strong>Name</strong>: autoCloseStatement</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">b. <strong>Script</strong>:</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14469532832984282 jive_macro_code jive_text_macro" data-renderedposition="2319.18408203125_7.986111640930176_1191_156" jivemacro_uid="_14469532832984282"><p><span style="font-size: 12pt;">   var days = parseInt(gs.getProperty("glide.ui.autoclose.time"));</span></p><p><span style="font-size: 12pt;">   var hours = days * 24;</span></p><p></p><p><span style="font-size: 12pt;">   if (days == 0)</span></p><p><span style="font-size: 12pt;">           template.print('now');</span></p><p><span style="font-size: 12pt;">   else if (days &lt;= 3)</span></p><p><span style="font-size: 12pt;">           template.print('in ' + hours + ' hour' + ((hours&gt;1) ? 's' : ''));</span></p><p><span style="font-size: 12pt;">   else</span></p><p><span style="font-size: 12pt;">           template.print('in ' + days + ' day' + ((days&gt;1) ? 's' : ''));</span></p><p></p></pre><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">c. Click the Submit button to save your work.</span></p><p></p><p><span style="font-size: 12pt;">Did the script look familiar?   It was everything we removed from the Email Notification Template that was between the &lt;mail_script&gt; tags.   Easy!</span></p><p></p><p><img   class="image-3 jive-image" src="07f37c42db9cd704ed6af3231f961987.iix" style="width: 620px; height: 221px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-size: 12pt;">7. Navigate to System Policy -&gt; Email -&gt; Email Notifications.   The Email Notifications list view will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">8. Search for notification named "Incident Resolved".   Edit this </span><span style="font-size: 16px; line-height: 26.6667px;">notification</span><span style="font-size: 12pt;">.</span></p><p></p><p><span style="font-size: 12pt;">9. Change the Active field to un-checked, right-click the form header to bring up the context menu, and click Save.   This deactivates the out-of-the-box Notification.</span></p><p></p><p><span style="font-size: 12pt;">10. Change the following on the still open form:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">a. <strong>Name</strong>: Incident Resolved <strong>CSS</strong></span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">b. <strong>Active</strong>: Checked.</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">c. What it will Contain -&gt; <strong>Email Template</strong>: incident.ess.resolve.css</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>: This is where we reference our new Email Notification Template.</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">d. <span style="color: #e23d39;"><strong>IMPORTANT</strong></span>: Right click on the form header and choose <strong>Insert And Stay</strong> so that we do not save over the out-of-the-box Notification!</span></p><p></p><p><span style="font-size: 12pt;">11. Right click on the form header and click on Configure -&gt; Form Layout.   The Form Layout form will be displayed.</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">a. Add the following fields:</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 60px;"><span style="font-size: 12pt;">Send Event to Creator</span></p><p style="padding-left: 60px;"><span style="font-size: 12pt;">Force delivery</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">b. Click the Save button.   This will return you to the Email Notification form.</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTE</strong>: Send Event to Creator makes sure an email is sent (it should be checked automatically).   Force delivery makes sure an email is sent even if the user has notification disabled (I just wanted to make sure the email is sent - a bit of overkill since in our prerequisites the users we will be using for testing should have Notification enabled).</span></p><p></p><p><span style="font-size: 12pt;">12. Make sure both new fields are checked.   Click the Submit button to save your work.</span></p><p></p><p><img   alt="1.email notification.png" class="image-4 jive-image" src="ecffe375db1c1fc068c1fb651f96191d.iix" style="display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-size: 12pt;">Okay, that is it!   We are ready to test our creation!</span></p><p></p><p></p><p><span style="font-size: 14pt;"><strong>Lab 1.2: Testing The Notification Script</strong></span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to Incidents -&gt; Open.   The Open Incidents list view will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">2. Click on an Incident whose status is not Resolved.   The Incident form will be displayed.   Note the Incident number.</span></p><p></p><p><span style="font-size: 12pt;">3. Click on the Resolve Incident button at the top-right of the form.   A pop-up will be displayed stating that you have fill in a handful of required fields.   Do so, and then click on the Resolve Incident button again. This should mark the incident as resolved.</span></p><p></p><p><span style="font-size: 12pt;">4. Navigate to System Policy -&gt; Events -&gt; Event log.   The Event log list view will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">5. Filter for the Name "incident.updated".   You should see that this event has recently (a within a couple of seconds) fired.   I did it a few times while I was testing the code for this article.   :-)</span></p><p></p><p><img   class="image-5 jive-image" src="399d814edbd41b04ed6af3231f9619f5.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 314px;"/></p><p></p><p><span style="font-size: 12pt;">6. Navigate to System Logs -&gt; Emails.   This will display the Email Log list view.</span></p><p></p><p><span style="font-size: 12pt;">7. Filter for Subject contains "has been resolved".   You should see the email notification sent out for your incident number.   Edit this </span><span style="font-size: 16px; line-height: 26.6667px;">notification</span><span style="font-size: 12pt;"> up.</span></p><p></p><p><span style="font-size: 12pt;">8. Examine the notification body and verify that there the text contains something like:</span></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">"Your incident INC0010051 has been resolved and will automatically close in 24 hours. If you feel the issue is not resolved, please click the following link to reopen your incident:"</span></p><p></p><p><img   class="image-6 jive-image" src="407960cadb909304b322f4621f961912.iix" style="width: 620px; height: 314px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-size: 12pt;">That's it!   If you see that type of message then it worked!   The "24 hours" is generated by the script.   So let's spiff it up a bit.</span></p><p></p><p></p><p><span style="font-size: 14pt;"><strong>Lab 1.3: Email Notification Script Best Practice</strong></span></p><p></p><p><span style="font-size: 12pt;">Here we will up the game a bit by making the script more extensible, and maintainable.   We will also be introducing a new twist on a switch statement, and implementing the script as a generic function to isolate it from accidental execution.</span></p><p></p><p><span style="font-size: 12pt;">1. Navigate to System Policy -&gt; Notification Email Scripts.   The Email Notification Scripts list view will be displayed.</span></p><p></p><p><span style="font-size: 12pt;">2. Filter for the script named "autoCloseStatement", and edit up the script.</span></p><p></p><p><span style="font-size: 12pt;">3. Change the <strong>script</strong> to the following:</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14469536796511074 jive_macro_code jive_text_macro" data-renderedposition="5754.236328125_7.986111640930176_1191_311" jivemacro_uid="_14469536796511074" modifiedtitle="true"><p><span style="font-size: 12pt;">(function() {</span></p><p><span style="font-size: 12pt;">       var days = parseInt(gs.getProperty("glide.ui.autoclose.time"));</span></p><p><span style="font-size: 12pt;">       var hours = days * 24;</span></p><p></p><p><span style="font-size: 12pt;">       var autoCloseStatement = '';</span></p><p><span style="font-size: 12pt;">       switch (true) {</span></p><p><span style="font-size: 12pt;">               case (days == 0):</span></p><p><span style="font-size: 12pt;">                       autoCloseStatement = 'now';</span></p><p><span style="font-size: 12pt;">                       break;</span></p><p><span style="font-size: 12pt;">               case (days &lt;= 3):</span></p><p><span style="font-size: 12pt;">                       autoCloseStatement = 'in ' + hours + ' hour' + ((hours&gt;1) ? 's' : '');</span></p><p><span style="font-size: 12pt;">                       break;</span></p><p><span style="font-size: 12pt;">               default:</span></p><p><span style="font-size: 12pt;">                       autoCloseStatement = 'in ' + days + ' day' + ((days&gt;1) ? 's' : '');</span></p><p><span style="font-size: 12pt;">                       break;</span></p><p><span style="font-size: 12pt;">       }</span></p><p></p><p><span style="font-size: 12pt;">       template.print(autoCloseStatement);</span></p><p><span style="font-size: 12pt;">})();</span></p><p></p></pre><p></p><p></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>NOTES</strong>: </span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">The editor throws a warning on the switch statement.   "The 'switch' should be an 'if'".   Really?   Seriously, ignore this warning as it is simply nuts.   </span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">The template.print places the generated string back into the email template text at the location of the script call.</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">Here we have two best practices:</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">1) Anonymous function - this keeps the code from being accidentally executed.   Only this Notification Script can execute this code.</span></p><p style="padding-left: 30px;"><span style="font-size: 12pt;">2) Whenever an "if" statement goes beyond one if/then/else you should look at converting it to a "switch" statement.   This improves readability, flexibility, and extensibility.</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 12pt;"><strong>Twist:</strong> Note the unusual switch statement.   This has a "true" in the argument!   This is how you can convert mixed "if" statement code into a "switch".   You do so by making the passed value "true", and then each argument of the if/else if/etc. can be included in parenthesis in each case statement.   Pretty cool, huh?   :-)</span></p><p></p><p><span style="font-size: 12pt;">4. Click the Submit button to save your work.</span></p><p></p><p><img   class="image-7 jive-image" src="1cdc4046db5c1344e9737a9e0f9619b7.iix" style="display: block; margin-left: auto; margin-right: auto; width: 620px; height: 314px;"/></p><p></p><p><span style="font-size: 12pt;">5. Now repeat lab 1.2 to test.</span></p><p></p><p><span style="font-size: 12pt;">There you go!   A definite upgrade from out-of-the-box!   :-)</span></p><p></p><p><span style="font-size: 12pt;">In the next article we will be exploring CSS in email notifications.</span></p><p></p><p><span style="font-size: 12pt;">Steven Bell</span></p><p></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="color: #800080; font-weight: inherit; font-size: 12pt; font-family: inherit; font-style: inherit;"><strong>If you find this article helps you, don't forget to log in and "like" it!</strong></span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="color: #800080; font-weight: inherit; font-size: 12pt; font-family: inherit; font-style: inherit;"><strong>I would also like to encourage you to become a member of our blog!</strong></span></p>