---
title: "MiniLab  Events"
date: 2015-09-04T04:11:58.000Z
authors: ["sabell2012"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f13e6e6ddbd0dbc01dcaf3231f9619c3"
---
<p>The purpose of this lab is demonstrate how to create then call an event that triggers a Script Action that calls a Script Include!   Additionally I wanted to show how you could simulate a Business Rule call in Scripts - Background.</p><p></p><p><span style="color: #ff0000;"><strong>CAVEAT</strong></span>: I did not go into extreme how-to detail, and there is a certain expectation of proficiency with the ServiceNow platform to successfully complete this lab.</p><p></p><p><img  alt="Mini-Lab - Events.jpg" class="image-0 jive-image" src="5160244adb5057049c9ffb651f961924.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p>1. Install the currentFactory Script Include from Share</p><p></p><p style="padding-left: 30px;"><strong>NOTE</strong>: I repackaged my currentFactory code into it's own Script Include.   You can download the XML here: <a title="hare.servicenow.com/app.do#/detailV2/66ab74c1555646007c3953512138ef39/overview" href="https://share.servicenow.com/app.do#/detailV2/66ab74c1555646007c3953512138ef39/overview">Share</a>.</p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;">To load it up into your instance do the following:</p><p></p><p style="padding-left: 30px;">a. Download the currentFactory file from ServiceNow share.</p><p style="padding-left: 30px;">b. In your instance raise yourself to Security Admin (click the lock symbol next to your name, check the box, and click the OK button).</p><p style="padding-left: 30px;">c. Navigate to System Definition -&gt; Script Includes.   A list view of all Script Includes will be displayed.</p><p style="padding-left: 30px;">d. Right-Click next to the name field to bring up the context menu.</p><p style="padding-left: 30px;">e. Click the Import XML link at the bottom of the context menu.</p><p style="padding-left: 30px;">f. Click the Choose File button.</p><p style="padding-left: 30px;">g. Navigate to your download folder and pick the file labeled: sys_script_include_CSTableUtils.xml and click the Ok button.   You will be returned to the import form.</p><p style="padding-left: 30px;">h. Click the Upload button. The new Script Include will be added to your Script Include list.</p><p></p><p>2. Create a Script Include to do something!</p><p></p><p style="padding-left: 30px;">a. Navigate to System Definition -&gt; Script Includes.   You may still be there.</p><p style="padding-left: 30px;">b. Click New.   The a blank Script Include form will be displayed.</p><p style="padding-left: 30px;">c. Fill in the following:</p><p></p><p style="padding-left: 30px;"><strong>NOTE</strong>: After filling in the name field then tabbing off the form a template with your Script Include name will be autofilled into the Script field.</p><p></p><p style="padding-left: 30px;"><strong>Name</strong>: MyIncidentUtils</p><p style="padding-left: 30px;"><strong>Accessable From</strong>: All application scopes</p><p style="padding-left: 30px;"><strong>Client callable</strong>: unchecked</p><p style="padding-left: 30px;"><strong>Active</strong>: checked</p><p style="padding-left: 30px;"><strong>Protection Policy</strong>: -- None --</p><p style="padding-left: 30px;"><strong>Script</strong>:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14413307674052396" jivemacro_uid="_14413307674052396">
<p>var MyIncidentUtils = Class.create();</p>
<p></p>
<p>MyIncidentUtils.prototype = {</p>
<p>   <span style="font-size: 13.3333330154419px;">   </span>initialize: function() {</p>
<p><span style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>},</p>
<p></p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>addTenDaysToOpenedAt : function(incident) {</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>gs.log('---&gt; ' + incident.number + ' - Opened At: ' + incident.opened_at, 'SI: MyIncidentUtils.AddTenDaysToOpenedAt');</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>var openedAt = new GlideDateTime(incident.opened_at.getDisplayValue());</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>var opened_at = openedAt.getDate();</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>opened_at.addDays(10);</p>
<p></p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>incident.opened_at = opened_at;</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>incident.update();</p>
<p></p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   <span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span></span>gs.log('---&gt; Date after: ' + incident.opened_at, 'SI: MyIncidentUtils.AddTenDaysToOpenedAt');</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>},</p>
<p></p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>type: 'MyIncidentUtils'</p>
<p>};</p>


</pre><p></p><p style="padding-left: 30px;">d. Click the Submit button.   <strong>NOTE</strong>: Always check your work, and click the syntax to make sure there were no problems.</p><p></p><p></p><p>3. Create a new event - Register the Event name</p><p></p><p style="padding-left: 30px;">a. Navigate to System Policy -&gt; Events -&gt; Registry.   The Event Registry list view will be displayed.</p><p style="padding-left: 30px;">b. Click on the New button.   The Event Registration form will be displayed.</p><p style="padding-left: 30px;">c. Fill the following in:</p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Event name</strong>: incident.opened_at.add_ten_days</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Table</strong>: Global (this would be Incident if you were firing the event from an Incident Business Rule)</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Fired by</strong>: Scripts - Background</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Description</strong>: Add ten days to the incident</p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;">d. Click the Submit button to save.</p><p></p><p>4. Create a Script Action to fire the Script Include</p><p></p><p style="padding-left: 30px;">a. Navigate to System Policy -&gt; Events -&gt; Script Actions.     The Script Actions list view will be displayed.</p><p style="padding-left: 30px;">b. Click the New button.   The new Script Action form will be displayed.</p><p style="padding-left: 30px;">c. Fill in the form with the following:</p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Name</strong>: AddTenDaysToOpenedAt</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><strong><span style="font-size: 13.3333330154419px;">   </span>Event name</strong>: incident.opened_at.add_ten_days</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Active</strong>: Checked</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span><strong>Script</strong>:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_text_macro jive_macro_code _jivemacro_uid_14413307673986667" jivemacro_uid="_14413307673986667">
<p>gs.log('---&gt; ' + current.number + ' - Opened At: ' + current.opened_at, 'SA: AddTenDaysToOpenedAt');</p>
<p></p>
<p>// Try/Catch...just in case</p>
<p>try {</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>new MyIncidentUtils().addTenDaysToOpenedAt(current);</p>
<p>}</p>
<p>catch(err) {</p>
<p><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>gs.log('---&gt; ERROR: ' + err, 'SA: AddTenDaysToOpenedAt');</p>
<p>}</p>


</pre><p></p><p style="padding-left: 30px;">d. Click the Submit button to save.</p><p></p><p>5. Using currentFactory fire the new event from Scripts - Background</p><p></p><p style="padding-left: 30px;">a. Type the following script into your Run Script field:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14413307673875375 jive_text_macro jive_macro_code" jivemacro_uid="_14413307673875375">
<p>var current = CSTableUtils.currentFactory('incident', 'Ascending', 'active=true');</p>
<p></p>
<p>// did we get one back, and we want to know what the value was before it was changed</p>
<p>gs.print(current.number + ' - Opened At: ' + current.opened_at);</p>
<p></p>
<p>gs.eventQueue('incident.opened_at.add_ten_days', current);</p>


</pre><p></p><p style="padding-left: 30px;">b. Click the Run script button.</p><p style="padding-left: 30px;">c. Note the Incident Number and the Date.</p><p></p><p style="padding-left: 30px;">Example response:</p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;">   *** Script: INC0000002 - Opened At: 2014-11-19 23:07:12</p><p></p><p>6. Verify</p><p></p><p style="padding-left: 30px;">a. Navigate to System Policy -&gt; Events -&gt; Event Log</p><p style="padding-left: 30px;">b. Order the Events List View by Created descending.</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>i. Search the Name field for: incident.opened_at.add_ten_days</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>ii. Parm1 of the record should contain the Incident Number.   Write this number down.</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>iii. Navigate to Incident -&gt; Open.</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>iv. Search for the Incident number listed in the Event log.</p><p style="padding-left: 30px;">c. Open that incident and see if the Opened At date has been advanced ten days.</p><p style="padding-left: 30px;">d. Navigate to System Logs -&gt; System Log -&gt; All</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>i. Order by Created descending</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>ii. In the messages field search for ---&gt;</p><p style="padding-left: 30px;"><span style="font-size: 13.3333330154419px;">   </span><span style="font-size: 13.3333330154419px;">   </span>iii. Observe the records written there.</p><p style="padding-left: 30px;"></p><p>And that is all there is to it!   Have fun!</p><p></p><p>Steven Bell.</p><p></p><p><span style="color: #800080; font-family: arial, sans-serif; font-size: 16px;">If you find this article helps you, don't forget to "like" it!</span></p>