---
title: "uGenericSet Data Structure"
date: 2015-11-12T04:10:45.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ce4d2229dbd0dbc01dcaf3231f9619cd"
---
<p>The set data type does not store duplicate elements.   It offers the ability to perform unions, differences and intersections with other sets. Iterating the structure using getIterator is a little slow, so use toArray() as needed.   It is "generic" in the spirit of Java generics (which have always seemed ironically named to me, since they make a data structure's element-type specific), meaning you permanently set the type of element at instantiation.</p><p></p><p>I have played around with it using data sets in the 1,000s of records range and the performance was satisfactory.   Comments and criticisms are always welcomed.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14472783664372876" data-renderedposition="137.60000610351562_8_1193_4288" jivemacro_uid="_14472783664372876" modifiedtitle="true"><p>// This data structure does not allow duplicates, thus re-adding the same value will simply ignore the 2nd value.</p><p>// Set the datatype when constructing the object:string, number, etc.   </p><p>// Once the object is constructed, elements of different types cannot be used for operations add(), remove(), contains() otherwise the object will throw an exception</p><p>// Wrap code that uses this in a try/catch block and write code to handle exceptions.</p><p>var u_GenericSet = Class.create();</p><p>u_GenericSet.prototype = {</p><p></p><p>       // Constructor creates a deep copy of the array parameter to avoid pass by reference mayhem.     </p><p>       // Array parameter is optional</p><p>       initialize: function (elementType, array) {</p><p></p><p>               if (JSUtil.nil(elementType)) {</p><p>                       throw "Mandatory constructor parameter 'elementType' was omitted when constructing object of type u_GenericSet";</p><p>               }</p><p></p><p>               if (!/^(number|string|object|boolean)$/i.test(elementType)) {</p><p>                       throw "Constructor parameter 'elementType' must be number|string|object|boolean when constructing object of type u_GenericSet";</p><p>               }</p><p></p><p>               this.elementType = elementType.toLowerCase();</p><p>               this.ary = [];</p><p></p><p>               if (array) {</p><p>                       for (var i = 0; i &lt; array.length; i++) {</p><p>                               if ((typeof array[i]) != this.elementType) {</p><p>                                       throw "Could not construct the u_GenericSet object because array parameter elements were not all of type " + this.elementType;</p><p>                               }</p><p>                               this.add(array[i]);</p><p>                       }</p><p>               }</p><p>       },</p><p></p><p>       // Ensures no duplicates.   Param must be of type set at construction</p><p>       add: function (element) {</p><p></p><p>               var passedType = (typeof element).toLowerCase();</p><p></p><p>               if (passedType != this.elementType) {</p><p>                       throw "u_GenericSet was constructed to contain only elements of type:" + this.elementType + " Attempted to add element of type:" + typeof element;</p><p>               }</p><p></p><p>               //First element</p><p>               if (this.ary.length == 0) {</p><p>                       this.ary[0] = element;</p><p>                       return;</p><p>               }</p><p></p><p>               //If the element is bigger than last element, stick it at the end               </p><p>               if (element &gt; this.ary[this.ary.length - 1]) {</p><p>                       this.ary[this.ary.length] = element;</p><p>                       return;</p><p>               }</p><p></p><p>               //If the element is smaller than first element, stick it at the beginning</p><p>               if (element &lt; this.ary[0]) {</p><p>                       this.ary.splice(0, 0, element);</p><p>                       return;</p><p>               }</p><p></p><p>               var finder = this._binaryIndexOf(element);</p><p>               if (finder.foundIt) {</p><p>                       return;</p><p>               } else {</p><p>                       this.ary.splice(finder.ndx, 0, element);</p><p>               }</p><p>       },</p><p></p><p>       //Returns object with 2 properties: 1) foundIt (boolean), 2) ndx (integer)</p><p>       _binaryIndexOf: function (searchElement) {</p><p></p><p>               var minIndex = 0;</p><p>               var maxIndex = (this.ary.length == 0) ? 0 : this.ary.length - 1;</p><p>               var currentIndex;</p><p>               var currentElement;</p><p></p><p>               while (minIndex &lt;= maxIndex) {</p><p>                       currentIndex = (minIndex + maxIndex) / 2 | 0;</p><p>                       currentElement = this.ary[currentIndex];</p><p></p><p>                       if (currentElement &lt; searchElement) {</p><p>                               minIndex = currentIndex + 1;</p><p>                       }</p><p>                       else if (currentElement &gt; searchElement) {</p><p>                               maxIndex = currentIndex - 1;</p><p>                       }</p><p>                       else if (currentElement == searchElement) {</p><p>                               return { foundIt: true, ndx: currentIndex };</p><p>                       }</p><p>               }</p><p>               return { foundIt: false, ndx: minIndex };</p><p>       },</p><p></p><p>       //Returns a boolean</p><p>       _binaryExists: function (searchElement) {</p><p></p><p>               var minIndex = 0;</p><p>               var maxIndex = (this.ary.length == 0) ? 0 : this.ary.length - 1;</p><p>               var currentIndex;</p><p>               var currentElement;</p><p></p><p>               while (minIndex &lt;= maxIndex) {</p><p>                       currentIndex = (minIndex + maxIndex) / 2 | 0;</p><p>                       currentElement = this.ary[currentIndex];</p><p></p><p>                       if (currentElement &lt; searchElement) {</p><p>                               minIndex = currentIndex + 1;</p><p>                       } else if (currentElement &gt; searchElement) {</p><p>                               maxIndex = currentIndex - 1;</p><p>                       } else {</p><p>                               return true;</p><p>                       }</p><p>               }</p><p>               return false;</p><p>       },</p><p>       </p><p>       //Returns a boolean</p><p>       contains: function (element) {</p><p></p><p>               var passedType = (typeof element).toLowerCase();</p><p></p><p>               if (passedType != this.elementType) {</p><p>                       throw "u_GenericSet was constructed to contain only elements of type:" + this.elementType + " Attempted to call contains for element of type:" + typeof element;</p><p>               }</p><p></p><p>               return this._binaryExists(element);</p><p>       },</p><p></p><p>       //Removes a value, not a value at an index </p><p>       remove: function (element) {</p><p></p><p></p><p>               var passedType = (typeof element).toLowerCase();</p><p></p><p>               if (passedType != this.elementType) {</p><p>                       throw "u_GenericSet was constructed to contain only elements of type:" + this.elementType + " Attempted to call remove for element of type:" + typeof element;</p><p>               }</p><p></p><p>               var finder = this._binaryIndexOf(element);</p><p>               if (finder.foundIt) {</p><p>                       this.ary.splice(finder.ndx, 1);</p><p>                       return true;</p><p>               }</p><p>               return false;</p><p>       },</p><p></p><p>       // Returns an int</p><p>       size: function () { return this.ary.length; },</p><p></p><p>       //Returns a new u_GenericSet containing the elements from both sets</p><p>       union: function (otherSet) {</p><p></p><p>               if (otherSet.type != "u_GenericSet") {</p><p>                       throw "Called union() on u_GenericSet with a parameter that was not a u_GenericSet type object.";</p><p>               }</p><p></p><p></p><p>               var otherAsArray = otherSet.toArray();</p><p>               var oReturn = new u_GenericSet(this.elementType, this.ary);</p><p>               for (var i = 0; i &lt; otherAsArray.length; i++) {</p><p>                       oReturn.add(otherAsArray[i]);</p><p>               }</p><p>               return oReturn;</p><p>       },</p><p></p><p>       //Returns a new <span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">u_GenericSet </span>containg the elements in this set that are not in the other</p><p>       difference: function (otherSet) {</p><p></p><p></p><p>               if (otherSet.type != "u_GenericSet") {</p><p>                       throw "Called difference() on u_GenericSet with a parameter that was not a u_GenericSet type object.";</p><p>               }</p><p></p><p>               var inThisSetButNotInOtherSet = [];</p><p>               for (var i = 0; i &lt; this.ary.length; i++) {</p><p>                       if (!otherSet.contains(this.ary[i])) {</p><p>                               inThisSetButNotInOtherSet.push(this.ary[i]);</p><p>                       }</p><p>               }</p><p></p><p>               return new u_GenericSet(this.elementType, inThisSetButNotInOtherSet);</p><p>       },</p><p></p><p>       //Returns a new <span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">u_GenericSet </span>containing elements that are members of both sets</p><p>       intersection: function (otherSet) {</p><p></p><p>               if (otherSet.type != "u_GenericSet") {</p><p>                       throw "Called intersection() on u_GenericSet with a parameter that was not a u_GenericSet type object.";</p><p>               }</p><p></p><p>               var inBothSets = [];</p><p>               var baseSet;</p><p>               var foreignSet;</p><p></p><p>               //Use the smallest set as the base set to minimize number of comparisons/iterations required</p><p>               if (this.ary.size() &lt; otherSet.size()) {</p><p>                       baseSet = this;</p><p>                       foreignSet = otherSet;</p><p>               } else {</p><p>                       baseSet = otherSet;</p><p>                       foreignSet = this;</p><p>               }</p><p></p><p>               var baseIter = baseSet.getIterator();</p><p>               while (baseIter.hasNext()) {</p><p>                       var val = baseIter.getValue();</p><p>                       if (foreignSet.contains(val)) {</p><p>                               inBothSets.push(val);</p><p>                       }</p><p>                       baseIter.next();</p><p>               }</p><p></p><p>               return new u_GenericSet(this.elementType, inBothSets);</p><p>       },</p><p></p><p>       // Returns a boolean</p><p>       isEmpty: function () {</p><p>               return this.ary.length == 0;</p><p>       },</p><p></p><p>       // Empties all elements</p><p>       purgeAll: function () {</p><p>               this.ary = [];</p><p>       },</p><p></p><p>       // Returns a comma separated list in a String</p><p>       toString: function () {</p><p>               return this.ary.toString();</p><p>       },</p><p></p><p>       //Creates a deep copy to avoid inadvertent modification of the original</p><p>       toArray: function () {</p><p>               var ret = [];</p><p>               for (var i = 0; i &lt; this.ary.length; i++) {</p><p>                       ret.push(this.ary[i]);</p><p>               }</p><p>               return ret;</p><p>       },</p><p><span style="color: #000000; font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">   </span><span class="comment" style="font-size: 12px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: #008200;">//Returns an object with functions: next(), hasNext(), and getValue();</span><span style="font-size: 12px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: #000000;">   </span></p><p>     getIterator: function () {</p><p>           </p><p>               var current = undefined;</p><p>               var store = this.ary;</p><p>               function hasNext() {</p><p>                       if (store.length == 0) {</p><p>                               return false;</p><p>                       }</p><p>                       if (current == undefined) {</p><p>                               current = 0;</p><p>                       }</p><p>                       if (current &lt; store.length) {</p><p>                               return true;</p><p>                       } else {</p><p>                               return false;</p><p>                       }</p><p>               }</p><p>               function next() {</p><p>                       var val = store[current];</p><p>                       current++;</p><p>                       return val;</p><p>               }</p><p>               function getValue() {</p><p>                       return store[current];</p><p>               }</p><p>               return { next: next, getValue: getValue, hasNext: hasNext };</p><p>       },</p><p>       type: 'u_GenericSet'</p><p>}</p></pre>