---
title: "A Better Requested Item Attachments Related List"
date: 2015-08-12T10:21:05.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=adfce2a5dbd0dbc01dcaf3231f961934"
---
<p><strong>NOTE:</strong> I've broken this post up into 2 new posts in order to try to keep things cleaner and to the point as this post ended up taking a couple twists and turns:</p><p><a title=""Related Attachments" Related List" __default_attr="5716" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="&quot;Related Attachments&quot; Related List" data-renderedposition="32_8_240_16" href="/community?id=community_blog&sys_id=928c2ae1dbd0dbc01dcaf3231f961927">"Related Attachments" Related List</a></p><p><a title="Improving the Attachments List View" __default_attr="5721" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Improving the Attachments List View" data-renderedposition="53_8_248_16" href="/community?id=community_blog&sys_id=1e5eaaaddbd0dbc01dcaf3231f961939">Improving the Attachments List View</a></p><p><strong style="color: #e23d39;">You may want to read them instead of continuing on with this outdated post. <span __jive_emoticon_name="wink" __jive_macro_name="emoticon" class="jive_macro_emoticon jive_emote jive_macro" data-renderedposition="72_520.515625_16_16" src="/8.0.4.21bdc7e/images/emoticons/wink.png"></span></strong></p><p></p><p>I've been working with a great new client lately and we wanted to show all attachments related to a Requested Item, whether they're on the parent RITM record or on any of the associated Catalog Tasks, all in one place.   I wrote about this previously (<a title="Showing Requested Item Attachments on the Catalog Task Form" __default_attr="2388" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Showing Requested Item Attachments on the Catalog Task Form" data-renderedposition="137_392.265625_425_16" href="/community?id=community_blog&sys_id=8e7d2269dbd0dbc01dcaf3231f9619aa">Showing Requested Item Attachments on the Catalog Task Form</a>), but I thought of a better way to display them.</p><p></p><p>First, we start by adding two Relationship records (System Definition \ Relationships), one for the Requested Item and the other on the Catalog Tasks table:</p><p></p><p><span style="font-family: 'courier new', courier;">Name:                                     All Attachments</span></p><p><span style="font-family: 'courier new', courier;">Applies to table:             Requested Item [sc_req_item]</span></p><p><span style="font-family: 'courier new', courier;">Queries from table:         Attachment [sys_attachment]</span></p><p><span style="font-family: 'courier new', courier;">Query with:</span></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14393568294312629 jive_macro_code jive_text_macro" data-renderedposition="303_8_1192_176" jivemacro_uid="_14393568294312629"><p><span style="font-family: 'courier new', courier;">(function(){</span></p><p>   var queryString = "table_nameINsc_req_item,sc_task^table_sys_idIN" + parent.getValue("sys_id");</p><p>   var gr = new GlideRecord("sc_task");</p><p>   gr.addQuery("request_item", parent.getValue("sys_id"));</p><p>   gr.query();</p><p>   while (gr.next()){</p><p><span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;"> <span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;"> </span></span>queryString += "," + gr.getValue("sys_id");</p><p>   }</p><p>   current.addEncodedQuery(queryString);</p><p>})();</p> </pre><p></p><p></p><p><span style="font-family: 'courier new', courier;">Name:                                     All Attachments</span></p><p style="font-size: 13.3333330154419px;"><span style="font-family: 'courier new', courier;">Applies to table:             Catalog Task [sc_task]</span></p><p style="font-size: 13.3333330154419px;"><span style="font-family: 'courier new', courier;">Queries from table:         Attachment [sys_attachment]</span></p><p style="font-size: 13.3333330154419px;"><span style="font-family: 'courier new', courier;">Query with:</span></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14393568294289347" data-renderedposition="599_8_1192_176" jivemacro_uid="_14393568294289347"><p><span style="font-family: 'courier new', courier;">(function(){</span></p><p>   var queryString = "table_nameINsc_req_item,sc_task^table_sys_idIN" + parent.getValue("request_item");</p><p>   var gr = new GlideRecord("sc_task");</p><p>   gr.addQuery("request_item", parent.getValue("request_item"));</p><p>   gr.query();</p><p>   while (gr.next()){</p><p>       queryString += "," + gr.sys_id.toString()</p><p>   }</p><p>   current.addEncodedQuery(queryString);</p><p>})();</p> </pre><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;">They both get a list of sys_ids for the Requested Item and any child Catalog Task.   If we add the "All Attachments" Related List to the Requested Item and Catalog Task forms, we get the following:</p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><img   alt="ServiceNow.png" class="image-1 jive-image" src="9a050806dbd41344e9737a9e0f96195c.iix" style="height: 170px; width: 620px;"/></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;">It's nice to have all the attachments in one place, but the "Table name" and "Table sys ID" fields are not very useful.   Luckily we can improve on that.</p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;">First, we need to create a new field called "Record" of type <span style="font-size: 13.3333330154419px;">"Document ID" on the Attachment table.   To do this, enter "sys_attachment.list" in the Navigator filter - this will display a list of attachment records.   Then right-click on the list header and select Configure \ Dictionary.   Create a new record with the following settings:</span></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Table:                                     Attachment [sys_attachment]</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Type:                                       Document ID</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Column label:                       Record (or whatever else you prefer)</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Use dependent field:         checked   (you may have to click on the Advanced View Related Link to show these fields)</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;"><span style="font-family: 'courier new', courier;">Dependent on field:           Table name</span><br/></span></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">You can also create the new column with the System Definition \ Tables module.</span></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">Next, we create a Business Rule on the Attachments table to populate that field:</span></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Name:             Custom - Populate Record Field<br/></span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Table:           Attachment [sys_attachment]</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Active:         checked<br/></span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Advanced:     checked</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">When:             before</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Insert:         checked</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Update:         checked<br/></span></p><p><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Condition:   current.table_sys_id.changes()</span></p><p><span style="font-size: 13.3333330154419px; font-family: 'courier new', courier;">Script:</span></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14393568294251250 jive_text_macro" data-renderedposition="1501_8_1192_64" jivemacro_uid="_14393568294251250"><p>function onBefore(current, previous) {</p><p>   current.u_record = current.table_sys_id;</p><p>}</p> </pre><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">The Business Rule simply copies the table_sys_id field into the new one.   Now we can have a useful Related List on the Requested Item and Catalog Task tables by replacing the fields that are displayed (right-click Configure \ List Layout) by removing the <span style="font-size: 13.3333330154419px;">"Table name" and "Table sys ID" fields and adding the new "Record" field</span>:</span></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;"><img   alt="NewAttachments.png" class="image-2 jive-image" src="8e24eb35db941704ed6af3231f9619cb.iix" style="height: 202px; width: 620px;"/></span></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">Now you can see the record the attachment is actually on, and even click on the link to go to that particular record.   The new Record field will be populated when any new attachments are added.   You can run the the following Background Script after hours to populate it on your existing records:</span></p><p style="font-size: 13.3333330154419px;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_1439356829416364" data-renderedposition="1924_8_1192_166" jivemacro_uid="_1439356829416364"><p><span style="color: #343d47; font-family: Arial; font-size: 13px; line-height: 1.5em; background-color: #f5f5f5;">(function() {</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">       var gr = new GlideRecord('sys_attachment');</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">       </span><span style="color: #343d47; font-family: Arial; font-size: 13px; line-height: 1.5em; background-color: #f5f5f5;">gr.autoSysFields(false);</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">       gr.query();</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">       while (gr.next()) {</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">               gr.u_record = gr.table_sys_id;</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">               gr.update();</span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">       } </span></p><p><span style="color: #343d47; font-family: Arial; font-size: 13px; background-color: #f5f5f5;">})();</span></p> </pre><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">Remember, test any script in your development or sandbox instance first.</span></p><p style="font-size: 13.3333330154419px;"></p><p style="font-size: 13.3333330154419px;"><span style="font-size: 13.3333330154419px;">This solution can also be modified for use with the SDLC and PPM applications.<br/></span></p>