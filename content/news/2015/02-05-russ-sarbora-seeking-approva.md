---
title: "Seeking Approval  Part  The Basics and the Approval  User activity"
date: 2015-02-04T20:25:36.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=2f1da2e5dbd0dbc01dcaf3231f961966"
---
<p>Automating an approval process is a common use case for workflow, but can sometimes lead people into difficulties. I thought it would useful to explain how the different approval activities work, and when and how they should be used. Its a big subject, so I expect this will turn into a multi-post series. I&#39;m going to start with some simple examples and digging into the underlying mechanics of how Workflow uses Approvals. But I also want to address issues you&#39;re facing with complicated approval processes, so send me your questions and problems, and I&#39;ll make them the subject of a later post.</p>
<p> </p>
<h3>Approvals and Workflows</h3>
<p>Many people assume that approvals are a feature of workflow, but that&#39;s not actually true. Approvals are an independent part of the product. Workflow integrates with Approvals via several activities that allow authors to incorporate Approvals into their flows. These <span style="font-size: 10pt; line-height: 1.5em;">Approval activities have two jobs:</span></p>
<p>1) create one or more approvals (records in an approval table)</p>
<p>2) aggregate the resolved (approved or rejected) approvals into a final approve/reject decision.</p>
<p> </p>
<p><img class="image-1 jive-image" style="height: 359px; width: 620px;" src="b94dd08adb985304b322f4621f96191a.iix" alt="diagram_1.1.png" /></p>
<p>The diagram attempts to show this in action.   The blue boxes and arrows represent the logic flow of the workflow. When we transition into an Approval activity, the activity creates a set of approval records.This is job #1 and it is now finished. The activity then goes into a wait state. (Technically, it checks for an auto-approve situation first, but we&#39;ll talk about that later in the post).     Notice that there is no blue line coming out of the &#34;wait for an event box&#34;. That&#39;s because the workflow is not</p>
<p>responsible for waking that activity up. As far as workflow is concerned, mission is complete, time to go home for a nap.</p>
<p> </p>
<p>Now notice the sun thingy with the dotted line, those aren&#39;t gray and dotted just because I have limited diagramming skills. They indicate that the event that will wake this activity back up comes from outside of workflow. (Another technical point, its completely legit to fire the event from a different workflow or even another branch of the same workflow, but the point is, something other than this activity needs to do it) Whenever an approval record changes state, the process changing that state is responsible for firing the event that tells workflow to wake up and get back to work. Out-of-the-box, we ship business rules on the approval tables that take care of firing this event for you.</p>
<p> </p>
<p><span style="font-size: 10pt; line-height: 1.5em;">Only after workflow receives its event will it move on to job #2. Here it uses the state of the approvals it cares about to make a final approve/reject decision. If a decision is possible, the activity is complete and the workflow takes the corresponding transition to the next activity. If it can&#39;t, the activity goes back to napping waiting for another wake up call.</span></p>
<p> </p>
<p>When you are designing an approval flow, or troubleshooting one that&#39;s not behaving the way you expected, it&#39;s helpful to keep these two jobs in mind. Is your activity generating the approval records you expect? If not, that&#39;s a workflow problem. Once those records get approved or approved or rejected, is the activity making the final decision that you expected? If not, that&#39;s a workflow problem. But if those records aren&#39;t getting approved or rejected, or the workflow isn&#39;t getting notified that they changed state, that&#39;s not a workflow problem. Find out why that event is not getting sent.</p>
<p> </p>
<p>Now that we understand how Workflow uses Approvals, Let take a look at some approval activities in action, I&#39;ll start with Approval - User.</p>
<p><span style="font-size: 16px; font-weight: bold; line-height: 1.5em;"> </span></p>
<p><span style="font-size: 16px; font-weight: bold; line-height: 1.5em;">Workflow Setup Note</span></p>
<p>When I&#39;m doing stuff like this, I like having a fresh, new table with no existing records, business rules, or other workflows interfering with what I&#39;m working on. So I created a custom table to use for the workflows in this post. Its just a simple extension of the &#34;task&#34; table with no additional columns. I named mine &#34;u_wfapprovals_test&#34;. If you are building your own copy of the workflows in this post, you can either:</p>
<ul><li>create your own custom table</li><li>download and install the update set attached to this post</li><li>use one of the existing task-derived tables</li></ul>
<p>I recommend installing the attached update set. It includes the table, the workflow we&#39;re going to build, and a couple extra goodies that make following along with the post easier.   In the rest of the post, I&#39;m going to assume that you&#39;ve installed this update set.</p>
<p> </p>
<h3>Approval - User : the Swiss Army knife of approval activities</h3>
<p>As I said above, the first part of an Approval activity&#39;s job is to create the approvals. In the case of Approval - User, these will be individual approvals, one for each specified user, each carrying equal weight on the final approval decision.</p>
<p> </p>
<p>Approval - User is extremely versatile, and gives you several ways to identify the users that will get an approval record. The different config options for doing that are <a title="ki.servicenow.com/index.php?title&#61;Approval_and_Rollback_Activities#Approval_-_User" href="http://wiki.servicenow.com/index.php?title&#61;Approval_and_Rollback_Activities#Approval_-_User" rel="nofollow">documented in the wiki</a>, so I&#39;m not going to cover them here. Approval - User even allows you to write scripts to control both identifying what users are going to be asked for approval, as well as the logic for determining the final Approved/Rejected decision. Its also available no matter what table your workflow is running on, in other words, Approval - User can be used to add an approval to anything. This why I called it the Swiss Army knife of approval activities.</p>
<p> </p>
<p>For now, we&#39;re just going to create a very simple scenario in order to understand what happens under the covers in a Workflow Approval activity.   Go into the Workflow Editor, and open the &#34;Seeking Approval - 1. Basic Approval User&#34; workflow. The workflow is very simple, and looks like this.</p>
<p><img class="jive-image image-2" style="height: 233px; width: 620px;" src="1b9f38c2db9097049c9ffb651f96194b.iix" alt="wf_1.1.png" /></p>
<p>The configuration for the Approval - User activity is also very simple, selecting a single approving user. It will be whoever is the Assigned To on the record that starts the workflow.</p>
<p><img class="jive-image image-3" style="height: 319px; width: 620px;" src="8f416002db10dfc068c1fb651f961921.iix" alt="act_1.1.png" /></p>
<p> </p>
<h5>In Action</h5>
<p><span style="font-size: 10pt; line-height: 1.5em;">Now let&#39;s test it out. Create a new u_wfapprovals_test record (if you&#39;ve installed the accompanying update set, you should have a &#34;WF Approvals&#34; application and &#34;WF Approvals Test&#34; module in your left-hand nav). On the form, the only field you need to complete is the Assigned To. I&#39;m going to pick &#34;Fred Luddy&#34;.</span></p>
<p> </p>
<p><img class="image-0 jive-image" style="height: 258px; width: 620px;" src="aa50c90edb901b04ed6af3231f961998.iix" alt="record_1.insert.png" /></p>
<p> </p>
<p><span style="font-size: 10pt; line-height: 1.5em;">After submitting the record, open the workflow execution context that resulted (here&#39;s another UI goodie from the update set, there should be</span><span style="font-size: 10pt; line-height: 1.5em;"> a &#34;Workflow Context&#34; UI Action available in both the form and list views of u_wfapprovals_test. In the List view, the action appears on the context menu that pops up when you right-click on a row of the list. In the Form view, the action will show up as a Related Link at the bottom of the form). Then click &#34;Show Workflow&#34; to open the context diagram view in a new browser tab. You should see something like this:</span></p>
<p> </p>
<p><img class="jive-image image-7" style="height: 271px; width: 620px;" src="54dd7379dbd4d3041dcaf3231f961941.iix" alt="context_1.waiting.png" /></p>
<p>What we&#39;re seeing here is that the workflow has transitioned into the Approval - User activity, and is now waiting for that activity to complete. Remember what I said above? Approval activities do 2 things:</p>
<p>1) identify a list of users that need to approve this record and create approval records for them,</p>
<p>2) as those individual approval records are resolved, accumulate them into a final Approved/Rejected decision.</p>
<p><span style="font-size: 10pt; line-height: 1.5em;"> </span></p>
<p><span style="font-size: 10pt; line-height: 1.5em;">So our activity has completed the first part of its job, creating an approval for the User specified in the activity config (in our case, just Fred Luddy), and is now waiting for that approval to be resolved. To confirm that, go back to the main SNC browser tab and open your test record&#39;s form view. You should have an Approvers related list, and there should be one approval in it, for Fred Luddy, in state&#61;Requested.   </span></p>
<p><span style="font-size: 10pt; line-height: 1.5em;"> </span></p>
<p><span style="font-size: 10pt; line-height: 1.5em;">Let&#39;s give the Approval - User activity what it wants, by approving(or rejecting) Fred&#39;s approval request.   Right-click on the request (or open it in form view), and Approve it. The approval&#39;s state will change to Approved. That change of state will be detected by a business rule on the approval table, which will in turn wake up the workflow and fire an event to the Approval - User activity to tell it to try and make a final decision. Go back to the tab containing the Workflow Context Diagram and </span><span style="font-size: 10pt; line-height: 1.5em;">refresh it. The Approval - User activity should have taken the Approved transition and the workflow will be completed. This is the second part of an Approval activities job - checking the state of its approvals, and when possible, make a final Approved/Rejected determination. </span></p>
<p><span style="font-size: 10pt;"> </span></p>
<h5><img class="jive-image image-8" style="height: 271px; width: 620px;" src="984429c6db50d7049c9ffb651f9619e0.iix" alt="context_1.finished.png" /></h5>
<p>For our simple case, Fred&#39;s approval is all the activity needed to make a final decision. For more complicated scenarios, Approval - User provides two different fields that let you specify how that final decision is made: Wait For, and When Anyone Rejects. These are also <a title="ki.servicenow.com/index.php?title&#61;Approval_and_Rollback_Activities#Approval_-_User" href="http://wiki.servicenow.com/index.php?title&#61;Approval_and_Rollback_Activities#Approval_-_User" rel="nofollow">documented pretty well in the wiki, </a>so I don&#39;t think I need to go into details on them. And if those two don&#39;t meet your needs, you can select the Wait For &#61; Condition based on Script option and provide your own custom approval decision logic.</p>
<p> </p>
<h3>Auto-Approving</h3>
<p>There&#39;s one more topic I want to cover in this post: Auto-approving. Insert another test record (u_wfapprovals_test), but this time leave the Assigned To field blank. Then pull up the Context Diagram for that workflow execution. It will have already completed, with the activity taking the Approved transition, even though it never waited for an approval. What happened?</p>
<p><span style="font-size: 10pt; line-height: 1.5em;"> </span></p>
<p><span style="font-size: 10pt; line-height: 1.5em;">The Approval - User activity in our flow is configured to create an approval for one user, whoever the Assigned To user is on our test record. Because we left that field empty on this particular record, no approval could be generated. You can double-check the Approvals table (sysapproval_approvers) to confirm that there are no requested approvals for our test record. In this situation, the workflow will set the state of the activity to &#34;Skipped&#34;, and the Approval - User activity will take the Approved transition. </span></p>
<p> </p>
<p>This auto-approving behavior occasionally trips new workflow authors up if they aren&#39;t aware of it, but we&#39;ve found it makes sense in most situations. If you have a use case where auto-approving is a problem, there is a fairly simple workaround. Configure the Approval - User activity to generate an approval for a hard-coded user account in addition to whatever &#34;real&#34; approvals you need. This extra approval will sit in state&#61;Requested and won&#39;t affect the final Approved/Rejected decision as long as you don&#39;t select the Wait For Everyone to Approve option in the activity configuration.</p>
<p> </p>
<p>Note: There was a bug fix in the Eureka release that affects this area. As of Eureka, approvals will not be created for inactive Users. In previous releases, as long as there was a matching User account, the approval would be created, even if the user was inactive and therefore unable to act on the approval. We figured that would be bad, so we fixed it. but it could mean that after upgrading to Eureka, new workflow contexts from workflows which would wait on approvals from inactive users pre-Eureka will automatically approve after you upgrade.</p>
<p> </p>
<h3>The End - For Now</h3>
<p>That&#39;s the meat and potatoes of Workflows and Approvals. In the next post I plan to cover the Approval - Group, Manual Approval, and Approval Coordinator activities. I would also like to do a post with some best-practice patterns for handling difficult real-world approval scenarios. So if you have a specific use case you&#39;re struggling with, send it to me.</p>
<p> </p>
<p>See <a title="task approval" href="community?id&#61;community_blog&amp;sys_id&#61;0bcda2e9dbd0dbc01dcaf3231f96198d" target="_blank" rel="nofollow">Seeking Approval - Part 2: Task vs non-Task approvals and the Approval - Group Activity</a> and <a title="manual approvals" href="community?id&#61;community_blog&amp;sys_id&#61;618d6669dbd0dbc01dcaf3231f96192d" target="_blank" rel="nofollow">Seeking Approval - Part 3 : Manual Approvals and Approval Coordinator</a> for more information.</p>