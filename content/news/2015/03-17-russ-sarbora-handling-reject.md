---
title: "Handling Rejection  the rollback activities"
date: 2015-03-16T19:26:34.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b75e2eaddbd0dbc01dcaf3231f96198f"
---
<p>At the end of my Seeking Approval article, I promised one on handling the rejection path of an approval. I was thinking that I would go into detail on how to use a rollback activity and the pitfalls you might encounter with them. But after reading the existing wiki docs on the subject, I don't think that's really necessary. There is already some really good documentation on this topic.</p><ul><li><a href="http://wiki.servicenow.com/index.php?title=Approval_and_Rollback_Activities#Rollback" title="http://wiki.servicenow.com/index.php?title=Approval_and_Rollback_Activities#Rollback">Approval and Rollback Activities - ServiceNow Wiki</a></li><li><a href="http://wiki.servicenow.com/index.php?title=Selecting_a_Rollback_Activity" title="http://wiki.servicenow.com/index.php?title=Selecting_a_Rollback_Activity">Selecting a Rollback Activity - ServiceNow Wiki</a></li><li><a href="http://wiki.servicenow.com/index.php?title=Designing_Workflows_with_Rollback_To" style="font-size: 10pt; line-height: 1.5em;" title="http://wiki.servicenow.com/index.php?title=Designing_Workflows_with_Rollback_To">Designing Workflows with Rollback To - ServiceNow Wiki</a></li><li><a href="https://hi.service-now.com/kb_view_customer.do?sysparm_article=KB0538562&amp;sysparm_ck=d75cf3466f723500e7f68e4c2c3ee4ab3b63bff3f0855acaf6503ee19f78d80e7d7473aa&amp;sysparm_nameofstack=&amp;sysparm_search=rollback&amp;sysparm_topic=&amp;uri=kb_view.do%3Fsysparm_article%3DKB0541991" title="https://hi.service-now.com/kb_view_customer.do?sysparm_article=KB0538562&amp;sysparm_ck=d75cf3466f723500e7f68e4c2c3ee4ab3b63bff3f0855acaf6503ee19f78d80e7d7473aa&amp;sysparm_nameofstack=&amp;sysparm_search=rollback&amp;sysparm_topic=&amp;uri=kb_view.do%3Fsysparm_article%3DKB0541991">ServiceNow KB: Workflow: Roll back approvals (KB0538562)</a></li></ul><p></p><p>If you clicked through those links, your head may be about to explode, because they are loaded with information. As I read those articles, it occurred to me that instead of instead of duplicating them, I should try to create a quick introduction on the basics of rollback, and how the activities work, so that when you do read those docs, you're a little more prepared and hopefully they make more sense.</p><p></p><h3>What's a rollback?</h3><p>The idea behind rollback is that sometimes a workflow needs a do-over on a section. Frequently this is because of an approval being rejected, but really, any situation where a workflow needs to a chance to recover and get back on track may use a rollback.</p><p></p><p>Hopefully this is obvious, but a rollback is not fairy dust that can magically un-send emails, un-run destructive scripts, and restart production servers that your Orchestration workflow has shut down. Rolling back is a process that is intended to work with Approvals and Tasks. Rolling back an approval or task activity will reset the records associated with those activities so that the workflow can execute those activities again.   With other types of activities, the rollback will cancel them if they are still executing, otherwise it doesn't do anything. Undoing the work of those other activities is the responsibility of the workflow author.</p><p></p><h3>Rollback vs Rollback To</h3><p>Prior to Eureka, Workflow offered two flavors of "rollback" activity. Rollback and Rollback To. They both do the same work when rolling back a specific activity, namely resetting approval and task activities. The interesting difference between them is in how they determine what activities will be rolled back.</p><p></p><h5>Rollback</h5><p>The legacy Rollback activity was based on execution order, it would roll back all activities that executed between itself and the activity it transitions to. Here's what I mean:</p><p><img   alt="wf_rollback.png" class="image-0 jive-image" src="4c10a775db185b048c8ef4621f96191c.iix" style="height: 248px; width: 620px;"/></p><p></p><p>When this flow starts, its going to run Create Task Activity 'A' and Create Task Activity 'B'. Let's assume that Task A gets completed and the resulting Approval User - 'C' gets rejected. The workflow now hits the Rollback activity, which transitions back to Create Task 'A'.   At this point the execution order of activities in the flow looks like this:</p><p><img   alt="exec_order_1.png" class="image-1 jive-image" height="78" src="c3dac10adbd0d344e9737a9e0f9619fd.iix" style="display: block; margin-left: auto; margin-right: auto;" width="219"/></p><p>The Rollback activity will rollback everything in that execution order between itself (D) and its transition target (A). In this case, A, B, and C get rolled back.</p><p></p><p>There are 2 problems with that, the first being that the Create Task 'B' gets rolled back. A case can definitely be made for that being unexpected behavior. Create Task 'B' is on a separate branch, so Rollback D affecting it surprises a lot of people. It also makes authoring flows using rollback more difficult. See the wiki articles for more details.</p><p></p><p>The second problem here is more subtle. Look at the two Create Task activities again. They have no guarantee of execution order. Its just as likely that the execution order could be:</p><p style="text-align: center;"><img   alt="exec_order_2.png" class="jive-image image-2" height="70" src="eca26446db105f048c8ef4621f9619f2.iix" width="219"/></p><p>With this second, equally valid, execution order, Create Task 'B' will not get rolled back, because it is not between A and D in the execution order. Same workflow design, different behavior. That's not ideal, and its why we added the Rollback To activity in the Aspen release.</p><p></p><h5>RollbackTo</h5><p>Rollback To is much more deterministic. It rolls back activities that are on the transition path between itself and the activity it transitions to. In other words, Rollback To is based on how you've drawn the workflow, not how the engine executes the workflow. In workflow above, imagine we swap the Rollback activity out and put in a Rollback To. The flow still has the same two potential execution orders (ABCD or BACD). However, <span style="font-size: 10pt; line-height: 1.5em;">with either of the them, the transition path between our Rollback To and Create Task 'A' is:</span></p><p><img   alt="transition path.png" class="image-1 jive-image" height="65" src="d9c144c6dbd4db048c8ef4621f96197c.iix" style="height: 65.4961832061069px; width: 156px; display: block; margin-left: auto; margin-right: auto;" width="156"/></p><p>As part of a separate branch, Create Task 'B' is never involved in that path and doesn't get rolled back.</p><p></p><p>So that's the fundamental difference between Rollback and Rollback To. There are a couple other differences:</p><ol><li>Rollback only works in workflows running on tables derived from Task - Rollback To is available to any workflow.</li><li>Rollback is deprecated as of Eureka. - I probably could have mentioned this earlier in the article and saved you a lot of reading. But there are still a lot of workflows out there that use the Rollback activity, so I thought it would useful to explain the difference between the two activities. If you do have a workflow that is currently using Rollback, there's no need to panic. The activity will continue to work. We aren't taking out runtime support for it, we just disabled the ability to add it into new workflows.</li></ol><p><span style="font-size: 10pt; line-height: 1.5em;"><br/></span></p><h3><span style="font-size: 10pt; line-height: 1.5em;">See the Wiki</span></h3><p>As I said at the top of this post, the wiki has excellent documentation on the Rollback activities, including an article that shows some recommended authoring patterns for workflows with rollbacks. If you're working on a complex approval scenario, they are definitely worth reading. Hopefully, after reading this, you'll get a little more out of them.<span style="font-size: 10pt; line-height: 1.5em;"> </span></p>