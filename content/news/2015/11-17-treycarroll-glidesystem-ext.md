---
title: "GlideSystem extension getUser"
date: 2015-11-17T00:06:04.000Z
authors: ["treycarroll"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=852d26e5dbd0dbc01dcaf3231f961992"
---
<p>As ServiceNow developers, if we need a handle to a user record and don't want to perform a GlideRecord query, we have used the getUser() method on the GlideSystem class via the global 'gs' variable.     This works well, usually, but I want it to work slightly differently.</p><p></p><p>For reference, here is a link to the wiki article on <a href="http://wiki.servicenow.com/index.php?title=Getting_a_User_Object#gsc.tab=0" title="http://wiki.servicenow.com/index.php?title=Getting_a_User_Object#gsc.tab=0">Getting a User Object - ServiceNow Wiki</a></p><p></p><p>If I do a simple getUser() to get the current user's sys_user record, I have access to some of the user's properties.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14476875746378447" data-renderedposition="159.1999969482422_8_1193_48" jivemacro_uid="_14476875746378447"><p>var currentUser = gs.getUser(); </p><p>var email = currentUser.email;</p><p>gs.print(email);</p></pre><p></p><p>However, the OOTB getUser() doesn't support custom fields that you have added to the sys_user table.   We have added a u_start_date field to sys_user on our instance.     If I try to retrieve it with getUser(), this happens:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14476877379307966 jive_macro_code jive_text_macro" data-renderedposition="293.6000061035156_8_1193_48" jivemacro_uid="_14476877379307966"><p>var currentUser = gs.getUser(); </p><p>var startDate = currentUser.u_start_date;</p><p>gs.print(startDate);</p></pre><p></p><p><img   class="image-1 jive-image" src="f35a9586db9c9f048c8ef4621f961968.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p>Strangely, if you want to retrieve a user other than the current user you have to first retrieve the current user.     Then you can use that current user object to access the getUserByID() method.<span class="br0" style="color: #009900;"></span></p><p></p><p>Pasting in the code from the wiki article to see how we would get the first name of the current user and a different user.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14476879423174897 jive_macro_code jive_text_macro" data-renderedposition="596_8_1193_64" jivemacro_uid="_14476879423174897"><p>var ourUser = gs.getUser(); </p><p>gs. ­print( ­ourUser. ­getFirstName()); //should print out the first name of the user you are currently logged in as </p><p>ourUser = ourUser. ­getUserByID( ­'abel.tuter'); //fetched a different user, using the user_name field or sys_id on the target user record. </p><p>gs. ­print( ­ourUser. ­getFirstName()); //this should be the first name of the user you fetched above </p></pre><p></p><p>You can use both of these objects to access some of the user properties</p><p></p><p>These work:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14476966839157358" data-renderedposition="746.4000244140625_8_1193_176" jivemacro_uid="_14476966839157358"><p>var ourUser = gs.getUser('JSMITH1'); </p><p>gs.print(ourUser.fullName);</p><p>gs.print(ourUser.lastName);//doesn't match sys_user field name</p><p>gs.print(ourUser.name);</p><p>gs.print(ourUser.email);</p><p>gs.print(ourUser.displayName);</p><p>gs.print(ourUser.title);</p><p>gs.print(ourUser.companyID);</p><p>gs.print(ourUser.departmentID);</p><p>gs.print(ourUser.managerName);</p><p>gs.print(ourUser.managerID);</p></pre><p></p><p>These fail:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1447696944791739 jive_text_macro" data-renderedposition="965.6000366210938_8_1193_64" jivemacro_uid="_1447696944791739"><p>var ourUser = gs.getUser('JSMITH1'); </p><p>gs.print(ourUser.last_name);</p><p>gs.print(ourUser.isLockedOut);</p><p>gs.print(ourUser.isActive);</p></pre><p></p><p>So the available properties are really sort of a "crap shoot".</p><p></p><p>You can dependably get user information for a user using these documented methods:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14476885626899033 jive_text_macro" data-renderedposition="1137.5999755859375_8_1193_288" jivemacro_uid="_14476885626899033"><p>myUserObject.getFirstName() -- returns first name of current user</p><p>myUserObject.getLastName() -- returns the last name of the current user</p><p>myUserObject.getFullName() -- returns the current user's full name</p><p>myUserObject.getDisplayName() -- returns the current user's display name, typically the same as full name</p><p>myUserObject.getEmail() -- returns the email address of the current user</p><p>myUserObject.getMobileNumber() — returns the mobile number of the current user</p><p>myUserObject.getDepartmentID() -- returns the sys_id of the current user's department</p><p>myUserObject.getCompanyID() -- returns the sys_id of the current user's company</p><p>myUserObject.getCompanyRecord() -- returns the current user's company GlideRecord</p><p>myUserObject.getLanguage() -- returns the current user's language</p><p>myUserObject.getLocation() -- returns the current user's location</p><p>myUserObject.getCountry() -- returns the current user's country</p><p>myUserObject.getManagerName() -- returns the full name of the current user's manager</p><p>myUserObject.getManagerID() -- returns the sys_id of the current user's manager</p><p>myUserObject.getDomainID() -- returns the domain ID of the current user</p><p>myUserObject.getDomainDisplayValue() -- returns the domain display value for the current user</p><p>myUserObject.getTZ() -- returns the timezone of the current user</p><p>myUserObject.getUserRoles() -- returns the roles explicitly granted to the current user</p></pre><p></p><p>That small list of properties is useful, but use-cases often arise outside of this subset, forcing us to perform a GlideRecord query on the sys_user table to get what we need.</p><p></p><p>So here is my list of things about getUser() that I feel need improvement:</p><ul><li>It feels awkward to have to get the current user in order to get a different user.</li><li>I really don't like be restricted to using only a small subset of sys_user's properties.</li><li>The getMyGroups() method name seems like a strange choice.</li><li>The fact that I can use .email, but not things like .last_name, is tempting and likely to lead to bugs, as I fail to properly remember which properties are available and which ones aren't.</li></ul><p></p><p>Now let's not throw the baby out with the bath water.   The getUser() method is a great idea.   And I absolutely love the isMemberOf() method that it provides.   But I want to tweak it slightly.</p><p></p><p>Here is my suggestion:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14476926613406772" data-renderedposition="1720.4000244140625_8_1193_1280" jivemacro_uid="_14476926613406772" modifiedtitle="true"><p>GlideSystem.prototype.getUser2 = function (user) {</p><p></p><p>       var usr;</p><p>       var grUser = new GlideRecord('sys_user');</p><p>       if (/current/i.test(arguments[0]) || arguments[0] == undefined) {</p><p>               grUser.addQuery('sys_id', new GlideSystem().getUserID() );</p><p>       } else {</p><p>               //select by sys_id, user_name or email.     Ensure that email is unique in your instance or remove it.</p><p>               grUser.addEncodedQuery('sys_id=' + arguments[0] + '^ORuser_name=' + arguments[0] + '^ORemail=' + arguments[0]);</p><p>       }       </p><p>       grUser.query();</p><p></p><p>       if ( grUser.next() ) {</p><p>               usr = grUser;</p><p>       } else {</p><p>               return null;</p><p>       }</p><p>       </p><p>       //Returns comma separated list of group ids</p><p>       usr.getGroups = function () {</p><p>               //Use an object key strategy to list group ids and remove duplicates</p><p>               var grps = [];</p><p>               var grGrpMember = new GlideRecord('sys_user_grmember');</p><p>               grGrpMember.addQuery('user', usr.sys_id);</p><p>               grGrpMember.query();</p><p></p><p>               while (grGrpMember.next()) {</p><p>                       grps.push(grGrpMember.group.sys_id.toString());</p><p>               }</p><p>                               </p><p>               return grps.toString();</p><p>       };</p><p>       </p><p>       //Returns comma separated list of role ids with duplicates removed</p><p>       usr.getRoles = function () {</p><p>               //Use an object key strategy to list group ids and remove duplicates</p><p>               var grps = {};</p><p>               var grGetRoles = new GlideRecord('sys_user_has_role');</p><p>               grGetRoles.addQuery('user', usr.sys_id);</p><p>               grGetRoles.query();</p><p></p><p>               while (grGetRoles.next()) {</p><p>                       grps[grGetRoles.role.sys_id.toString()] = true;</p><p>               }</p><p>               var ret = '';</p><p>               for (var k in grps) {</p><p>                       ret += k + ',';</p><p>               }</p><p>               ret = ret.slice(0, -1);//remove last comma</p><p>               return ret;</p><p>       };</p><p></p><p>       //Accepts group id or name</p><p>       usr.isMemberOf = function (group) {</p><p>               var grIsMember = new GlideRecord('sys_user_grmember');</p><p>               grIsMember.addQuery('user', usr.sys_id);</p><p>               var orHandle = grIsMember.addQuery('group.name', group);//passed group name</p><p>               orHandle.addOrCondition('group',group);//passed sys_id</p><p>               grIsMember.query();</p><p>               if (grIsMember.next()) {</p><p>                       return true;</p><p>               }</p><p>               return false;</p><p>       };</p><p></p><p>       //Accepts role id or name</p><p>       usr.hasRole = function (role) {</p><p>               var grHasRole = new GlideRecord('sys_user_has_role');</p><p>               grHasRole.addQuery('user', usr.sys_id);</p><p>               var orHandle = grHasRole.addQuery('role.name', role);//passed group name</p><p>               orHandle.addOrCondition('role', role);//passed sys_id</p><p>               grHasRole.query();</p><p>               if (grHasRole.next()) {</p><p>                       return true;</p><p>               }</p><p>               return false;</p><p>       };</p><p></p><p>       return usr;</p><p>}</p></pre><p></p><p><span style="line-height: 1.5;">The getUser2() method allows us to get the current user like this:</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14476897608202616 jive_text_macro" data-renderedposition="3065.199951171875_8_1193_16" jivemacro_uid="_14476897608202616"><p>var currentUser = gs.getUser2('current');</p></pre><p>OR</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14476897468571677 jive_text_macro" data-renderedposition="3102.800048828125_8_1193_16" jivemacro_uid="_14476897468571677"><p>var currentUser = gs.getUser2();</p></pre><p></p><p>But we can also go straight for a different user without first going through the unnecessary step of getting the current user:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14476898356872008 jive_macro_code jive_text_macro" data-renderedposition="3183.60009765625_8_1193_16" jivemacro_uid="_14476898356872008"><p>var otherUser = gs.getUser2('JSMITH1');</p></pre><p></p><p>To get a comma separated list of the user's groups:</p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14476902820189851 jive_macro_code jive_text_macro" data-renderedposition="3242.800048828125_8_1193_16" jivemacro_uid="_14476902820189851"><p>var usersGroups = <span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">otherUser</span>.getGroups(); //This stores a comma separated list of group sys_ids in a string.</p></pre><p></p><p>This could occasionally be helpful, but we are likely more often going to be checking to see if the user is a member of a particular group.</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14476930586665931" data-renderedposition="3302_8_1193_48" jivemacro_uid="_14476930586665931"><p>if(gs.getUser2().isMemberOf('SNOW Dev')){</p><p>       gs.print('User is member of SN Dev Group');</p><p>}</p></pre><p></p><p>To get a comma separated list of the user's roles (without duplicates):</p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14476931189332735 jive_macro_code jive_text_macro" data-renderedposition="3393.199951171875_8_1193_16" jivemacro_uid="_14476931189332735"><p>var usersRoles = gs.getUser2().getRoles(); //This stores a comma separated list of role sys_ids in a string.</p></pre><p></p><p>To check to see if a retrieved user has a give role:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1447693235943307 jive_text_macro" data-renderedposition="3452.400146484375_8_1193_16" jivemacro_uid="_1447693235943307"><p>var hasRole = gs.getUser2('JSMITH1').hasRole('admin'); //returns true if JSMITH1 has the admin role</p></pre><p></p><p>The advantages of using getUser2():</p><ul><li>You don't have to get the current user before getting the user you really want.   (Single step instead of two-step process.)</li><li>You can get to any property on the sys_user table, even custom properties you have added to the dictionary entry for the table.</li></ul>