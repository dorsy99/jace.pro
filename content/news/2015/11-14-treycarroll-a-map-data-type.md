---
title: "A Map Data Type for ServiceNow"
date: 2015-11-14T01:23:31.000Z
authors: ["treycarroll"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=e31da2e5dbd0dbc01dcaf3231f96195e"
---
<p>After blogging my proposed u_GenericSet data type class a couple of days ago, I got the idea to finish out the thought with a post on a u_GenericMap data type.</p><p></p><p>I frequently use Javascript objects as a "poor man's" <span style="color: #666666; font-family: arial, sans-serif;">Dictionary/Associative Array/HashMap.   For brevity, I'm just going to refer to the structure as a Map.</span></p><p></p><p><span style="color: #666666; font-family: arial, sans-serif;">This data type aggregates a list of key / value pairs.     It is probably one of the most intuitive data types to work with, and is very powerful.</span></p><p></p><p style="font-family: arial, sans-serif; color: #666666;">We can use Javascript objects to<span style="font-weight: inherit; font-style: inherit; font-family: inherit;"> create a Map.</span></p><p style="font-family: arial, sans-serif; color: #666666;"></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14474428825136766 jive_text_macro" data-renderedposition="167.9971466064453_7.997159004211426_1078_93" jivemacro_uid="_14474428825136766"><p>var map = {}; </p><p>map['AK'] = 1; </p><p>map['TX'] = 2; </p><p>map['CA'] = 3; </p><p>var texasRank = map['TX']; </p><p>gs.print('When it comes to square feet, Texas is #'+ texasRank);</p></pre><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-family: arial, sans-serif; color: #666666;"><span style="line-height: 1.5;">This actually works very well.   It does exactly what we want to do with it, and there is no cognitive dissonance coming from improper accessors. </span><span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="280.72442626953125_907.0880126953125_16_16" src="/8.0.1.35b65d4/images/emoticons/happy.png"></span><span style="line-height: 1.5;">   Of course, nothing is preventing us from doing something distinctly un-map-like like this</span></p><p></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14474413535102269" data-renderedposition="361.6335144042969_7.997159004211426_1078_15" jivemacro_uid="_14474413535102269"><span style="font-family: arial, sans-serif; color: #666666;">map['XX'] = {notLikeTheOthers:[1,2,3]};//What?   I thought that we were using string keys mapped to numeric values!   </span></pre><p></p><p></p><p>If only there was a way to ensure that the key and value were of a type that was consistent with the intent of the data structure...</p><p></p><p>Meet u_GenericMap:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14486832170016974" data-renderedposition="497.0880432128906_7.997159004211426_1078_2859" jivemacro_uid="_14486832170016974" modifiedtitle="true"><p>var u_GenericMap = Class.create();   </p><p>u_GenericMap.prototype = {   </p><p>           </p><p>       //Constructor.       </p><p>       //@param map is optional.   If provided, it must be of type u_GenericMap and its elements will be put() into the new Map.   </p><p>       initialize: function (keyType, valType, map) {   </p><p>   </p><p>               if (keyType == undefined || keyType == null || keyType == '') {   </p><p>                       throw "Mandatory constructor parameter 'keyType' was omitted when constructing object of type u_GenericMap";   </p><p>               }   </p><p>   </p><p>               if (!/^(number|string|object|boolean)$/i.test(keyType)) {   </p><p>                       throw "Constructor parameter 'keyType' must be number|string|object|boolean when constructing object of type u_GenericMap";   </p><p>               }   </p><p>   </p><p>               if (valType == undefined || valType == null || valType == '') {   </p><p>                       throw "Mandatory constructor parameter 'valType' was omitted when constructing object of type u_GenericMap";   </p><p>               }   </p><p>   </p><p>   </p><p>               if (!/^(number|string|object|boolean)$/i.test(valType)) {   </p><p>                       throw "Constructor parameter 'valType' must be number|string|object|boolean when constructing object of type u_GenericMap";   </p><p>               }   </p><p>   </p><p>               this.keyType = keyType.toLowerCase();   </p><p>               this.valType = valType.toLowerCase();   </p><p>               this.obj = {};   </p><p>               this.length = 0;   </p><p>   </p><p>               if (map &amp;&amp; map.type == 'u_GenericMap') {   </p><p>                       var iterator = map.getIterator();   </p><p>                       while (iterator.next()) {   </p><p>                               this.obj[iterator.getCurrent().key] = iterator.getCurrent().value;   </p><p>                       }   </p><p>               }   </p><p>       },   </p><p>           </p><p>       //Adds an element to the map using he key/value params   </p><p>       put: function (key, val) {   </p><p>   </p><p>               var passedKeyType = (typeof key).toLowerCase();   </p><p>               var passedValType = (typeof val).toLowerCase();   </p><p>   </p><p>               if (passedKeyType != this.keyType) {   </p><p>                       throw "u_GenericMap was constructed to contain only keys of type:" + this.keyType + " Attempted to put element using key of type:" + passedKeyType;   </p><p>               }   </p><p>   </p><p>               if (passedValType != this.valType) {   </p><p>                       throw "u_GenericMap was constructed to contain only values of type:" + this.valType + " Attempted to put value of type:" + passedValType;   </p><p>               }                 </p><p>   </p><p>               this.length++;   </p><p>               this.obj[key] = val;   </p><p>       },   </p><p>   </p><p>       //Returns true if the map contains this key   </p><p>       containsKey: function (key) {   </p><p>   </p><p>               var passedKeyType = (typeof key).toLowerCase();   </p><p>   </p><p>               if (passedKeyType != this.keyType) {   </p><p>                       throw "u_GenericMap was constructed to contain only keys of type:" + this.keyType + " Attempted to call containsKey with parameter of type:" + passedKeyType;   </p><p>               }   </p><p>   </p><p>               return this.obj.hasOwnProperty(key) ;   </p><p>       },   </p><p>   </p><p>       //Returns undefined if the key does not exist, otherwise returns the associated value   </p><p>       getValue: function (key) {   </p><p>   </p><p>               var passedKeyType = (typeof key).toLowerCase();   </p><p>   </p><p>               if (passedKeyType != this.keyType) {   </p><p>                       throw "u_GenericMap was constructed to contain only keys of type:" + this.keyType + " Attempted to call getValue with parameter of type:" + passedKeyType;   </p><p>               }   </p><p>   </p><p>               return this.obj[key];   </p><p>       },   </p><p>   </p><p>       //Remove an element at a key   </p><p>       remove: function (key) {   </p><p>   </p><p>               var passedKeyType = (typeof key).toLowerCase();   </p><p>   </p><p>               if (passedKeyType != this.keyType) {   </p><p>                       throw "u_GenericMap was constructed to contain only keys of type:" + this.keyType + " Attempted to call remove with parameter of type:" + passedKeyType;   </p><p>               }   </p><p>   </p><p>               if (!this.obj.hasOwnProperty(key)) {   </p><p>                       return false;   </p><p>               }   </p><p>   </p><p>               this.length--;   </p><p>               delete this.obj[key];   </p><p>   </p><p>               return true;   </p><p>       },   </p><p>   </p><p>       //Returns the size of the structure   </p><p>       size: function () { return this.length; },   </p><p>   </p><p>       //Determines if map is empty   </p><p>       isEmpty: function () {   </p><p>               return this.length == 0;   </p><p>       },   </p><p>   </p><p>       //Purge all elements   </p><p>       purgeAll: function () {   </p><p>               this.length = 0;   </p><p>               this.obj = {};   </p><p>       },   </p><p>   </p><p>       //Returns a JSON encoded string representation of the map   </p><p>       toString: function () {   </p><p>               try {//try client first.   This will throw if executing on the server   </p><p>                       if (window) {   </p><p>                               return JSON.stringify(this.obj);   </p><p>                       }   </p><p>               } catch (e) {//Server side   </p><p>                       try {   </p><p>                               return new JSON().encode(this.obj);   </p><p>                       } catch (e) {   </p><p>                               throw "u_GenericMap-&gt;toString() Error:" + e.message;   </p><p>                       }   </p><p>               }   </p><p>       },   </p><p>   </p><p>       //Returns an array of the keys   </p><p>       getKeys: function () {   </p><p>               var keys = [];   </p><p>               for (var k in this.obj) {   </p><p>                       keys.push(k);   </p><p>               }   </p><p>               return keys;   </p><p>       },   </p><p>   </p><p>       //Returns an array of the values   </p><p>       getValues: function () {   </p><p>               var vals = [];   </p><p>               for (var k in this.obj) {   </p><p>                       vals.push(this.obj[k]);   </p><p>               }   </p><p>               return vals;   </p><p>       },   </p><p>   </p><p>       //Returns an iterator with functions for next(), hasNext() and getCurrent().   getCurrent() returns an obj with keys: key, value   </p><p>       getIterator: function () {   </p><p>   </p><p>               var store = [];   </p><p>               var currentVal;   </p><p>               var currentIndex;   </p><p>                   </p><p>               for (var k in this.obj) {   </p><p>                       store.push({ 'key': k, 'value': this.obj[k] });   </p><p>               }   </p><p>               currentIndex = 0;                   </p><p>   </p><p>               //sets var "currentVal", returns true if there are more elements, false otherwise   </p><p>               function hasNext() {   </p><p>                       if (currentIndex &lt; store.length) {   </p><p>                               currentVal = store[currentIndex];   </p><p>                               return true;   </p><p>                       } else {   </p><p>                               return false;   </p><p>                       }   </p><p>               }   </p><p>   </p><p>               //Returns the currentValue, set the var "currentVal", increments the internal index   </p><p>               function next() {   </p><p>                       currentVal = store[currentIndex];   </p><p>                       return store[currentIndex++];   </p><p>               }   </p><p>   </p><p>               //Returns an object with keys: key, value   </p><p>               function getCurrent() {   </p><p>                       return currentVal;   </p><p>               }   </p><p>               return { next: next, getCurrent: getCurrent, hasNext: hasNext };   </p><p>       },   </p><p>       type: 'u_GenericMap'   </p><p>}</p></pre><p>You can use this class on both the client and server.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14474420873945751 jive_text_macro" data-renderedposition="3396.178955078125_7.997159004211426_1078_139" jivemacro_uid="_14474420873945751"><p>var m = new u_GenericMap('string', 'string');</p><p>m.put('Washington','1789');</p><p>m.put('Adams', '1797');</p><p>m.put('Jefferson','1801');</p><p></p><p>var it = m.getIterator();</p><p>while(it.next()){       </p><p>     gs.print(it.getCurrent().key+ ':' +       it.getCurrent().value);//gs.print only works on the server, but alert will work on the client</p><p>}</p></pre>