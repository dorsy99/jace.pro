---
title: "The special agent of ServiceNow MID Server"
date: 2015-09-29T18:08:49.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=0f9caee1dbd0dbc01dcaf3231f9619d8"
---
<p>One of the most powerful features of ServiceNow is the <a title="ki.servicenow.com/index.php?title=Discovery#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Discovery#gsc.tab=0">Discovery plugin</a> and <a title="ki.servicenow.com/index.php?title=Orchestration#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Orchestration#gsc.tab=0">Orchestration plugin</a>. With these plugins, you can discover CIs and automate things within your network when you <a title="ki.servicenow.com/index.php?title=MID_Server_Installation#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=MID_Server_Installation#gsc.tab=0">install the MID Server</a>.</p><p></p><p>Discovery and Orchestration are magical features. Once you set them up properly, they work like a charm. If you would like to keep the magic alive, maybe you could imagine that we use Minions in our systems. You may skip this blog because it would destroy your fantasy <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="92_547.640625_16_16" src="/8.0.1.35b65d4/images/emoticons/happy.png"></span> (Or you could read it until the end anyway).</p><p></p><p></p><h2>The MID Server in the agentless architecture</h2><p>The Management, Instrumentation and Discovery (MID) Server is a Java application that sits in your local network and runs as a Windows service or <a title="ki.servicenow.com/index.php?title=Discovery_Application_Mapping_for_UNIX#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Discovery_Application_Mapping_for_UNIX#gsc.tab=0">UNIX </a>daemon within your network. Based on the configuration that you set for the MID Server, it connects to your ServiceNow instance via https with the specified username and password. There is no way for an external source to initiate a communication with the MID Server. The MID Server initiates the connection to the ServiceNow instance via https. There is no need to open or tunnel any other external ports to the MID Server and your network can remain safe within your firewall.</p><p></p><p>Traditionally, client/server architecture requires network to open and expose certain specials dedicated ports to the services. Exposing external open ports pose a risk and can be a nightmare for network administrators.</p><p></p><p><img   alt="MIDServer_Communications.jpg" class="image-1 jive-image" src="262c11c2db5c1b04ed6af3231f9619d4.iix" style="height: 393px; width: 620px; display: block; margin-left: auto; margin-right: auto;"/></p><h2></h2><h2>The role of MID Server in the activity flow</h2><p>During a discovery activity or orchestration activity, the following sequence of events happen:</p><ol><li>Probe Process<ol style="list-style-type: lower-alpha;"><li>The Probe Process creates a new record to ECC Queues table (where the "queue" field is "output")</li></ol></li><li>MID Server process<br/>(The MID Server regularly polls the ECC queue on the ServiceNow instance)<ol style="list-style-type: lower-alpha;"><li>MID Server picks up the record from ECC Queues table (where the "queue" field is "output")</li><li>MID Server process the ECC record</li><li>MID Server executes the commands from the internal network.</li><li>MID Server receive the result from the execution of the command</li><li>MID Server constructs a new ECC record</li><li>MID Server writes the new ECC record back to the ECC Queues table (where the "queue" field is "input")</li></ol></li><li>Sensor Process<ol style="list-style-type: lower-alpha;"><li>The Sensor Process picks up the new ECC record from the ECC Queues table (where the "queue" field is "input")</li><li>The Sensor Process process the new ECC record.</li></ol></li></ol><p></p><p>Here is an example of the orchestration activity flow:</p><p><img   alt="Orchestration_Flow.jpg" class="image-0 jive-image" src="4d551402db189fc068c1fb651f961993.iix" style="height: 60px; width: 620px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p></p><p><span style="font-size: 12pt;"><strong>ECC Queue</strong></span></p><p>The key component between the probe/sensor process and the MID server is the ECC queue.</p><p></p><p>Generally, the ECC Queue table is the holding place where different components of ServiceNow communicates with each other. The ECC Queue table is also used for internal Event Management. <span style="font-size: 10pt; line-height: 1.5em;">For MID Server services (which uses the probe and sensor process), the ECC Queue table can be understood as the communication channel between ServiceNow instance and the MID Server.</span></p><p></p><table border="1"><tbody><tr><td><p>Example of the two ECC Queue records that interacts with the MID Server.</p><p></p><p>a) Output queue: the record with "Queue" field that shows "output", are ECC records for MID Server to pick up for execution.</p><p>b) Input queue: the record with "Queue" field that shows "input" is written by the MID Server after it finishes processing.</p><center><p><img   alt="ECC_Queue.jpg" class="image-2 jive-image" src="761930cadbd097041dcaf3231f96194a.iix" style="height: 204px; width: 620px; display: block; margin-center: auto;"/></p></center></td></tr></tbody></table><p></p><p></p><h2>MID Server services</h2><p>A number of services are built on top of MID Server. Discovery and Orchestration are two of the main ones. <a title="ki.servicenow.com/index.php?title=JDBCProbe#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=JDBCProbe#gsc.tab=0">JDBC probes</a> and <a title="ki.servicenow.com/index.php?title=Scheduling_Data_Imports#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Scheduling_Data_Imports#gsc.tab=0">Scheduled Imports</a> also uses the MID Server services via the Probe and Sensor process. Hence the understanding of how MID Server works, is useful in design consideration and enable you to <a title="i.service-now.com/kb_view.do?sysparm_article=KB0535180" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0535180">troubleshoot most issues resulting from using the MID Server.</a></p><p></p><p><span style="font-size: 12pt;"><strong>Limitations and design considerations</strong></span></p><p>Just as much as we would like everything to be done immediately, there are just some MID Server limitations we must consider.</p><ul><li><strong>The discovery and orchestration activities are not designed for real time.</strong> <br/>Based on the design, there could be a number of delay along the process. There are also polling and parsing time between the instructions. Hence a split second instruction at the MID Server could take up to two seconds depending on network, I/O, CPU processing power between the ServiceNow instance and the MID Server.</li><li><strong>The commands to be executed by the MID Server should not take too long.</strong> <br/>If the commands to be executed by the MID Server takes too long, the MID Server might get hogged up and this could be a bottleneck performance issue.</li><li><strong>The results from the execution from the MID Server should not be too long.</strong> <br/>If the results are too big, this could also cause performance bottleneck at the MID Server and ServiceNow processing.</li></ul><p></p><p><span style="font-size: 12pt;"><strong>Troubleshooting the MID Server</strong></span></p><p>The MID Server process goes through a few stages and as a result there are some opportunities for things to go wrong. If there were to be any issues with services using the MID Server, you could analyze the various stages to isolate where the issue is.</p><p></p><p>You could check the ECC Queue table for the respective records.</p><ul><li>Check the "state" and "processed" field of the ECC record on the output queue to see if it has been processed. You can also compare the difference between the "created" field and the "processed" field to see how long it actually takes to be processed.</li><li>If there are a lot of ECC Â  records on the output queue in ready state, maybe the MID Server is overloaded or overwhelmed.</li><li>If there are a lot of ECC records on the input queue in ready state, maybe the ServiceNow instance is not able to process the messages fast enough.</li><li>You could also open the respective ECC record and review the XML of the payload. By looking at the ECC record on the input queue, we can see the actual results that comes back from the MID Server processing before the sensor process processes them. This is useful to isolate whether there is an issue with the MID Server processing or an error in the sensor script.</li></ul><p></p><p>Here is an example of the XML payload result from an orchestration activity for PowerShell to Get-Date:</p><p><img   alt="XML_View.jpg" class="image-3 jive-image" src="b868948edbd817041dcaf3231f9619ae.iix" style="height: 588px; width: 620px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p><span style="font-size: 12pt;"><strong>Fantasy Busters</strong></span></p><p>I hope the information is useful. Unfortunately, we do not employ any Minions in our systems. Maybe one day we might replace MID Servers with Minions. Whatever it is, the work of the MID Server continues to be magical.</p><p></p><p><strong>Resources</strong></p><p>For more information, please see:</p><p><a title="Everything you wanted to know about Discovery" __default_attr="2913" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Everything you wanted to know about Discovery" data-renderedposition="3236.53125_8_322_16" href="/community?id=community_blog&sys_id=e03d2ae5dbd0dbc01dcaf3231f9619f0">Everything you wanted to know about Discovery</a></p><p><a title="ww.youtube.com/playlist?list=PLCOmiTb5WX3ot-E2BibCoZVieG3UGIe2z" href="https://www.youtube.com/playlist?list=PLCOmiTb5WX3ot-E2BibCoZVieG3UGIe2z">Discovery video playlist </a></p><p><a href="http://wiki.servicenow.com/index.php?title=Discovery_Agentless_Architecture" style="font-size: 10pt; line-height: 1.5em;" title="http://wiki.servicenow.com/index.php?title=Discovery_Agentless_Architecture">Discovery Agentless Architecture </a></p><p><a href="http://wiki.servicenow.com/index.php?title=MID_Server#gsc.tab=0" style="font-size: 10pt; line-height: 1.5em;" title="http://wiki.servicenow.com/index.php?title=MID_Server#gsc.tab=0">MID Server</a></p><p><a href="http://wiki.servicenow.com/index.php?title=Discovery" title="http://wiki.servicenow.com/index.php?title=Discovery">Discovery </a></p><p><a href="http://wiki.servicenow.com/index.php?title=Orchestration" title="http://wiki.servicenow.com/index.php?title=Orchestration">Orchestration </a></p><p><a href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0535180" title="https://hi.service-now.com/kb_view.do?sysparm_article=KB0535180">ServiceNow KB: Troubleshooting a MID Server that is down or not responding (KB0535180)</a></p>