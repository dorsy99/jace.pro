---
title: "Automatic Source Control and You  Save Time and Headaches"
date: 2015-08-15T00:21:19.000Z
authors: ["jbauguess"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=8afc26a5dbd0dbc01dcaf3231f961919"
---
<p style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Today we're going to examine a build system I've been using, which I've dubbed "SNBuild".   Using it can help you accomplish the following:</p><p style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Source Control</li><li>Update Set Backup</li><li>Code Quality Examination</li><li>Automatic Documentation</li></ol><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Sound too good to be true?   Well let's take a look at this: it's fairly simple.</span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">Setup</h2><p></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Even if you aren't going to use a source control repository, which I'm not sure why you wouldn't want to do that, the NodeJS program I've developed will at a minimum extract files to a local folder.   If you haven't used NodeJS before, go to <a title="dejs.org/" href="http://nodejs.org/" target="_blank">nodejs.org</a>, download it, and try it out.   It's a very powerful engine, and very useful for a variety of tasks.   And you'll need it installed if you want to run my program locally.</span></p><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">ServiceNowScriptDocumenter</h2><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Not the most imaginative name, but at it's core, that's why I developed this application.   I needed a way to have documentation so I could easily see if I had already written functionality so I wasn't repeating myself.   DRY - Pragmatic Programming Tip #11 (and a tip in nearly every other resource that teaches you how to program).   <a title="elp.github.com/articles/fork-a-repo/" href="https://help.github.com/articles/fork-a-repo/" target="_blank">Fork</a> or clone <a title="ithub.com/jmbauguess/ServiceNowScriptDocumenter" href="https://github.com/jmbauguess/ServiceNowScriptDocumenter" target="_blank">this repository</a><span> (git clone </span><a title="k-external-small" class="jive-link-external-small" href="https://github.com/jmbauguess/ServiceNowScriptDocumenter" rel="nofollow" target="_blank">https://github.com/jmbauguess/ServiceNowScriptDocumenter</a><span>).   There are just a few changes you'll need to make:</span></span></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>The "include" variable in index.js.   I set this to only extract code updated by my account in ServiceNow.   For starters, you don't want to extract and analyze OOB code.   Most of it isn't annotated with JSDoc, so your jobs to make documentation will ignore it.   Secondly, ServiceNow keeps their own code version controlled, so we don't need to help them out with that.   And if we are taking a piece of code and modifying it (which I don't recommend*), it will be caught by our app then.   Finally, much of it is rife with JSHint errors.   For your own sanity, just ignore them all.</li><li>Add any "requestsToMake" to that object.   I only extract Script Includes, UI Scripts, my unit tests, and the update set itself (which I use as an html file for documentation purposes).   Extracting the remote update set, the backup plan essentially, is done in a separate step because it's a little more complicated, as we'll see in the next section.</li><li>The "writeAFile" function.   I added some custom fields to my "sys_update_set" table, and you may not want those on yours.   Or you may already have similar fields on yours.   Either way, you may wish to modify this function, or delete it if you're not going to extract sys_update_set records with the requestsToMake array.</li><li>Any tasks in the gulp.js file.   You may not have your code with JSDoc, so you probably don't want those tasks to run.   You also may not care for the JSHinting, but I recommend it, as it will help you develop better code.   At a minimum you want the "extract", "add-files", "commit-files", and "push-files" tasks to run.</li><li>The sourceArray variable in the gulp.js file.   You may want to save different types of files.   And if you're not including the markdown or JSDoc output, you'll need to remove those.   Just know that if you want to add file types (say business rules or client scripts), you'll need to add corresponding records in the index.js file.   As I expand this, I'll likely extract the properties into a separate file, but since this was so small, it was easy enough to keep it in the source.   I know, bad practice...</li></ol><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Installing the program is a simple matter of running <code>npm install</code> from the directory where you cloned the repository.</span><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Running the program just requires a command line call: <code>gulp --instance "$INSTANCE" --username "$USERNAME" --password "$PASSWORD" --reason 'A reason' --update_set Updatesetname</code>.</span></p><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">Making Things Automatic</h2><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Once again, I'll be leveraging Jenkins to handle building my application for me.</span></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Create a new generic job and give it an appropriate name.<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_1.png"><img alt="sn_doc_1" class="size-large wp-image-32 alignnone jiveImage" height="43" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_1-1024x88.png" width="500"/></a></li><li>Check the "This build is parameterized" checkbox.   Add a String parameter of UPDATE_SET, PASSWORD, USERNAME, and INSTANCE.   Give them default values (especially password, username, and instance!)<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_2.png"><img alt="sn_doc_2" class="size-large wp-image-33 alignnone jiveImage" height="103" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_2-1024x211.png" width="500"/></a></li><li>Under Source Code Management, enter your repository URL and any credentials you need to enter.<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_3.png"><img alt="sn_doc_3" class="size-large wp-image-34 alignnone jiveImage" height="62" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_3-1024x127.png" width="500"/></a></li><li>Under Build Triggers, check "Trigger builds remotely", and decide an authentication token.   You'll need this for use in ServiceNow in a little bit.<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_4.png"><img alt="sn_doc_4" class="size-large wp-image-35 alignnone jiveImage" height="75" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_4-1024x154.png" width="500"/></a></li><li>If you're like me, your Jenkins doesn't have the <a title="iki.jenkins-ci.org/display/JENKINS/NodeJS+Plugin" href="https://wiki.jenkins-ci.org/display/JENKINS/NodeJS+Plugin" target="_blank">NodeJS plugin</a>.   That's ok, because we're going to use a shell script to execute our build.<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_5.png"><img alt="sn_doc_5" class="size-large wp-image-36 alignnone jiveImage" height="96" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sn_doc_5-1024x196.png" width="500"/></a></li></ol><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Now we have a job that will run via remote trigger.   Next, let's create a REST Message in ServiceNow that will serve our needs.</span></p><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">REST Message</h2><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">If you haven't used REST Message before, it's a powerful way to integrate with other systems.   I'm currently working on integrations with Rally, Jenkins, and Sonar.</span></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Create a REST Message.   Give it a good name like "SN Jenkins Builder".</li><li>Set the Endpoint to: ${jenkins}${job}${action}.</li><li>Set the basic authentication to be user Jenkins username and password, then save the record.<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/jenkins_rest.png"><img alt="jenkins_rest" class="size-large wp-image-44 alignnone jiveImage" height="143" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/jenkins_rest-1024x292.png" width="500"/></a></li></ol><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Congratulations, you've made a REST Message.   Of course, this one really won't do much of anything, will it?   After all, ${jenkins}${job}${action} isn't a valid URL.   Good thing we plan on using that a different way.</span></p><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">Business Rule</h2><p></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Go to the Update Set table, and right click to get to the Business Rules for the table.</li><li>Create a new Business Rule, and give it a good name like "Automated Push to Jenkins".</li><li>This rule needs to run "before update" on the condition of current.state.changesTo("complete")</li><li>The script needs to be the following (after the onBefore declaration):<br/><code>(function(current) {<br/>var message = new RESTMessage('SN Jenkins Builder', 'post');<br/>message.setStringParameter("jenkins", gs.getProperty("jenkins.url"));<br/>message.setStringParameter("job", encodeURIComponent(gs.getProperty("script.documenter.job")));<br/>message.setStringParameter("action", "buildWithParameters?token=" + gs.getProperty("script.documenter.token") + "&amp;UPDATE_SET=" + encodeURIComponent(current.name));<br/>var response = message.execute();<br/>if (isAccepted(response.getStatusCode())) {<br/>gs.addInfoMessage("Update set has been sent to Jenkins.");<br/>} else {<br/>gs.addErrorMessage("Failure sending update set.");<br/>}function isAccepted(code) {<br/>return (code == "200" || code == "201") ? true : false;<br/>}<br/>})();</code></li><li>Save the record.</li></ol><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">System Properties</h2><p></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Go to System Properties, and create three properties:<ol><li>jenkins.url -&gt; The base url of your jenkins server</li><li>script.documenter.job -&gt; The name of your job in Jenkins</li><li>script.documenter.token -&gt; The build token of your Jenkins job</li></ol></li><li>To make them easier to find and maintain, let's add them to a page and module.<ol><li>From the property, click "New" in the Category related list<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_1.png"><img alt="sys_property_1" class="wp-image-39 size-large alignnone jiveImage" height="162" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_1-1024x332.png" width="500"/></a></li><li>Name the category and save it<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_2.png"><img alt="sys_property_2" class="size-large alignnone jiveImage wp-image-40" height="90" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_2-1024x184.png" width="500"/></a></li><li>From the other properties, click "Edit" in the Category related list, and add it<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_3.png"><img alt="sys_property_3" class="size-large alignnone jiveImage wp-image-41" height="172" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_3-1024x352.png" width="500"/></a></li><li>Create a module (I chose to do so under Update Sets).   Give it a URL of "system_properties_ui.do?sysparm_category=" and the name of the category.<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_4.png"><img alt="sys_property_4" class="size-large wp-image-42 alignnone jiveImage" height="135" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_4-1024x277.png" width="500"/></a></li><li>Now you can view and edit the properties from the left nav easily!<br/><a href="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_5.png"><img alt="sys_property_5" class="size-large wp-image-43 alignnone jiveImage" height="116" src="http://sensibleservicenow.com/wp-content/uploads/2015/08/sys_property_5-1024x238.png" width="500"/></a><br/>Hat tip to Mark Amann of CloudSherpas for showing me this a long time ago.</li></ol></li></ol><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">Creating the Remote Update Set Automatically</h2><p></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">If you right-click on the Export to XML UI Action on the Update Set once it's closed, you can see what happens behind the scenes to give you that remote update set record.   Now we need to take it, modify it slightly, and make it an action that occurs when the update set closes.</span></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><br/></span></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Create a new Business Rule for the Update Set table</li><li>Give it a meaningful name, such as "Automatically create remote update set"</li><li>It needs to run "before update", with a condition of current.state.changesTo("complete")</li><li>The script needs to contain the following code after the onBefore() function declaration:<br/><code>var retrievedUpdateSet = new GlideRecord('sys_remote_update_set');<br/>retrievedUpdateSet.initialize();<br/>retrievedUpdateSet.description = current.description;<br/>retrievedUpdateSet.name = current.name;<br/>retrievedUpdateSet.release_date = current.release_date;<br/>retrievedUpdateSet.remote_sys_id = current.sys_id;<br/>retrievedUpdateSet.application = current.application;<br/>var scopeGr = new GlideRecord('sys_scope');<br/>scopeGr.get(current.application);<br/>if (scopeGr.isValid()) {<br/>retrievedUpdateSet.application_name = scopeGr.name;<br/>retrievedUpdateSet.application_scope = scopeGr.scope;<br/>retrievedUpdateSet.application_version = scopeGr.version;<br/>}<br/>retrievedUpdateSet.state = "loaded";<br/>var sysid = retrievedUpdateSet.insert();<br/>var update = new GlideRecord('sys_update_xml');<br/>update.addQuery('update_set', current.sys_id);<br/>update.query();<br/>while(update.next()) {<br/>update.remote_update_set = retrievedUpdateSet.sys_id<br/>update.update_set = '';<br/>update.insert();<br/>}</code></li><li>Save the record</li></ol><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">Code Quality and Documentation</h2><p></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Now, to fully leverage these pieces, you need to do a few things:</span></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>Be willing to accept the fact that you need to refactor some code</li><li>Come up with rules based on what's at <a title="hint.com/" href="http://jshint.com/" target="_blank">JSHint's website</a> (which can mitigate some of your refactoring if you are less strict that the default configuration)</li><li>Learn JSDoc (which is simple) and use it on all of your code</li></ol><h3 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h3><h3 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">JSHint</h3><p></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">I predefine globals such as "gs", "g_user", "GlideRecord", since those are things ServiceNow has available in their scripts.   This is not uncommon among other frameworks such as jQuery. You may find a lot of problems with your code the first time you run this. That's ok. Take time as you go through cycles to fix those issues. If you have automated unit and functional tests, you don't need to be scared about breaking something. If you don't have those, do whatever you can to implement automated tests as soon as you can.</span></p><h3 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h3><h3 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">JSDoc</h3><p></p><p><span style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">There are numerous comment annotation frameworks for javascript right now, but I chose JSDoc since it seemed to be easy to learn.   The main tags I use:</span></p><ol style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;"><li>@description - At a bare minimum, use this to describe what your function is supposed to do</li><li>@param - The next bare minimum is to document your parameters by type and with a description of what they are</li><li>@return - If you are returning something, note what it should be both by type and description</li><li>@example - It's nice to include examples of your code in action</li><li>@memberOf - If you're extending a Class, be sure to annotate with this so the function knows to whom it belongs</li></ol><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;"></h2><h2 style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif;">Profit</h2><p></p><p style="color: #000000; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px;">Now that we have everything set-up, we can close an update set and have piece of mind that it's backed up safely in a repository, and our code is documented well (assuming we took the time to do that in the first place). I have an update set with all of the functionality listed above <a title="ist.github.com/jmbauguess/49744d04b899b4025ccd" href="https://gist.github.com/jmbauguess/49744d04b899b4025ccd" target="_blank">here</a>. Feel free to install it in your instance.</p>