---
title: "Knowledege Base  Part  Import bulk docx and doc files with images to ServiceNow as KB with Powershell V"
date: 2015-10-12T09:52:09.000Z
authors: ["Deepak Ingale"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=bbcde2e9dbd0dbc01dcaf3231f96193f"
---
<p><span style="font-size: 12pt;">Hello Members,</span></p><p></p><p><span style="font-size: 12pt;">From last few days or so, I was trying to import docx with images to ServiceNow. </span></p><p><span style="font-size: 12pt;">I have tried out the solution available on HI support KB (<a __default_attr="205840" __jive_macro_name="thread" class="jive_macro_thread jive_macro" data-orig-content="&lt;span style=&quot;text-decoration: underline;&quot; data-mce-style=&quot;text-decoration: underline;&quot;&gt;&lt;span style=&quot;color: rgb(0, 102, 204);&quot; data-mce-style=&quot;color: #0066cc;&quot;&gt;Help required to import KBs in DOCX format to ServiceNow - (ServiceNow KB article KB0533212)&lt;/span&gt;&lt;/span&gt;" data-renderedposition="79.79999542236328_403.8800048828125_712_18" href="/community?id=community_question&sys_id=19cfbe6ddb58dbc01dcaf3231f96191a" modifiedtitle="true" title="&lt;span style=&quot;text-decoration: underline;&quot;&gt;&lt;span style=&quot;color: #0066cc;&quot;&gt;Help required to import KBs in DOCX format to ServiceNow - (ServiceNow KB article KB0533212)&lt;/span&gt;&lt;/span&gt;"><span style="text-decoration: underline;" data-mce-style="text-decoration: underline;"><span style="color: rgb(0, 102, 204);" data-mce-style="color: #0066cc;">Help required to import KBs in DOCX format to ServiceNow - (ServiceNow KB article KB0533212)</span></span></a>), but somehow, that didn't work for me.</span></p><p></p><p><span style="font-size: 12pt;">ServiceNow KB article on HI promises to convert docx files to htm with docx macros built in VBA, somehow that didn't work for me.</span></p><p><span style="font-size: 12pt;">So I thought to implement solution with the help of my friend 'Powershell'. </span></p><p><span style="font-size: 12pt;"> </span></p><p><span><span style="font-size: 12pt;">I have created a powershell script which will convert <strong>doc</strong>x file to </span><span style="font-size: 12pt;"><strong>htm </strong></span><span style="font-size: 12pt;">file, will copy each KB article content to excel cells, segregate the images of <strong>docx </strong>files to separate files, which can then be imported as zip file at one go in ServiceNow.</span></span></p><p><span style="font-size: 12pt;"> </span></p><p><span style="font-size: 12pt;">Now let me walk you through the detailed procedure of this.</span></p><p><span style="font-size: 12pt;"> </span></p><h3><span style="font-size: 24pt;">Requirements:-</span><span style="font-size: 24pt;"><br/></span></h3><p><span style="font-size: 18pt;"> </span></p><p></p><p><span style="font-size: 12pt;">Windows Powershell V3 installed on your local machine. Powershell is available inbuilt on windows OS starting with windows 7 and later.</span></p><p><span style="font-size: 12pt;">If you are on older version of windows, you will require to install powershell separately.</span></p><p><span style="font-size: 12pt;">Solution is tested with Powershell v3, Microsoft office 2007 and on windows operating system windows 7.</span></p><p><span style="font-size: 12pt;">Some code modification may be required if you are running it on Powershell V2 or Powershell V4.<br/></span><span style="font-size: 12pt;"><br/></span><span style="font-size: 24pt;">Steps to create your powershell script.</span></p><p></p><ul><li><span style="font-size: 12pt;">Copy below code on clipboard, open notepad, paste the code and save it with   '.ps1' extension. This will now work as your Powershell script which will convert 'docx' files to 'htm' files.</span><br/><span style="font-size: 12pt;">You will also require to create a directory structure mentioned in this scripts.</span></li><li><span style="font-size: 12pt;">Create folder structure ''D:\HTML Utility\Files to Import' :- This will work as repository for your 'docx' KB files. You have to deploy all 'docx' files in this directory</span></li><li><span style="font-size: 12pt;">Create folder structure 'D:\HTML Utility\Converted Files' :</span>- <span style="font-size: 12pt;">This will work as repository to images within the 'docx' files, which you will later on import at a one go in servicenow.</span></li><li><span style="font-size: 12pt;">Create 'Template.xls' file under 'Files to Import' folder. This file will work as your 'Data Source' for KB articles importing. It will contain html body tag of your each KB article.</span></li><li><span style="font-size: 12pt;">Click on start menu of windows and type 'Powershell'. You will be provided with below results of screenshot. Click on Powershell ISE (Integrated script environment) to launch your script from this console. You can simply copy-paste the code and execute or you can call the .ps1 file you saved on your machine.</span></li></ul><p></p><p></p><p></p><p><span style="font-size: 24pt;">Limitations:-</span></p><p><span style="font-size: 24pt;"> </span></p><p><span style="font-size: 12pt;">There is an excel limitation to store 32,767 characters in one cell. </span></p><p><span style="font-size: 12pt;"><a href="https://support.office.com/en-us/article/Excel-specifications-and-limits-1672b34d-7043-467e-8e27-269d656771c3" title="https://support.office.com/en-us/article/Excel-specifications-and-limits-1672b34d-7043-467e-8e27-269d656771c3">Excel specifications and limits - Excel</a></span></p><p><span style="font-size: 12pt;">There is a limitation of 65000 characters on 'Text' field of kb_knowledge, which might be incrased but I haven't tried this.</span></p><p><span style="font-size: 12pt;"> </span></p><p><span style="font-size: 24pt;"><img   class="jiveImage image-0" src="73562bf9db9c5b048c8ef4621f961974.iix" style="max-height: 900px; max-width: 1200px;"/><br/></span></p><p></p><p><span style="font-size: 12pt;">Taking consideration all these limitations, I have created a script to follow limit of ServiceNow of 65,000 characters. My script will store each KB article html body   content in single excel cell. If KB article length is more than excel cell limit, script will take care to store next characters beyond limit of excel to next cell. However, script will work for KB articles where characters are less than 64000. Else it will throw a document name on your powershell console indicating your document has been skipped due to charater limits. This is for syncing with ServiceNow text limit field.</span></p><p><span style="font-size: 12pt;"> </span></p><p><span style="font-size: 12pt;"><img  __jive_id="29840" class="jiveImage image-1" src="943a49c6db941b04ed6af3231f961934.iix" style="max-height: 900px; max-width: 1200px;"/></span></p><p><span style="font-size: 12pt;"><img   class="jiveImage image-2" src="ddaa40c6db5c1304b322f4621f9619a7.iix" style="max-height: 900px; max-width: 1200px;"/></span></p><p></p><pre __default_attr="c#" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14449889350397332 jive_text_macro" data-renderedposition="1395.7999267578125_8_1175_1216" jivemacro_uid="_14449889350397332"><p>cls</p><p>$kbFiles = Get-ChildItem 'D:\HTML Utility\Files to Import' -Filter '*.docx' #File Repository for DOCx KB files</p><p>$targetDir= "D:\HTML Utility\Converted Files" # Path for converted htm and their associated files</p><p>$word = New-Object -ComObject "Word.Application"</p><p>$word.Visible = $true</p><p>$excel = new-object -ComObject 'excel.application'</p><p>$excel.visible = $true</p><p>$workBook = $excel.workbooks.open('D:\HTML Utility\Files to Import\Template.xls') # Template.xls file has to be created first at location specified</p><p>$worksheet1 = $workBook.Worksheets.item(1)</p><p>$worksheet1.name = 'fileForServiceNow'</p><p>$worksheet1.columns.item(1).WrapText = $True</p><p>$worksheet1.columns.item(1).columnWidth = 40</p><p>$worksheet1.columns.item(2).WrapText = $True</p><p>$worksheet1.columns.item(2).columnWidth = 25</p><p>$worksheet1.cells.item(1,1).value2 = 'KBTextPart1' # set header for CSV file to import</p><p>$worksheet1.cells.item(1,2).value2 = 'KBTextPart2' # set header for CSV file to import</p><p>$worksheet1.cells.item(1,3).value2 = 'Short Description' # set header for csv file to import</p><p>$counter = 1</p><p>$i = 0</p><p>$KBArticelIndexInExcel = 2</p><p>foreach ($document in $kbFiles)</p><p>{</p><p>Write-Progress -Activity Updating   -status progress -PercentComplete ($counter / $kbFiles.count)</p><p>write-host $document.Name</p><p>$existingDoc = $word.Documents.Open($document.FullName)</p><p>$name = $document.Name.Replace(" ","_");</p><p>$saveaspath = $targetDir+ '\' + $name.Replace('.docx','.htm')</p><p>$wdFormatHTML = [int]10</p><p>$existingDoc.WebOptions.AllowPNG = $true</p><p>#$existingDoc.SaveAs([ref] $saveaspath,[ref]$wdFormatHTML)</p><p>$existingDoc.SaveAs($saveaspath,$wdFormatHTML)</p><p>$existingDoc.Close()</p><p>[System.Collections.ArrayList]$htmlContent = get-content $saveaspath</p><p>$htmlContent &gt; 'D:\HTML Utility\Files to Import\tempStorage.txt'</p><p>for($i=0; $i -le $htmlContent.count ; $i++)</p><p>{</p><p>   if($htmlContent[$i] -contains '&lt;/head&gt;')</p><p>   {</p><p>     $headIndex = $i;</p><p>     write-host 'line no is: ' $i</p><p>   }</p><p>}</p><p>$htmlcontent.RemoveRange(0,$headIndex+1)</p><p>$stringlist = [string]$htmlContent</p><p>Out-File -InputObject $stringlist -FilePath 'D:\HTML Utility\Files to Import\tempWithoutHeadTag.txt' -Encoding ascii</p><p>$KBText = (get-Content 'D:\HTML Utility\Files to Import\tempWithoutHeadTag.txt') -replace '/image','_image'</p><p>if($KBText.length -gt 32000) # Excel cell has store only upto 32700 characters, if KB article length is more than 32000, its content will be stored in 2 Cells.</p><p>{</p><p>   $worksheet1.cells.item($KBArticelIndexInExcel,1).value2 = $KBText.substring(0,32000)</p><p>   $worksheet1.cells.item($KBArticelIndexInExcel,2).value2 = $KBText.substring(32000,$kbtext.length - 32000)</p><p>   $worksheet1.cells.item($KBArticelIndexInExcel,3).value2 = $document.Name.replace('.docx','')</p><p>}</p><p>else</p><p>{</p><p>   $worksheet1.cells.item($KBArticelIndexInExcel,1).value2 = $KBText</p><p>   $worksheet1.cells.item($KBArticelIndexInExcel,2).value2 = ''</p><p>   $worksheet1.cells.item($KBArticelIndexInExcel,3).value2 = $document.Name.replace('.docx','')</p><p>}</p><p>$KBArticelIndexInExcel++</p><p>$counter++</p><p>}</p><p>$worksheet1.SaveAs('D:\HTML Utility\Files to Import\UploadKB.xls')</p><p>$Word.Quit()</p><p>$htmlContent.count</p><p>$excel.Quit()<span style="font-size: 10pt;"><br/></span></p>                   </pre><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 12pt;">After you run the script, go to 'D:\HTML Utility\Converted Files', you will see folders got generated ending with <strong>_files. </strong>These folders contains images within your KB docx. </span></p><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 10pt;"><img   class="jiveImage image-1" src="943a49c6db941b04ed6af3231f961934.iix" style="max-height: 900px; max-width: 1200px;"/></span></p><p></p><p><span style="font-size: 12pt;">Select all the files ending with _files, right click on any file, select open to compress the file with zip.</span></p><p><span style="font-size: 12pt;">Once done, it will create a single zip file. Don't worry about the name of the file. This single file will contains all the images within your all KBs.</span></p><p><span style="font-size: 12pt;">This file is ready to be imported into serviceNow</span></p><p><span><span style="font-size: 12pt;">Combined screenshot of Zip file and ServiceNow console to upload zip file images is below.</span><br/></span></p><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 10pt;"><img  __jive_id="29858" class="jiveImage image-1" src="943a49c6db941b04ed6af3231f961934.iix" style="max-height: 900px; max-width: 1200px;"/></span></p><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 12pt;">Click on image zip upload and upload your single zip file.</span></p><p><span style="font-size: 12pt;"> </span></p><p><span style="font-size: 12pt;">Once done, now go to 'D:\HTML Utility\Files to Import'.</span></p><p><span style="font-size: 12pt;">check for 'UploadKB.xls' file. This file contains all the 'Text' of your all the documents.</span></p><p><span style="font-size: 12pt;">It will work as data source for your import set.</span></p><p><span style="font-size: 12pt;"> </span></p><p><span style="font-size: 12pt;">I am not able to attach the update set here which is used for transform mapping.</span></p><p><span style="font-size: 12pt;">I am writing down onBefore code which is used for mapping 'text' field of kb_knowledge table </span></p><p><span style="font-size: 12pt;">Also, the staging table which will be created for this transform mapping, will have kbtextpart1 and kbtextpart2 fields. Make sure to set their size limit to 32000 characters.</span></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14449889350107049 jive_text_macro" data-renderedposition="3177.800048828125_8_1175_193" jivemacro_uid="_14449889350107049"><p>/**</p><p><span> * For variables go to: </span><a title="k-external-small" class="jive-link-external-small" href="http://wiki.service-now.com/index.php?title=Import_Sets" rel="nofollow" target="_blank">http://wiki.service-now.com/index.php?title=Import_Sets</a></p><p>**/</p><p>gs.log('Deepak Import KB length is : ' + source.u_kbtextpart1.toString().length + ' '   + source.u_kbtextpart2.toString().length + '\n ' +   source.u_kbtextpart1 + source.u_kbtextpart2);</p><p>target.kb_knowledge_base.setDisplayValue('IT');</p><p>target.text = source.u_kbtextpart1.toString() + source.u_kbtextpart2.toString();</p>         </pre><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 10pt;"> </span></p><p><span style="font-size: 10pt;"> </span></p>