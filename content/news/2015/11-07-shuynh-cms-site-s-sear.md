---
title: "CMS Sites search results page not used by Search Results Global content block"
date: 2015-11-07T05:37:18.000Z
authors: ["shuynh"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=285e2aaddbd0dbc01dcaf3231f96193d"
---
<p>When a global search is performed within the CMS it displays the results using the 'Portal - Search Results' (search_results.do) CMS page.</p><p><br/><img   alt="global search cms.jpg" class="image-11 jive-image" src="80730502db141b04ed6af3231f96196a.iix" style="width: 620px; height: 152px; display: block; margin-left: auto; margin-right: auto;"/></p><p><img   alt="search results.jpg" class="image-12 jive-image" src="c343a0c6dbd057049c9ffb651f9619cb.iix" style="width: 620px; height: 350px; display: block; margin-left: auto; margin-right: auto;"/></p><p>The search results page is defined in two places in CMS: from within the CMS site record and the content configuration page.</p><p></p><table border="1"><tbody><tr><td>Within each CMS <a title="ki.servicenow.com/index.php?title=Creating_a_Site#Creating_a_New_Site" href="http://wiki.servicenow.com/index.php?title=Creating_a_Site#Creating_a_New_Site">Site</a> record:</td><td>Within the CMS <a title="ki.servicenow.com/index.php?title=Content_Management_Administration#Content_Configuration_Page" href="http://wiki.servicenow.com/index.php?title=Content_Management_Administration#Content_Configuration_Page">Content Configuration page</a>:</td></tr><tr><td><img   alt="Screen Shot 2015-11-05 at 3.50.43 PM.JPG" class="image-1 jive-image" height="145" src="31a16bbddb585b048c8ef4621f9619b8.iix" style="width: 403px; height: 145.629545454545px;" width="403"/></td><td><img   alt="Screen Shot 2015-11-06 at 11.57.47 AM.JPG" class="image-2 jive-image" height="127" src="92760d42db541b04ed6af3231f961910.iix" style="width: 490px; height: 127.175572519084px;" width="490"/></td></tr></tbody></table><p></p><p>The Content Configuration page is where global defaults are specified.   The global search results page will be used unless a different page is specified at the site level. This allows a different search results page to be be configured per CMS site if desired. There is a known issue where this doesn't work as expected (see: <a title="i.service-now.com/kb_view.do?sysparm_article=KB0551168" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0551168">'Search page' not overriding</a>) and it is when a refined search is performed from the ' Search Results (Global)' dynamic block displayed on the 'Portal - Search Results' (search_results.do) CMS page...</p><p></p><p><img   alt="global search.jpg" class="image-6 jive-image" src="f1e3ec06db505f048c8ef4621f961938.iix" style="width: 620px; height: 192px; display: block; margin-left: auto; margin-right: auto;"/></p><p>...the page that displays this second set of search results will allows be the global default page from the Content Configuration record; if there is a different page defined in the site, it will not be used.</p><p></p><p>This occurs because all global searches on a CMS site are handled by a processor called ContentSearch. Content search begins to process the search term, then checks for the "sysparm_current_site" parameter within the "Search Results (Global)" [content_block_programmatic] record; however, it does not exist:</p><p><img   alt="global search processor.jpg" class="image-7 jive-image" src="a6760c42dbdc5704ed6af3231f96196f.iix" style="width: 620px; height: 474px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>If the processor is not able to find this parameter it will default to whatever search page it finds on the Content Configuration [content_config] page.   If the Content Configuration 'Search page'   [search_page] is not populated or null, you are redirected to a blank page.   This is because that page is looking for the sys_id of the content page and passes it to view_content with the sysparm_sys_id URI parameter and the url will look like this:</p><p><br/><a _jive_internal="true" class="unlinked" rel="nofollow" target="_blank">https://&lt;instance_name&gt;.service-now.com/content_site/view_content.do?sysparm_sys_id=&amp;sysparm_search=&lt;search_term&gt;</a></p><p></p><p>The workaround provides a link to an XML file containing a revised 'Search Results (Global)' dynamic content script that now includes   "sysparm_current_site" which checks for the site's 'Search page':</p><p></p><pre __default_attr="xml" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14468535962076762 jive_text_macro" data-renderedposition="1943.60791015625_7.997159004211426_1192_309" jivemacro_uid="_14468535962076762"><p>&lt;?xml version="1.0" encoding="utf-8"?&gt;</p><p>&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;</p><p></p><p></p><p>&lt;form name="content_search" id="content_search" action="content_search.do" method="post" style="padding-left:5px; padding-bottom:10px;"&gt;</p><p>       &lt;input type="HIDDEN" value="${current_page.getSiteID()}" name="sysparm_current_site"/&gt;       </p><p>         &lt;span class="globalSearch contextSearch" &gt;</p><p>                 &lt;g:evaluate var="sysparm_search"&gt;</p><p>                                 var arr = new Object();</p><p>                                 var sysparm_search = RP.getParameterValue('sysparm_search');</p><p>                                 sysparm_search;</p><p>   &lt;/g:evaluate&gt;</p><p>                 &lt;j:set var="jvar_cms_search_result" value="true" /&gt;</p><p>                 &lt;j:set var="jvar_ts_groupid" value="" /&gt;</p><p>                 &lt;j2:set var="sysparm_query" value="123TEXTQUERY321=${sysparm_search}" /&gt;</p><p>                 &lt;g:inline template="textsearch.xml"/&gt;</p><p>         &lt;/span&gt;     </p><p>&lt;/form&gt;</p><p>&lt;/j:jelly&gt;</p><p></p></pre><p>You can manually update the code above or import the xml file <a title="i.service-now.com/kb_view.do?sysparm_article=KB0551168" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0551168">attached to the KB to resolve the issue.</a></p><p></p><p>This change will generate an entry within the Customer Updates as expected noting the record has been customized so any changes introduced on future upgrades will be skipped as the 'Replace on upgrade' is set to false:</p><p><img   alt="replace upgrade.jpg" class="image-8 jive-image" src="2ec027f1db1093049c9ffb651f9619c7.iix" style="width: 620px; height: 97px; display: block; margin-left: auto; margin-right: auto;"/></p><p>It's recommended that you modify the 'Replace on upgrade' from 'false' to 'true' so updates introduced to this record by future upgrades will not be skipped per <a title="ki.servicenow.com/index.php?title=Upgrades_Best_Practices#Prepare_for_Upgrading" href="http://wiki.servicenow.com/index.php?title=Upgrades_Best_Practices#Prepare_for_Upgrading">6.7 Manage Customizations</a>.</p>