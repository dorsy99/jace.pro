---
title: "Everything you need to know about cloning with Edge Encryption"
date: 2017-10-04T23:11:06.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ce4d2229dbd0dbc01dcaf3231f9619ce"
---
<p>When<span> cloning while using <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/reference/edge-encryption.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/reference/edge-encryption.html">Edge Encryption</a></span> on your clone source instance and / or the clone target instance, there are many things to consider to ensure success. But first, let's start with how a clone works.</p><p></p><h2>Overview of cloning</h2><p>During a clone, you take a dump of your source database — minus the excluded tables from your clone configuration — and move it into your target database. Afterwards, you restore the preserved data — data that was copied before the clone — into your target database.</p><p></p><p style="text-align: center;"><img   alt="clone process.png" class="image-3 jive-image" height="197" src="ec4fe446db58dfc068c1fb651f9619e4.iix" style="height: 197px; width: 835.89px;" width="835"/></p><p>Get a more detailed overview of how cloning works in the product documentation: <a href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/managing-data/concept/c_SystemClone.html" title="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/managing-data/concept/c_SystemClone.html">System clone</a></p><p></p><p><span style="color: #303030; font-size: 24px; font-weight: bold; line-height: 1.5;">Three ways to handle keys on a clone with Edge Encryption</span></p><p>In connection with clones and Edge Encryption, it is important to understand that your <strong><em>encrypted</em></strong> data was copied over from target to source. So, how will you be able to read that encrypted data on the target system? To solve this issue, you have three options depending on the state of your data.</p><p></p><h3>Option 1 — Source and target can use the same encryption key</h3><p><span style="color: #3d3d3d;">This is the easiest way to perform the clone and still being able to access encrypted data. If both source and target my use the same encryption key, use t</span>he following community article by <a title="martygrinstead" __default_attr="35922" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="martygrinstead" data-renderedposition="572.75_8_113_18" href="/community?id=community_user_profile&user=f1ee0e21db181fc09c9ffb651f9619c7">martygrinstead</a> as a reference: <a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=48dc2665dbd0dbc01dcaf3231f961914">Cloning an instance when Edge Encryption is Active</a></p><p></p><h3>Option 2 — Only attachments are encrypted. Fields are not encrypted and tokenization is not used OR the data you have encrypted can be excluded from the clone</h3><p>If you clone with the exclusion of attachments (meaning your encrypted data is not part of the clone), you can contact Customer Support to preserve the Edge Encryption keys during the clone.</p><p></p><h3>Option 3 — Source and target cannot use the same encryption key.</h3><p>Use Option 1 as a stepping stone. Once the data is in your sub-production instance, and your edge proxies can connect to the sub-production system using the production key, start a key rotation to re-encrypt your data with the sub-production key. Once the key rotation jobs are finished, you can delete the old production key from the sub-production instance.</p><p></p><p>For more information on key rotation, see the product documentation: <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/concept/c_EncryptionKeyRotation.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/concept/c_EncryptionKeyRotation.html">Rotate Encryption Keys</a></p><p></p><p>While there is a theoretical Option 4 — decrypt data before the clone — this option would be counterproductive and not discussed here.</p><p></p><h2>Managing signature keys</h2><p>Now that we have covered possible options regarding the encryption keys, we also have to discuss possible signature issues during the clone. Many customers use the same signature key for all instances. If for some reason you are using different signature keys in your different instances, you will have to re-sign all edge configuration items as well.</p><p></p><p><span style="color: #3d3d3d;">You have three options for managing signature keys:</span></p><p></p><h3>Option 1 — Copy the signature key from the clone source to the clone target</h3><p>This can be done using java keytools. Visit the product documentation <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/task/configure-sig-key.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/task/configure-sig-key.html">Configure the Signature Key</a> for detailed steps on how to do this.<span style="color: #9900ff;"><br/></span></p><p></p><p><span style="font-size: 12pt;"><strong>Option 2 — Correct issues after the clone</strong></span></p><p>After the clone, you will have error messages that the signatures in your configuration don't match. To fix this issue, set the properties</p><ul><li>edgeencryption.proxy.skip.config.validate = true</li><li>edgeencryption.proxy.signature.verify = false</li></ul><p>as described in the knowledge article <a title="i.service-now.com/kb_view.do?sysparm_article=KB0621218" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0621218">KB0621218</a> and restart the proxies.</p><p></p><p>Update every rule and configuration in the Edge Encryption application. For example, do this by setting the records to <strong>inactive</strong> and then back to <strong>active</strong>. This will re-sign each record. Once you have done this for all records, set</p><ul><li>edgeencryption.proxy.skip.config.validate = false</li><li>edgeencryption.proxy.signature.verify = true</li></ul><p>and restart the Edge proxies again.</p><p></p><h3>Option 3 — Exclude the Edge Encryption configuration and rules from the clone</h3><p>After the clone, recreate the still needed configurations. This is the most labor-intensive option and is not recommended.</p><p></p><h2>Cloning with tokenization or preserving database</h2><p>If you are using <a href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/concept/c_EncryptionPatterns.html" style="text-decoration: underline;" title="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/concept/c_EncryptionPatterns.html">tokenization</a> or have columns encrypted using equality-preserving or order-preserving encryption types, the information required to decrypt the tokens or the columns properly is stored in a MySQL database connected to your Edge proxies. For tokenized or preserved data to be properly readable after a clone, that MySQL database will have to be "cloned" with the instance, so that all data matches. The easiest way to sync the target database to the source database is to create a backup of the source MySQL database at the same time the backup is run on the parent instance (contact support for the approximate timing), since the clone will use the last backup of the parent instance to copy to the clone target instance. Before starting up the proxies again after the clone has finished, restore that backup of the clone source instance's MySQL database over the clone target instance's MySQL database.</p><p></p><p>This might be easier explained in a timeline:</p><table border="1" cellpadding="0" cellspacing="0" style="border: none;" width="472"><tbody><tr><td style="border: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="79"><p></p></td><td style="border: solid windowtext 1.0pt !msorm; border-left: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="47"><ol style="list-style-type: lower-alpha;"><li>e.g. 00:30</li></ol></td><td style="border: solid windowtext 1.0pt !msorm; border-left: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="77"><p>Clone Start — X minutes</p></td><td style="border: solid windowtext 1.0pt !msorm; border-left: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="95"><p>Clone Start</p></td><td style="border: solid windowtext 1.0pt !msorm; border-left: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="72"><p>Clone Start + X minutes</p></td><td style="border: solid windowtext 1.0pt !msorm; border-left: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="57"><p>Clone End</p></td><td style="border: solid windowtext 1.0pt !msorm; border-left: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="47"><p></p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="79"><p>Clone Source Instance</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p>Nightly Backup</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="77"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="95"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="72"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="57"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p></p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="79"><p>Clone Target Instance</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="77"><p>Data Preservers copy data as XML</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="95"><p>Source's nightly backup restored</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="72"><p>Data Preservers restored as XML</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="57"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #5B9BD5; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p></p></td></tr><tr><td style="border: solid windowtext 1.0pt !msorm; border-top: none !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="79"><p></p></td><td style="border-top: none !msorm; border-left: none !msorm; border-bottom: solid windowtext 1.0pt !msorm; border-right: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="47"><p></p></td><td style="border-top: none !msorm; border-left: none !msorm; border-bottom: solid windowtext 1.0pt !msorm; border-right: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="77"><p></p></td><td style="border-top: none !msorm; border-left: none !msorm; border-bottom: solid windowtext 1.0pt !msorm; border-right: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="95"><p></p></td><td style="border-top: none !msorm; border-left: none !msorm; border-bottom: solid windowtext 1.0pt !msorm; border-right: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="72"><p></p></td><td style="border-top: none !msorm; border-left: none !msorm; border-bottom: solid windowtext 1.0pt !msorm; border-right: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="57"><p></p></td><td style="border-top: none !msorm; border-left: none !msorm; border-bottom: solid windowtext 1.0pt !msorm; border-right: solid windowtext 1.0pt !msorm; padding: 0 5.4pt 0 5.4pt !msorm;" valign="top" width="47"><p></p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="79"><p>Clone Source MySQL</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p>Create Backup</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="77"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="95"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="72"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="57"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p></p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="79"><p>Clone Target MySQL</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="77"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="95"><p>Shut down proxies</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="72"><p></p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="57"><p>Restore Source MySQL backup</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; background: #92D050; padding: 0 5.4pt 0 5.4pt;" valign="top" width="47"><p>Start Proxies</p></td></tr></tbody></table><p></p><p><span style="color: #3d3d3d;">To summarize, cloning with Edge Encryption requires some forethought, since the data that is encrypted in the source instance needs to be readable in the target instance. There are several items involved that need to be looked into:</span></p><ul><li><span style="color: #3d3d3d;">Encryption key</span></li><li><span style="color: #3d3d3d;">Signature key</span></li><li><span style="color: #3d3d3d;">Tokenization database</span></li></ul><p><span style="color: #3d3d3d;">Always ensure that you have a plan in place before cloning the instance, and follow the steps outlined for your process plan to ensure all will work properly.</span></p>