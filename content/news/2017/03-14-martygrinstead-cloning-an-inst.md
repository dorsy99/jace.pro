---
title: "Cloning an instance when Edge Encryption is active"
date: 2017-03-14T02:03:21.000Z
authors: ["martygrinstead"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=48dc2665dbd0dbc01dcaf3231f961914"
---
<p><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/managing-data/concept/c_SystemClone.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/managing-data/concept/c_SystemClone.html">Cloning an instance</a> is important to help ensure your sub-Production environments are configured similarly to your Production environment, and contain a representative set of data. However, <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/c_EdgeEncryptionOverview.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/c_EdgeEncryptionOverview.html">Edge Encryption</a> adds a layer of complexity during the cloning process, since the Edge proxy and the instance must have some matching configuration settings. Before the clone, the Production instance and Edge proxy have consistent settings, and the clone target (and its Edge proxy) will have a different configuration. After the clone, the clone target instance will now have all of the settings used by Production, but the Edge proxy will still have the pre-clone settings. What just happened?</p><p></p><p style="text-align: center;"><img   alt="confused.gif" class="image-1 jive-image" src="75d401c2db10d304b322f4621f9619eb.iix" style="height: auto;"/></p><p></p><p>When cloning while Edge Encryption is active, follow these steps to ensure your Edge proxy and instance can communicate and successfully display the expected encoded values. At a high level, you will copy the Edge proxy installation from Production to the clone target machine, update the configuration files on the target machine to point to the clone, and update the local Edge database (if used). After this, you can proceed to clone Production to the target. Once the clone is finished, you can start the Edge proxy and verify everything is working as expected.</p><p></p><h1>How to clone when there is an Edge Encryption proxy involved</h1><p>Here are the detailed steps for cloning when there is Edge Encryption is active. For simplicity we are providing instructions for one proxy, but this can be extended to multiple proxies if necessary when the instance has multiple proxies assigned.</p><p></p><ol><li>Zip the entire Edge Encryption proxy installation used by the source instance which is on the Edge Encryption proxy machine. For example, on Linux, zip the entire contents of the Edge Encryption proxy installation: <em><strong>$ zip -r edge_helsinki.zip edge_helsinki</strong></em><br/><br/>Where <em><strong>edge_helsinki.zip</strong></em> is the name of the zip file and <strong>edge_helsinki</strong> is the name of the top directory that contains the entire Edge Encryption proxy installation files that are used by the source instance.<br/><br/></li><li>Copy the .zip file to the Edge Encryption machine that will be used by the clone target instance.<br/><br/></li><li>Unzip the .zip file on the edge encryption machine that will be used by the clone target instance: <em><strong>unzip edge_helsinki.zip</strong></em><br/><br/></li><li>At the unzipped location, change the directory to <strong>$proxy_installation_location/conf </strong>and edit the <em><strong>edgeencryption.properties</strong></em> file, changing these lines to point to the clone target instance configuration as appropriate: <strong>edgeencryption.target.host</strong> = &lt;clone target instance name&gt;.service-now.com<br/><br/>Example: edgeencryption.target.host = myinstance.service-now.com<br/><strong>edgeencryption.proxy.host</strong> = &lt;hostname or IP address of the edge encyrption proxy machine used by the clone target instance&gt;<br/><br/>Example:<br/>edgeencryption.proxy.host = 10.0.2.15<br/>edgeencryption.proxy.host = myedgeproxy.mycompany.com<br/><strong>edgeencryption.proxy.https.port</strong> = &lt;https port of the edge encryption proxy machine used by the clone target instance&gt;<br/><br/>Example:<br/>edgeencryption.proxy.https.port = 8082<br/>If MySQL database is used, also modify these properties as needed:<br/><strong>edgeencryption.db.url</strong> = &lt;jdbc connection string to the database used by the edge encryption proxy machine used by the clone target instance&gt;<br/><br/>Example:<br/>edgeencryption.db.url = jdbc:mysql://localhost<br/><strong>edgeencryption.db.user</strong> = &lt;root user&gt;<br/><strong>edgeencryption.db.password</strong> = &lt;root password&gt;<br/><strong>edgeencryption.db.name</strong> = &lt;database name&gt;<br/><br/><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="2477.86669921875_48_225_14"><p><span style="color: #1287b5;">If you are re-using the edgeencryption.db.name from the pre-cloned instance, you may want to change this to a new</span><span style="color: #1287b5;"><strong> edgeencryption.db.name</strong></span><span style="color: #1287b5;"> or drop the associated database (and of course the tables and data in that database will also drop) so that the database is clean. In this example we log into the MySQL database used by the clone target Edge Encryption proxy and we will drop the current database and reuse the same database name in the edgeencryption.db.name setting.</span></p></pre>If you decide to reuse the same database, please follow step 5.   If you are going to create a new database, skip to step 6.</li><li>Log in to mySQL database: <strong>$ mysql -u root<br/></strong>Show all of the databases currently used by the Edge proxy before we start the clone. In this case, my database name is <strong>ee_istanbul</strong>. After the clone we are going to reuse the same <strong>edgeencryption.db.name = ee_istanbul</strong> database name, so we are going to drop that database so that it will be clean post-clone:<br/><br/>mysql&gt; show databases;<br/><span style="font-family: 'courier new', courier;">+--------------------+<br/></span><span style="font-family: 'courier new', courier;">| Database                     |<br/></span><span style="font-family: 'courier new', courier;">+--------------------+<br/></span><span style="font-family: 'courier new', courier;">| information_schema |<br/></span><span style="font-family: 'courier new', courier;">| edgeencryption         |<br/></span><span style="font-family: 'courier new', courier;">| ee_istanbul               |<br/></span><span style="font-family: 'courier new', courier;">| mysql                           |<br/></span><span style="font-family: 'courier new', courier;">| performance_schema |<br/></span><span style="font-family: 'courier new', courier;">| test                             |<br/></span><span style="font-family: 'courier new', courier;">+--------------------+<br/></span>6 rows in set (0.01 sec)<br/><br/>Drop the <strong>ee_istanbul</strong> database. Then confirm that the <strong>ee_istanbul</strong> database no longer exists:<br/><br/>mysql&gt; drop database ee_istanbul;<br/>Query OK, 3 rows affected (0.01 sec)<br/><br/>mysql&gt; show databases;<br/><span style="font-family: 'courier new', courier;">+--------------------+<br/></span><span style="font-family: 'courier new', courier;">| Database                     |<br/></span><span style="font-family: 'courier new', courier;">+--------------------+<br/></span><span style="font-family: 'courier new', courier;">| information_schema |<br/></span><span style="font-family: 'courier new', courier;">| edgeencryption         |<br/></span><span style="font-family: 'courier new', courier;">| mysql                           |<br/></span><span style="font-family: 'courier new', courier;">| performance_schema |<br/></span><span style="font-family: 'courier new', courier;">| test                             |<br/></span><span style="font-family: 'courier new', courier;">+--------------------+<br/></span>5 rows in set (0.00 sec)<br/><br/><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="3416.36669921875_48_225_14"><em>You may review the edgeencryption.properties file in its entirety and change any other settings that would be appropriate to your environment.</em></pre></li><li>Execute the clone from source to target instances following the standard cloning procedure.<br/><br/></li><li>Following the clone, start the Edge Encryption proxy serving the target clone while observing the <strong>$proxy_installation_location/conf/edgeencryption.log</strong>. If the proxy does not start or warning and/or errors are seen, consult the following articles:<ul><li><a title="i.service-now.com/kb_view.do?sysparm_article=KB0621204" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0621204">Browser Access to an Instance via an Edge Proxy Fails and Results in a Secure Connection Failed Message in the Browser (KB0621204)</a></li><li><a title="i.service-now.com/kb_view.do?sysparm_article=KB0621218" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0621218">Edge Encryption Proxy Fails to Start with Error "failed signature validation" (KB0621218)</a></li><li><a title="i.service-now.com/kb_view.do?sysparm_article=KB0621286" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0621286">Edge Encryption Proxy Fails to Start with Error "Failed to load encryption rules" (KB0621286)</a></li><li><a title="i.service-now.com/kb_view.do?sysparm_article=KB0621289" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0621289">How to Increase Debug Logging for the Edge Encryption Proxy (KB0621289)</a><br/><br/></li></ul></li><li>Once the proxy starts up successfully, you can log in to the MySQL database and verify that the database for the clone target has been created. In this example the database is called <strong>ee_istanbul</strong> since that is how <strong>edgeencryption.db.name = ee_istanbul</strong> was set in the <em><strong>edgeencryption.log</strong></em> file of the clone target:<br/><br/>$ mysql -u root<br/>mysql&gt; show databases;<br/><span style="font-family: 'courier new', courier;">+--------------------+<br/></span><span style="font-family: 'courier new', courier;">| Database                     |<br/></span><span style="font-family: 'courier new', courier;">+--------------------+<br/></span><span style="font-family: 'courier new', courier;">| information_schema |<br/></span><span style="font-family: 'courier new', courier;">| edgeencryption         |<br/></span><span style="font-family: 'courier new', courier;">| ee_istanbul               |<br/></span><span style="font-family: 'courier new', courier;">| mysql                           |<br/></span><span style="font-family: 'courier new', courier;">| performance_schema |<br/></span><span style="font-family: 'courier new', courier;">| test                             |<br/></span><span style="font-family: 'courier new', courier;">+--------------------+<br/></span>6 rows in set (0.01 sec)</li></ol><p></p><p>Following these steps will ensure that, after you clone your Production instance over a sub-Prod instance, you will be able to view all of the encrypted data when accessing the instance through the Edge proxy. If you do not follow these steps, you may encounter proxy startup errors, and all of the data will remain encrypted and unusable by all client applications (browsers and web servers). As designed, the only way to decrypt the data in the newly cloned instance is to ensure the Edge proxy server is configured with the same configuration that was used to encrypt the data while it was in Production.</p>