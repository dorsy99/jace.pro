---
title: "How to migrate from V to V of knowledgebase"
date: 2017-04-13T19:45:02.000Z
authors: ["Anil"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=611d22e5dbd0dbc01dcaf3231f961921"
---
<p>Hey Guys, i have been doing a good amount of work on migrating knowledgebase from V2 to V3 and have captured steps on how to do that.</p><p>Steps:</p><p></p><p>Take a backup of all article from kb_knowledge table in xml format from the source instance</p><p>Take a backup of kb_category table from the source instance.</p><p>Import kb_knowldge_base.xml to kb_knowledge_base table using import xml option to target instance.</p><p>Import kb_category.xml to kb_category table using import xml option to target instance.</p><p>background script : setZzFullCategory(); // Optional depending on the knowledge bases in question , use it if you have more than one v3 knowledgebase.</p><p>background script : moveArticles('&lt;sourcekb_sys_id&gt;','&lt;targetkb_sys_id&gt;',false); - Get count of articles that will be moved.</p><p>background script : moveArticles('&lt;sourcekb_sys_id&gt;','&lt;targetkb_sys_id&gt;',true); - Move articles to Knowldge base v3</p><p>background script : updateV3Category('kb_sys_id',false); -   Get count of articles that will be moved. (repeat this for all v3 knowledgebases)</p><p>background script : updateV3Category('kb_sys_id',true); - Update category for the articles. (repeat this for all v3 knowledgebases)</p><p>background script : publishArticles('kb_sys_id',false); -- Get count of articles that will be updated. // Optional step (repeat this for all v3 knowledgebases)</p><p>background script : publishArticles('kb_sys_id',true);   - attach workflow for the articles. (This may take around 3 to 4 mins to complete); // Optional step (repeat this for all v3 knowledgebases)</p><p></p><p>Verify if the knowledgebase modules on left nav point to $knowledge.do else point them to $knowledge.do</p><p></p><p>script includes mentioned above</p><p></p><p><strong>Name: </strong>setZzFullCategory</p><p></p><p><strong>script:</strong></p><p>function setZzFullCategory() {</p><p>   var gr = new GlideRecord('kb_category');</p><p>   gr.orderBy('sys_id');</p><p>   gr.query();</p><p>   while(gr.next()) {</p><p>         if(gr.parent_table =='kb_knowledge_base') {</p><p>   gr.u_zz_full_category = gr.parent_id.title + " / " + gr.full_category;</p><p>   gr.setWorkflow(false);</p><p>   gr.autoSysFields(false);</p><p>   gr.update();</p><p>   }</p><p>         else {</p><p>         if(gr.parent_id.parent_id.parent_id != undefined) {</p><p>               gr.u_zz_full_category = gr.parent_id.parent_id.parent_id.title + " / " + gr.full_category;</p><p>       gr.setWorkflow(false);</p><p>       gr.autoSysFields(false);</p><p>               gr.update();</p><p>         }</p><p>               else {</p><p>             if(gr.parent_id.parent_id !=undefined) {</p><p>               gr.u_zz_full_category = gr.parent_id.parent_id.title + " / " + gr.full_category;</p><p>       gr.setWorkflow(false);</p><p>       gr.autoSysFields(false);</p><p>               gr.update();</p><p>         }</p><p>                     else {</p><p>             if(gr.parent_id !=undefined) {</p><p>               gr.u_zz_full_category = gr.parent_id.title + " / " + gr.full_category;</p><p>       gr.setWorkflow(false);</p><p>       gr.autoSysFields(false);</p><p>               gr.update();</p><p>           }</p><p>           }</p><p>                 }</p><p>         }                 </p><p></p><p></p><p>   }</p><p>}</p><p></p><p><strong>Name: moveArticles</strong></p><p></p><p><strong>Usage: </strong></p><p>moveArticles(&lt;souceKbSysID&gt;,&lt;destinationKbSysID&gt;,false); This line would check how many records would be migrated from source to destination KB</p><p>moveArticles(&lt;souceKbSysID&gt;,&lt;destinationKbSysID&gt;,true); This le will do the actual migration of KB articles.</p><p></p><p></p><p><strong>script:</strong></p><p>function moveArticles(source,destination,doIt) {</p><p>if(doIt == undefined) {</p><p>   doIt = false;</p><p>}</p><p>var i = 0;</p><p>var query = 'kb_knowledge_base='+ source;</p><p>var grKb = new GlideRecord('kb_knowledge');</p><p>grKb.addEncodedQuery(query);</p><p>grKb.query();</p><p>while(grKb.next()) {</p><p>     if(doIt) {</p><p>       grKb.kb_knowledge_base = destination;</p><p>       grKb.update();</p><p>     }</p><p>     i++;</p><p>}</p><p>   if(doIt) {</p><p>   sDebug = 'Number of KB articles that got migrated: ' + i;</p><p>   }</p><p>   else {</p><p>   sDebug = 'Number of KB articles that would be migrated: ' + i;</p><p>   }</p><p></p><p>gs.log(sDebug,'fpadmin');</p><p></p><p></p><p>}</p><p></p><p><strong>Name: </strong>updateV3Category</p><p></p><p><strong>Usage: </strong>updateV3Category(&lt;kbsysid&gt;,true);</p><p></p><p><strong>Script: </strong></p><p>function updateV3Category(source, doIt) {</p><p>if(doIt == undefined) {</p><p>   doIt = false;</p><p>}</p><p>var i = 0;</p><p>var sDebug = '';</p><p>var kcquery = '';</p><p>var category = '';</p><p>var query = 'kb_knowledge_base='+ source;</p><p>var grKb = new GlideRecord('kb_knowledge');</p><p>grKb.addEncodedQuery(query);</p><p>grKb.query();</p><p>while(grKb.next()) {</p><p>   category = '';</p><p>   kcquery = 'parent_id=' + source + '^label=' + grKb.topic ;</p><p>     if(doIt) {</p><p>       </p><p>       var grKc = new GlideRecord('kb_category');</p><p>       grKc.addEncodedQuery(kcquery);</p><p>       grKc.query();</p><p>       if(grKc.next()) {</p><p>       category = grKc.sys_id;</p><p>       }</p><p>       grKb.kb_category = category;</p><p>       grKb.update();</p><p>     }</p><p>     i++;</p><p>sDebug += "   " + kcquery;</p><p>}</p><p>   if(doIt) {</p><p>   sDebug += 'Number of KB articles that got updated with new category: ' + i;</p><p>   }</p><p>   else {</p><p>   sDebug += 'Number of KB articles that would be updated with new category: ' + i;</p><p>   }</p><p></p><p>gs.log(sDebug,'fpadmin');</p><p></p><p></p><p>}</p><p></p><p><strong>Name: </strong>publishArticles</p><p></p><p><strong>Usage:</strong></p><p>publishArticles(&lt;kbSysID&gt;,false); This gets the number of articles that will be published.</p><p>publishArticles(&lt;kbSysID&gt;,true); This publishes the articles.</p><p></p><p><strong>script:</strong></p><p></p><p>function publishArticles(source,doIt) {</p><p>if(doIt == undefined) {</p><p>   doIt = false;</p><p>}</p><p>var i = 0;</p><p>var query = 'kb_knowledge_base='+ source;</p><p>var grKb = new GlideRecord('kb_knowledge');</p><p>grKb.addEncodedQuery(query);</p><p>grKb.query();</p><p>while(grKb.next()) {</p><p>     if(doIt) {</p><p>       grKb.workflow_state = 'draft';</p><p>       grKb.update();</p><p>       new KBWorkflow().startWorkflow(grKb, "workflow");</p><p>     }</p><p>     i++;</p><p>}</p><p>   if(doIt) {</p><p>   sDebug = 'Number of KB articles that got published: ' + i;</p><p>   }</p><p>   else {</p><p>   sDebug = 'Number of KB articles that would be published: ' + i;</p><p>   }</p><p></p><p>gs.log(sDebug,'fpadmin');</p><p>}</p><p></p><p>Thanks</p><p>Anil</p>