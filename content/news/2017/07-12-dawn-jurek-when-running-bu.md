---
title: "When running business rules timing is everything"
date: 2017-07-12T01:45:21.000Z
authors: ["Dawn Jurek"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=342e266ddbd0dbc01dcaf3231f961971"
---
<p style="text-align: left;">Imagine this: Two airline passengers, John and Mary, log in to an airline's seat reservation webpage to select their seats. A <em>query</em> business rule determines which seats were available to each passenger—based on factors such as their airfare and frequent flyer status—and then the system displays the same seating chart to both of them. They both select the same seat and submit the form, but Mary's reflexes are a little faster than John's, and she hits <strong>Submit</strong> a fraction of a second before he does.</p><p></p><p style="text-align: center;"><img   alt="seat_selection.jpg" class="image-15 jive-image" src="e5b170c2db5c57049c9ffb651f96196a.iix" style="height: auto;"/></p><p></p><p>If the system didn't double-check and discover that the seat was no longer available when John clicked <strong>Submit</strong>,...</p><p style="text-align: center;"><img   alt="business_rules_seat.jpg" class="image-16 jive-image" src="63e39002dbd49fc068c1fb651f961980.iix" style="height: auto;"/></p><p></p><p>...there could be an <em>awkward</em> situation at boarding time.</p><p style="text-align: center;"><img   alt="awkward_moment.jpg" class="image-12 jive-image" src="bcf8fb31db501304b322f4621f961931.iix" style="height: auto;"/></p><p></p><p>Fortunately, a <em>before</em> business rule checked for data that may have changed during the time lapse between John's filling in the form and submitting it. So the database was not updated to assign John the same seat that Mary had secured just a millisecond earlier, and they won't have to fight over the seat. Thanks to this business rule, an awkward situation was avoided!</p><p style="text-align: center;"><img   alt="seat_notice.jpg" class="image-14 jive-image" src="06881982db18d304b322f4621f9619a9.iix" style="height: auto;"/></p><p></p><p>In this installment of our <a title="" _jive_internal="true" href="/content?filterID=all~objecttype~objecttype%5Bblogpost%5D&amp;filterID=all~tag%5Bnowsupport+best+practices+series%5D&amp;query=nowsupport+best+practices" style="font-family: arial, sans-serif; color: #3778c7;">best practices series</a>, we look at what business rules are, and how they run.</p><p></p><h2>What is a business rule?</h2><p></p><p>A <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/script/business-rules/concept/c_BusinessRules.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/script/business-rules/concept/c_BusinessRules.html">business rule</a> is a server-side script that runs when a record is displayed, inserted, updated, or deleted, or when a table is queried. Common uses are to check for data that may have changed during the time lapse between filling in a form and submitting it, as in the example above, or to automatically change values in form fields when certain conditions are met.</p><p></p><h2><strong>When business rules run</strong></h2><p></p><p>Using business rules at the right point in the business rule processing flow helps prevent unpredictable results and performance issues related to those rules.</p><p><img   alt="Timing is Everything.png" class="image-11 jive-image" src="2e551c0adbd05344e9737a9e0f96190e.iix" style="width: 620px; height: 413px; display: block; margin-left: auto; margin-right: auto;"/></p><p>This flowchart illustrates when business rules run, relative to database operations on the record—such as the system displaying the form, the user updating the form, and the database being updated. In general, business rules apply consistently to records regardless of whether they're accessed through forms, lists, or web services. However, <em>display</em> business rules are only used by forms—not by lists or web services.</p><p style="text-align: center;"><img   alt="flowchart.png" class="image-2 jive-image" src="736973fddbd05fc03eb27a9e0f961930.iix" style="height: auto;"/></p><p><span style="font-size: 10pt;">The <strong>When</strong> field on the Business Rule form, shown here, indicates the point at which the business rule script runs, relative to database operations shown in the flowchart above. To display the <strong>When </strong>field on the form, the <strong>Advanced </strong>check box must be selected. This business rule runs <em>before </em>the current object is saved to the database.<span style="font-family: Calibri, sans-serif;"> </span></span></p><p></p><p style="text-align: center;"><img   alt="Business rule form final.jpg" class="image-6 jive-image" src="a8c7f882dbd89344e9737a9e0f9619ff.iix" style="width: 800px; height: 420px;"/></p><p></p><p>Here's a list of base system business rules. You can view business rules in your own instance by navigating to <strong>System Definition &gt; Business Rules</strong>. In this case, the list is personalized to display the <strong>When</strong> column. The most commonly used business rules are <em>before</em> and <em>after</em> rules.</p><p></p><p><img   alt="business_rules_list_when.jpg" class="image-5 jive-image" src="d89b1d8edb9c9f048c8ef4621f96190c.iix" style="width: 800px; height: 418px; display: block; margin-left: auto; margin-right: auto;"/></p><p style="text-align: center;"></p><p style="text-align: left;">This table explains when business rules run and provides example use cases.</p><p style="text-align: center;"></p><table border="1" class="jiveBorder" height="384" style="border: 1px solid #c6c6c6; margin-left: auto; margin-right: auto; width: 817px; height: 386px;"><tbody><tr><th style="text-align: left; background-color: #f2f2f2; color: #505050; padding: 6px;" valign="middle"><strong>When value<br/></strong></th><th style="text-align: left; background-color: #f2f2f2; color: #505050; padding: 6px;" valign="middle"><strong>When the rule runs<br/></strong></th><th style="text-align: left; background-color: #f2f2f2; color: #505050; padding: 6px;" valign="middle"><strong>Example use case<br/></strong></th></tr><tr><td style="padding: 6px;">display</td><td style="padding: 6px;">Before the form is presented to the user, just after the data is read from the database.</td><td style="padding: 6px;">To provide client scripts access to server-side objects.</td></tr><tr><td style="padding: 6px;">before</td><td style="padding: 6px;">After the user submits the form but before any action is taken on the record in the database.</td><td style="padding: 6px;">To update information on the current object. For example, a business rule containing <strong>current.state=3;</strong> would set the <strong>State</strong> field on the current record to the state whose numeric <strong>Value</strong> is <strong>3</strong>.</td></tr><tr><td style="padding: 6px;">after</td><td style="padding: 6px;">After the user submits the form and after any action is taken on the record in the database.</td><td style="padding: 6px;">To update information on related objects that need to be displayed immediately, such as GlideRecord queries.</td></tr><tr><td style="padding: 6px;">async</td><td style="padding: 6px;">When the scheduler runs the scheduled job created from the business rule. The system creates a scheduled job from the business rule after the user submits the form and after any action is taken on the record in the database.</td><td style="padding: 6px;">To update information on related objects that do not need to be displayed immediately, such as calculating metrics and service level agreements (SLA).</td></tr></tbody></table><p style="text-align: center;"></p><p>You can often use an <em>async</em> business rule in place of an <em>after</em> business rule. <em>Async</em> business rules are similar to <em>after</em> rules in that they run after the database commits a change. Unlike <em>after </em>rules, <em>async</em> rules run in the background simultaneously with other processes. <em>Async</em> business rules allow the system to return control to the user sooner but may take longer to update related objects.</p><p></p><h2><strong>Business rule examples</strong></h2><p></p><p>Here are examples of a <em>before</em> and an <em>after</em> business rule.</p><p></p><h3>Business rule that runs <em>before</em> database update</h3><p></p><p>The insert_incident business rule runs <em>before</em> the database is updated:</p><p></p><p style="text-align: center;"><img   alt="Business rule form no annotations.jpg" class="image-7 jive-image" src="7886dc46db145344e9737a9e0f9619c9.iix" style="width: 800px; height: 420px;"/></p><p></p><p>When this rule runs, the current.number variable is assigned the next available incident number, and a message is displayed to the user:</p><p></p><p style="text-align: center;"><img   alt="Script from insert_incident.JPG" class="image-10 jive-image" src="8776f40edb9c5f048c8ef4621f961924.iix" style="width: 800px; height: 275px;"/></p><h3></h3><h3>Business rule that runs <em>after</em> database update</h3><p></p><p>The SNC - ITIL - Close Related business rule for the Change Request table runs <em>after</em> the database is updated:</p><p></p><p style="text-align: center;"><img   alt="SNC - ITIL - Close Related.JPG" class="image-8 jive-image" src="1c75bff1db9c9b048c8ef4621f96196b.iix" style="width: 800px; height: 473px;"/></p><p></p><p>When this rule runs, it closes all related child change tasks and related problems:</p><p></p><p style="text-align: center;"><img   alt="SNC - ITIL - Close Related script.JPG" class="image-9 jive-image" src="e2f7514adb58130468c1fb651f9619b5.iix" style="width: 800px; height: 519px;"/></p><p></p><p>To learn more about configuring business rules, check out this video on our <a title="ww.youtube.com/user/servicenowdemo" href="https://www.youtube.com/user/servicenowdemo">NOWSupport YouTube Channel</a>:</p><p></p><p><iframe frameborder="0" height="360" src="https://www.youtube.com/embed/VUQwql3Rki8?rel=0" width="640">
</iframe></p><p></p><p><strong>For more information, see:</strong></p><ul><li><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/concept/c_BusinessRules.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/concept/c_BusinessRules.html" style="color: purple;">Business rules</a></li><li><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/reference/r_HowBusinessRulesWork.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/reference/r_HowBusinessRulesWork.html" style="color: purple;">How business rules work</a></li><li><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/concept/c_ScriptingWithDisplayBusinessRules.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/concept/c_ScriptingWithDisplayBusinessRules.html" style="color: purple;">Display business rules</a></li><li><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/reference/r_AsyncBusinessRules.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/reference/r_AsyncBusinessRules.html" style="color: purple;">Async business rules</a></li><li><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/general-scripting/reference/r_ExecutionOrderScriptsAndEngines.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/general-scripting/reference/r_ExecutionOrderScriptsAndEngines.html" style="color: purple;">Execution order of scripts and engines</a></li></ul><p></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #666666;">--</p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #666666;">Behind the scenes here at ServiceNow, the Knowledge Management and Multimedia teams work closely with subject matter experts to disseminate critical information to our customers. We've found that certain topics come up frequently, in the form of best practices that can help you keep your ServiceNow instances running smoothly. This series targets those topics so that you and your organization can benefit from our collective expertise. If you have a best practices topic you'd like us to cover in this series, please let us know in the comments below.</p><p style="font-family: arial, sans-serif; color: #666666;"></p><p style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #666666;"><span style="font-weight: inherit; font-style: inherit; font-family: inherit;">To access all of the blog posts in this series, search for "</span><span style="font-weight: inherit; font-family: inherit; font-style: inherit;"><strong>nowsupport best practices series</strong></span><span style="font-weight: inherit; font-style: inherit; font-family: inherit;">."</span></p>