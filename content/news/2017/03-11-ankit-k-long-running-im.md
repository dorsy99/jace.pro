---
title: "Long running Import Set Deleter job causing performance issues on the affected node"
date: 2017-03-11T03:57:02.000Z
authors: ["Ankit K"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=872da6e5dbd0dbc01dcaf3231f9619f2"
---
<p>The Import Set Deleter job cleans records in the import tables. This is a default job which cleans the data of sys_import_set_row and its child tables as these tables tend to grow big very often. Sometimes there is a possibility, although rare, that orphan records are left in sys_import_set_row table and they are not cleaned in future scheduling of the job. This is a problem that was fixed in Fuji addressed out of memory exceptions that arise from MultipleDelete, which the <a title="i.service-now.com/kb_view.do?sysparm_article=KB0597507" href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0597507">Import Set Deleter job</a> utilizes. However, the fixes did not completely prevent memory concerns for the particular job.</p><p></p><p>You could be affected by the issue if you are on certain early patches of Geneva up to Geneva Patch 9. It is also seen in Helsinki, up to Helsinki Patch 5. The severity may depend on the number of child tables that the import set row tables have for an instance.</p><p></p><p>Here are a few scenarios that may help determine if you may be affected by the issue:</p><ol><li>Long-running import set delete job</li><li>JAVA in use memory goes up</li><li>Localhost logs statements</li></ol><p></p><p>All 3 scenarios need to be experienced in order for this issue to apply.</p><p></p><p></p><table border="1" class="jiveBorder" style="border: 1px solid #c6c6c6; width: 100%;"><tbody><tr><th style="text-align: left; background-color: #f2f2f2; color: #505050; padding: 6px;" valign="middle"><h1><span style="color: #303030;">Long running import set deleter job</span></h1></th></tr><tr><td style="padding: 6px;"><p>In checking the stats page(/stats.do), you see that the Import Set Deleter was the longest running job on that particular node.</p><p></p><p>Snippet from the stats.do</p><p></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>glide.scheduler.worker.5</em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Current job: Import Set Deleter</em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Job started: Tue Sep 06 18:00:02 PDT 2016</em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Job duration: 1:11:24.846</em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Total jobs: 7612</em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Mean duration: 0:00:01.276</em></span></p><p></p><p>The same can be checked via the sys_trigger table to understand which node this job has been running on.</p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>url: /sys_trigger_list.do?</em></span></p></td></tr></tbody></table><p></p><p></p><table border="1" class="jiveBorder" style="border: 1px solid #c6c6c6; width: 100%;"><tbody><tr><th style="text-align: left; background-color: #f2f2f2; color: #505050; padding: 6px;" valign="middle"><h1><span style="color: #303030;">JAVA HEAP in use memory is high / free memory low</span></h1></th></tr><tr><td style="padding: 6px;"><p>Check for memory usage patterns for the affected node. If you notice that this is the only transaction running for long and the in use memory is on an uptick, make a note of that and save the information.</p><p></p><p>Snippet from the stats.do</p><p></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Servlet Memory </em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Max memory: 2022.0 </em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Allocated: 2022.0 </em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>In use: 1926.0 </em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>Free percentage: 5.0 </em></span></p></td></tr></tbody></table><p></p><table border="1" class="jiveBorder" style="border: 1px solid #c6c6c6; width: 100%;"><tbody><tr><th style="text-align: left; background-color: #f2f2f2; color: #505050; padding: 6px;" valign="middle"><h1><span style="color: #303030;">Local Host Logs statements </span></h1></th></tr><tr><td style="padding: 6px;"><p>Download the node files and verify the logs for information/statements such as the ones below:</p><p></p><p>Snippet from local host log files</p><p></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (609) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning import set ISET6612326 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (633) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=cf96b7b0db46aa00e93ff2e9af9619e6 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (637) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (639) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612283 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (641) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=55e8f7b4db8a2e4090b0ff1aaf96195c </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (645) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (647) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612284 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (649) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=f32b3738db8a2e4090b0ff1aaf961938 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (652) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (654) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612285 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (656) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=5a7d33b8db8a2e4090b0ff1aaf9619b0 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (659) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (662) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612286 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (664) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=81cf3f34db46aa00e93ff2e9af961975 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (667) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (669) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612287 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (671) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=5f02484ddb8a2e4090b0ff1aaf96193d </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (674) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (676) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612288 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (678) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=7d5484cddb8a2e4090b0ff1aaf961900 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (681) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (684) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612289 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (686) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=6ca60885db46aa00e93ff2e9af96194b </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (689) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (692) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612290 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (693) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=fee88c81dbca2e4090b0ff1aaf9619a6 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (696) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (699) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612291 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (701) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=d53bc8c5db46aa00e93ff2e9af96193e </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (705) worker.5 worker.5 *** Script: Import Set Cleaner:: .. 0 rows removed from ldap_import </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (707) worker.5 worker.5 *** Script: Import Set Cleaner:: Removing data from import set table ldap_import where import set=ISET6612292 </em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>2016-09-29 00:00:01 (709) worker.5 worker.5 *** Script: Import Set Cleaner:: Cleaning table ldap_import query:sys_import_set=088d0409db46aa00e93ff2e9af9619e9 </em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>..</em></span></p><p><span style="color: #303030; font-family: 'book antiqua', palatino;"><em>..</em></span></p><p><span style="color: #303030; font-size: 12px; font-family: 'book antiqua', palatino;"><em>** Script: Import Set Cleaner:: Deleting orphaned import set row records if any by querying for import set sys_id being empty for table: ldap_import</em></span></p></td></tr></tbody></table><p></p><h3>Workaround long-running Import Set Deleter job causing performance issues on the affected node:</h3><ol style="margin-bottom: 9px; color: #485563; font-family: SourceSansPro, 'Helvetica Neue', Arial; font-size: 13px;"><li><p>Navigate to <strong>Script Includes &gt; ImportSetCleaner.</strong></p></li><li>Change the line: <br/><em>this.cleanedImportSetRowTables.push(gr.table_name);</em><br/>to<br/><em>//this.cleanedImportSetRowTables.push(gr.table_name);</em></li></ol><p>Once you change the ImportSetCleaner line, you will notice that the line is now commented out.</p><p></p><p><strong>Releases this issue is currently fixed in:</strong></p><ul><li>Geneva Patch 10</li><li>Helsinki Patch 6</li><li>Istanbul</li></ul><p></p><p>We recommend that you upgrade to one of the releases, mentioned in <a href="https://hi.service-now.com/kb_view.do?sysparm_article=KB0597507" title="https://hi.service-now.com/kb_view.do?sysparm_article=KB0597507">ServiceNow KB: Import Set Deleter job causing instances to run low or out of memory, causing performance issues</a>, where the fix is found. Upgrading to one of these releases will prevent or improve performance caused by this particular issue.</p>