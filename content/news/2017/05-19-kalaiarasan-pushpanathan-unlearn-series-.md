---
title: "Unlearn Series  Adding a cool encoded query menu"
date: 2017-05-18T17:18:20.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=160deaa5dbd0dbc01dcaf3231f961978"
---
<p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">There have been few blog posts and share utilities by others that inspired coming up with this cool feature. If you are fan of those (which I am), then you might like this!</span></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;"><strong>Wouldn't it be cool to be able to right click on the filter breadcrumb and copy a encoded gliderecord similar to copying query?</strong></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;"><img   alt="5-18-2017 5-13-38 PM.png" class="image-1 jive-image" src="6328518edb1c97049c9ffb651f961998.iix" style="height: auto;"/></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;"><strong>To begin, creating global UI script is a bad practice</strong> and I avoid creating them as much as possible. But, you can do few cool things using a global UI script that wouldn't be possible otherwise. </span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">This is one such exception for using a global UI script that you can add in your system and get a cool menu that will give you a block of encoded query. I would recommend keeping this Development environment alone so that you don't run into risk of post upgrade issues or cause any other impact in case something changes in ServiceNow. Also, why would you need this on production when you are not supposed to do any manual work on Prod ? <span __jive_emoticon_name="happy" __jive_macro_name="emoticon" class="jive_emote jive_macro" data-renderedposition="440.72442626953125_895.5965576171875_16_16" src="/8.0.4.21bdc7e/images/emoticons/happy.png"></span></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">As <strong>g_list</strong> object and <strong>g_form</strong> does not seem to be available on list layout, I have used a combination of plain Javascript and Jquery methods to build the solution. Below are the steps used to build this menu.</span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">First, we need to sure that code doesn't run unnecessarily on all the pages except list which will be taken care by this.</span></li></ul><p></p><p><span style="font-size: 10pt; font-family: georgia, palatino; color: #303030;"><em>var currentURL = window.location.href;</em></span></p><p><span style="font-size: 10pt; font-family: georgia, palatino; color: #303030;"><em>var start = currentURL.indexOf('.com/');</em></span></p><p><span style="font-size: 10pt; font-family: georgia, palatino; color: #303030;"><em>var end = currentURL.indexOf('_list.do');</em></span></p><p><span style="font-size: 10pt; font-family: georgia, palatino; color: #303030;"><em>if(start != -1 &amp;&amp; end != -1)</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">Next, add a listener object to the filter breadcrumb so that whenever it is right clicked, we can add our custom menu. </span></li></ul><p></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>var getBreadCrumbObject = document.getElementById(tableName+'_breadcrumb');</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>getBreadCrumbObject.addEventListener("contextmenu", function(e)</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">Create a new menu item and append it to the existing list so that it is added last.</span></li></ul><p></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>var getCopyQueryElement = jQuery('#context_breadcrumb_menu');</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>var createNewMenu = '&lt;div id="custom_copy_encoded_query" item_id="copy_encoded_query" class="context_item" func_set="true"&gt;Copy encoded query&lt;/div&gt;';</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>getCopyQueryElement.append(createNewMenu);</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">Associate a click event handler function to the new item.</span></li></ul><p></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>jQuery("#custom_copy_encoded_query").click(function() {</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">Build the query from the different parameters of the URL (fixed query, normal query etc)</span></li></ul><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;"><em> <span style="font-family: georgia, palatino;"> var url = document.URL.parseQuery();</span></em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   var query = '';</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   if(url['sysparm_fixed_query'])</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   {</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   query = decodeURI(url['sysparm_fixed_query']);</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   query = query.replace('^EQ','');</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   }</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   if(url['sysparm_query']){</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   if(query!='')</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   {</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   query = query + '^' + decodeURI(url['sysparm_query']);</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   }</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   else</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   {</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   query = decodeURI(url['sysparm_query']);</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   }</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>   }</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">(Thanks to <a __default_attr="2899" __jive_macro_name="user" _jive_internal="true" class="jive_macro jive_macro_user" data-orig-content="&lt;span style=&quot;color: #303030;&quot; data-mce-style=&quot;color: #303030;&quot;&gt;&lt;span style=&quot;color: #3334ca;&quot; data-mce-style=&quot;color: #3334ca;&quot;&gt;jim.coyne&lt;/span&gt;) &lt;/span&gt;" data-renderedposition="1403.3238525390625_114.67329406738281_95_16" href="/community?id=community_user_profile&user=8352da29dbd81fc09c9ffb651f9619c7" modifiedtitle="true" title="&lt;span style=&quot;color: #303030;&quot;&gt;&lt;span style=&quot;color: #3334ca;&quot;&gt;jim.coyne&lt;/span&gt;) &lt;/span&gt;"><span style="color: #303030;" data-mce-style="color: #303030;"><span style="color: #3334ca;" data-mce-style="color: #3334ca;">jim.coyne</span>) </span></a>Create a skeleton script and add the computed query to it (Copied this from <a _jive_internal="true" href="/community?id=community_blog&sys_id=936d2e29dbd0dbc01dcaf3231f9619fc"><span style="color: #303030;"><span style="color: #3334ca;">here</span>)</span></a><br/></span></li></ul><p></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>var newLine = "\n";</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>var script = newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script = "//Change the gliderecord variable as per need"+ newLine +newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += "var gr = new GlideRecord('" + tableName + "');" + newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>if (query != "") {</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += "gr.addEncodedQuery('" + query + "');" + newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>}</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>else</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>{</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += "gr.addEncodedQuery('');" + newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>} </em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += "gr.query();" + newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += "while (gr.next()) {" + newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += newLine;</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>script += "}" + newLine;</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">Copy the script to the clipboard. </span></li></ul><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>copyToClipboard(script);</em></span></p><p></p><ul><li><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">Finally, add the hover effects to keep the style of the new menu consistent with the other menus.</span></li></ul><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em> }).hover(function(){ jQuery(this).addClass('context_menu_hover')},</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>function(){ jQuery(this).removeClass('context_menu_hover') }</em></span></p><p><span style="font-family: georgia, palatino; font-size: 10pt; color: #303030;"><em>);</em></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt; color: #303030;">The script is available <a title="ithub.com/iamkalai/CopyEncodedQuery" href="https://github.com/iamkalai/CopyEncodedQuery">https://github.com/iamkalai/CopyEncodedQuery</a> if you want to download and use it. Feel free to tweak the script if you notice any improvement opportunities and make sure you share the updated version here. Keep sharing - Keep learning !</span></p>