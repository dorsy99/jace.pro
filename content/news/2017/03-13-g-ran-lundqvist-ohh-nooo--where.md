---
title: "Ohh nooo where did my unsaved data go"
date: 2017-03-13T02:13:47.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=e01eae2ddbd0dbc01dcaf3231f96194c"
---
<p>This Dilemma is coming from a community member who was asked to put in a "confirm message" to a user where they had filled in information on a catalog item in the Service Portal and tried to move away from the page before "saving" it. We are talking pretty much the same functionality like we have on for example the incident form.</p><p></p><p>Before I continue, I would like to do a shout out to Nabil &amp; Jace(<a title="jacebenson" __default_attr="2082" __jive_macro_name="user" _jive_internal="true" class="jive_macro jive_macro_user" data-orig-content="jacebenson" data-renderedposition="73_409_92_16" href="/community?id=community_user_profile&user=d6625a69dbd81fc09c9ffb651f9619fc">jacebenson</a>) at our slack channel (sndevs.slack.com) for helping me getting the last pieces together.</p><p></p><p>I was going to record this as a video, but google seems to be messing with hangout so that wasn't possible, so bare with me. There can be a few screen shot coming this way.</p><p></p><p>So, we are looking at the page OOB "sc_cat_item" in the Service Portal.</p><p></p><p>It looks something like this when you selected an item:</p><p><img   class="image-1 jive-image" height="470" src="ac828002db18db048c8ef4621f9619ba.iix" style="width: 524px; height: 469.91px;" width="524"/></p><p></p><p>If I press back now or reload, the page will just do that without caring that there is info in a form that hasn't been saved.</p><p></p><p>So we need to customized the widget that are showing the catalog item. First thing is to clone that widget.</p><p>For those who doesn't know, you can "CTRL+right click" on the widget to get a menu like this and where you can easy go to the widget editor.</p><p><img   class="image-2 jive-image" height="258" src="b328ad0edb58d7041dcaf3231f9619ec.iix" style="width: 361px; height: 257.358px;" width="361"/></p><p>Now, we can't edit OOB widgets, so we need to clone the widget first to be able to edit it.</p><p><img   class="image-3 jive-image" height="194" src="266181c6db1897041dcaf3231f96196a.iix" style="width: 392px; height: 193.747px;" width="392"/></p><p>Choose a new name and we are almost ready. Remember when you cloned, the cloned version doesn't load in the widget editor automatically.</p><p></p><p>Now we need to put our widget on the page before we start to do anything. Easier for testing and not so much confusion when you think you have change it later on..</p><p>This widget is kind of weird, since when you go to page through designer mode, you will not see it there, but it is there..</p><p><img   class="jive-image image-4" height="211" src="006e5c4edb1c1f048c8ef4621f9619cd.iix" style="width: 572px; height: 211.271px;" width="572"/></p><p>I would say this is kind of buggy and there is different ways of removing it, you can for example go through the page editor, there it is visible like here:</p><p><img   class="image-5 jive-image" height="255" src="4bdd7bb5db141304b322f4621f9619c4.iix" style="width: 557px; height: 255.142px;" width="557"/></p><p></p><p>Anyway, I usually just mark the whole container, deletes it and then put in a new container, a 12 "column" and then my widget in there.</p><p>Then you can go back to your catalog page, reload it and when you "CTRL-right click" you should see your new widget name there.</p><p></p><p>So, open up your widget in the editor so we can do the real magic.</p><p></p><p>Before we start there might be some other way as well, I'm no Uber coder, but at least I got it to work =)</p><p>We need to do the following:</p><p></p><p>1. Add a name to the form that is holding the first. This is since angular is putting a variable on the form if it contains data that isn't saved and it's called $dirty. So if form-name.$dirty == true, it has unchanged data. I found on my world tour of google some example for angular to handle this, but couldn't get it real to work. In this example I name the form "c.myCatTest". if I just named it "myCatTest" I couldn't get it to work even if I should get it. So the only change in html template is this on line 21:</p><p><img   class="image-6 jive-image" height="258" src="9b41e942dbdc1b04ed6af3231f96197b.iix" style="width: 404px; height: 258.69px;" width="404"/></p><p></p><p>Then we need to do some client script as well. Now, you can put this pretty much where you want, but I put it here between line 62 &amp; 74:</p><p><img   class="image-7 jive-image" height="290" src="4113c18edbd01b04ed6af3231f9619a5.iix" style="width: 593px; height: 289.805px;" width="593"/></p><p></p><p>Now, This is two parts. The $scope.$on('$locationChangeStart'.... should be enough if I read the docs correctly,</p><p>but that triggers only if the user presses the back-button or presses on another link on the page, like breadcrumbs, menu etc.</p><p>I also tried here to change my code on line 64 to if ($scope.myCatTest.$dirty) when I named my form to "myCatTest" but couldn't get it to work, this works at least =)</p><p></p><p></p><p>The second part $window.onbeforeunload.... handles if the use trying to write in a URL manually or hit the reload button. <br/>It doesn't care about the back-button....Se we need both.</p><p></p><p>So with this code you now should be able to save, reload the catalog form on the portal and you should need to confirm if you have some unsaved data and try to leave.</p><p></p><p></p><p>Links for more info:</p><p>$dirty -&gt; <a href="https://docs.angularjs.org/api/ng/type/form.FormController" title="https://docs.angularjs.org/api/ng/type/form.FormController">https://docs.angularjs.org/api/ng/type/form.FormController</a></p><p>$locationChangeStart -&gt; <a href="https://docs.angularjs.org/api/ng/service/$location" title="https://docs.angularjs.org/api/ng/service/$location">https://docs.angularjs.org/api/ng/service/$location</a></p><p>$windows.onbeforeunload -&gt; <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload" title="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload">https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload</a></p><p></p><p>Hope this will save some time for other people as well.</p><p></p><p>//GÃ¶ran</p><p></p><p><img   alt="Symfoni Logo Color Box.jpg" class="image-8 jive-image" height="51" src="74df98c2dbd85344e9737a9e0f9619ca.iix" style="width: 175px; height: 51.1792px;" width="175"/><img   alt="sn-community-mvp.png" class="image-9 jive-image" src="11ccbff1db501344e9737a9e0f961916.iix" style="width: auto; height: auto;"/></p>