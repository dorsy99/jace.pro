---
title: "Unlearn Series  Restrict Users On Email Client"
date: 2017-08-01T09:22:45.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b62e2a6ddbd0dbc01dcaf3231f96197d"
---
<p><span style="font-family: verdana, geneva; font-size: 10pt;"><img  alt="8-1-2017 9-56-44 AM.png" class="image-1 jive-image" src="25bc884edb9c1304b322f4621f9619f9.iix" style="width: 620px; height: 333px;"/></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;">People have asked this question in the past where they wanted to restrict the users that are available for selection in the email client. This would be very useful if you want to enable the email client feature only to a subset of your active user base or want to restrict the users only on certain modules/tables.</span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;">Even I had the same question as we were needed to restrict the users available for selection and ServiceNow does not appear to provide any OOB solution for this. The below solution presents one of the way that you can do this while there may be other ways to do the same.</span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;">To begin, create a before query business rule on sys_user table and add the following conditions to make sure it runs when records are queried and not on update of record etc.</span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><strong>Condition</strong>: gs.getSession().isInteractive() &amp;&amp; (current.getEncodedQuery()).indexOf('active=true') != -1 &amp;&amp; gs.action != ''</span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><strong>Script: </strong></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>(function executeRule(current, previous /*null when async*/) {</em></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>try</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>if(gs.action.getGlideURI() != '')</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>if(gs.action.getGlideURI().getMap()!= '')</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>if(gs.action.getGlideURI().getMap().get('sysparm_processor')=='EmailClient') //This condition matches only if triggered from email client</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>//tables for which the email client check is to enabled.</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>var validTablesForEmailClient = 'incident';</em></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>//get the url containing the current tablename</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>urlToCheck = gs.action.getGlideURI().getMap().get('x_referer');</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>if(urlToCheck!='')</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>//parse and get the current tablename using Regex</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>var paramToCheck = 'sysparm_table';</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>var regex = new RegExp('[\\?&amp;]' + paramToCheck + '=([^&amp;#]*)');</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>var results = regex.exec(urlToCheck);</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>var tableName = (results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' ')));</em></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>if(tableName != '')</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>//Restriction applies only to table in validTablesForEmailClient variable</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>if(validTablesForEmailClient.indexOf(tableName)!=-1)</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>current.addEncodedQuery('roles=itil');</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>catch(errObj)</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>{</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>gs.error('Global_Set_Filter_Email_Client-'+errObj);</em></span></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>}</em></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><em>})(current, previous);</em></span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><strong>gs.action.getGlideURI().getMap().get('sysparm_processor')=='EmailClient'</strong> is important since it stops from processing the business rule, if it not triggered from email client. I have also used some regex to parse the current table from which the email client is triggered (using <span style="font-family: verdana, geneva; font-size: 13.3333px;"><em>x_referer paramter</em></span>) since I want to apply the restriction only when triggered from incident table. </span></p><p></p><p><span style="font-family: verdana, geneva; font-size: 10pt;"><strong>Note:</strong> gs.action is not a documented feature. So you take the risk when using undocumented feature.</span></p><p></p><p><span style="color: #666666; font-size: 13.3333px; font-family: verdana, geneva;"><em>If you liked the content, please share, like, bookmark or leave your valuable comments.</em></span></p>