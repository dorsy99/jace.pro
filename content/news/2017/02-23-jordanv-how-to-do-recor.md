---
title: "How to do record and field lookups in Service Portal"
date: 2017-02-23T00:43:01.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=a73e62addbd0dbc01dcaf3231f9619a3"
---
<p>In Service Portal, when you have the <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/build/service-portal/concept/enable-shopping-cart.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/build/service-portal/concept/enable-shopping-cart.html">Service Catalog Cart enabled</a> you may have found that while it populates the user ordering the items in the Cart view, the "Deliver to" address is empty. This happens even when the user has an address against their user profile.</p><p></p><p>I received a question recently asking if a user's deliver to address in the cart can be populated automatically with an order. While support doesn't normally provide customizations, I saw this as a good opportunity to improve my knowledge of the Service Portal. So I jumped in to see how easy it is to populate a field on the form using the new Service Portal configuration interface.</p><p></p><h1>How to do record and field lookups in Service Portal</h1><p>For this task I wanted to have the field populated automatically when the cart loads, and also for the "Deliver to" address to change if I change the user in the "Requested for" field.</p><p><img   alt="Service Catalog cart portal1.jpg" class="image-4 jive-image" src="e868ccc6db109704ed6af3231f961954.iix" style="width: 620px; height: 236px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>By clicking "Ctrl + Right Click" on the widget I was able to get straight to the configuration page I needed to modify via the link "Widget in Editor". See <span style="color: #eb7a3d;"><a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/build/service-portal/concept/c_ConfigureWidgetInstances.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/build/service-portal/concept/c_ConfigureWidgetInstances.html">Configure widget instances.</a><br/></span></p><p><img   alt="Screen Shot 2017-02-20 at 5.19.06 pm.JPG" class="image-2 jive-image" src="b13a6ccedb545f048c8ef4621f961927.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p>To populate the user's address, we will need to update both the <strong>Client Script</strong> and the <strong>Server Script.</strong></p><p></p><h2>Updating the Client Script to populate the user's address</h2><p>Service Portal uses the AngularJS framework, and upon changing a field an event is broadcast on the root scope called `field.change`. We can listen for that event to be broadcast with the following code:</p><p style="padding-left: 30px;"><span style="color: #909090;"><code>$scope.$on("field.change", function(evt, parms) { <br/>â€ƒâ€ƒ if (parms.field.name == '<span style="color: #e23d39;">field_name</span>' { <br/>â€ƒâ€ƒ // your code here <br/><br/>â€ƒâ€ƒ } <br/>}); </code></span></p><p></p><p>You can find the variable name of the field you want to update by inspecting the element using your browsers developer tools to find the ng-modal attribute:</p><p><img   alt="variableName1.jpg" class="image-10 jive-image" src="7fd3af71db941704ed6af3231f961916.iix" style="width: 620px; height: 266px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>Initially in the out of the box client script the "Deliver to" field is set to an empty string. You must first set the "Deliver to" location on the initial page load, so you can reference the server script location variable (that we will create later in this article) to update the Client Script from:</p><p style="padding-left: 30px;"><span style="color: #909090;"><code>c.deliverTo = ""; </code></span></p><p>to:</p><p style="padding-left: 30px;"><span style="color: #909090;"><code>c.deliverTo = <span style="color: #e23d39;">c.data.location</span>; </code></span></p><p style="padding-left: 30px;"></p><p>The next step is to call the Server Script when the client script "hears" the field change to obtain and populate the new location from the server:</p><p style="padding-left: 30px;"><code><span style="color: #909090;">$scope.$on("field.change", function(evt, parms) {<br/>â€ƒ if (parms.field.name == 'requested_for') { //detects that requestor name has changed<br/>â€ƒâ€ƒ c.deliverTo = '';<br/>â€ƒâ€ƒ c.server.get({ //send the server the new user ID &amp; action is to update the location<br/>â€ƒâ€ƒâ€ƒ <span style="color: #e23d39;">userID</span>: parms.newValue, <br/>â€ƒâ€ƒâ€ƒ <span style="color: #e23d39;">action</span>: "get_user_location"<br/>â€ƒâ€ƒ }).then(function(response) { //update the location displayed on the form<br/>â€ƒâ€ƒâ€ƒ c.deliverTo = <span style="color: #e23d39;">response.data.location</span>; <br/>â€ƒâ€ƒ });<br/>â€ƒâ€ƒ }<br/> });</span></code></p><p><span style="line-height: 1.5;">Note: When the field.change event is broadcast, the callback function is supplied with a "parms" parameter which contains the old and new values for the field that changed. Above we are setting userID to the "newValue" to be sent to the server along with the action to perform. The "c.deliverTo" value is taking the data returned from the server side call to populate that field.</span></p><p></p><h2>Updating the <strong>Server Script to look up the user's address</strong></h2><p>First we will create the function that looks up the address based on the userID passed to the function:</p><p style="padding-left: 30px;"><span style="color: #909090;"><code>function getUserLocation(userSysID) { <br/>â€ƒ var sysUserGR = new GlideRecord("sys_user");<br/>â€ƒ sysUserGR.get(userSysID);<br/>â€ƒ var newLocation = sysUserGR.getElement("location");<br/>â€ƒ return newLocation.getDisplayValue();<br/> } </code></span></p><p></p><p>In the client script, we are using the c.server.get function which creates on the server an input object containing the userID and action (get_user_location) to perform. The code below is only run when the "Requested for" value changes and triggers the c.server.get function as this supplies the correct parameters for the if statement.</p><p style="padding-left: 30px;"><code><span style="color: #909090;">if (input &amp;&amp; input.action === "<span style="color: #e23d39;">get_user_location</span>") {<br/>â€ƒ userID = input.userID;<br/>}</span></code></p><p></p><p>The userID variable is already populated near the beginning of the server script. The above is used if "Requested for" changes to override the initial user ID with the new value.</p><p></p><p>You need to place the line below to populate the location variable to be supplied to the client (both when the form loads and when the value changes).</p><p style="padding-left: 30px;"><span style="color: #909090;"><code><span style="color: #e23d39;">data.location</span> = getUserLocation(userID); </code></span></p><p></p><p>I've included a screenshot below showing exactly where I've added this code below:</p><p><img   alt="record service portal catalog.jpg" class="image-11 jive-image" height="162" src="df98458edb541b04ed6af3231f9619b3.iix" style="display: block; margin-left: auto; margin-right: auto; height: 162px; width: 797.143px;" width="797"/></p><p></p><p><span style="color: #eb7a3d;"><span style="color: #303030;">With the updates above, the "Deliver To" address is populated when the cart form is loaded and when the "Requested for" user is changed.</span><br/></span></p><p></p><p><span style="color: #303030;">One catch I found from going through this exercise was my server side function "getUserLocation" was towards the end of the server script. For some reason it did not work until I moved it toward the top of the server script. I am still working on finding the cause for this.</span></p><p></p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="2696_8_1192_43"><p><span style="color: #303030;">If you find any function appears to not be running ensure it is towards the top of the server script like my screenshot above.</span></p></pre><p><span style="color: #303030;">Another handy tip is clicking "Ctrl + Right Click" on the widget then click "Log to console: $scope.data." This displays all of the content in the data object passed from the server script to the client script in the browser developer tools javascript console:<br/></span></p><p><span style="color: #303030;"><img   alt="scopedata.jpg" class="image-12 jive-image" src="40c428cedb505f048c8ef4621f961962.iix" style="width: 620px; height: 555px; display: block; margin-left: auto; margin-right: auto;"/><br/></span></p><p><span style="color: #303030;">The screenshot below shows a sample of the data logged, and you can see the "data.location" contents that we obtained above in this output:<br/><img   alt="data location logged1.jpg" class="image-13 jive-image" src="e3044c06dbd85fc03eb27a9e0f961915.iix" style="width: 620px; height: 88px; display: block; margin-left: auto; margin-right: auto;"/><br/></span></p><p>There is also <span style="color: #303030;">"Log to console: $scope" as an option, this provides all data contained in the $scope object including "$scope.data" and can provide extra information for your developing purposes beyond that stored in the data object.</span></p><p></p><p><span style="color: #303030;">If you have any tips or improvements on my implementation above, I look forward to hearing them in the comments for this article. This is only scraping the surface of what is possible in the Servicenow Service Portal.</span></p><p></p><p>Other sources:</p><p><a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service_portal/concept/ClientScript.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service_portal/concept/ClientScript.html">Widget Client Script</a></p><p><a href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_Scripting.html" title="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_Scripting.html">Widget scripting</a></p><p><a href="https://github.com/service-portal/documentation" title="https://github.com/service-portal/documentation">GitHub - service-portal/documentation: Here you will find unofficial documentation for the ServiceNow Service Portal tec…</a></p>