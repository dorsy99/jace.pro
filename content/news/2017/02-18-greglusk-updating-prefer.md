---
title: "Updating Preferences on User Logout"
date: 2017-02-17T22:38:16.000Z
authors: ["GregLusk"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ee4d6229dbd0dbc01dcaf3231f961956"
---
<p><span style="font-size: 10.5pt; font-family: 'Helvetica Neue';">One of the first suggestions to increase performance for a user is to reduce the number of rows per page that the user displays.   However, there are legitimate use cases that require a large number of rows to be displayed at once.   How can we allow as much flexibility for our users while still paying attention to performance issues?   The solution below allows administrators to set a maximum default rows system property that is used to reset the maximum rows count for users when their session has ended, instead of keeping the user's last setting. It can easily be adapted to set other user preferences on logout.   Import set attached.</span></p><p>   </p><ol><li>Create 3 new System Properties in the sys_properties table:<ol><li>lll.max.row.count<ul><li>Name: lll.max.row.count.</li><li>Description: Sets the maximum number of the value for maxrows on the users preference record before reseting it to lll.reset.count at logout.</li><li>Type: integer.</li><li>Value: User configurable integer.</li></ul></li><li>lll.reset.count<ul><li>Name: lll.reset.count.</li><li>Description: The value to set maxrows on the users preference record after the value is higher than lll.max.row.count.</li><li>Type: integer.</li><li>Value: User configurable integer, should be equal or less than lll.max.row.count.</li></ul></li><li>lll.excluded.users<ul><li>Name: lll.excluded.users.</li><li>Description: Comma separated values of user IDs to exclude from List Limit Limiting.</li><li>Type: string.</li><li>Value: User configurable string of login ids to exclude from list limit limiting.</li></ul></li></ol></li><li>Create a business rule with the following properties:<ul><li>Name: List Limit Limiter</li><li>Table: User Session [sys_user_session]</li><li>Priority: 100</li><li>Active: true</li><li>Advanced: true</li><li>When: async</li><li>Order: 100</li><li>Update: true</li><li>Condition: current.invalidated.changes() &amp;&amp; current.invalidated.hasValue() &amp;&amp; current.name.hasValue()   &amp;&amp;   gs.getProperty('lll.excluded.users').indexOf(current.name) ==-1</li><li>Script:</li></ul></li></ol><p>(function executeRule(current, previous /*null when async*/) {</p><p>//This BR executes when a user session is ended.   It checks if the user is in the exclude</p><p>//list (lll.excluded.users) if it is not it compares the number of list rows the user has</p><p>//set to display against a maximum number (lll.max.row.count) if the list rows is greater</p><p>//than the maximum number the users list row number is set to lll.reset.count</p><p>         var LoggedOutUser = new GlideRecord('sys_user');</p><p>         if (LoggedOutUser.get('user_name',current.name)){</p><p>//setPreference and getPreference do not work for the rowcount preference:</p><p><span>//</span><a title="" _jive_internal="true" href="http://wiki.servicenow.com/index.php?title=User_Preference_Settings" rel="nofollow" target="_blank">http://wiki.servicenow.com/index.php?title=User_Preference_Settings</a></p><p>                   var userPref = new GlideRecord('sys_user_preference');</p><p>                   userPref.addQuery('user',LoggedOutUser.sys_id);</p><p>                   userPref.addQuery('name','rowcount');</p><p>                   userPref.query();</p><p>                   while (userPref.next()){</p><p>                             if (parseInt(userPref.value) &gt; parseInt(gs.getProperty('lll.max.row.count'))){</p><p>                                       userPref.value = gs.getProperty('lll.reset.count');</p><p>                                       userPref.update();</p><p>                             }</p><p>                   }</p><p>         }</p><p>})(current, previous);</p>