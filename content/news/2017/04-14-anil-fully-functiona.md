---
title: "Fully functional UI action"
date: 2017-04-14T02:19:30.000Z
authors: ["Anil"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=8fcda2e9dbd0dbc01dcaf3231f96194a"
---
<p>UI action to create an adhoc request from incident</p><p>table name of adhoc request = <span style="font-family: 'Courier New';">u_ad_hoc_request</span></p><p>Please see the code below, few things to mention in the below code</p><ol style="list-style-type: decimal;"><li><span style="font-family: 'Courier New';">gsftSubmit(null, g_form.getFormElement(), 'createadhocrequest'); // This line is needed for the UI action to work if there is a onclick event on the ui action. Replace 'createadhocrequest' with the 'Action name' on the UI action.</span></li><li><span style="font-family: 'Courier New';">The url that is build should follow below logic</span></li></ol><p style="margin-left: 1.0in;"><span style="font-family: 'Courier New';">&lt;instance url&gt;+&lt;tablename&gt;+.do?sys_id=-1&amp;sysparm_query=+&lt;field1&gt;+&lt;field1value&gt;+^&lt;field2&gt;&lt;field2value&gt;+^&lt;field3&gt;&lt;field3value&gt; and so on</span></p><ol style="list-style-type: decimal;"><li><span style="font-family: 'Courier New';">3.   </span><span style="font-family: 'Courier New';">gs.action.setRedirectURL(url); // This is the command to redirect to the new record</span></li><li><span style="font-family: 'Courier New';">4.   </span><span style="font-family: 'Courier New';">gs.action.setReturnURL(current); // This is the command to set the return to current record</span></li><li><span style="font-family: 'Courier New';">5.   </span><span style="font-family: 'Courier New';">Add a condition in the UI action to check if the adhoc_request is null (condition: current.adhoc_request.nil()), also add conditions to ensure that the incident state is in the states in which you would allow users to create an adhoc request out of it.</span></li></ol><p></p><p><span style="font-family: 'Courier New';">function runClientCode(){</span></p><p><span style="font-family: 'Courier New';"> //validate if this field is filled in..</span></p><p><span style="font-family: 'Courier New';"> g_form.setMandatory('assigned_to',true);</span></p><p><span style="font-family: 'Courier New';"> gsftSubmit(null, g_form.getFormElement(), 'createadhocrequest');// This line is important (//MUST call the 'Action name' set in this UI Action)</span></p><p><span style="font-family: 'Courier New';">}</span></p><p><span style="font-family: 'Courier New';">if(typeof window == 'undefined') { // Ensures serverside call of this code, runs without onclick</span></p><p><span style="font-family: 'Courier New';"> createAdhocRequest();</span></p><p><span style="font-family: 'Courier New';">}</span></p><p><span style="font-family: 'Courier New';">function createAdhocRequest() {</span></p><p><span style="font-family: 'Courier New';"> var url = gs.getProperty('glide.servlet.uri')+'u_ad_hoc_request.do?sys_id=-1&amp;sysparm_query=';</span></p><p><span style="font-family: 'Courier New';"> url += 'category=' + current.category.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^subcategory=' + current.subcategory.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^requested_by=' + current.caller.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^requested_for=' + current.caller.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^priority=' + current.priority.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^assignment_group=' + current.assignment_group.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^assigned_to=' + current.assigned_to.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^short_description=' + current.short_description.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^description=' + current.description.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^comments=' + current.comments.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^work_notes=' + current.work_notes.toString();</span></p><p><span style="font-family: 'Courier New';"> url += '^sys_created_on=' + current.sys_created_on.toString();</span></p><p><span style="font-family: 'Courier New';"> url+=   '^parent=' + current.sys_id;</span></p><p><span style="font-family: 'Courier New';"> gs.action.setRedirectURL(url);</span></p><p><span style="font-family: 'Courier New';"> gs.action.setReturnURL(current);</span></p><ol style="list-style-type: lower-alpha;"><li><span style="font-family: 'Courier New';">current.state = 7 ; // set incident state to closed</span></li></ol><p><span style="font-family: 'Courier New';"> current.work_notes ='adhoc request created';</span></p><p><span style="font-family: 'Courier New';"> current.comments' ='adhoc request created';</span></p><p><span style="font-family: 'Courier New';"> current.update();</span></p><p><span style="font-family: 'Courier New';">}</span></p><p></p><p></p><p>Few thoughts Business rule on adhoc request table:</p><ol style="list-style-type: decimal;"><li><strong>After</strong> business rule</li><li><strong>Insert is checked</strong></li><li>This BR will have code like the one below, I have added a line to set the adhoc_request field on the incident table with the adhoc request created)</li></ol><p></p><p>var gr = new GlideRecord('incident');</p><ol style="list-style-type: lower-alpha;"><li>gr.addQuery('sys_id',current.parent);</li><li>gr.query();</li></ol><p>if(gr.next()) {</p><p> gr.comments = 'This ticket has been converted to' + current.number+ '.'; // Add additional comments</p><p> gr.close_notes = 'This ticket has been converted to' + current.number+ '.';</p><p> gr.adhoc_request = current.sys_id; </p><p> gr.update();</p><p>}</p><p></p><p></p><p>Further reading : <a title="ww.servicenowguru.com/system-ui/ui-actions-system-ui/client-server-code-ui-action/" href="https://www.servicenowguru.com/system-ui/ui-actions-system-ui/client-server-code-ui-action/">https://www.servicenowguru.com/system-ui/ui-actions-system-ui/client-server-code-ui-action/</a></p><p><a title="" _jive_internal="true" href="/community?id=community_question&sys_id=5d46cba1db1cdbc01dcaf3231f9619aa">https://community.servicenow.com/thread/172048</a></p><p><a title="" _jive_internal="true" href="/community/it-service-management/blog/2015/05/06/getting-that-url-right">https://community.servicenow.com/community/it-service-management/blog/2015/05/06/getting-that-url-right</a></p><p><a title="ki.servicenow.com/index.php?title=GlideRecord#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=GlideRecord#gsc.tab=0">http://wiki.servicenow.com/index.php?title=GlideRecord#gsc.tab=0</a> (getLink method).</p><p></p><p></p><p>Thanks</p><p>Anil</p>