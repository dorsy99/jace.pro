---
title: "Discover Cisco WAP Device from Controller"
date: 2017-11-29T20:04:53.000Z
authors: ["Patrick DeCarlo"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=b53daae5dbd0dbc01dcaf3231f961973"
---
<p><span style="font-size: 8pt;"><em>** This example is based around Cisco based product *** </em></span></p><p></p><p><span style="text-decoration: underline; font-size: 10pt;"><strong>Overall Developer Steps:</strong></span></p><ol><li><span style="font-size: 10pt;">Load MIB files needed for SNMP</span><ol style="list-style-type: lower-alpha;"><li><span style="font-size: 10pt;">The MIBs I loaded: AIRESPACE-WIRELESS-MIB, AIRESPACE-REF-MIB, AIRESPACE-SWITCHING-MIB</span></li></ol></li><li><span style="font-size: 10pt;">Create new Probe to pull SNMP Query</span><ol style="list-style-type: lower-alpha;"><li><span style="font-size: 10pt;">Tie probe back to "Standard Network Switch Classifier" Trigger</span></li></ol></li><li><span style="font-size: 10pt;">Create Custom Sensor to read data and insert in CMDB with relationships. </span></li></ol><p></p><p></p><p><span style="text-decoration: underline; font-size: 10pt;"><strong>Creating Custom Probe:</strong></span></p><p></p><p><span style="text-decoration: underline; font-size: 10pt;"><strong><img   class="image-1 jive-image" height="263" src="6a7841cadb1413043eb27a9e0f96198b.iix" style="height: 263px; width: 644.506px;" width="645"/></strong></span></p><p></p><p><span style="font-size: 10pt;"><strong>SNMP Fields:</strong></span></p><p><span style="font-size: 10pt;">Command == Table</span></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-size: 10pt;">OID == iso.org.dod.internet.private.enterprises.airespace.bsnWireless.bsnAP.bsnAPTable</span></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-size: 10pt;">Table Fields == bsnAPName,bsnAPDot3MacAddress,bsnAPPrimaryMwarName,bsnAPModel,bsnAPIOSVersion,bsnAPSerialNumber</span></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p>Next we need to tie Probe back to Standard Network Switch Classifier Trigger. If you know this probe is only needed for one type of device then you can create a new classifier and add this probe and others to new classifier.</p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="text-decoration: underline; font-size: 10pt;"><strong>Creating Custom Sensor:</strong></span></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;">Make sure sensor reacts to Probe just created above.</p><p style="font-family: Calibri; font-size: 11.0pt;">Sensor Type = Sensor</p><p style="font-family: Calibri; font-size: 11.0pt;">Sensor Type(The Other one) = Javascript</p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;">Script:</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1511964117821692 jive_text_macro" data-renderedposition="908.78125_8_1192_1056" jivemacro_uid="_1511964117821692"><p></p><p>new DiscoverySensor({</p><p>process: function (result, ciData) {</p><p>var snmp = new SNMPResponse(result);</p><p>//gs.info('PD: IN SNMP - WAP Device');</p><p>//ensures that we call the current record (used for creating the "parent" relationship below)</p><p>var recOBJ = this.getCmdbRecord();</p><p>//enter into the table we defined in the probe</p><p>var wapTable = 'iso.org.dod.internet.private.enterprises.airespace.bsnWireless.bsnAP';</p><p>var apTable = snmp.getOIDTable(wapTable, 'bsnAPEntry');</p><p>//gs.info('PD: IN SNMP - WAP Device and wapTable {0} and apTable {1}', wapTable, apTable);</p><p></p><p>for (var ap in apTable) {</p><p>var model = apTable[ap]['bsnAPModel'];</p><p>//get Model info/ or Create</p><p>var mod = new GlideRecord('cmdb_model');</p><p>mod.addQuery('name', model);</p><p>mod.query();</p><p>if (!mod.next()) {</p><p>mod.initialize();</p><p>mod.name = model;</p><p>mod.insert();</p><p>}</p><p></p><p>var idResult;</p><p>var logger = new DiscoveryLogger();</p><p>logger.setSource(this.type);</p><p>logger.setSensor(this.getEccQueueId());</p><p></p><p>var apData = new CIData({</p><p>"sys_class_name": "cmdb_ci_wap_network",</p><p>"name": Â  apTable[ap]['bsnAPName'].toUpperCase(),</p><p>"serial_number": apTable[ap]['bsnAPSerialNumber'],</p><p>"mac_address": apTable[ap]['bsnAPDot3MacAddress'],</p><p>"model_id": mod.sys_id,</p><p>"comments": 'OS Version = '+apTable[ap]['bsnAPIOSVersion']</p><p></p><p>});</p><p></p><p>idResult = DiscoveryCMDBUtil.insertOrUpdate(apData, logger);</p><p></p><p>var id = idResult.sysId;</p><p></p><p></p><p>// Build/Update relationship data</p><p>//getting type id</p><p>var t = new GlideRecord('cmdb_rel_type');</p><p>t.get('name', 'Controller for::Controlled by');</p><p>var rel = new GlideRecord('cmdb_rel_ci');</p><p>rel.addQuery('parent', recOBJ.sys_id);</p><p>rel.addQuery('child', id);</p><p>rel.addQuery('type', t.sys_id);</p><p>rel.query();</p><p>if(!rel.next()){</p><p>rel.type = t.sys_id;</p><p>rel.parent = recOBJ.sys_id;</p><p>rel.child = id;</p><p>rel.update();</p><p>}</p><p>}</p><p></p><p>},</p><p>type: 'DiscoverySensor'</p><p>});</p><p></p><p></p></pre><p></p><p>For your needs, you might want to adjust or add the fields you need to collect for your needs.</p><p></p><p>I hope example helps others out there with the same needs. </p><p>Thanks to Ryan Zulli for his help. </p>