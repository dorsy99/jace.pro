---
title: "ServiceNow Scripting  ClientServer Communication"
date: 2017-04-13T07:27:52.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=57cce265dbd0dbc01dcaf3231f961901"
---
<p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">As a ServiceNow Administrator, you will often be asked to find ways of improving efficiency within the IT Service Desk. While there are many ways to do this, a simple example would be retrieving and displaying related information for the Service Desk Analyst before they go looking for it. This could be information from the caller's <em>User</em> record, <em>Location</em> record or even a <em>Configuration Item</em>. Today we'll focus on the various options available for handling communication between the client and server when requesting <span style="text-decoration: underline;">related</span> information.</span></p><p></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Most ServiceNow Administrators would likely have used the <span style="color: #2873ee;"><em><a href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;id=c_GlideFormAPI"><span style="color: #2873ee;">GlideForm</span></a></em></span> (g_form) API to manipulate field data within a table form. But did you also know that this API offers the ability to retrieve database records as JavaScript objects? The <em>getReference()</em> method allows us to retrieve a table record in the form of a JavaScript object. Only records populated in <em>Reference</em> fields on the current table form can be retrieved using this method. For an <em>Incident</em> record, this would include <em>User</em> records on the <em>Caller</em>, <em>Opened By</em> or <em>Assigned To</em> fields, or even records from the <em>Location</em> or <em>Configuration Item</em> fields.</span></p><p></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Let's take a simple example:</span></p><p style="margin-left: 36.0pt;"><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><em>Retrieve the Configuration Item record and display the IP Address values in a field message.</em></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">The <em>getReference() </em>method can be used to retrieve the selected <em>Configuration Item</em> record as a JavaScript object, and then we can access the object's properties (e.g. field values) to display the <em>IP Address</em> to the user. Let's take a look at the code.</span></p><p><span style="font-family: arial, helvetica, sans-serif; color: #303030; font-size: 12pt;"><img   alt="1.png" class="image-1 jive-image" src="648624cedb14d704ed6af3231f96193e.iix" style="width: 620px; height: 242px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">The above code is contained with an <em>onChange</em> Client Script running on the <em>Incident</em> table. The script has been modified such that it will run when the form loads, as well as when the <em>Configuration Item</em> value changes. Since we're using a field level message, another <em>g_form</em> method called <em>showFieldMsg()</em> is being called to show the <em>IP Address</em> value. Although the above script will not attempt the <em>getReference() </em>call if the <em>Configuration Item</em> field is empty, we still check that the returned record object <em>ciRec</em> exists (line 8) before attempting to access its <em>ip_address</em> property. Failing to do this could result in an error when processing the client side JavaScript. We also check that the selected <em>Configuration Item</em> has an <em>IP Address </em>value, and only show the message if it does. Let's take a look at the result.</span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="2.png" class="image-2 jive-image" src="3976c00adbdcd3049c9ffb651f9619c3.iix" style="width: 620px; height: 264px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">As you can see, the <em>IP Address</em> value was retrieved for the selected <em>Configuration Item</em>, and displayed in the blue field message. The <em>getReference() </em>method is a very quick and easy way to achieve such a result, but it does have its limitations. Firstly, it provides no functionality to select which fields we want to retrieve from the selected record, and as such will retrieve the entire record from the database. In the case of a table with many fields, this increases the amount of data being transferred and therefore increases the time required to retrieve and process the values. Secondly, the record object only contains values stored on the selected record. This means that any populated <em>Reference</em> fields on the selected record will only contain the <em>sys_id</em> values of those referenced records. This means that no <em>Display Values</em> are accessible via the object, and the ability to <em>dot-walk</em> to other fields is also not available. Lastly, another limitation exists when accessing a referenced record from an <em>extended table</em>. The <em>getReference()</em> method will only retrieve the record via the <em>base table</em>. That means that any fields defined on the <em>extended table</em> and not on the <em>base table</em>, will be unavailable on the returned JavaScript object. An example of this would be the <em>Business Criticality</em> field on the <em>Business Service</em> class of <em>Configuration Item</em>.</span></p><p></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">To overcome the <em>getReference()</em> limitations described above, another solution can be used called <span style="color: #2873ee;"><em><a href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;id=c_GlideAjaxAPI"><span style="color: #2873ee;">GlideAjax</span></a></em></span>. Although this process is more complex to use, it presents significant benefits regarding data efficiency and speed, as well as the ability to do a lot more than just retrieve table record data. By using the GlideAjax class, a <em>Client Script</em> can be used call the server and trigger a server-side script to run. Examples of this include accessing any of the <span style="color: #2873ee;"><em><a href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;id=c_GlideSystemAPI"><span style="color: #2873ee;">GlideSystem</span></a></em></span> methods (<em>gs.getProperty() </em>or <em>gs.getUser()</em> etc.), or updating a database record directly by using the <em>GlideRecord</em> class. </span></p><p></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">So how does it work I hear you ask? Well, within a <em>Client Script</em> an object is instantiated from the <em>GlideAjax</em> class. This class is available on any ServiceNow table form, and even on UI Pages. Parameters are then defined and posted to the server for processing. Then, a <em>Script Include</em> on the server is invoked, and this script determines if and what values should be returned to the client. One of these parameters <span style="text-decoration: underline;">must</span> be the name of a function defined in the <em>extended GlideAjax</em> class. Before we take a look at the code, let's define a new example:</span></p><p style="margin-left: 36.0pt;"><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><em>Retrieve and display the name of the user who Manages the selected Configuration Item.</em></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">As we saw earlier, we'll need an <em>onChange</em> Client Script running on the <em>Incident</em> table, which is triggered when the <em>Configuration Item</em> value changes. But first, let's take a look at the <em>Script Include</em> and define what we want the server side script to actually do.</span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="3.png" class="image-3 jive-image" src="01b36731db141fc068c1fb651f9619e4.iix" style="width: 620px; height: 349px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p><span style="font-family: arial, helvetica, sans-serif; color: #303030; font-size: 12pt;"><span style="background: white;">In my last post we discussed </span><span style="background: white; color: #2873ee;"><a _jive_internal="true" href="/community?id=community_blog&sys_id=88bce625dbd0dbc01dcaf3231f9619be"><span style="color: #2873ee;">Class Vs Classless Script Includes</span></a></span><span style="background: white;">. In this example we will define a class in a <em>Script Include</em>, however it is considered an <em>extended class</em> as it builds on the existing functionality provided by ServiceNow. In technical terms this is called <em>Prototyping</em>. The class definition is slightly different to the default stub provided after entering the script name, however the content where functions/methods and properties are defined is still the same. In the above code extract, you will see that we've defined a function stub called <em>getManagedBy()</em>. This will be the function we call from our <em>Client Script</em>. As this function can be called from any table form, we will need to pass the <em>sys_id</em> value of the Configur<em>ation Item</em> record we want to retrieve data from. Then, after retrieving the <em>sys_id</em> value the function should run a <em>GlideRecord</em> query to obtain the <em>Configuration Item</em> record as an object. From here we can return the <em>Display Value</em> of the <em>managed_by</em> field. Let's look at the updated code below.</span></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="4.png" class="image-4 jive-image" src="e535c90adb90130468c1fb651f961930.iix" style="width: 620px; height: 270px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">As you can see, we've added some code to use the <em>sys_id</em> value to retrieve the <em>GlideRecord</em> object, and then call a method called <em>getDisplayValue()</em> to retrieve the <em>Display Value</em> of the <em>managed_by</em> field. Since this field is a reference to the <em>User</em> table, the <em>Display Value</em> is the value from the <em>name</em> field (e.g. the user's full name). This value will be passed back to the client when requested. Now let's look at the <em>Client Script</em>.</span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="5 (new).png" class="image-5 jive-image" src="3694e84edb505f048c8ef4621f961909.iix" style="width: 620px; height: 315px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">Like the <em>onChange</em> <em>Client Script</em> we used earlier in the <em>getReference() </em>example, this script is triggered when the <em>Configuration Item</em> field is populated. If the value is cleared, it will clear any field level messages that may have been previously displayed. We've also defined 2 local functions (meaning they are only available within the scope of this <em>onChange</em> function). The first is called <em>getConfigManagedBy()</em> and is invoked directly by the <em>onChange</em> function. The second function is called <em>getConfigManagedByCallBack()</em> and it is called indirectly when a response is received from the server (this is known as a <em>Callback</em>). As you can see, in the first function we instantiate an object from the <em>GlideAjax</em> class, and in doing so we pass the name of the <em>Script Include</em> we defined - <em>ConfigurationItemAjax</em>. Then, we use a method called <em>addParam() </em>to add some name/value pairs. The first parameter name is <em>sysparm_name</em>, and its value refers to the name of the we want to call within our <em>Script Include</em> (e.g. <em>getManagedBy()</em>). The next parameter name is <em>sysparm_ciSysId</em>, and its value is the <em>sys_id</em> of the selected <em>Configuration Item</em>. Finally, we call a method called <em>getXML() </em>and pass to it the name of the <em>Callback</em> function. When this method is called, the parameters are sent to the server, and there our <em>Script Include</em> function will be invoked. Once processed, the server script will return a value to the client, and in doing so will invoke the nominated <em>Callback</em> function - <em>getConfigManagedByCallBack()</em>. This function receives the server's payload in the form of an object called <em>response</em>. Although it may look tricky, line 18 simply dot-walks along some object properties to get an attribute named <em>answer</em>. This value is then assigned to a local variable of the same name. Because we only want to show our message when the value is not empty, we first check if the returned value is empty. If the value is not empty, we call the <em>g_form</em> method <em>showFieldMsg()</em> and show a field level message with the name of the user who currently manages the selected <em>Configuration Item</em>. Let's take a look at the result.</span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><img   alt="6.png" class="image-6 jive-image" src="22b5cc46db98db048c8ef4621f96196c.iix" style="width: 620px; height: 258px; display: block; margin-left: auto; margin-right: auto;"/></span></p><p><span style="color: #303030; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;">As you can see, Roger Rasmussen manages the selected <em>Configuration Item</em> called <em>Client Services</em>. While this example of <em>GlideAjax</em> is fairly simple, I'm sure you have realised its potential for retrieving a great deal of useful information for the user. For further information on the topics covered in this article, please see the following pages on the ServiceNow Wiki:</span></p><ul><li><span style="color: #2873ee; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><a href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;id=c_GlideAjaxAPI"><span style="color: #2873ee;">GlideAjax</span></a></span></li><li><span style="color: #2873ee; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><a href="https://developer.servicenow.com/app.do#!/api_doc?v=helsinki&amp;id=c_GlideFormAPI"><span style="color: #2873ee;">GlideForm</span></a></span></li><li><span style="color: #2873ee; background: white; font-family: arial, helvetica, sans-serif; font-size: 12pt;"><a href="http://wiki.servicenow.com/index.php?title=Client_Script_Best_Practices"><span style="color: #2873ee;">Client Script Best Practices</span></a></span></li></ul><p></p><p><span style="color: #2873ee; background: white; font-size: 12pt; font-family: arial, helvetica, sans-serif;"><span style="font-weight: bold; font-family: 'Times New Roman'; color: #666666;">NOTE</span><span style="font-family: Arial; color: #666666;">: </span><span style="font-family: 'Times New Roman'; color: #666666;">MY POSTINGS REFLECT MY OWN VIEWS AND DO NOT NECESSARILY REPRESENT THE VIEWS OF MY EMPLOYER. </span></span></p>