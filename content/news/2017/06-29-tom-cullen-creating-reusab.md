---
title: "Creating reusable custom scripted steps in ATF"
date: 2017-06-29T00:12:28.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=398d6669dbd0dbc01dcaf3231f9619d2"
---
<p>Istanbul brought us the first version of the Automated Testing Framework for ServiceNow.   These out-of-box steps for testing our applications are already saving time and money for all of us.   Forms, UI testing, and server side testing was the Istanbul release focus.   In the Jakarta release, the ATF team is delivering Service Catalog, Rest APIs, Scheduling, Transaction log, and browser options.   The ongoing development of this service is in good hands!</p><p></p><p>Today I want to go over the steps for creating a custom (and reusable) scripted step for ATF.   Before I begin I'd like to give a shout out to the great work that <a title="drjohnchun" __default_attr="29028" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="drjohnchun" data-renderedposition="92.80000305175781_983.125_89_17" href="/community?id=community_user_profile&user=53101665db581fc09c9ffb651f9619f6">drjohnchun</a> done with his Automated Test Framework series and the communications from <a title="fernando.cremer@servicenow.com" __default_attr="56637" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="fernando.cremer@servicenow.com" data-renderedposition="113.5999984741211_467.51251220703125_234_17" href="/community?id=community_user_profile&user=13f0daa1db981fc09c9ffb651f961960">fernando.cremer@servicenow.com</a>, <a title="Anson.Mayers" __default_attr="14204" __jive_macro_name="user" class="jive_macro jive_macro_user" data-orig-content="Anson.Mayers" data-renderedposition="113.5999984741211_709.7125244140625_108_17" href="/community?id=community_user_profile&user=640f86a1db181fc09c9ffb651f96199a">Anson.Mayers</a>, and @Shrity_Verma. I'm always amazed at the depth of the ServiceNow community.</p><p></p><p><span style="font-size: 18pt;">Why use a custom scripted step?</span></p><p>The obvious reason is there is a test scenario that can't be replicated by working with OOB steps only.     That's what happened to me.   I was asked to write a Hacklab for K17.   It was my first experience with ATF.   I took a simple application and tested it manually, then built the corresponding steps as a TEST in ATF and named it "OC1 Application Test 1".   Pretty easy and very straight forward -but- I couldn't exactly replicate my manual test.   The reason was I use workflows whenever possible.   It's the "power of the platform" and saves so much code/test time its crazy.   So when I test, I include the "Show Workflow" related list and once I perform an action, I check to see that the workflow is where I expect it to be.</p><p></p><p>You guessed it ... there wasn't a Get Workflow OOB step.   The rest of this blog is the way I went about creating one.</p><p></p><p><span style="font-size: 24px;">Format of a Custom Scripted StepConfig</span></p><p><span style="font-size: 10pt;">A custom scripted step is made up of three parts.<br/></span></p><ol><li><span style="font-size: 10pt;"><strong>Header Section</strong></span><ol><li><span style="font-size: 10pt;">Name of your custom step</span></li><li><span style="font-size: 10pt;">Application / Scope</span></li><li><span style="font-size: 10pt;">etc.     Pretty standard stuff</span></li></ol></li><li><span style="font-size: 10pt;"><strong>Script</strong></span><ol><li><span style="font-size: 10pt;">Description generation script</span><ol><li><span style="font-size: 10pt;">** not going to spend any time on this. Simply prints the Step description as documentation for the Test that executes it.</span></li></ol></li><li><span style="font-size: 10pt;">Step execution script</span><ol><li><span style="font-size: 10pt;">** going to spend a lot of time on this</span></li></ol></li></ol></li><li><span style="font-size: 10pt;"><strong>Variables</strong></span><ol><li><span style="font-size: 10pt;">Input variables passed into the step</span></li><li><span style="font-size: 10pt;">Output variables available for future steps reference</span></li></ol></li></ol><p>That's it!   Let's build it.   We will concentrate on 2.2 the Step execution script.</p><p></p><p><span style="font-size: 14pt;">Building the Step Execution Script </span></p><p>The first thing I had to do was <strong>understand the data</strong>.   What table(s) were involved in executing my workflow?   This took a bit of investigative work, but the ServiceNow platform is not a black box.   I ran a test, then navigated to   the Workflow Active Contexts.   I found my workflow, used the handy "right Click" menu and selected "show XML".   From there it was just follow-the-data.</p><p>I could manually trace the data and found the current workflow step.   I opened Xplore and wrote a<strong> </strong>function to replicate what I had just done.   (Sidenote:   If you don't use Xplore yet, go to SHARE and give it a try.   It's awesome.)   Below is a picture of my <strong>test function</strong>.   The picture may be a bit blurry.   The logic is 1) Read the [wf_context] table using the table name and sys_id, 2) Use the sys_id of the [wf_context] record to read the [wf_executing] table. The data displayed on the right is just what I was looking for.   Now all I need to do is port this code to the (2.2) Step execution script.</p><p><img   alt="Xplore testing workflow function.png" class="image-1 jive-image" src="70546482db1457049c9ffb651f961929.iix" style="width: 620px; height: 222px;"/></p><p></p><p></p><p><span style="font-size: 14pt;">Port your script to ATF using the StepConfig template</span></p><p>The hard work is behind us. Navigate to Automated Test Framework &gt; Administration &gt; Step Configurations. Select the Custom Scripted StepConfig record from the list.   We will use this as our template.   Select the COPY ui-action.   Rename the generated "Custom Scripted StepConfig copy"   to any name that makes you happy!   I chose "Custom getWorkflowStep".   Open this record and we'll make our edits.</p><p></p><p>Make a relevant description for your script.   In my case I used this code</p><p><img   alt="Screen Shot 2017-06-28 at 2.17.31 PM.png" class="image-2 jive-image" src="c8330802db181304b322f4621f9619da.iix" style="width: 620px; height: 157px;"/></p><p>The Step execution script is where it all happens.   It consists of inputs, output, and a setResult.   Looking back at the function we wrote we know the script requires the table-name and sys-id that started the workflow.   Using the Variable section (at the bottom of the form) we'll assign the inputs as Table and Record_ID.   While we're here, we'll also assign our output variables as Workflow_version, Workflow_step_name, and Workflow_step_state.   Notice the generated column names begin with "u_".   Returning to the script code, we make sure that we've received a table and sys_id before we go any further. Set the stepResult accordingly.</p><p><img   alt="Screen Shot 2017-06-28 at 2.29.29 PM.png" class="image-3 jive-image" src="0112a7f9dbdc9fc0b322f4621f96196d.iix" style="width: 620px; height: 212px;"/></p><p>Finally, copy/paste the code we tested after our variable verifications.   If we do this right, others will be using our Step, so be polite and add some good comments!</p><p><img   alt="Screen Shot 2017-06-28 at 2.36.01 PM.png" class="image-4 jive-image" src="567c8942db9413043eb27a9e0f96195a.iix" style="width: 620px; height: 305px;"/></p><p>Map the requested information to the outputs object and set an OutputMessage.   Use the UPDATE ui-action and save your custom step configuration.</p><p></p><p><span style="font-size: 14pt;">Test out your new custom getWorkflow step</span></p><p>Now the fun part!   Find an existing Test or create a new Test. At the appropriate time ... use the ADD TEST STEP ui-action.   Select the 'server' type ... scroll down and select your new Custom getWorkflowStep!!   Run your Test(s).   (feel pride)!</p><p><img   alt="Screen Shot 2017-06-28 at 3.06.28 PM.png" class="image-5 jive-image" src="26cc288adb149344e9737a9e0f96193d.iix" style="width: 620px; height: 351px;"/></p><p></p><p></p><p></p><p>My hat is off again to everyone on the community.   I hope this helps someone take the first step to custom steps (what !!).</p><p>I will post all code in SHARE and monitor this blog for questions or issues.</p>