---
title: "Portal diaries Setting List collector values in Service Portal by catalog client script"
date: 2017-10-20T23:13:01.000Z
authors: ["dvp"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=571da2e5dbd0dbc01dcaf3231f961913"
---
<p style="margin-top: auto;">We had a requirement, where we wanted to display the list of users belonging to a group. This can be done by auto populating the list collector, based on selecting a value in the group reference field.</p><p></p><p><img   class="image-1 jive-image" src="f3534ccadbd8d3041dcaf3231f96193d.iix" style="max-width: 1200px; max-height: 900px;"/></p><p></p><p style="margin-top: auto;">Here's a client script that does it ( <a title="ww.servicenowguru.com/scripting/client-scripts-scripting/move-list-collector-options/" href="https://www.servicenowguru.com/scripting/client-scripts-scripting/move-list-collector-options/">Move List Collector Options)</a>. This script works beautifully in tool(UI) as well as CMS but not in service portal,   as DOM manipulations in Service Portal are not supported in client script.</p><p></p><p style="margin-top: auto;">After several trails, I decided on using <strong>setValue's </strong>optional parameter in the client script for this scenario.</p><p style="margin-top: auto;">Here is the format</p><p style="margin-top: auto;"><em>g_form.setValue('var_user_groups', sys_id_array, display_value_array);</em></p><p></p><p style="margin-top: auto;">But the downside of using this is, it is not supported on backend tool. To not let it be a limitation on either screen, I combined both the functionalities in the client script.</p><p></p><p style="margin-top: auto;">Here is the client script</p><p style="margin-top: auto;">The onChange script is written on a group field which passes the group information to the server side using AJAX.</p><p></p><p style="margin-top: auto;">Server script return the sys_id's and display values of the of users in the group. Once the value is obtained in the client side, sys_id's and display values are separated and set to list collector field.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_1508512899800319 jive_text_macro" data-renderedposition="601_8_1130_928" jivemacro_uid="_1508512899800319"><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>function onChange(control, oldValue, newValue, isLoading) {</em></span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>     if (isLoading || newValue == '') {</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>           return;</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>     }</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>     //Type appropriate comment here, and begin script below</em></span> </p><p style="margin-top: auto;"><em>           </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>             var grp = g_form.getValue('var_group');   </em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>             var ajax = new GlideAjax('ajaxGetUsersGroups');</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>             ajax.addParam('sysparm_name', 'getUsers');</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>             ajax.addParam('sysparm_group', grp);</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>             ajax.getXML(doSomething);</em></span> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>}               </em></span> </p><p style="margin-top: auto;"><em>             </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>         function doSomething(response){</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               var answer = response.responseXML.documentElement.getAttribute("answer");</em></span> </p><p style="margin-top: auto;"></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               var arr = answer.split('||');</em></span> </p><p style="margin-top: auto;"><em>               </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               //arr[1] has the sys_id of the users</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               //arr[0] has the display name of the users</em></span> </p><p style="margin-top: auto;"><em>               </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               if (window === null)</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                       g_form.setValue('var_user_groups', arr[1], arr[0]); // Mobile Compatible</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>             else</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                       addItemstoList('var_user_groups', arr[1], arr[0]);   </em></span> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>}</em></span> </p><p style="margin-top: auto;"></p><p style="margin-top: auto;"></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>function addItemstoList(listCollector, sysid, display_value) {</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       var varName = listCollector;</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       var leftBucket = gel(varName + '_select_0');</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       var rightBucket = gel(varName + '_select_1');</em></span> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       var selectedOptionsIDs = [];</em></span> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       rightBucket.options.length = 0;</em></span> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               if (sysid != '') {</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               var myCIArray = sysid.split(',');</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               var displayvalue = display_value.split(',');</em></span> </p><p style="margin-top: auto;"><em>                       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               for(i=0; i &lt; myCIArray.length; i++) {</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                     var option = document.createElement('option');</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                     option.value = myCIArray[i];</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                     option.text = displayvalue[i];</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                     // add the option to the bucket</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>                     rightBucket.add(option);</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>               }</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       }</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       // sort the buckets</em></span> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       sortSelect(rightBucket);</em></span> </p><p style="margin-top: auto;"></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>       moveSelectedOptions(selectedOptionsIDs, leftBucket, rightBucket, '--None--');</em></span> </p><p style="margin-top: auto;"><em>       </em> </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><em>}</em></span></p></pre><p style="margin-top: auto;"></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"><strong><em>Script Include</em></strong></span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">Retuns the sys_id and display values of the users </span></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_15085129128655987 jive_macro_code jive_text_macro" data-renderedposition="1586_8_1130_357" jivemacro_uid="_15085129128655987"><p style="margin-top: auto;"><span style="font-size: 9.0pt;">var ajaxGetUsersGroups = Class.create(); </span></p><ol style="list-style-type: lower-alpha;"><li><span style="font-size: 9.0pt;">ajaxGetUsersGroups.prototype = Object.extendsObject(AbstractAjaxProcessor, { </span></li></ol><p style="margin-top: auto;">   </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">         getUsers: function() { </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">           var group = this.getParameter('sysparm_group'); </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">           var rel = new GlideRecord("sys_user_grmember"); </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">           rel.addQuery("group", group);   </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">           rel.query(); </span></p><p style="margin-top: auto;">   </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">               var name_arr = []; </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">               var sys_id_arr = []; </span></p><p style="margin-top: auto;">                 </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">           while(rel.next()){ </span></p><p style="margin-top: auto;">                           </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">                     name_arr.push(rel.user.name.toString()); </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">                     sys_id_arr.push(rel.user.toString()); </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">               } </span></p><p style="margin-top: auto;">         </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">       return name_arr.toString() + '||' + sys_id_arr.toString();         </span></p><p style="margin-top: auto;"><span style="font-size: 9.0pt;"> },         </span></p><p style="margin-top: auto;">                                                                                                 </p><p style="margin-top: auto;"><span style="font-size: 9.0pt;">}); </span></p></pre><p></p><p></p><p style="font-family: arial, sans-serif; color: #666666;">Previous blogs in this series</p><p style="font-family: arial, sans-serif; color: #666666;"><a title="" _jive_internal="true" data-containerid="1007" data-containertype="37" data-objectid="6415" data-objecttype="38" href="/community?id=community_blog&sys_id=228da669dbd0dbc01dcaf3231f9619f3" style="font-weight: inherit; font-style: inherit; font-family: inherit; color: #3778c7;">Portal diaries: Service Portal — Making Rejection Comments Mandatory on Approval Record</a></p><p style="font-family: arial, sans-serif; color: #666666;"><a __default_attr="6416" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Portal diaries: Service Portal — Approval Summarizer in Portal" data-renderedposition="2028.78125_8_402_16" href="/community?id=community_blog&sys_id=ac4daee5dbd0dbc01dcaf3231f96193b" modifiedtitle="true" title="Portal diaries: Service Portal — Approval Summarizer in Portal">Portal diaries: Service Portal — Approval Summarizer in Portal</a></p>