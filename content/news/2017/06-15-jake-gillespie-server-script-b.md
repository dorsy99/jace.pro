---
title: "Server Script Best Practices"
date: 2017-06-15T04:59:48.000Z
authors: ["Jake Gillespie"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=2b5c6aa1dbd0dbc01dcaf3231f961949"
---
<p><span style="font-family: arial, helvetica, sans-serif;"><span lang="EN-GB" style="color: #303030;">In my last two posts we've reviewed </span><a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=e25ce6a1dbd0dbc01dcaf3231f9619dc">Coding Best Practices</a><span style="color: #8a8a8c;"><span style="color: #303030;"> as well as</span> </span><a title="" _jive_internal="true" href="/community?id=community_blog&sys_id=f27ce2e1dbd0dbc01dcaf3231f961912">Client Script Best Practices</a><span style="color: #8a8a8c;"><span style="color: #303030;"> in ServiceNow. Now I'd like to review some of the Best Practice tips for writing successful Server-side scripts. The ServiceNow platform is extremely flexible when it comes to enhancing functionality on the Server side. As an Administrator, you can add scripting to many system components, which drive the system processes <em>under-the-hood</em>. Some of the most common examples include Workflow Activities (such as dynamic approvals) and Reference Field filters (aka Reference Qualifiers), but there are actually many more. If you're not familiar with terms such as</span> </span><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/concept/c_BusinessRules.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/business-rules/concept/c_BusinessRules.html">Business Rules</a><span style="color: #8a8a8c;"><span style="color: #303030;">,</span> </span><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_ScriptIncludes.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_ScriptIncludes.html">Script Includes</a><span style="color: #303030;"> or </span><a title="eveloper.servicenow.com/app.do#!/api_doc?v=istanbul&id=c_GlideRecordAPI" href="https://developer.servicenow.com/app.do#!/api_doc?v=istanbul&amp;id=c_GlideRecordAPI">GlideRecord</a><span style="color: #303030;">, I suggest reading about them first on the ServiceNow Documentation site before reading the rest of this article.</span></span></p><p class="Normal1"></p><p class="Normal1"><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">So where do the Server-side scripts execute and what language are they written in? Although the underlying code that the ServiceNow platform is built on is actually <em>Java</em>, most of the scripts we execute are actually written in <em>JavaScript</em>. ServiceNow uses a <em>JavaScript</em> engine called Rhino to interpret and execute such Server-side <em>JavaScript</em>. It is important to understand though that the <em>JavaScript</em> you execute on the Server is almost always not the same as <em>JavaScript</em> you execute on the Client. The syntax might be the same, but the Objects and Classes used will be quite different. For example, in my previous article we discussed <em>GlideForm</em> (g_form) and how it can be used to manipulate fields on a table form. On the Server, this API cannot be accessed at all as it is only available on the Client-side. On the Server-side, the <em>GlideRecord</em> Class is frequently used to manipulate field values in a table record. Another popular Server-side API is <em>GlideSystem</em> (or gs), and it includes many functions, which are not specific to table records but rather the current session and system configuration. Because these scripts are executed directly on the Server, they are very powerful and can seriously affect system performance and stability if implemented incorrectly. To avoid such issues, I recommend the following Best Practices:</span></p><p class="Normal1"></p><p style="padding-left: 30px;"><strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">Use Script Includes instead of Global Business Rules</span></strong></p><p style="padding-left: 30px;"><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;"></span><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">If you define a function or Class in a Global Business Rule, this code will be loaded when the Business Rules execute on ANY and EVERY table in the system. This is usually highly undesirable since it adds additional processing load, which will affect the system performance. Script Includes can be used to serve the same purposes, however they are only loaded if their function call is detected. The most common example of this is a Reference Qualifier script. Since this script might only be needed on a couple of table fields in the system, it is far more efficient to have this script loaded as required instead of on EVERY table!</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">Wrap Business Rule scripts in functions</span></strong></p><p style="padding-left: 30px;"><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;"></span><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">Because there are many Business Rules in the system, they are executed in a sequence (based on their Order value). When this happens, the contents of these scripts are compiled together into one big long sequence. If the same variable or function names are used in multiple Business Rules, they could conflict and change the flow of the program, causing unexpected behaviour. It is therefore recommended that scripts defined in Business Rules be wrapped into local functions. This protects variables from being changed unexpectedly. Local function names should also be reasonably specific to avoid conflicting with other Business Rule scripts. Note that this only affects older Business Rules prior to the introduction of the <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/general-scripting/concept/immediately-invoked-function-expressions.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/general-scripting/concept/immediately-invoked-function-expressions.html">Immediately-Invoked Function Expression</a> (IIFE) code stub. In recent releases, new Business Rules will automatically use the IIFE structure, thus negating the need to wrap code in functions.</span></p><p class="Normal1" style="padding-left: 30px;"></p><p style="padding-left: 30px;"><strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">Avoid updating other records in a Before Business Rule</span></strong></p><p style="padding-left: 30px;"><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;"></span><span style="color: #303030; font-family: arial, helvetica, sans-serif;"><em><span lang="EN-GB">Before</span></em><span lang="EN-GB"> Insert/Update Business Rules are nice because they allow us to modify the <em>current</em> (record) Object just before the Database operation is executed. However, you can hinder system performance if you are unnecessarily updating other records during this script. This is because an insert/update action on another table will likely invoke any applicable Business Rules configured on that table as well, and thus delay the current action being performed. If you need to trigger an action on another table record it is better to do this in an <em>After</em> or <em>Async</em> Business Rule, but knowing which one to use will depend on your circumstances. <em>After</em> Business Rules are triggered immediately after the current action has occurred (e.g. when a database record has been updated), and they still have access to the <em>previous</em> Object (as well as the <em>changes()</em> method etc.). <em>Async</em> Business Rules on the other hand, work like a once-off scheduled job, and are processed a short time after the current action has finished depending on system resources. For interactive sessions (e.g. User clicks a <em>Save</em> UI Action), the <em>Before</em> and <em>After</em> Business Rules will run before the User sees the Form reload. Long running <em>Before</em>/<em>After</em> Business Rules will increase this duration. <em>Async</em> Business Rules on the other hand, will not affect this duration as they are queued for the system to run in the background.</span></span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">Use Conditions in Business Rules</span></strong></p><p style="padding-left: 30px;"><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;"></span><span lang="EN-GB" style="font-family: arial, helvetica, sans-serif; color: #303030;">When a database transaction occurs, all of the <span style="text-decoration-line: underline;">applicable</span> Business Rules will be executed in the following sequence:</span></p><ul style="padding-left: 30px;"><ul><li style="padding-left: 30px;"><span style="color: #303030;">[User opens a List]</span><ul><li style="padding-left: 30px;"><span style="color: #303030;">Query</span></li></ul></li><li style="padding-left: 30px;"><span style="color: #303030;">[User opens a Form]</span><ul><li style="padding-left: 30px;"><span style="color: #303030;">Display</span></li></ul></li><li style="padding-left: 30px;"><span style="color: #303030;">[User inserts/updates/deletes a record]</span><ul><li style="padding-left: 30px;"><span style="color: #303030;">Before</span></li><li style="padding-left: 30px;"><span style="color: #303030;">After</span></li><li style="padding-left: 30px;"><span style="color: #303030;">Async (scheduled)</span></li></ul></li></ul></ul><p style="padding-left: 30px;"><span style="color: #303030;"><span lang="EN-GB" style="font-family: arial, helvetica, sans-serif;">Within each of the above groups, Business Rules are further sequenced by their Order number. Because it's possible (an</span><span lang="EN-GB" style="font-family: arial, helvetica, sans-serif;">d likely) that multiple Business Rules (of each type) have been defined, the system will effectively combine all of them into one big long script for processing (where the order is determined by the <em>Order</em> field on each rule). If no <em>Condition</em> is configured on these rules, all of them will be executed <span style="text-decoration: underline;">every</span> time. However, if you define a condition on the <em>Condition</em> field (or the Condition Builder), the system will first evaluate these conditions and only include the script contents/actions if the condition evaluates to <em>true</em>. This will improve system performance, as only the applicable Business Rules will be triggered. Note that the <em>Condition</em> field has a limited character length, so if your condition is quite long you will need to move the logic to a <em>Script Include</em> function and call it from the <em>Condition</em> field instead.</span></span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="color: #303030; font-family: arial, helvetica, sans-serif;"><span lang="EN-GB"></span><strong><span lang="EN-GB">Use GlideAggregate instead of getRowCount()</span></strong></span></p><p style="padding-left: 30px;"><span style="color: #303030; font-family: arial, helvetica, sans-serif;"><span lang="EN-GB"></span></span><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">At times we've all needed to check how many records were returned by a specific query, and we probably did this by using a function from the <em>GlideRecord</em> Class called getRowCount(). This will work however, <em>under-the-hood</em> it is not the most efficient means of obtaining such a count. This is because the <em>GlideRecord</em> Class will retrieve the values of each record as well as the number of records returned. It is therefore recommended that we use the <em>GlideAggregate</em> Class instead. This Class operates with some similar functions and parameters as the <em>GlideRecord</em> Class, however its purpose is not to retrieve all of the record data but simply to provide statistics based on the records returned by a query.</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">Avoid hardcoding values by using System Properties and Messages</span></strong></p><p style="padding-left: 30px;"><strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;"></span></strong><span lang="EN-GB" style="color: #303030; font-family: arial, helvetica, sans-serif;">As a Developer, it is very easy to <em>hardcode</em> values into scripts that we write. Often this might be to assign an approval or task to a specific group, or perhaps display an onscreen error message. In doing so we make it difficult to maintain and make changes to these values, since they could be buried deep within our code and changing them will often require an <em>Update Set</em> migration. In ServiceNow, a common practice is to <em>hardcode</em> <em>sys_id</em> values into scripts so our query will always find the <span style="text-decoration: underline;">same</span> record, but this is against the ServiceNow Best Practice, and can easily be avoided by simply using a <em>System Property</em>. Why use a <em>System Property</em> you ask? Well if you store the <em>sys_id</em> in a <em>System Property</em>, an Administrator (or anyone with access to the specific System Property via Roles) can easily update the value later, and not necessarily via the Update Set migration process. <em>System Properties</em> allow us to categorise and describe the values we store in them. I recommend adding your <em>System Properties</em> to a <em>Category</em> (they can belong to more than one), and then adding a menu module (link) to display them. This will allow Administrators to easily find and maintain them. Likewise, if you need to provide specific error or information messages to the user, consider storing these in the <em>Message</em> table. These values can be easily retrieved on both the Client and Server using the standard APIs, and have the added advantage of being mapped against a specific language. This allows us to customise the messages for multi-language configurations. Remember, the key is to avoid <span style="text-decoration: underline;">hardcoding</span> values, as it won't always be us making the changes, so please think about the next person working on your code!</span></p><p class="Normal1"></p><p class="Normal1"><span style="color: #303030; font-family: arial, helvetica, sans-serif;"><span lang="EN-GB">In this article we've covered some of the principles behind Server Scripting Best Practices in ServiceNow. In my next article, we'll discuss GlideRecord Scripting Best Practices and how they apply specifically to ServiceNow.</span> <span style="background: white;">For further information on the topics covered in this article, please see the following pages:</span></span></p><ul style="list-style-type: disc;"><li><span style="color: windowtext; background: white;"><a title="ki.servicenow.com/index.php?title=Coding_Best_Practices#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Coding_Best_Practices#gsc.tab=0">Coding Best Practices</a></span></li><li><span style="color: windowtext; background: white;"><a title="ki.servicenow.com/index.php?title=Technical_Best_Practices#gsc.tab=0" href="http://wiki.servicenow.com/index.php?title=Technical_Best_Practices#gsc.tab=0">Technical Best Practices</a></span></li><li><a href="http://wiki.servicenow.com/index.php?title=Scripting_in_Business_Rules#gsc.tab=0"><span style="background: white;">Scripting in Business Rules</span></a></li><li><a href="http://wiki.servicenow.com/index.php?title=Business_Rules_Best_Practices#gsc.tab=0"><span style="background: white;">Business Rule Best Practices</span></a></li><li><span style="background: white;"><a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_ScriptIncludes.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_ScriptIncludes.html">Script Includes</a></span></li><li><a href="http://wiki.servicenow.com/index.php?title=Differences_Among_Scripts#gsc.tab=0"><span style="background: white;">Differences Among Scripts</span></a></li><li><span style="background: white;"><a title="eveloper.servicenow.com/app.do#!/api_doc?v=istanbul&id=c_GlideRecordAPI" href="https://developer.servicenow.com/app.do#!/api_doc?v=istanbul&amp;id=c_GlideRecordAPI">GlideRecord</a></span></li><li><span style="background: white;"><a title="eveloper.servicenow.com/app.do#!/api_doc?v=istanbul&id=c_GlideAggregateAPI" href="https://developer.servicenow.com/app.do#!/api_doc?v=istanbul&amp;id=c_GlideAggregateAPI">GlideAggregate</a></span></li></ul><p></p><p><span style="background: white;"><span style="font-weight: bold; font-size: 16px; font-family: 'Times New Roman'; color: #666666;">NOTE</span><span style="font-size: 16px; font-family: Arial; color: #666666;">: </span><span style="font-size: 16px; font-family: 'Times New Roman'; color: #666666;">MY POSTINGS REFLECT MY OWN VIEWS AND DO NOT NECESSARILY REPRESENT THE VIEWS OF MY EMPLOYER.</span></span></p>