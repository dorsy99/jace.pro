---
title: "Service Portal fundamentals AngularJS scopes"
date: 2017-10-30T05:48:38.000Z
authors: ["dylan.lindgren"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=7a6d2e29dbd0dbc01dcaf3231f961962"
---
<p><span style="font-size: 12pt;">Apart from the basic concepts of HTML, CSS, and JavaScript, one of the most powerful things you can learn to really feel comfortable in Service Portal is AngularJS scopes.</span></p><p></p><p><span style="font-size: 12pt;">There are many resources online which do a great job of explaining AngularJS scopes; there's really no better than what can be found in the <a title="ocs.angularjs.org/guide/scope" href="https://docs.angularjs.org/guide/scope">official AngularJS documentation</a>. However, there's nothing I'm aware of which is targeted at someone who's getting started in Service Portal, has the basic knowledge of creating a widget, but still feels confused about what's actually going on behind the scenes. Hopefully after reading this article some of that fog of confusion will have lifted.</span></p><p></p><p><span style="font-size: 12pt;">Once you understand scopes, the amount of road blocks you'll hit when developing widgets will dramatically lower, and you'll be well on your way to becoming a Service Portal master!</span></p><p></p><p><span style="font-size: 12pt;"><em>This is my first post in what will hopefully become a series of articles helping to explain the basic concepts of Service Portal. If you have any suggestions for topics, feel free to leave a comment below, or reach out to me on twitter with my handle <a title="witter.com/dylanlindgren" href="https://twitter.com/dylanlindgren">@dylanlindgren</a>.</em></span></p><p></p><h2><span style="font-size: 18pt;">The DOM</span></h2><p></p><p><span style="font-size: 12pt;">Given that you're reading this article, it's likely that you've ventured into the developer tools of your web browser on at least a few occasions. Perhaps after a sudden fit of anxiety at the overwhelming amount of information in there, the first thing you'll have noticed is a tree-like structure of elements, within elements, within elements, and so on. This structure is a live, visual representation of the current state of something called the <strong>Document Object Model</strong> of the page you are on; for short it's called the <strong>DOM</strong>.</span></p><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="1.png" class="image-1 jive-image" src="8a93fc0adb5c5f048c8ef4621f9619cd.iix" style="width: 620px; height: 382px;"/></span></p><p></p><p><span style="font-size: 12pt;">The description of the DOM from the <a title="eveloper.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction" href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction">Mozilla Developer Network</a> is as follows:</span></p><blockquote class="jive-quote"><p><span style="font-size: 12pt;">The Document Object Model (DOM) [...] represents the page so that programs can change the document structure, style and content. The DOM represents the document as nodes and objects.</span></p></blockquote><p><span style="font-size: 12pt;">Shown in another way, you can really see how this parent &amp; child relationship that each DOM element has goes in to building what you see in your browser window. Note that the "stacking" of elements shows the parent &amp; child relationships of the elements on the page.</span></p><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="2.png" class="image-2 jive-image" src="36511802dbd01f048c8ef4621f9619c8.iix" style="width: 620px; height: 507px;"/></span></p><p></p><p><span style="font-size: 12pt;">The key point to understand about the DOM is that it is a "tree" of elements, like in this hypothetical DOM tree:</span></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="3.png" class="image-3 jive-image" src="774f6f75db9c1704ed6af3231f96192f.iix" style="width: 620px; height: 524px;"/></span></p><p></p><h2><span style="font-size: 18pt;">Directives</span></h2><p></p><p><span style="font-size: 12pt;">A comprehensive definition of an directive can be found on the <a title="ocs.angularjs.org/guide/directive" href="https://docs.angularjs.org/guide/directive">AngularJS documentation</a>:</span></p><blockquote class="jive-quote"><p><span style="font-size: 12pt;">At a high level, directives are markers on a DOM element [...] that tell AngularJS [...] to attach a specified behavior to that DOM element [...], or even to transform the DOM element and its children.</span></p></blockquote><p><span style="font-size: 12pt;">To rephrase that, any element within the DOM can have a directive attached to it, and you can use the directive to give the element custom behaviour.</span></p><p><span style="font-size: 12pt;">This element you're targeting could be anything, such as an <a title="eveloper.mozilla.org/en-US/docs/Web/HTML/Element/img" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img">image</a>, a <a title="eveloper.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements">header</a>, a <a title="eveloper.mozilla.org/en-US/docs/Web/HTML/Element/ul" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/ul">list</a>, or even a container <a title="eveloper.mozilla.org/en-US/docs/Web/HTML/Element/div" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div">div element</a> (which may have many elements within it). And the custom behaviour you give to it could be an animation, to load some text into it from an external website, or even hide it from the page completely; it's up to the creator of the directive. This allows developers to build their own reusable components which do not exist natively in HTML, such as a login button that has a particular style/functionality, or a list of records.</span></p><p></p><p><span style="font-size: 12pt;">So in the case of the hypothetical DOM tree I showed earlier, perhaps the elements with a green border below might have directives associated with them.</span></p><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="4.png" class="image-4 jive-image" src="40271506db90d7041dcaf3231f961947.iix" style="width: 620px; height: 525px;"/></span></p><p></p><p><span style="font-size: 12pt;">Note that the element with the blue border is the element on the page with the attribute <span style="font-family: 'andale mono', times;"><a title="ocs.angularjs.org/api/ng/directive/ngApp" href="https://docs.angularjs.org/api/ng/directive/ngApp">ng-app</a></span>. In AngularJS the element with this attribute is considered the root element of the application. It's only the elements below this which Angular treats as part of the application.</span></p><p></p><p><span style="font-size: 12pt;">Let's just show the AngularJS-related elements of the DOM, and rotate it so it looks more like a "tree" (albeit, one that's upside down!)</span></p><p></p><p style="text-align: center;"><img   alt="5.png" class="image-5 jive-image" src="b0ae8c86db1417041dcaf3231f9619bf.iix" style="height: auto;"/></p><p></p><h2><span style="font-size: 18pt;">Directives, a.k.a Widgets</span></h2><p></p><p><span style="font-size: 12pt;">You might now be asking yourself...</span></p><blockquote class="jive-quote"><p><span style="font-size: 12pt;"><em>Why am I reading about directives? How does this relate to Service Portal?</em></span></p></blockquote><p></p><p><span style="font-size: 12pt;">Well, Service Portal widgets <em><strong>are</strong></em> directives. When you load a Service Portal page, a new AngularJS directive is created for each different widget on the page. This directive is then placed in the DOM wherever the widget was put on the page via <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/task/t_ConfigureAPage.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/task/t_ConfigureAPage.html">Service Portal Designer</a> or <a title="ocs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_PageEditor.html" href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_PageEditor.html">Page Editor</a>. As you know from the previous section, a directive adds custom behaviour, and in the case of a widget this behaviour is to insert the HTML from the widget, and perform the actions you define within the client script and/or link function of the widget.</span></p><p></p><p><span style="font-size: 12pt;">So why are there two names for the same thing? Well, there's lots of functionality that's been added to widgets to make them easier to work with, such as <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/concept/c_WidgetInstanceOptions.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/concept/c_WidgetInstanceOptions.html">options</a>, the addition of the server-side behaviour that happens in it's <a title="ocs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/widget-server-script.html" href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/widget-server-script.html">server script</a>, and the <a title="ocs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_Scripting.html" href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_Scripting.html">passing of the data variable</a> generated in it to the client script.</span></p><p></p><p><span style="font-size: 12pt;">So in the case of widgets, the hypothetical structure of the directives from the previous section could be like so:</span></p><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="6.png" class="image-6 jive-image" src="5ef82739dbd41fc068c1fb651f96196f.iix" style="width: 620px; height: 263px;"/></span></p><p></p><p><span style="font-size: 12pt;">You'll notice above there's an "embedded" Widget B, and is not added via Page Designer. This widget is embedded in Widget A as described on the <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/concept/c_NestedWidgets.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/concept/c_NestedWidgets.html">official ServiceNow Documentation</a>. This is actually the only way that you'd end up having a widget sitting below another widget in the DOM.</span></p><p></p><h2><span style="font-size: 18pt;">Scopes</span></h2><p></p><p><span style="font-size: 12pt;">One characteristic that's just as important to a widget as it is to a directive is scopes. A scope can be thought of as a space where application functionality is contained to. By default a directive will share the scope of it's parent directive, however they can also be set to have a new, isolated scope.</span></p><p><span style="font-size: 12pt;">In Service Portal a widget <em><strong>always</strong></em> has an isolated scope. This is something that has been set by the developers of Service Portal to ensure widgets play nicely together, and that you can have multiple instances of the same widget on a single page as they all have their own isolated space to play.</span></p><p></p><h2><span style="font-size: 18pt;">The scope tree</span></h2><p></p><p><span style="font-size: 12pt;">Not just is the DOM a tree, but scopes sit in a tree as well. You can think of the scope tree as a cut-down version of the DOM tree, with all the things that didn't create a new scope removed. As all widgets create a new scope then the scope tree in the example above would look like so:</span></p><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="7.png" class="image-7 jive-image" src="9009dd06db18d304b322f4621f961978.iix" style="height: auto;"/></span></p><p></p><h2><span style="font-size: 18pt;">Local scope vs Root scope</span></h2><p></p><p><span style="font-size: 12pt;">You'll have noticed in the above diagram that at the top of the tree is a thing called <span style="font-family: 'andale mono', times;"><a title="ocs.angularjs.org/api/ng/service/$rootScope" href="https://docs.angularjs.org/api/ng/service/$rootScope">$rootScope</a></span>. You can think of this as an overarching scope that is available to your whole application, from any widget/directive. It also allows you to listen for/broadcast events, but more on that in the next section.</span></p><p></p><h2><span style="font-size: 18pt;">Cross-scope communication</span></h2><p></p><p><span style="font-size: 12pt;">All widgets have isolated scopes, so how can we access data from one widget in another widget? There's two ways:</span></p><p></p><h3><span style="font-size: 14pt;">Events</span></h3><p></p><p><span style="font-size: 12pt;">Similar to the concept of <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/platform-events/concept/events.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/platform-events/concept/events.html">events in ServiceNow</a>, AngularJS events can be announced from any scope in your application. These events can be listened from any scope as well, however which method you use to announce the event will have an impact on which scopes will hear it.</span></p><p></p><p><span style="font-size: 12pt;">There are two methods you can use to announce events:</span></p><p></p><ul><li><span style="font-size: 12pt;">With <span style="font-family: 'andale mono', times;">$broadcast()</span>, the event will travel <span style="color: #333399;"><em><strong>down</strong></em></span> in the scope tree from wherever it was announced, until it hits the bottom. The event will not be heard by sibling scopes. See more on the <a title="ocs.angularjs.org/api/ng/type/$rootScope.Scope#$broadcast" href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$broadcast">official AngularJS documentation</a>.</span></li><li><span style="font-size: 12pt;">Using <span style="font-family: 'andale mono', times;">$emit()</span>, the event will travel <span style="color: #008000;"><em><strong>up</strong></em></span> in the scope tree from wherever it was announced, until it hits the <span style="font-family: 'andale mono', times;">$rootScope</span>. This event will not be heard by sibling scopes. See more on the <a title="ocs.angularjs.org/api/ng/type/$rootScope.Scope#$emit" href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$emit">official AngularJS documentation</a>.</span></li></ul><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="8.png" class="image-8 jive-image" src="7e937086db589344e9737a9e0f9619ca.iix" style="height: auto;"/></span></p><p></p><p><span style="font-size: 12pt;">So now that we know how announce an event, how do we listen for it? For that, we can use the <span style="font-family: 'andale mono', times;">$on()</span> method. When you use this method, you supply it with a function and whenever that event is heard by the scope the function will be called. See more about this on the <a title="ocs.angularjs.org/api/ng/type/$rootScope.Scope#$on" href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$on">official Angular JS documentation</a>.</span></p><p></p><p><span style="font-size: 12pt;">The <span style="font-family: 'andale mono', times;">$broadcast()</span> and <span style="font-family: 'andale mono', times;">$on()</span> functions are also available on $rootScope, which gives you another place to listen for/announce an event to ensure the right scopes will hear it.</span></p><p></p><h3><span style="font-size: 14pt;">Angular Providers</span></h3><p></p><p><span style="font-size: 12pt;">Another means of communication between widgets is a service or a factory, which in Service Portal are both types of <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/task/angular-providers.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/build/service-portal/task/angular-providers.html">Angular Providers</a>. Services and factories in AngularJS basically offer a place where you can define functions and variables, and any scope which has access to it can use them.</span></p><p></p><p><span style="font-size: 12pt;">The diagram below visualises where these sit in relation to the scopes, if for all 3 widgets in our example the Angular Provider was added to their related lists.Given the overwhelming amount of information in this article already, I'll cover in detail how one would use an Angular Provider in a future installment.</span></p><p></p><p style="text-align: center;"><span style="font-size: 12pt;"><img   alt="9.png" class="image-9 jive-image" src="6f519c42db549fc068c1fb651f9619af.iix" style="width: 620px; height: 380px;"/></span></p><p></p><h2><span style="font-size: 18pt;">Conclusion</span></h2><p></p><p><span style="font-size: 12pt;">In the next installment in this series, we will look into how to put this theory into practice by making a series of widgets which communicate with each other. Specifically, how to create a widget showing a list, that reacts and updates with new information when you change a field on the out-of-box form widget.</span></p><p></p><p><span style="font-size: 12pt;">If you'd like to read more about AngularJS scopes, I've put together some further reading links below:</span></p><ul><li><span style="font-size: 12pt;"><a title="ocs.angularjs.org/guide/scope" href="https://docs.angularjs.org/guide/scope">https://docs.angularjs.org/guide/scope</a></span></li><li><span style="font-size: 12pt;"><a title="ithub.com/angular/angular.js/wiki/Understanding-Scopes" href="https://github.com/angular/angular.js/wiki/Understanding-Scopes">https://github.com/angular/angular.js/wiki/Understanding-Scopes</a></span></li><li><span style="font-size: 12pt;"><a title="ocs.angularjs.org/api/ng/type/$rootScope.Scope" href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope">https://docs.angularjs.org/api/ng/type/$rootScope.Scope</a></span></li></ul><p></p><p><span style="font-size: 12pt;">Well, that's it for scopes! Feel free to leave feedback in the comments below, or reach out to me on twitter with my handle <a title="itter.com/dylanlindgren" href="http://twitter.com/dylanlindgren">@dylanlindgren</a> if you'd like to buy me a beer!   </span></p>