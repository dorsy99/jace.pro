---
title: "Useful Background Script  Find records createdupdated within a time window"
date: 2017-12-19T07:02:12.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=278d2a69dbd0dbc01dcaf3231f9619a7"
---
<p>Other Useful Background Scripts:</p><p><a title="Useful Background Script - Find a record by its sys_id" __default_attr="7572" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Useful Background Script - Find a record by its sys_id" data-renderedposition="31_8_357_16" href="/community?id=community_blog&sys_id=8b4da229dbd0dbc01dcaf3231f961913">Useful Background Script - Find a record by its sys_id</a></p><p></p><p>Here's another script I use from time to time.   It allows you to search for records created and or updated within a certain timeframe.   Useful when you want to know what all happens when you create or update a particular record.</p><p></p><p><span style="color: #666666; font-family: arial, sans-serif;">There's an option (addLink = true) to output message with a link to the record so you can just click on the link and jump to the record.   You will have to copy/paste the link if running as a background script or just click on the link if you are using the <a title="hare.servicenow.com/app.do#/detailV2/9a1be70e13800b000de935528144b04c/overview" href="https://share.servicenow.com/app.do#/detailV2/9a1be70e13800b000de935528144b04c/overview">Xplore: Developer Toolkit</a>:</span></p><p><img   class="image-1 jive-image" height="165" src="83b8bb75db545704ed6af3231f96190e.iix" style="width: 697px; height: 165.256px;" width="697"/></p><p>When "addLink = false", you'll just get the record details.   The class display label, table name and the record's display value are shown.</p><p></p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_15136446639108345 jive_macro_code jive_text_macro" data-renderedposition="428.25_8_1177_2160" jivemacro_uid="_15136446639108345"><p>// Search for records created and/or updated in the last "x" seconds</p><p>//</p><p>// Optionally add a hyperlink to the record that was found.</p><p><span>// Useful when running the script in the 'Xplore: Developer Toolkit' -   </span><a title="" _jive_internal="true" href="https://share.servicenow.com/app.do#/detailV2/9a1be70e13800b000de935528144b04c/overview" rel="nofollow" target="_blank">https://share.servicenow.com/app.do#/detailV2/9a1be70e13800b000de935528144b04c/overview</a></p><p>// To add a link, set the "addLink" variable to "true"</p><p></p><p>(function(){</p><p>   //options</p><p>   var created = true;             //look for records created within the specified window</p><p>   var updated = true;             //look for records updated within the specified window</p><p>   var secondsAgo = 60;           //how many seconds ago were the records created/updated (integer)</p><p>   var window = 600;                 //how large a window, in seconds, should we look at (integer)</p><p>   var addLink = true;             //set to "true" to add a link to the record in the output (Xplore)</p><p>   var restrictToUser = "user_id";   //user ID of the user you want to restrict the search to.   Leave blank to look for any user</p><p></p><p>   //initialize</p><p>   var userQuery = "";</p><p>   var tableName = "";</p><p>   var tableLabel = "";</p><p>   var tableWeWantToSearch = true;</p><p>   var recordCount = 0;</p><p>   var foundRecord = false;</p><p>   var message = "";</p><p></p><p>   try {</p><p>       //make sure we are restricting by one or the other</p><p>       if (!created &amp;&amp; !updated){</p><p>           gs.addInfoMessage("Need to restrict by either the Created or Updated dates (both are fine)");</p><p>           return;</p><p>       }</p><p></p><p>       //verify the times</p><p>       secondsAgo = Math.abs(parseInt(secondsAgo));</p><p>       window = Math.abs(parseInt(window));</p><p>       if (isNaN(secondsAgo) || isNaN(window)){</p><p>           gs.addInfoMessage("Please specify a proper value for both 'secondsAgo' and 'window'");</p><p>           return;</p><p>       }</p><p>       var startTime = new GlideDateTime();                 //current date/time in UTC</p><p>       startTime.subtract(secondsAgo * 1000);             //get the starting time</p><p>       var endTime = new GlideDateTime(startTime);</p><p>       endTime.addSeconds(window);                                   //and then the end time</p><p>       gs.addInfoMessage("Timeframe is between " + startTime + " and " + endTime + " UTC");</p><p></p><p>       //should we limit the search for records created/updated by a particular user or not?</p><p>       if (restrictToUser != ""){</p><p>           var restrictedMessage = "Limited to records ";</p><p>           if (created){</p><p>               userQuery = "sys_created_by=" + restrictToUser;</p><p>               restrictedMessage += "created ";</p><p>           }</p><p>           if (updated){</p><p>               if (userQuery !=""){</p><p>                   userQuery += "^ORsys_updated_by=" + restrictToUser;</p><p>                   restrictedMessage += "or updated ";</p><p>               } else {</p><p>                   userQuery = "sys_updated_by=" + restrictToUser;</p><p>                   restrictedMessage += "updated ";</p><p>               }</p><p>           }</p><p>           userQuery += "^";       //need to add an "AND" condition to the filter</p><p>           gs.addInfoMessage(restrictedMessage + "by '" + restrictToUser + "'");</p><p>       }</p><p></p><p>       //loop through all the valid base-class tables (no need to look at any sub-classes because the records are contained in the base-class as well)</p><p>       var table = new GlideRecord("sys_db_object");</p><p>       table.addEncodedQuery("super_class=NULL^label!=^nameISNOTEMPTY");</p><p>       table.orderBy("name");</p><p>       table.query();</p><p>       while (table.next()){</p><p>           //get the table name and label</p><p>           tableName = (table.getValue("name") + "").toLowerCase();</p><p>           tableLabel = (table.getValue("label")+ "").toLowerCase();</p><p>           tableWeWantToSearch = true;   //assume it is a table we want to look into</p><p></p><p>           //skip views and some other tables that return a lot of probably irrelevant records</p><p>           //just comment out one of the following lines if you want to include the table(s) in the search</p><p>           if (tableName.indexOf("v_") == 0) tableWeWantToSearch = false;                                       //views</p><p>           else if (tableName == "ts_c_attachment") tableWeWantToSearch = false;                         //text search indices</p><p>           else if (tableName == "ts_chain") tableWeWantToSearch = false;                                       //..</p><p>           else if (tableName == "ts_document") tableWeWantToSearch = false;                                 //..</p><p>           else if (tableName == "ts_phrase") tableWeWantToSearch = false;                                     //..</p><p>           else if (tableName == "ts_word") tableWeWantToSearch = false;                                         //..</p><p>           else if (tableName == "ts_word_roots") tableWeWantToSearch = false;                             //..</p><p>           else if (tableLabel.indexOf("text index ") == 0) tableWeWantToSearch = false;         //..</p><p>           else if (tableLabel.indexOf("ts index stats") == 0) tableWeWantToSearch = false;   //..</p><p>           else if (tableLabel.indexOf("recorded incremental change") == 0) tableWeWantToSearch = false;</p><p>           else if (tableName.indexOf("sh$") == 0) tableWeWantToSearch = false;</p><p>           else if (tableLabel.indexOf("rollback sequence") == 0) tableWeWantToSearch = false;</p><p>           else if (tableLabel.indexOf("score level") == 0) tableWeWantToSearch = false;</p><p>           else if (tableLabel.indexOf("pa favorites") == 0) tableWeWantToSearch = false;</p><p>           else if (tableName.indexOf("syslog") == 0) tableWeWantToSearch = false;</p><p>           else if (tableName.indexOf("sys_cache_flush") == 0) tableWeWantToSearch = false;</p><p>           else if (tableName.indexOf("sys_db_cache") == 0) tableWeWantToSearch = false;</p><p>           else if (tableName.indexOf("sysevent") == 0) tableWeWantToSearch = false;                 //***** you may want to look at this one sometimes, depending on what you are looking for</p><p></p><p>           if (tableWeWantToSearch){</p><p>               var searchTable = new GlideRecord(table.getValue("name"));</p><p>               //make sure it is a valid table first</p><p>               if (searchTable.isValid()){</p><p>                   searchTable.addEncodedQuery(userQuery + "sys_created_onBETWEEN" + startTime + "@" + endTime + "^ORsys_updated_onBETWEEN" + startTime + "@" + endTime);</p><p>                   //message = searchTable.getEncodedQuery();</p><p>                   //gs.addInfoMessage(message);</p><p>                   searchTable.query();</p><p>                   while(searchTable.next()){</p><p>                       foundRecord = true;</p><p>                       recordCount ++;</p><p>                       _showFoundRecord();</p><p>                   }</p><p>               } else {</p><p>                   message = "***** Trying to search an invalid table name called '" + table.getValue("name") + "' - the sys_id of that sys_db_object record is '" + table.getValue("sys_id") + "'";</p><p>                   gs.addInfoMessage(message);</p><p>               }</p><p>           }</p><p>       }</p><p></p><p>       if (foundRecord == true){</p><p>           gs.addInfoMessage(recordCount + " record(s) found");</p><p>       } else {</p><p>           gs.addInfoMessage("No records were found");</p><p>       }</p><p>   } catch(err) {</p><p>       gs.log("ERROR: " + err);</p><p>   }</p><p></p><p></p><p>   function _showFoundRecord(){</p><p>       var details = searchTable.getDisplayValue();</p><p>       if (addLink == true) {</p><p>           details = "&lt;a href='" + gs.getProperty('glide.servlet.uri') + "nav_to.do?uri=" + searchTable.getLink() +"' target='_blank'&gt;" + searchTable.getDisplayValue() + "&lt;/a&gt;";</p><p>       }</p><p>       message = "Found a record of type '" + searchTable.getClassDisplayValue() + "' (" + searchTable.getRecordClassName() + ") called '" + details + "'";</p><p>       gs.addInfoMessage(message);</p><p>   }</p><p>})();</p></pre><p></p><p></p><p><span style="font-family: arial, sans-serif; color: #666666;"><strong>Note:</strong></span><span style="color: #666666; font-family: arial, sans-serif;"> Remember, running scripts as a background script or the Xplore tool can modify data so be aware what you are running.   Always a good idea to test it out on your personal development instance first.</span></p>