---
title: "Data preparation for a clean Breakdown"
date: 2017-06-30T19:25:26.000Z
authors: ["Arnoud Kooi"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=36fd662ddbd0dbc01dcaf3231f9619eb"
---
<p>In Performance Analytics, <a href="https://docs.servicenow.com/bundle/istanbul-performance-analytics-and-reporting/page/use/performance-analytics/concept/c_CreatingBreakdowns.html" title="https://docs.servicenow.com/bundle/istanbul-performance-analytics-and-reporting/page/use/performance-analytics/concept/c_CreatingBreakdowns.html">Breakdowns</a> are the way to slice and dice the results of your <a href="https://docs.servicenow.com/bundle/istanbul-performance-analytics-and-reporting/page/use/performance-analytics/concept/c_Indicators.html" title="https://docs.servicenow.com/bundle/istanbul-performance-analytics-and-reporting/page/use/performance-analytics/concept/c_Indicators.html">Indicators</a>. They let you filter or group by your data, in order to enable the stakeholders to identify trends and take action on them.</p><p>Depending on the settings of your indicator you have 2 levels of breakdown, for example, the out of box Indicator Number of Closed Incidents has got the Breakdowns Priority and Assignment group by default.</p><p>This makes it easy to first narrow down the results to the Assignment group you're interested in, and then use the second breakdown to group them by priority.</p><p></p><p>No need to create an Indicator for a specific Assignment Group or Priority, or any other dimension you can create a breakdown for!</p><p></p><p>So much for the basics, let's look into a bit more advanced use case.</p><p>Creating a breakdown is best suited for structured data, If we stuck to the example of Assignment Group, this is a Reference field to the Group table. Priority is defined as a Choice list. Both examples are structured data.</p><p>However, there are examples where you want to breakdown on data in a string field.</p><p>There is a good explanation how you can do that in the community, but in this blog, I would like to take a step back and see how we can bring back the structure.</p><p></p><p>Let's say that your organization has added a field to the Change table called Environment. Goals of the field is to capture the environment the change affects, there should be three options, Development, Test and Production. But when we look at the data we see 7 distinct values. Creating a breakdown on this data results in a breakdown where we can select Pr, Prod and Production. Obviously not what we want, so let's work on the foundation!</p><p>The image below shows the situation we start with, and the desired, structured result.</p><p><img   class="image-1 jive-image" height="469" src="5c25e44edb1457049c9ffb651f9619d8.iix" style="width: 408px; height: 468.542px;" width="408"/></p><p></p><p>To achieve this, we have two approaches:</p><ul style="list-style-type: disc;"><li>Create an Environment table which we <a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ReferenceField.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ReferenceField.html">Reference</a> to</li><li>Add the Environments to the <a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ChoiceLists.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ChoiceLists.html">Choice list</a></li></ul><p></p><p>If we would like to store more information on environments, or plan to make other references to it, I would recommend the approach to create a dedicated table.</p><p>But in this example, I assume we only want to capture it in the Change, so I will further explain the way to convert to a choice list.</p><p></p><p><strong>Create an updateset</strong></p><p>You should not execute this on your Production Instance. Therefore, create a updateset that matches your companies naming convention, for example:</p><p>PA Breakdown Environment 1</p><p>and set it to current.</p><p><img   class="image-2 jive-image" height="200" src="4705c082db9c5704ed6af3231f9619d0.iix" style="width: 466px; height: 199.929px;" width="466"/></p><p></p><p><strong>Add the new field</strong></p><p>After that, we can go to the dictionary of the change table (change_request) and add the new Environment field by clicking New.</p><p>Type: Choice</p><p></p><p>Label: Environment</p><p>Name: u_environ (As u_environment is probably taken)</p><p>Choice: Dropdown with --None--</p><p>Right-click in the header and choose Save.</p><p></p><p></p><p><strong>Add choices</strong></p><p>After that, we can add the choices using the related list that appeared.</p><table border="1" cellpadding="0" cellspacing="0" style="border: none;"><tbody><tr><td style="border: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p><strong>Value</strong></p></td><td style="border: solid windowtext 1.0pt; border-left: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p><strong>Label</strong></p></td><td style="border: solid windowtext 1.0pt; border-left: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p><strong>Sequence</strong></p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>dev</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>Development</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>10</p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>test</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>Test</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>20</p></td></tr><tr><td style="border: solid windowtext 1.0pt; border-top: none; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>prod</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>Production</p></td><td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0 5.4pt 0 5.4pt;" valign="top" width="113"><p>30</p></td></tr></tbody></table><p></p><p><img   class="image-3 jive-image" height="399" src="5d5420c6db90dfc03eb27a9e0f96195d.iix" style="width: 528px; height: 399.406px;" width="528"/></p><p></p><p></p><p></p><p><strong>Fill the new column</strong></p><p>The next step might be the hardest part; we are now ready for the actual data improvement. If you have a table with thousands of rows, you probably want to automate this.</p><p></p><p>Below you see an example script to do so.</p><p>Run this on your environment as a background script. Be aware that after testing you must also run this in your production environment, after deploying the updateset.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_14993431153441722 jive_macro_code jive_text_macro" data-renderedposition="2359.390625_8_1192_1344" jivemacro_uid="_14993431153441722"><p>//example script to help convert unstructured data to sys choice options</p><p>//review and test before using this in your instance</p><p></p><p>//Set your variables</p><p>var myTable = "incident"; //change to your table</p><p>var myOldField = "u_caller_mood"; //change to your existing field;</p><p>var myNewField = "u_caller_emotion"; //change to your new field;</p><p>var automatch = true; //Set to false after first time you run this script</p><p>var myOldNewPairs = </p><p>[</p><p>   ["oldValue","newValue"]</p><p>]; </p><p>// define old new values to replace example [["unhappy","angry"],["","new"]]]</p><p></p><p></p><p>//Review and alter following to your needs IF needed</p><p>var gr; </p><p>var vals = []; //To contain all values</p><p>var lbls = []; //To contain all labels</p><p>var au = new ArrayUtil(); //Contains helper fuinctions for arrays</p><p></p><p>//Fill the arrays form choicelist</p><p>var ch = new GlideRecord('sys_choice');</p><p>ch.addQuery("name",myTable); </p><p>ch.addQuery("element",myNewField); </p><p>ch.query();</p><p>while (ch.next()) {</p><p>   vals.push(ch.getValue('value').toLowerCase());</p><p>   lbls.push(ch.getValue('label').toLowerCase());</p><p>}</p><p></p><p>//set the new values based on matches on label or value in syschoice table</p><p>if (automatch){ //only needs to run first time</p><p>   gr = new GlideRecord(myTable);</p><p>   gr.addNullQuery(myNewField);</p><p>   gr.query();</p><p>   while (gr.next()) {</p><p>     </p><p>   gr.setWorkflow(false); //dont trigger anything</p><p>   if (au.indexOf(vals, gr[myOldField].toLowerCase()) &gt;= 0){ </p><p>   //match on values, just copy</p><p>   gr[myNewField] = vals[au.indexOf(vals, gr[myOldField].toLowerCase())];</p><p>   gr.update();</p><p>     </p><p>   }</p><p>   if (au.indexOf(lbls, gr[myOldField].toLowerCase()) &gt;= 0){ </p><p>   //match on label, grab index from values array</p><p>   gr[myNewField] = vals[au.indexOf(lbls, gr[myOldField].toLowerCase())];</p><p>   gr.update();</p><p>   }   </p><p>   }</p><p>}</p><p></p><p>//loop over the old new value pairs</p><p>for (var i = 0; i&lt; myOldNewPairs.length; i++){</p><p>   gr = new GlideRecord(myTable);</p><p>   gr.addQuery(myOldField, myOldNewPairs[i][0]);</p><p>   gr.query();</p><p>   while (gr.next()) {</p><p>   gr.setWorkflow(false); //dont trigger anything</p><p>   if (au.indexOf(vals, myOldNewPairs[i][1].toLowerCase()) &gt;= 0){ </p><p>   //check if its a valid value</p><p>   gr[myNewField] = myOldNewPairs[i][1];</p><p>   gr.update();   </p><p>   } </p><p>   }</p><p>}</p><p></p><p></p><p>//helper to output remaining unstructured values</p><p>var ga = new GlideAggregate(myTable);</p><p>ga.addNullQuery(myNewField);</p><p>ga.addAggregate('COUNT', myOldField );</p><p>ga.query();</p><p>var output = "\n// Helper Array (replace value with one of following choice list values)\n"+</p><p>"// Copy paste below to myOldNewPairs and adjust values \n\n// Possible new values: " + </p><p>vals.toString()</p><p>+'\n[\n ["oldValue","newValue"]';</p><p>while (ga.next()) {</p><p> if (ga[myOldField].toString().length &gt; 0)</p><p>   output += ',\n ["' + ga[myOldField]+ '","value"]' </p><p>}</p><p>output += "\n]";</p><p>gs.print(output);</p></pre><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14988151067939608" data-renderedposition="3703.390625_8_1192_0" jivemacro_uid="_14988151067939608" modifiedtitle="true"></pre><p></p><p>After the script is run, the result is the following.</p><p><img   class="jive-image image-4" height="210" src="2033cc4adbd8d3041dcaf3231f961953.iix" style="width: 354px; height: 210.116px;" width="354"/> <strong> </strong></p><p>The values in the right Environment column are now the cleaned up version. This is the data quality we can build upon!</p><p></p><p>Please review the following video to check out a demonstration how these steps are executed in a demo instance.</p><p><iframe src="https://youtube.com/embed/WiOFOisV2pQ" width="440" height="330"/></p><p></p><p><strong>Next step</strong></p><p>As we love breakdowns, it's also a good idea to breakdown our work. We have now laid the foundation for the best data quality for this breakdown. Let's close the updateset and apply it in the next environment and run the data transformation scripts over there.</p><p>If that's successful we can create a regular breakdown source, breakdown and apply them to the Change Indicators in another updateset.</p><p></p><p>If that all is successful, as the last step, you could remove the original field from</p><p></p><p><strong>Conclusion and Lessons</strong></p><p><span style="text-decoration: underline;">Performance Analytics is part of the platform. Design your customizations and applications with reporting and analytics in mind, meaning a clean data foundation.</span></p><p></p><p>Obviously, it's a lot easier when you initially set it up the right way, rather than correcting it afterward. When you do change it, thorough test and analyze the existing behavior and code, for example, are there ACL's, BR's or client scripts interacting with the existing field? Interact with the platform admins/developer as much as possible and correct the issues at forehand.</p><p></p><p>When you want to change it from a "scripted" breakdown, be aware that the new version is a new breakdown and the original needs to be removed. This would also require a historical data collection.</p><p></p><p><strong>Questions / Suggestions</strong></p><p>If you have any questions about this, are there concepts in Performance Analytics that need clarification?</p><p>Leave a comment, we are happy to help!</p>