---
title: "How to close ticket after  business days"
date: 2017-02-25T05:53:30.000Z
authors: ["Göran Lundqvist"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=314e26addbd0dbc01dcaf3231f961986"
---
<p>I found this question on the community where they were looking for a solution to close the ticket after 3 business days. As we all know, for example the "autoclose" for incident doesn't count business days, it just goes for "days". Which pretty much leaves people setting a high value enough so it would take care most of the short holidays and the customers won't be angry. This solution can be used on all kind of tickets.</p><p></p><p><strong>EDIT:</strong> I also put this as an "idea" on the community, so go in and vote for it and see if we can get it into a future release: <a title="Be able to use Business hours/days to autoclose ticket" __default_attr="1637" __jive_macro_name="idea" class="jive_macro_idea jive_macro" data-orig-content="Be able to use Business hours/days to autoclose ticket" href="undefined1637">Be able to use Business hours/days to autoclose ticket</a> </p><p></p><p>I will use the following stuff to get it to work:</p><p></p><ul><li><strong>Relative Durations</strong>. I use this to set the amount of business days I want it to wait until it closes. <a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_UsingRelativeDuration.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_UsingRelativeDuration.html">Using relative duration</a></li><li><strong>DurationCalculator</strong>. To calculate the duration with a schedule. <a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_DrtnClDueDate.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/script/server-scripting/concept/c_DrtnClDueDate.html">Using DurationCalculator to calculate a due date</a></li><li><strong>Schedule Job</strong>. Then I'll put the code in a schedule job that runs how often you want it to run to check and close those tickets that are "due".</li></ul><p></p><p></p><p>First step is to create a relative duration that fits the amount of days you want. You can easy find it under <em>System Scheduler-&gt;Schedules-&gt;Relative Durations</em>.</p><p>As you can see there are a few examples that you can either use or look to understand how it's build up.</p><p><img   class="image-1 jive-image" height="202" src="33d48982db10d304b322f4621f961978.iix" style="width: 338px; height: 201.71px;" width="338"/></p><p>But lets create a new one that we want to be "3 business days". It doesn't need to be more than this:</p><p><img   class="image-2 jive-image" height="143" src="1a82a006db105f048c8ef4621f961931.iix" style="width: 356px; height: 142.974px;" width="356"/></p><p>Copy the sys_id of this record, since you will be needing it later for the coding of the schedule job.</p><p></p><p>Next step will just to get the sys_id of the schedule you want to use. Just head to the schedule record and copy that sys_id as well.</p><p></p><p>Now we got all the nice things we need. So lets head to <em>System Definition-&gt;Scheduled Job</em> and press <strong><em>New.</em></strong><em> </em>Choose "Automatically run a script of your choosing" and we get to the new record.</p><p>Here you can set how often you want it to run, but perhaps once a day would be nice and let's pick a time when we don't think so many people are working.</p><p>Remember to put all your code in an <span style="text-decoration: underline;"><strong>anonymous function</strong></span> so it variable etc. doesn't get messed up with other things that is running. If you don't do this, strange things can happen if you for example have two jobs running at the same time and both having a variable called for example gr.</p><p></p><p>Summary of the code below.</p><ul><li>Get the sys_id for the relative duration I want to use</li><li>Query all the records I want to go through. Active is true and got a resolve date is the ones I want here.</li><li>Loop through the records I get and check if its been more than 3 business days since it was set to resolve. If it is, close it.</li></ul><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14879798674003661 jive_text_macro" data-renderedposition="1074.375_8_1192_672" jivemacro_uid="_14879798674003661"><p>(function(){</p><p>   //Get the relative duration for 3 business days</p><p>   var relDur = 'f3ae5fc70f0132004cf365ba32050eb9';</p><p>   //get the incidents that we want to go through</p><p>   var encQue = 'active=true^resolved_atISNOTEMPTY';</p><p></p><p>   var gr = new GlideRecord('incident');</p><p>   gr.addEncodedQuery(encQue);</p><p>   gr.query();</p><p></p><p>   while(gr.next()){</p><p>   //Calculate and see if resolve date is more than 3 business days ago. And if, close the ticket.</p><p>   var dc = new DurationCalculator();</p><p></p><p>   //Load the schedule into our calculation through the function below</p><p>   addSchedule(dc);</p><p></p><p>   //Do the calculation and see if end date is before today</p><p>   dc.setStartDateTime(gr.resolved_at);</p><p>   if (!dc.calcRelativeDuration(relDur)) {</p><p>   gs.error("*** calcRelativeDuration failed for record {0}", gr.number);</p><p>   }</p><p>   if (dc.getEndDateTime() &lt; gs.nowDateTime()){</p><p>   gr.setValue('state', 7);</p><p>   gr.update();</p><p>   }</p><p>   }</p><p></p><p>   function addSchedule(durationCalculator) {</p><p>   //   Load the "8-5 weekdays" schedule into our duration calculator.</p><p>   var scheduleName = "8-5 weekdays";</p><p>   var grSched = new GlideRecord('cmn_schedule');</p><p>   grSched.addQuery('name', scheduleName);</p><p>   grSched.query();</p><p>   if (!grSched.next()) {</p><p>   gs.error("*** Could not find schedule {0}.", scheduleName);</p><p>   return;</p><p>   }</p><p>   return durationCalculator.setSchedule(grSched.getUniqueValue(), "GMT");</p><p>   }</p><p></p><p>})();</p></pre><p></p><p>That it, I hope it can give some ideas how to use the duration calculator for more fun stuff.</p><p></p><p></p><p>//Göran</p><p></p><p><br/><img   alt="Symfoni Logo Color Box.jpg" class="image-3 jive-image" height="61" src="d705488adb1c5fc068c1fb651f961919.iix" style="width: 207px; height: 61.0105px;" width="207"/><img   alt="sn-community-mvp.png" class="image-4 jive-image" height="53" src="7d92eb3ddb9093041dcaf3231f96199c.iix" style="width: 150px; height: 53.3333px;" width="150"/></p>