---
title: "Wrap fix scripts in functions or else"
date: 2017-04-06T21:00:34.000Z
authors: ["treycarroll"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=eefd662ddbd0dbc01dcaf3231f9619e1"
---
<p>We noticed a very odd issue yesterday when running a "no brainer" script to update items in a GlideRecord while next loop:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14914936183433477 jive_text_macro" data-renderedposition="50_8_1192_192" jivemacro_uid="_14914936183433477" modifiedtitle="true"><p>var gr = new GlideRecord("cmdb_ci");</p><p>   gr.addNotNullQuery('u_vulnerability_remediation_group');</p><p>   gr.query();</p><p></p><p>   while ( gr.next() ) {</p><p>             try {</p><p>                       gr.setValue('u_vulnerability_remediation_group',   '');</p><p>                       gr.update();</p><p>             } catch(e) {</p><p>                       gs.print(e.message);</p><p>             }</p><p>   }</p></pre><p></p><p>I have used code like this for years in SNOW and it just works (err.. worked).   I have some examples just like this actually checked into source control!</p><p></p><p>Under Helsinki, the actual results of this script were "intriguing":   It deleted a single item and then exited the loop.   </p><p></p><p>After some tinkering I discovered that a function wrapper solved the problem.</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14914941919196223 jive_text_macro" data-renderedposition="389_8_1192_224" jivemacro_uid="_14914941919196223" modifiedtitle="true"><p>//After wrapping the code in a IFFE, the loop continues to update items as expected.</p><p>(function() {</p><p>   var gr = new GlideRecord("cmdb_ci");</p><p>   gr.addNotNullQuery('u_vulnerability_remediation_group');</p><p>   gr.query();</p><p>   while ( gr.next() ) {</p><p>             try{</p><p>                       gr.setValue('u_vulnerability_remediation_group',   '');</p><p>                       gr.update();</p><p>             } catch(e) {</p><p>                       gs.print(e.message);</p><p>             }</p><p>   }</p><p>}());</p></pre>