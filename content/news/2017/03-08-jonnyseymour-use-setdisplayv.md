---
title: "Use setDisplayValue to match reference fields"
date: 2017-03-08T05:24:40.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=123deae5dbd0dbc01dcaf3231f961944"
---
<p>Do you get Reference fields getting the wrong matching? Then use setDisplayValue. Enviably developed within this highly regarded <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/reference-pages/reference/r_FieldTypes.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/reference-pages/reference/r_FieldTypes.html">field type</a> that displays as a string is just one click away from another table that includes our famous <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/use/navigation/concept/c_DotWalking.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/use/navigation/concept/c_DotWalking.html">dot walk features</a>. Dot-walking provides an ideal way to join table records. When you define a reference field, the system creates a relationship between the two tables. Adding a reference field to a form makes the other fields in the referenced table available to the form. When on the incident table, both <strong>Caller</strong> and <strong>Assigned to</strong> are referenced to the sys_user table.</p><p></p><p>Here is the story of an example of what happens when you try to set a <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ReferenceField.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ReferenceField.html">reference field</a> value like any other ordinary field! <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ReferenceField.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/field-administration/concept/c_ReferenceField.html">Reference fields </a>are special. I mean, they are REALLY special. A lion disguised as cat.</p><p></p><p><img   alt="Cat-Lion-Mirror.png" class="image-10 jive-image" height="133" src="d00ec80adb101f048c8ef4621f961998.iix" style="width: 113px; height: 132.941px; display: block; margin-left: auto; margin-right: auto;" width="113"/></p><h2>Example of populating a reference field by setValue vs setDisplayValue</h2><p>I have created two users on sys_user (in this order):</p><p><strong>First user:</strong> user_name = 2, First name = Mike, Last Name = Yes     (Display value : "Mike Yes") - (e.g. sysid:de5e388d4f1932002c9e4b8d0210c7f3)</p><p><img   alt="populate ref.jpg" class="image-6 jive-image" src="e951d486db905304b322f4621f961900.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p><strong>Second user:</strong> user_name = user_2, First name = "", Last Name = 2   (Display value : "2")</p><p><img   alt="populate ref1.jpg" class="image-7 jive-image" src="12d4bbb1db50d3049c9ffb651f9619fd.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p></p><p>When executing the following background script :</p><p></p><p>---background script----</p><pre __default_attr="java" __jive_macro_name="code" class="_jivemacro_uid_148847404947826 jive_macro_code jive_text_macro" data-renderedposition="1046.933349609375_8_1102_192" jivemacro_uid="_148847404947826" modifiedtitle="true"><p>// Create a new Incident</p><p>var gr = new GlideRecord('incident');</p><p></p><p>// Set the caller ID by setValue but using the Display value</p><p>gr.caller_id = "2";</p><p>gr.short_description = "testing sys_user.name and sys_user.user_name matching display value";</p><p>var vsid = gr.insert();</p><p>// Now, retrieving the record inserted</p><p>var gr2 = new GlideRecord('incident');</p><p>gr2.get('sys_id',vsid);</p><p></p><p>gs.print ('inserted ' + gr2.number +' OK. Caller: ' + gr2.caller_id.name + ' Caller sys_id: ' + gr2.caller_id.sys_id);</p></pre><p></p><p>The result is the incident is created with caller_id = "Mike Yes". It matches the incorrect value.</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="1290.933349609375_8_1102_62"><p>&gt; [0:00:00.228] Script completed in scope global: script</p><p>&gt; *** Script: inserted INC0010002 OK. <span style="color: #e23d39;">Caller: Mike Yes</span> Caller sys_id: de5e388d4f1932002c9e4b8d0210c7f3</p></pre><p><img   alt="background script.jpg" class="image-8 jive-image" src="9652d54adb581b04ed6af3231f96194e.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>On reference fields to sys_user, user_name is used to match the user before using the "Display value." This is because I have use setValue ( = is setValue)</p><p><strong>&gt; gr.caller_id = "2";</strong></p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="1592.933349609375_8_1102_43"><p>Please note gr.&lt;field&gt; = "xxx" is the same as gr.setValue('field',"xxxx")</p></pre><p></p><p>Same behavior will be seen on email inbound actions, scripts and <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/import-sets/concept/c_ImportDataUsingImportSets.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/import-sets/concept/c_ImportDataUsingImportSets.html">data imports</a> (loading the data into reference fields). If you are not using the sys_id on reference fields, the appropriate method is:</p><p><strong>&gt; gr.setDisplayValue('caller_id', "2"); </strong></p><pre __default_attr="warning" __jive_macro_name="alert" alert="warning" class="jive_text_macro jive_macro_alert" data-renderedposition="1747.933349609375_8_1102_43"><p>Use setDisplayValue to assign Reference fields or Choice values when the data provided it is the "Display" value</p></pre><p></p><p>Here is the correct script for this example</p><p>---background script----</p><pre __default_attr="java" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14884740839042352 jive_text_macro" data-renderedposition="1867.933349609375_8_1102_224" jivemacro_uid="_14884740839042352" modifiedtitle="true"><p>// Create a new record</p><p>var gr = new GlideRecord('incident');</p><p></p><p>// IMPORTANT: As "2" is the Display value of the user "2", setDisplayValue needs to be used.</p><p>gr.setDisplayValue('caller_id', "2"); </p><p>// as short_description is just string, setValue is enough.</p><p>gr.short_description = "testing sys_user.name and sys_user.user_name matching display value";</p><p>var vsid = gr.insert();</p><p></p><p>// Retrieving the information back to review:</p><p>var gr2 = new GlideRecord('incident');</p><p>gr2.get('sys_id',vsid);</p><p></p><p>gs.print ('inserted ' + gr2.number +' OK. Caller: ' + gr2.caller_id.name + ' Caller sys_id: ' + gr2.caller_id.sys_id);</p></pre><p></p><p>The result is the incident is created with caller_id = "2" . Yeah!</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="2143.933349609375_8_1102_62"><p>&gt;[0:00:00.067] Script completed in scope global: script</p><p>&gt;*** Script: inserted INC0010003 OK. <span style="color: #e23d39;">Caller: 2</span> Caller sys_id: d1de7cc94f1932002c9e4b8d0210c7ce</p></pre><p>It correctly matches the Caller "2".</p><p><img   alt="caller id.jpg" class="image-9 jive-image" src="6cae2ccadb585f048c8ef4621f9619ba.iix" style="width: 620px; height: 134px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>When dealing with reference fields, please ensure to use <strong>setDisplayValue</strong> if you are not passing the sys_id to avoid surprises! If you are creating a script, or a inbound action, a <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/import-sets/task/t_CreateNewDataSource.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/import-sets/task/t_CreateNewDataSource.html">data source</a> (to import data), etc </p><p></p><p><strong>More information here:</strong></p><ul><li><a title="" _jive_internal="true" href="https://docs.servicenow.com/bundle/istanbul-service-management-for-the-enterprise/page/product/facilities-service-management/concept/c_TransformMap.html" rel="nofollow" target="_blank">Transform map</a></li><li><a title="Adding Referenced Field Values to a Form" __default_attr="6281" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Adding Referenced Field Values to a Form" data-renderedposition="2528.783447265625_38_282_17" href="/community?id=community_blog&sys_id=51cc2265dbd0dbc01dcaf3231f96195c">Adding Referenced Field Values to a Form</a></li><li><a title="Where to avoid linking to a reference field when configuring a list" __default_attr="6363" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Where to avoid linking to a reference field when configuring a list" data-renderedposition="2552.583251953125_38_422_17" href="/community?id=community_blog&sys_id=1b3d2ee5dbd0dbc01dcaf3231f961933">Where to avoid linking to a reference field when configuring a list</a></li><li><a title="Example of an import set table (staging table) with reference fields" __default_attr="6219" __jive_macro_name="blogpost" class="jive_macro jive_macro_blogpost" data-orig-content="Example of an import set table (staging table) with reference fields" data-renderedposition="2576.38330078125_38_431_17" href="/community?id=community_blog&sys_id=894deee5dbd0dbc01dcaf3231f961937">Example of an import set table (staging table) with reference fields</a></li><li><strong><a title="" _jive_internal="true" data-containerid="-1" data-containertype="-1" data-objectid="45437" data-objecttype="3" href="/people/jonnyseymour/content">My other blogs</a></strong></li></ul>