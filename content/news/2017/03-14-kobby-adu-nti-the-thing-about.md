---
title: "The thing about redirecting to the Service Portal"
date: 2017-03-13T06:00:22.000Z
authors: ["kobby.adu-nti"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=4a9c6ee1dbd0dbc01dcaf3231f96197c"
---
<p><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">As you may well know, in the Helsinki release of the platform, we introduced the Service Portal. In the base system, there is a </span><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">Script</span><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;"> </span><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">Include</span><span style="font-weight: bold; font-family: arial, helvetica, sans-serif; font-size: 10pt;"> </span><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">named</span><span style="font-weight: bold; font-family: arial, helvetica, sans-serif; font-size: 10pt;"> SPEntryPage</span>.<span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;"> This record is designed to work in conjunction with the system property </span><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;"><span style="font-weight: bold;">glide.entry.first.page.script</span> to control the login behaviour of an end user when attempting to access an instance. Unfortunately, in Helsinki and the early versions of the Istanbul release of the platform, we see that the <span style="font-family: arial, helvetica, sans-serif; font-size: 13.3333px; font-weight: bold;">SPEntryPage </span>Script Include does not behave as described in the document site below.</span></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;"><a title="ocs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_RedirectToSPAfterLogin.html#c_RedirectToSPAfterLogin" href="https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_RedirectToSPAfterLogin.html#c_RedirectToSPAfterLogin">https://docs.servicenow.com/bundle/helsinki-servicenow-platform/page/build/service-portal/concept/c_RedirectToSPAfterLogin.html#c_RedirectToSPAfterLogin</a></span></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">We have updated the article above now, but in a previous incarnation of this article, there was a mention that the <strong>SPEntryPage</strong> script contained a function that redirected any end user account attempting to access an instance to the Service Portal, on the condition that the end user account was not configured with a role.</span></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">I would invite you to review your <strong>SPEntryPage</strong> script, in line 69 of the Script Include record there is a condition that looks for a user <em><strong>role</strong> </em>as a control. On a base system you will see the following code defined:</span></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><table border="1" cellpadding="0" cellspacing="0" style="border-style: solid; border-color: #a3a3a3; border-width: 1pt;" summary="" title=""><tbody><tr><td style="border-style: solid; border-color: #a3a3a3; border-width: 1pt; padding: 4pt 4pt 4pt 4pt;"><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-family: 'courier new', courier;"><strong>if (user.hasRoles() &amp;&amp; !redirectURL &amp;&amp; !isServicePortalURL)</strong></span></p></td></tr></tbody></table><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">The above code snippet is problematic as there is no variable <span style="font-weight: bold; font-style: italic;">user </span>defined in SPEntryPage record. The condition will therefore never trigger. Service Now is well aware of this issue and will be addressing it in later releases of Helsinki and Istanbul.</span></p><p style="font-family: Calibri; font-size: 11.0pt;"></p><p style="font-family: Calibri; font-size: 11.0pt;"><span style="font-family: arial, helvetica, sans-serif; font-size: 10pt;">This issue can be corrected by updating the Script Include from line 60 - 69 with the following code:</span></p><p></p><table border="1" cellpadding="0" cellspacing="0" style="border-style: solid; border-color: #a3a3a3; border-width: 1pt;" summary="" title=""><tbody><tr><td style="border-style: solid; border-color: #a3a3a3; border-width: 1pt; padding: 4pt 4pt 4pt 4pt;"><p style="font-family: Courier; font-size: 11.0pt;"><strong>getFirstPageURL: function() {</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               var session = gs.getSession();</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               this.logProperties('before', session);</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               var check = session.getRoles();</strong></p><p style="font-family: Courier; font-size: 11.0pt;"></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               // has roles and is not a Service Portal page - go to UI16</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               var nt = session.getProperty("nav_to");</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               var isServicePortalURL = new GlideSPScriptable().isServicePortalURL(nt);</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               var redirectURL = session.getProperty("login_redirect");</strong></p><p style="font-family: Courier; font-size: 11.0pt;"></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>               if (check &amp;&amp; !redirectURL &amp;&amp; !isServicePortalURL)</strong></p><p style="font-family: Courier; font-size: 11.0pt;"><strong>                       return;</strong></p></td></tr></tbody></table>