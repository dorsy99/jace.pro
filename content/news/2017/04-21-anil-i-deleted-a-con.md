---
title: "I deleted a configuration item accidently How to restore it without data loss"
date: 2017-04-21T03:18:27.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=65bd6aa9dbd0dbc01dcaf3231f96198c"
---
<p>Step 1: Go to deleted records and find out which all records got deleted because of the deleted configuration item record.</p><p>Usually you will see records from cmdb_ci ( or any of the child tables depending on which CI got deleted) and the task_ci records corresponding to that CI.</p><p></p><p>Step 2.Using the undelete option, restore the cmdb_ci( or any of the child tables depending on which CI got deleted) records first and then undelete the other related records like task_ci or other m2m table records.</p><p></p><p>Step 3. Go to sys_history_line table and find out which task records had a configuration item on them and not have them anymore in order to get that data run below query in background script ( strongly recommended to run in dev or sub prod instances and validate the data before doing it on prd instance)</p><p></p><p>var query = 'cmdb_ci=';</p><p>var cmdb_ci_sys_id = '';</p><p>var grTask = new GlideRecord('task');</p><p>grTask.addEncodedQuery(query);</p><p>grTask.query();</p><p>while(grTask.next()) {</p><p>cmdb_ci_sys_id = getCI(grTask.sys_id);</p><p>if(cmdb_ci_sys_id != '')</p><p>   gs.print(grTask.number + "|" + grTask.sys_id + "|"   +cmdb_ci_sys_id );</p><p>}</p><p></p><p></p><p>function getCI(task) {</p><p>   var query = 'set.id='+ task+'^label=Configuration item';</p><p>   var cmdb_ci_sys_id = '';</p><p>   //gs.print(query);</p><p>   var grHist = new GlideRecord('sys_history_line');</p><p>   grHist.addEncodedQuery(query);</p><p>       grHist.orderByDesc('update_time');</p><p>       grHist.query();</p><p>       if(grHist.next()) {</p><p>       cmdb_ci_sys_id = grHist.new_value;</p><p>       }</p><p>return cmdb_ci_sys_id ;</p><p>}</p><p></p><p>You should receive an output like this</p><p></p><p><span style="color: #000000; font-family: 'Times New Roman'; font-size: medium;">[0:00:02.426] Script completed in scope global: script</span></p><hr style="color: #000000; font-family: 'Times New Roman'; font-size: medium;"/><pre style="color: #000000;">*** Script: INC0000040|471d4732a9fe198100affbf655e59172|0c43b896c6112275019abd2b2b93f464</pre><p></p><p>the output is a | separated text, now this can be easily copied to excel and converted to 3 columns, task #, task sys_id and cmdb_ci sys_id.</p><p></p><p>Step 4: Next we have 2 options 1. either update the task record via script or manually do it.</p><p></p><p>If you want to it via script then the above script can be tweaked to do the same.</p><p></p><p>Below script provides 2 options 1. use it to verify the existence of cmdb_ci sys_id by setting the doIt = false, use it to update the task record by setting the doIt = true</p><p>var doIt = false; // use this to verify the data</p><p>//var doIt = true; // use this to update the data</p><p>checkTasks(doIt);</p><p>function checkTasks(doIt) {</p><p>   var query = 'cmdb_ci=';</p><p>   var cmdb_ci_sys_id = '';</p><p>   var grTask = new GlideRecord('task');</p><p>   grTask.addEncodedQuery(query);</p><p>   grTask.query();</p><p>   while(grTask.next()) {</p><p>   cmdb_ci_sys_id = getCI(grTask.sys_id);</p><p>   if(cmdb_ci_sys_id != '') {</p><p>   gs.print(grTask.number + "|" + grTask.sys_id + "|"   +cmdb_ci_sys_id );</p><p>   if(doIt) {</p><p>   grTask.cmdb_ci = cmdb_ci_sys_id;</p><p>   grTask.setWorkFlow(false);</p><p>   grTask.update();</p><p>   }</p><p>   }</p><p>   }</p><p>}</p><p></p><p></p><p>function getCI(task) {</p><p>   var query = 'set.id='+ task+'^label=Configuration item';</p><p>   var cmdb_ci_sys_id = '';</p><p>   //gs.print(query);</p><p>   var grHist = new GlideRecord('sys_history_line');</p><p>   grHist.addEncodedQuery(query);</p><p>   grHist.orderByDesc('update_time');</p><p>   grHist.query();</p><p>   if(grHist.next()) {</p><p>   cmdb_ci_sys_id = grHist.new_value;</p><p>   }</p><p>   return cmdb_ci_sys_id ;</p><p>}</p>