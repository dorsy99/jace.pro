---
title: "Blackouts and Maintenance Rules"
date: 2017-08-08T07:35:39.000Z
authors: ["Tony B"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f1ade2a9dbd0dbc01dcaf3231f96191c"
---
<p>In Event Management the term "blackout" (or "maintenance") is used to refer to a time period when notifications for events should be prevented, for example when regular system maintenance is scheduled.   Ideally, Event Management would be tightly integrated with a CMDB so that changes to the status of a CI would be reflected in an alert (i.e. event notification).   Furthermore, if Event Management is tightly integrated with Change Management, then any active change requests that change the status of a CI would also be reflected in an alert. ServiceNow Event Management takes advantage of native integration with the CMDB and Change Management to automate these blackout scenarios, and it does so using <strong>Maintenance Rules</strong>.</p><p></p><p>Maintenance Rules are used to determine when the <strong>Maintenance</strong> field for an alert associated with a CI in the CMDB should be set (or unset).   When an alert is in maintenance, the impact of the alert (i.e. the severity) for the CI is excluded from impact calculations.</p><p></p><p>ServiceNow Event Management includes two default Maintenance Rules that will automatically set the Maintenance field for an alert to true:</p><ul><li>CI in Change Window - Where the CI has an active change window, the matching CIs are marked as being in maintenance status.   The following conditions in a Change Requestmust be met:<ul><li><strong>State</strong> is one of these options: Scheduled, Implement, Work in Progress, or Open/New</li><li><strong>Approval</strong> is Approved</li><li>The current time is between <strong>Planned start date</strong> and <strong>Planned end date</strong>, or between <strong>Actual start</strong> and <strong>Actual end</strong></li><li>The change request record is not an on-hold record</li></ul></li><li>Maintenance status of CI - CIs whose CMDB status field is <strong>In Maintenance</strong> are flagged by this rule as being in maintenance status.</li></ul><p></p><p>Maintenance Rules are executed every minute by a scheduled job.</p><p></p><p>In addition to these OOTB Maintenance Rules, you can define your own rules to cater for unique requirements.   You can configure a Maintenance Rule to automatically set the Maintenance field in an alert based on a condition built from any table within a ServiceNow instance.   Two examples using this method are provided in the ServiceNow <a title="ocs.servicenow.com/bundle/jakarta-it-operations-management/page/product/event-management/task/create-maintenance-rule.html" href="https://docs.servicenow.com/bundle/jakarta-it-operations-management/page/product/event-management/task/create-maintenance-rule.html">Product Documentation</a>.   Note that when a custom Maintenance Rule sets the Maintenance field to true for an alert, the associated CI's status is <em>not</em> set to In Maintenance - <em>the Maintenance Rule only changes the status of the Maintenance field for the alert</em>.</p><p></p><p>Some scenarios however, may require more complex business logic and fortunately, Maintenance Rules include an <strong>Advanced</strong> option enabling JavaScript to be used to configure processing logic.</p><p></p><p>Recently a <a title="" _jive_internal="true" href="/community?id=community_question&sys_id=9e444f29dbd8dbc01dcaf3231f96197d">question</a> was posted on the ServiceNow Community asking how Event Management could suppress alerts for CIs during a specific time window.   For example, suppose a monitoring tool generates an event for a Windows Server that experiences very high CPU utilization every day between between 6am - 7am however this is actually normal.   Assuming "blackout" functionality is not available in the monitoring tool (and you're <em>not</em> using <a title="ocs.servicenow.com/bundle/jakarta-it-operations-management/page/product/event-management/concept/operational-metrics.html" href="https://docs.servicenow.com/bundle/jakarta-it-operations-management/page/product/event-management/concept/operational-metrics.html">Operational Intelligence</a>... wait, you're <em>not??</em>), you might initially consider using an Event Rule in ServiceNow to filter events.   While configuring a Filter in an Event Rule does support certain date/time operations such as comparing the time_of_event between two selected times, the times are effectively static - you wouldn't want to be manually setting the start and end date/times every day, right?</p><p></p><p>Rather than filter the event, we can use a Maintenance Rule to automatically set the Maintenance field to true for an alert.   Here's how in Jakarta:</p><ul><li>Navigate to <strong>Event Management &gt; Rules &gt; Maintenance Rules</strong> and click on <strong>New</strong>.</li><li>Provide a <strong>Name</strong> for the rule and then check the <strong>Advanced</strong> checkbox.   When you do this you'll see default code provided for you:</li></ul><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier; font-size: 8pt;">(<span style="color: #660000;"><strong>function</strong></span> findCisInMaint(){</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier; font-size: 8pt;">     <span style="color: #339900;"><strong>//Your code goes here</strong></span></span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier; font-size: 8pt;">     <span style="color: #660033;"><strong>var</strong></span> <span style="color: #2873ee;"><strong>result</strong></span> = [<span style="color: #2873ee;"><strong>'id1'</strong></span>,<span style="color: #2873ee;"><strong>'id2'</strong></span>,<span style="color: #2873ee;"><strong>'id3'</strong></span>];</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier; font-size: 8pt;">     </span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier; font-size: 8pt;">     <span style="color: #660000;"><strong>return</strong></span> JSON.stringify(<span style="color: #3a0699;"><strong>result</strong></span>);</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier; font-size: 8pt;">})();</span></p><ul><li>The script returns an array of strings that are then converted into a format Event Management uses to place alerts with matching CIs into Maintenance.   Here's a sample script supporting the scenario described above:</li></ul><p></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">(<span style="color: #660033;">function</span> findCisInMaint(){</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="color: #339900; font-size: 8pt; font-family: 'courier new', courier;">     // Get the CI(s)</span></p><p style="padding-left: 30px;"><span style="font-family: 'courier new', courier;"><span style="font-size: 8pt;">     <span style="color: #660033;">var</span> <span style="color: #2873ee;">ci</span> = <span style="color: #660033;">new</span> GlideRecord(</span><span style="color: #2873ee; font-size: 8pt;">'cmdb_ci'</span><span style="font-size: 8pt;">);</span></span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">     <span style="color: #3a0699;">ci</span>.addQuery(<span style="color: #2873ee;">'name'</span>,<span style="color: #2873ee;">'V-W2K3-32-MQ7'</span>);</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">     <span style="color: #3a0699;">ci</span>.addQuery(<span style="color: #2873ee;">'sys_class_name'</span>, <span style="color: #2873ee;">'cmdb_ci_win_server'</span>);</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">     <span style="color: #3a0699;">ci</span>.query();</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">     <span style="color: #660033;">if</span> (<span style="color: #3a0699;">ci</span>.next()) {</span></p><p style="padding-left: 30px;"><span style="color: #339900; font-size: 8pt; font-family: 'courier new', courier;">           // Set the CI ID</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033; font-size: 8pt;">var</span> <span style="color: #2873ee;">cid</span> = <span style="color: #3a0699;">ci</span>.sys_id;</span></p><p style="padding-left: 30px;"><span style="color: #339900; font-size: 8pt; font-family: 'courier new', courier;">           // Get current date/time so we can build the date format</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033;">var</span> <span style="color: #2873ee;">cdt</span> = <span style="color: #660033;">new</span> GlideDateTime();</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033; font-size: 8pt;">var</span> <span style="color: #2873ee;">date</span> = <span style="color: #3a0699;">cdt</span>.getYearUTC() + <span style="color: #2873ee;">'-'</span> + <span style="color: #3a0699;">cdt</span>.getMonthUTC() + <span style="color: #2873ee;">'-'</span> + <span style="color: #3a0699;">cdt</span>.getDayOfMonthUTC();</span></p><p style="padding-left: 30px;"><span style="color: #339900; font-size: 8pt; font-family: 'courier new', courier;">           // Set start time</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033; font-size: 8pt;">var</span> <span style="color: #2873ee;">sgt</span> = <span style="color: #660033; font-size: 8pt;">new</span> GlideDateTime();</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #3a0699;">sgt</span>.setDisplayValueInternal(<span style="color: #3a0699;">date</span> + <span style="color: #2873ee;">' 06:00:00'</span>); <span style="color: #339900;">// Adjust as necessary</span></span></p><p style="padding-left: 30px;"><span style="color: #339900; font-size: 8pt; font-family: 'courier new', courier;">           //Set end time</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033; font-size: 8pt;">var</span> <span style="color: #2873ee;">egt</span> = <span style="color: #660033; font-size: 8pt;">new</span> GlideDateTime();</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #3a0699;">egt</span>.setDisplayValueInternal(<span style="color: #3a0699;">date</span> + ' 07:00:00'); <span style="color: #339900;">// Adjust as necessary</span></span></p><p style="padding-left: 30px;"><span style="color: #339900; font-size: 8pt; font-family: 'courier new', courier;">           // Get current time</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033; font-size: 8pt;">var</span> <span style="color: #2873ee;">ngt</span> = <span style="color: #660033; font-size: 8pt;">new</span> GlideDateTime();</span></p><p style="padding-left: 30px;"></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #339900;">// if the current time is between the start and end times add the CI to the result array</span></span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           <span style="color: #660033; font-size: 8pt;">if</span> ((<span style="color: #3a0699;">ngt</span>.compareTo(<span style="color: #3a0699;">sgt</span>)==1) &amp;&amp; (<span style="color: #3a0699;">ngt</span>.compareTo(<span style="color: #3a0699;">egt</span>)==-1)) {</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">                 <span style="color: #660033; font-size: 8pt;">var</span> <span style="color: #2873ee;">result</span> = [<span style="color: #3a0699;">cid</span> + <span style="color: #2873ee;">""</span>];</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">                 <span style="color: #660033;">return</span> JSON.stringify(<span style="color: #3a0699;">result</span>);</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">           }</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">     }</span></p><p style="padding-left: 30px;"><span style="font-size: 8pt; font-family: 'courier new', courier;">})();</span></p><p></p><p></p><p>In this sample script, since the sys_id field being returned is an object we append the "" to convert it to a string as the function returns an array of strings. While this is a fairly basic example, it could easily be extended into a more flexible solution by adding a table and form allowing the CI(s) and start/end times to be selected.</p><p></p><p>Hopefully the information in this blog helps demystify how Maintenance Rules can be used to support blackouts in ServiceNow Event Management.</p><p></p><p>Keep posted for more blogs on Event Management in the future.</p>