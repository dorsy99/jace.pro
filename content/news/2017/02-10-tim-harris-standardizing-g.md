---
title: "Standardizing GlideAjax Calls to Prevent Script Include Sprawl"
date: 2017-02-09T09:28:06.000Z
authors: ["tim.harris"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=4a1d22e5dbd0dbc01dcaf3231f961976"
---
<p>A while back I realized that we were running into what I would call, "script include sprawl." Let me explain...</p><p></p><p>Pretty much every GlideAjax call that was being made had it's own corresponding script include to return specific data. At best, a new method was being added to an already existing script include. YUCK!! Think about it-- It doesn't take long for things to get really messy. </p><p></p><p>Then, I got the ACE report results and realized that there were tons of client scripts that were doing direct GlideRecord queries instead of a GlideAjax call. Things were about to get even messier unless I provided a standardized way to do all GlideAjax calls through one script include.</p><p></p><p>Here is the solution I came up with:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14866103558266043 jive_text_macro" data-renderedposition="218_8_1192_576" jivemacro_uid="_14866103558266043"><p>var AjaxGlideRecord = Class.create();</p><p>AjaxGlideRecord.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p>   getRecordField: function() {</p><p>   var data = '';</p><p>   var table = this.getParameter('sysparm_table_name')+'';</p><p>   var enc = this.getParameter('sysparm_encoded_query')+'';</p><p>   var field = this.getParameter('sysparm_field')+'';</p><p></p><p>   var gr = new GlideRecord(this.getParameter('sysparm_table_name'));</p><p>   gr.addEncodedQuery(this.getParameter('sysparm_encoded_query'));</p><p>   gr.query();</p><p>   if(gr.next()) {</p><p>   data = gr.getValue(field);</p><p>   }</p><p>   return data;</p><p>   },</p><p>   getRecordFields: function() {</p><p>   var data = {};</p><p>   var table = this.getParameter('sysparm_table_name')+'';</p><p>   var enc = this.getParameter('sysparm_encoded_query')+'';</p><p>   var fields = this.getParameter('sysparm_fields')+'';</p><p>   var field_names = fields.split("|");</p><p></p><p>   var gr = new GlideRecord(this.getParameter('sysparm_table_name'));</p><p>   gr.addEncodedQuery(this.getParameter('sysparm_encoded_query'));</p><p>   gr.query();</p><p>   if(gr.next()) {</p><p>     field_names.forEach(function(element) {</p><p>     data[element] = gr.getValue(element);</p><p>     });   </p><p>   }</p><p>   data = new global.JSON().encode(data);</p><p>   return data;</p><p>   },</p><p>       type: 'AjaxGlideRecord'</p><p>});</p></pre><p></p><p>Here is how to retrieve a single piece of data from a client script:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_14866105011985103 jive_text_macro" data-renderedposition="857_8_1192_192" jivemacro_uid="_14866105011985103"><p>var ga = new GlideAjax('AjaxGlideRecord');</p><p>ga.addParam('sysparm_name','getRecordField');</p><p>ga.addParam('sysparm_table_name',"sys_user");</p><p>ga.addParam('sysparm_encoded_query',"sys_id=ba1443d38db62400932b553d6ead9dec");</p><p>ga.addParam('sysparm_field',"email");</p><p>ga.getXML(parseResult);</p><p></p><p></p><p>function parseResult(response) {</p><p>     var answer = response.responseXML.documentElement.getAttribute("answer");</p><p>     console.log(answer);</p><p>}</p></pre><p></p><p>Here is how to retrieve multiple pieces of data from a client script:</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_14866105998402060" data-renderedposition="1112_8_1192_224" jivemacro_uid="_14866105998402060"><p>var ga = new GlideAjax('AjaxGlideRecord');</p><p>ga.addParam('sysparm_name','getRecordFields');</p><p>ga.addParam('sysparm_table_name',"sys_user");</p><p>ga.addParam('sysparm_encoded_query',"sys_id=ba1443d38db62400932b553d6ead9dec");</p><p>ga.addParam('sysparm_fields',"email|user_name");</p><p>ga.getXML(parseResult);</p><p></p><p></p><p>function parseResult(response) {</p><p>     var answer = response.responseXML.documentElement.getAttribute("answer");</p><p>     answer = answer.evalJSON(); // Turn JSON string into object</p><p>     console.log(answer.email);</p><p>     console.log(answer.user_name);</p><p>}</p></pre><p></p><p>Problem solved.</p>