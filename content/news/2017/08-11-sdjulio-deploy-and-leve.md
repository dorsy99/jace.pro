---
title: "Deploy and leverage your Edge Encryption proxy"
date: 2017-08-11T01:01:34.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=bdace225dbd0dbc01dcaf3231f9619c0"
---
<p>ServiceNow's <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/reference/edge-encryption.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/reference/edge-encryption.html">Edge Encryption</a> proxy is an on-premise proxy server that uses industry standard encryption to make specific ServiceNow instance data (fields and attachments) unreadable and unusable by anyone or any application. This means that your data cannot be seen or accessed in any useable state by ServiceNow, a potential attacker, or any other unauthorized party. Once deployed, authorized access to the ServiceNow instance data can only be achieved through the Edge Encryption proxy server using the appropriate encryption keys and certificates. Edge Encryption allows you to securely expand the use of your ServiceNow enterprise services and maintain control over your most sensitive data whether at rest, in motion, or in use.</p><p></p><p>If you have already purchased an Edge Encryption proxy subscription, then perhaps you have some questions prior to full deployment. This post is intended to assist in your preparations to leverage this powerful data security tool. The information below will give you the knowledge and confidence needed for a successful deployment.</p><p></p><h1><span style="color: #303030;">Your keys to a savvy Edge Encryption proxy deployment</span></h1><ol><li><a title="o" href="#net">Know your network</a></li><li><a title="" _jive_internal="true" href="#size">Edge Proxy sizing recommendations</a></li><li><a title="" _jive_internal="true" href="#lb">Load balancer considerations</a></li><li><a title="" _jive_internal="true" href="#cert">Certificates and key stores</a></li><li><a title="" _jive_internal="true" href="#props">Edge Encryption properties</a></li><li><a title="" _jive_internal="true" href="#tokens">Encryption tokens</a></li><li><a title="" _jive_internal="true" href="#logs">Understanding logs</a></li><li><a title="" _jive_internal="true" href="#time">Timing</a></li></ol><p></p><h3><a name="net"></a>Networking: Know your network</h3><p>It is imperative to understand your network environment as well as where the Edge proxy would be deployed. It is not a replacement for a simple pass-through proxy. Neither is it a caching and web acceleration tool. It is an <a title="w.juniper.net/techpubs/en_US/junos-space15.2/topics/concept/junos-space-ssl-forward-proxy-overview.html" href="http://www.juniper.net/techpubs/en_US/junos-space15.2/topics/concept/junos-space-ssl-forward-proxy-overview.html">SSL forward proxy</a>. The client initiates a secure session with the Edge Proxy which is then terminated. The Edge Proxy initiates a session with your ServiceNow instance on behalf of the client. The client does not interact directly with the instance, and the reverse is also true. The proxy, therefore, manages two sessions at once. This is an important networking consideration.</p><p></p><p>Please note that Edge Proxy is a Java application. Java manages HTTP sessions but offloads networking to the host OS. The host OS' TCP stack, therefore, must be tuned for optimum performance.</p><p></p><p><span style="color: #303030;">Review the following for TCP tuning on Windows</span></p><ul><li><a title="echnet.microsoft.com/en-us/library/2007.01.cableguy.aspx" href="https://technet.microsoft.com/en-us/library/2007.01.cableguy.aspx">TCP Receive Window Auto-Tuning</a></li><li><a title="" _jive_internal="true" href="https://blogs.technet.microsoft.com/networking/2016/08/11/an-update-on-windows-tcp-autotuninglevel/" rel="nofollow" target="_blank">An Update on Windows TCP AutoTuningLevel</a></li><li><a title="" _jive_internal="true" href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2129176" rel="nofollow" target="_blank">After upgrading a virtual machine to hardware version 11, network dependent workloads experience performance degradation</a></li><li><a title="" _jive_internal="true" href="http://pubs.vmware.com/vsphere-60/index.jsp?topic=/com.vmware.vsphere.networking.doc/GUID-D80AEC2F-E0DA-4172-BFFD-B721BF36C2E8.html" rel="nofollow" target="_blank">Enable or Disable TSO on a Windows Virtual Machine</a></li><li><a title="" _jive_internal="true" href="https://www.ibm.com/support/knowledgecenter/SS7JFU_8.5.5/com.ibm.websphere.express.doc/ae/tprf_tunewindows.html" rel="nofollow" target="_blank">Tuning Windows systems</a></li></ul><p></p><h3><a name="size"></a>Edge Proxy sizing recommendations</h3><p>ServiceNow recommends that customers <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/edge-environment-size.html#edge-environment-size" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/edge-environment-size.html#edge-environment-size">deploy at least two Edge Encryption Proxies</a>.     This not only provides for good performance, but also allows for service</p><p>resiliency in the case of failure of a single host. A recent performance enhancement allows the proxy to make a much greater number of connections to a single host</p><p>than was previously possible.</p><p></p><pre __default_attr="info" __jive_macro_name="alert" alert="info" class="jive_text_macro jive_macro_alert" data-renderedposition="2165.2333984375_8_265_14"><p>This update is available beginning with the following releases: Helsinki Patch 4 Hotfix 5, Helsinki Patch 10, Istanbul Patch 5 and Patch 6, Jakarta.</p></pre><p></p><p>At minimum, each Edge Proxy should have 4GB of available RAM to use.   Six GB of RAM is recommended.   This implies a hardware requirement of at least an additional 1GB of RAM for the operating system. The following property is commented out by default but should be enabled if hardware requirements are met: <strong>wrapper.java.initmemory<span style="font-size: 12.0pt; font-family: Calibri;">=4096</span></strong>.   If six GB of RAM are available, then the value would be 6144.   The file to edit is &lt;install dir&gt;/conf/wrapper.conf.</p><p></p><p>While we do not typically set an upper bound for memory utilization it may be something for you to consider setting if the system will be hosting more than one service. Java will consume nearly all remaining system memory if an upper bound is not set.   In order to set the upper bound, please use the following parameter in wrapper.conf: <strong>wrapper.java.maxmemory=XX</strong>.   The numerical value is expressed in megabytes and must be equal to or larger than that set in wrapper.java.initmemory.</p><p></p><h3><a name="lb"></a>Load balancer considerations</h3><p>With several Edge proxies in a load balancer pool and the load balancer doing SSL termination, clients will need the load balancer to present a certificate valid for the FQDN of the virtual host.   As long as that certificate is trusted by the clients, there should be no issue.   It would then be a choice on your part whether the load balancer uses HTTPS to talk to the Edge proxies, or simple HTTP.   The latter could be used if that leg of the network is secure and you want to avoid SSL overhead.   The Edge Proxy will always use HTTPS when connecting to your ServiceNow instance.</p><p></p><p>Another key factor when using load balancers is that client sessions must be persistent.   This means that if a client connects to the proxy using pool member A, then all subsequent traffic between the proxy and the client must go through pool member A.   How this is accomplished depends on the specific load balancer.   One strategy is to use session ID headers, but it is not the only approach. You can use<a title="upport.f5.com/kb/en-us/products/lc_9_x/manuals/product/lc_config_guide_10_1/lc_persist_profiles.html" href="https://support.f5.com/kb/en-us/products/lc_9_x/manuals/product/lc_config_guide_10_1/lc_persist_profiles.html"> F5 load balancers</a>.</p><p></p><h3><a name="cert"></a>Certificates and key stores: Involve your security team</h3><p>Your security team is an essential part of your deployment process.   They are typically in charge of creating the certificates needed by your Edge Proxy.   The proxy or, proxies, need certificates which your clients will trust.   As such they will have to be signed by a trusted Certificate Authority (CA).   This certificate will have to be placed into the Edge Proxy's key store since it will present this certificate to your clients when they attempt to connect.   If you use a load balancer and terminate SSL as mentioned above, then the certificate will be presented by the load balancer.</p><p></p><p>Again, clients would have to trust the certificate.</p><ul><li><a title="wrickert.wordpress.com/2011/10/07/certificates-for-dummies/" href="https://nwrickert.wordpress.com/2011/10/07/certificates-for-dummies/">Some PKI basics</a></li><li><a title="va67.blogspot.com/2012/12/truststore-vs-keystore-in-java-ssl.html" href="http://java67.blogspot.com/2012/12/truststore-vs-keystore-in-java-ssl.html">What's the difference between a key store and a trust store?</a></li></ul><p></p><h3>Mind your key stores</h3><p>The Edge Encryption Proxy is able to use Java key stores as well as SafeNet KeySecure key stores out of the box.   In its default configuration the Edge Proxy will rely on a Java key store: keystore.jceks.   Note that this is not a JKS file.   <a title="jks.readthedocs.io/en/latest/jks.html" href="http://pyjks.readthedocs.io/en/latest/jks.html">JCEKS</a> (Java Cryptography Extension KeyStore) files, in general, offer better protection than JKS.   Keystore.jceks is where the proxy stores the certificates it will present as a client.   It also stores your <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_CreateEncryptionKeys.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_CreateEncryptionKeys.html">encryption key(s)</a> and its digital signature for signing changes to the encryption properties and configuration files. See how to <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_SetUpAKeyPair.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_SetUpAKeyPair.html">set up a key pair.</a></p><p></p><p>Keystore.jceks has a copy of the ServiceNow public key.   This key must be a part of the key store so that the proxy can trust out of box rules and configurations. It is possible for you to build your own key store, but this key must be part of it. When you modify this file, please remember not to set a different password for items inside the key store.   While it is possible to do so, we are unable to open items inside the key store which have a different password than the file itself at this time.   Here is a sample command for <a title="ww.ibm.com/support/knowledgecenter/en/SSB2KG_1.0.0/com.ibm.tivoli.isklm.doc_11/top_EKMipug_example_1.html" href="https://www.ibm.com/support/knowledgecenter/en/SSB2KG_1.0.0/com.ibm.tivoli.isklm.doc_11/top_EKMipug_example_1.html">importing a certificate into a JCEKS key store</a>: keytool -import -keystore my_keystore.jceks -file new_cert.pem -alias my_client_cert -storepass "SOME_PASSWORD" -storetype JCEKS</p><p></p><p><span>See <a href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_SetUpSecureSSLConnection.html" title="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_SetUpSecureSSLConnection.html">Import and configure the certificate for secure SSL connection</a> for more info.<br/></span></p><p></p><p>If you have multiple proxies connecting to the same instance they should either have a copy of the same keystore file, or should read the key store from a shared network location.   Either of these could be difficult to manage.   For this reason, Edge Encryption Proxies can also use <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_SetUpNAEKeyStore.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/task/t_SetUpNAEKeyStore.html">SafeNet KeySecure keystores</a>. This allows for full lifecycle management, automated operations and many other benefits.   Configuration information is found below.</p><h3></h3><p></p><h3><a name="props"></a>Know your Edge Encryption properties</h3><p>The <a title="ocs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/reference/r_EdgeEncryptionProperties.html" href="https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/administer/edge-encryption/reference/r_EdgeEncryptionProperties.html">edgeencryption.properties</a> file is the primary configuration document for your Edge Encryption Proxy.     One key property is <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/reference/r_EdgeEncryptionProperties.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/reference/r_EdgeEncryptionProperties.html">edgeencryption.proxy.host</a>.   The documentation is clear:</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="5225.14990234375_8_265_14"><p>Server name, IP address, or fully qualified domain name of the   computer running the proxy. Along with the port, this property defines the URL used by the client to access the proxy server. </p></pre><p>The value is important for two reasons:</p><p></p><ol><li>Browser clients understand this as the location where resources are found</li><li>Session security uses this value as part of the certificate validation process</li></ol><p></p><p>First, this is the IP or FQDN (Fully Qualified Domain Name) of the host running the Edge Proxy service, not just a host name.   This means having foo.bar.com (FQDN) and not simply foo (server name).   This value is important because it is the host name which the Edge proxy presents to clients upon connection.   Client browsers understand this as the host where resources may be found.   Second, since this will typically be a secure connection, a client will review the certificate presented by the proxy and test whether the DNS record for foo.bar.com resolves to the IP of the host presenting that certificate.   If not, the SSL/TLS session is aborted.   This has further implications for more advanced configurations.</p><p></p><p>For example, the name of the load balancer can be used in this parameter.   This device will then take care of routing   traffic to the appropriate proxy behind it.   Finally, it should be noted that this parameter should never use the loopback address (127.0.0.1) or localhost. As mentioned before, the proxy provides that address when presenting resources: <a title="" _jive_internal="true" href="https://127.0.0.1:8082/navpage.do" rel="nofollow" target="_blank">https://127.0.0.1:8082/navpage.do</a> for example.   The browser would understand that "navpage.do" is found at its localhost address, which is false, and the browser would throw an error.</p><p></p><p>Let us say that you have decided that multiple Edge proxies are needed to make efficient use of resources.   Each host will still have to have its FQDN in edgeencryption.proxy.host.   In case that the load balancer terminates SSL/TLS, the clients will not communicate directly with the Edge proxies.   Therefore, the proxies will only communicate with the load balancer before them and the instance on the other side.   It is possible for the load balancer not to communicate with the proxies using SSL/TLS to reduce overhead.   This should only be considered if the network is known secured and trusted.   In case the load balancer simply passes the connections to the proxy pool and sticks sessions to specific proxies, it is still recommended that the value remain the local FQDN.   However, it is in this configuration that certificate validation can become a more complex issue.   Let's say that the client attempts to connect to edge.mydomain.com.   It will expect a certificate issued to edge.mydomain.com, but the proxies may respond with a certificate where the Subject field has a value of proxy_X.mydomain.com. If there is nothing further in the Subject Alternative Name field, this connection will fail.   The client would not be able to validate that proxy_X.mydomain.com is a valid holder of the edge.mydomain.com certificate.   However, if the <a title="n.wikipedia.org/wiki/Subject_Alternative_Name" href="https://en.wikipedia.org/wiki/Subject_Alternative_Name">Subject Alternative Name</a> field includes proxy_X.mydomain.com and FQDNs of the other pool members, the connection will succeed regardless of which member responds. <a title="echnet.microsoft.com/en-us/library/ff625722(v=ws.10).aspx" href="https://technet.microsoft.com/en-us/library/ff625722(v=ws.10).aspx">Here</a> is how to set the field value on Windows.</p><p></p><p>Two other properties are important if you decide to run multiple proxies: edgeencryption.customer.assigned.known.cleartext and edgeencryption.encrypter.static.iv. These properties must have the same values on all your proxies.   The first is an encrypted text which is used to determine that all the proxies are using the same keys.   The second is the salt value which is used for equality preserving and order preserving encryption types.   Note that this salt property must be exactly 16 bytes.   In Linux the following command may be used to generate this random string: tr -dc "[:graph:]" &lt; /dev/urandom | head -c 16.</p><p></p><p>• <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/edge-config.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/edge-config.html">https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/concept/edge-config.html</a></p><p></p><h3><a name="tokens"></a>Understanding encryption tokens</h3><p>The Edge Encryption proxy allows you to create tokens which replace matching text.   If you create a pattern for matching text "foo" a replacement token will be created and stored in the instance.   The token will be the same size as the text it is replacing and will substitute it whenever matched.   When you search the instance for "foo", the query sent is for the token value.   When the results are returned, the token value is replaced by "foo".   This means   that the original data never leaves your network. It is stored in the same database catalog used for order preserving encryption.</p><p></p><p><span style="color: #303030;">Tips for using encryption tokens</span></p><ul><li>You can use out of box patterns or make your own.   Basic patterns simply use a specific sequence of characters.</li><li>Advanced patterns use Java's powerful <a title="ocs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html" href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">RegEx engine</a>.</li><li>A pattern of all alpha characters is not allowed</li><li>The minimum pattern size is 5 characters but this is modifiable via the <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/reference/r_PropInstEdgeEncryp.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/administer/edge-encryption/reference/r_PropInstEdgeEncryp.html">glide.edge.pattern.min.size</a> property</li><li>The following characters are illegal in patterns: (*) and ( + )</li></ul><p></p><h3><a name="logs"></a>Edge Encryption logs are your friend</h3><p>There are four logs which the Edge Encryption Proxy generates: edgeencryption.log, jetty.log, wrapper.log and edgenetwork.log.   The edgeencryption.log is the primary application log.   It contains information regarding operations like startup and shutdown.   It also includes transaction information, errors and warnings.   The wrapper.log is the <a title="w.eclipse.org/jetty/documentation/9.0.6.v20130930/configuring-logging.html." href="http://www.eclipse.org/jetty/documentation/9.0.6.v20130930/configuring-logging.html.">default logging</a> facility when debugging parameters are set.   The Jetty log contains output from the Jetty servlet.   Jetty debugging can be enabled by editing the &lt;install dir&gt;/conf/log4j.properties.</p><p></p><p>The edgenetwork.log is available beginning on releases Helsinki Patch 10, Istanbul Patch 6 and Jakarta.   It is not enabled by default but can be turned on dynamically by adding a property to the &lt;install dir&gt;/conf/log4j.properties file.   There is no need to restart the proxy.   In a few minutes the file will appear within the logs folder.</p><p></p><p>The relevant properties are below.</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="8736.7666015625_8_265_94"><p>#log4j.logger.com.snc.edgeencryption.metrics.EdgeEncryptionTimingMetricCache=info, TimingLog</p><p>#log4j.appender.TimingLog=org.apache.log4j.RollingFileAppender log4j.appender.TimingLog.File=../logs/edgenetwork.log</p><p>#log4j.appender.TimingLog.MaxFileSize=500MB log4j.appender.TimingLog.MaxBackupIndex=4</p><p>#log4j.appender.TimingLog.layout=org.apache.log4j.PatternLayout log4j.appender.TimingLog.layout.ConversionPattern=%d#%-5p %m%n</p></pre><p>You may set the logging level to warn, info or debug.   Warn level records requests which require more than ten seconds.   This includes request processing time including rules execution, round trip to instance, and response processing.   Info level records requests which take more than five seconds.   Debug records all requests.</p><p></p><p>If you encounter an issue with your Edge Proxy it is recommended that you provide a copy of all proxy logs when you open an incident.   This will allow the Technical</p><p>Support Engineer to immediately begin diagnosing the problem.</p><p></p><h3><a name="time"></a>Timing is everything</h3><p>There are times when proxy logs are not enough.   Here is an example of a difficult issue.   When connecting through the Edge Proxy the browser recorded HTTP response code 504, Gateway Timeout.   It also recorded Cross-Origin frame errors.   Compounding the issue is the fact that we were dealing with two clients. One was the browser mentioned above.   The other was a .NET application.   The .NET application was unable to POST content via the Edge proxy.   Browsers were able to navigate the instance but received the 504 and CORS errors at seemingly random intervals.</p><p></p><p>Sample of what was seen by the customer's browser.</p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="9646.2001953125_8_265_148"><p>jquery2_includes.jsx?v=10-**-2016_1358:17 Uncaught DOMException: Blocked a frame with origin</p><p><span>"</span><a title="" _jive_internal="true" href="https://edge.mydomain.com" rel="nofollow" target="_blank">https://edge.mydomain.com</a><span>" from accessing a cross-origin frame. </span></p><p>…</p><p>js_includes_ngCommon.jsx?v=10-**-2016_1358&amp;lp=Tue_Dec_06_16_00_22_PST_2016&amp;c=13_283:11625 snPresence response time 750ms</p><p>js_includes_amb.jsx?v=10-**-2016_1358&amp;lp=Tue_Dec_06_16_00_22_PST_2016&amp;c=13_283:6POST</p><p><a title="" _jive_internal="true" href="https://edge.mydomain.com/amb/connect" rel="nofollow" target="_blank">https://edge.mydomain.com/amb/connect</a><span> 504 (Gateway Timeout)</span></p></pre><p>At first glance these would seem to be networking issues.   This is because browsers block content originating from a different domain when initiated by scripts. It is an important security measure and part of the larger HTTP access control known as <a title="eveloper.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">CORS</a>.   The HTTP response code 504 is specific to proxies. It is defined by <a title="ww.w3.org/Protocols/rfc2616/rfc2616-sec10.html" href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">W3.org</a> as: "The server, while acting as a gateway or proxy, did not receive a timely response from the upstream server specified by the URI (e.g. HTTP, FTP, LDAP) or some other auxiliary server (e.g. DNS) it needed to access in attempting to complete the request."   Taken together these seemed to point to a network issue since the customer's network environment is complex.   In this case, these errors were deceiving.</p><p></p><p>There was further confusion due to what was recorded in the proxy's wrapper.log.</p><p></p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="10293.7001953125_8_265_121"><p>INFO     | jvm 1       | 2017/01/** 13:04:47.501 | CloudEdgeProxy-175dfe4a-43, WRITE: TLSv1.2 Handshake, length = 40 INFO     |</p><p>jvm 1       | 2017/01/** 13:04:47.501 | CloudEdgeProxy-175dfe4a-38, WRITE: TLSv1.2 Application Data, length = 2888 INFO     |</p><p>jvm 1       | 2017/01/** 13:04:47.501 | HttpClient@1970620526-scheduler, called closeOutbound() INFO     | jvm 1       |</p><p>2017/01/** 13:04:47.501 | HttpClient@1970620526-scheduler, closeOutboundInternal() INFO     | jvm 1       | 2017/01/**</p><p>13:04:47.501 | HttpClient@1970620526-scheduler, SEND TLSv1.2 ALERT:   warning, description = close_notify</p></pre><p>The above pointed us to an issue with the client as it connected to the proxy.   An important clue was found in the browser log.   The HTTP 504 error indicated that the verb in use was POST.   When a .NET application carries out a POST it will default to set the Expect header to "100-Continue".   This is fine in most cases. However, because the underlying Jetty servlet did not handle Expect headers properly, the Edge Proxy could not process the POST request.   The workaround was to prevent the .NET application from setting the Expect header altogether.   After this, the application was able to POST without issue.   The Jetty issue has since been resolved and this behavior is no longer an issue.</p><p></p><p>We still had the CORS issue, however.   Client browsers still saw HTTP 504 from time to time.   The CORS issue had not disappeared and it would not be practical to configure customer browsers to not send an Expect header when communicating with ServiceNow.   During in depth discussions we considered the possibility that sessions were being timed out.   Again this was a clue we found in the browser logs.</p><p></p><pre __jive_macro_name="quote" class="jive_macro_quote jive_text_macro" data-renderedposition="11054.4501953125_8_265_41"><p>js_includes_ngCommon.jsx?v=10-**-2016_1358&amp;lp=Tue_Dec_06_16_00_22_PST_2016&amp;c=13_283:11625 snPresence response time 750ms</p><p><span>js_includes_amb.jsx?v=10-**-2016_1358&amp;lp=Tue_Dec_06_16_00_22_PST_2016&amp;c=13_283:6POST </span><a title="" _jive_internal="true" href="https://edge.mydomain.com/amb/connect" rel="nofollow" target="_blank">https://edge.mydomain.com/amb/connect</a><span> 504 (Gateway Timeout)</span></p></pre><p>The above revealed that a "presence" check with the instance was unable to complete.   The timeout for this process is 30 seconds.   However, the session timeout for the Edge proxy was set out of box to the same 30 seconds.   We had a timeout collision and there was no way to prevent it.</p><p></p><p>Some quick thinking and great work by our Edge Development Team produced a property which allows editing the session timeout.   This property is edgeencryption.proxy.idle.timeout which is available from Helsinki Patch 4 Hot Fix 4 onwards.   Once this was applied and the timeout value set to a non-multiple of 30, the customer's browser did not record any more CORS or HTTP 504 errors.</p><p></p><h3>---</h3><p></p><p></p><p>The Edge Encryption Proxy is a powerful tool to secure your data.   It is important to understand the networking environment it will reside in.   As a security tool, it does not perform traditional proxy duties like caching or content filtering.   Instead it is an SSL forward proxyThis means it cannot simply be a drop in replacement for some other proxy type.   Please take time to consider the factors discussed above to ensure the smoothest possible deployment of your Edge Encryption Proxy.</p>