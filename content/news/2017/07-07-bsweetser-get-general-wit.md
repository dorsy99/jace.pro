---
title: "Get General with Your Requests"
date: 2017-07-06T08:43:42.000Z
authors: ["bsweetser"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=897dee29dbd0dbc01dcaf3231f96191f"
---
<p><img   alt="darkandstormy_5013.jpg" class="image-1 jive-image" src="96cd8d82db9c97041dcaf3231f9619ea.iix" style="height: auto; display: block; margin-left: auto; margin-right: auto;"/></p><p>It was a dark and stormy night. In the IT department, requests rained down in great torrents - except at occasional intervals, where end users were temporarily content with the assets assigned to them...</p><p></p><p>How do you handle requests for items such as end user computers? Do you provide a standard catalog of specific items from which the users can select? Or do you just have a generic catalog item for the request and then allow IT or someone else doing the fulfillment select the type of device?</p><p></p><p>The lifecycle of an asset begins with the request of an item. To facilitate the service catalog's connection to Asset Management, Catalog Items can be created directly from Model records in ServiceNow. This has several benefits:</p><ul><li>Determine if you have an item in stock to fulfill the request instead of purchasing new</li><li>Create the Asset record when it is procured to effect updates to the asset details automatically as part of the receiving and deployment of the item</li><li>Manage details about a model of device in a single location instead of in separate Model and Catalog Item records</li></ul><p></p><p>But there is a problem (cue thunder and lightning)...</p><p></p><p><img   alt="lightning_wmbinder.jpg" class="image-2 jive-image" src="7bceeccadb98d704ed6af3231f961948.iix" style="width: 620px; height: 413px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>Many companies do not want to give their users a choice of specific device. They want to just give the users more generic options and then fulfill the request with what makes the most sense at the time.</p><p></p><p>For example, the company standard might be the HP EliteBook 1030 today, but the transition to the newer HP EliteBook 1040 may be in progress. Rather than having users select one model or the other, these companies would rather just have their users select <strong>Company Standard Laptop</strong>. Then the users either get one of the 1030s in stock or get lucky and receive a 1040.</p><p>In the past, I've recommended the use of bundles to achieve this result. You can create a Bundle Model called Company Standard Laptop (or whatever naming is appropriate to the situation), then make the main component of the bundle the device you want to provide at the time. This does achieve the goal of obscuring the actual item from the user. Unfortunately, this approach has a few limitations:</p><ul><li>The main component is fixed   and needs to be updated in the Bundle Model to change it - it cannot be changed when the request is fulfilled</li><li>Bundle Models are not Hardware Models by default, so you need to change the Class to be able to publish the Bundle to the Service Catalog for end users to request</li><li>Bundle Models are not maintained in stock as bundles - to source them, you need to break out the main component (it is beyond the scope of this particular post to get into how to handle a bundle that has multiple items)</li></ul><p></p><p>There must be a better way!</p><p>And there is!</p><p></p><p>Below is an approach that provides the desired result without the negative side effects. This only covers the bare essentials for what you need to do to make this work. You can fill in the rest with other details. At minimum, you need:</p><ul><li>The generic Catalog Item</li><li>A Variable on the Catalog Item</li><li>A Catalog UI Policy to only display the Variable on a task created as part of the fulfillment of the item, NOT on the initial request form</li><li>A Workflow to attach to the generic Catalog Item that creates the task to select the item to use for fulfillment of the request and then runs a script to create the new Requested Item against the Request</li><li>Catalog Items for any Models of device that should be available for selection as part of this process</li></ul><p></p><p>The first thing you need is a generic Catalog Item. Navigate to <strong>Service Catalog &gt; Catalog Definitions &gt; Maintain Items</strong>. Click <strong>New</strong>. <strong>Name</strong> the Item, select the <strong>Catalog</strong> and <strong>Category</strong>, and <strong>Save</strong>.</p><p></p><p>Next you need a Variable. This can be part of a Variable Set if you plan to use it in multiple Catalog Items. In fact, I recommend this. The key to the Variable is that it should be a Reference field that points to <strong>Catalog Item [sc_cat_item]</strong>. This makes later scripts easier and only displays items that have explicitly been published to the catalog. You can apply whatever other filters you deem appropriate for this. For example, maybe only display Certified Models.</p><p></p><p><img   class="image-3 jive-image" src="e55bc8c2db1c1344e9737a9e0f961993.iix" style="width: 620px; height: 235px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>The Catalog UI Policy is part of the magic here. This allows you to hide the Variable to the end user making the request, but display it in a later task so the Workflow can take action on it. Create a new <strong>Catalog UI Policy</strong>. Name the new policy something meaningful, like <strong>Hide Catalog Item selection in Catalog</strong> and <strong>Save</strong> it. Under Related Links, click <strong>Advanced view</strong>. This gives you the option under <strong>When to Apply</strong> to only apply the UI action on a Catalog Item view. Do not set any other conditions. Add the variable and set the Visible flag to False.</p><p></p><p><img   class="jive-image image-4" src="1a98ab39db581704ed6af3231f9619e3.iix" style="width: 620px; height: 415px; display: block; margin-left: auto; margin-right: auto;"/></p><p></p><p>The Workflow takes this information and uses it. Your workflow can contain whatever approvals or other steps you require for your process, but at some point it needs two activities:</p><ol><li>The task that allows the Model of device to be selected</li><li>The script that adds a Requested Item for the Model to the request, thus allowing it to be sourced and handled as if it were directly selected by the end user</li></ol><p>The Task should be a Catalog Task (use the <strong>Catalog Task</strong> activity, not the Create Task activity). Identify the Fulfillment group to do the work and a short description with instructions/details on how to make the appropriate selection. The key in this Task, though, is to be sure to select your variable under the <strong>Add Variables</strong> section of the Task.</p><p></p><p>The script to include in a Run Script activity leverages an undocumented Service Catalog API described in several places around the Community (EDIT 29 Sept 2017: Documentation on the API is now available, albeit limited): <a href="https://developer.servicenow.com/app.do#!/api_doc?v=jakarta&amp;id=GlideappCalcHelperAPI" title="https://developer.servicenow.com/app.do#!/api_doc?v=jakarta&amp;id=GlideappCalcHelperAPI">https://developer.servicenow.com/app.do#!/api_doc?v=jakarta&amp;id=GlideappCalcHelperAPI</a> ). Here is the script to include:</p><pre __default_attr="java" __jive_macro_name="code" class="_jivemacro_uid_14993120094043847 jive_macro_code jive_text_macro" data-renderedposition="2765.546875_8_1192_1136" jivemacro_uid="_14993120094043847"><p>// Script to create new RITM attached to the same REQ to source a Server of the selected Model</p><p>// get the sys_id of the Catalog Item from which to create the RITM</p><p></p><p>var ritmTemplateID = current.variables.server_cat_item;</p><p></p><p>// undocumented feature - no API definition unfortunately</p><p>// appears to do the following:</p><p>// - Create new RITM based on template</p><p>// - Copy all variables from the template to the new RITM</p><p>// - Associate the new RITM to the current RITM</p><p>var requestHelper = new GlideappCalculationHelper();</p><p></p><p>//1)pass in the Request sys_id, 2)Catalog Item sys_id, 3)1 is equal to the quantity times to order this catalog item</p><p>requestHelper.addItemToExistingRequest(current.request + '', ritmTemplateID + '', 1); </p><p></p><p>// This resets the REQ to redo any sourcing steps that need to be performed</p><p>requestHelper.rebalanceRequest(current.request + '');</p><p></p><p>// Find the new RITM (it should be the most recent)</p><p>var reqItem = new GlideRecord('sc_req_item');</p><p>reqItem.addQuery('request', current.request + '');</p><p>reqItem.addQuery('cat_item', ritmTemplateID + '');</p><p>reqItem.orderByDesc('number');</p><p>reqItem.setLimit(1);</p><p>reqItem.query();</p><p></p><p>if (reqItem.next()) {</p><p>   // Since the variables are being created by the undocumented API used above</p><p>   // need to get the original RITM variable values and populate those values</p><p>   // in the RITM being created.</p><p>   copyVariables(reqItem.sys_id, current.sys_id);</p><p>}</p><p></p><p>// Copies the variables from original RITM to new RITM</p><p>function copyVariables(newRITM, orginalRITM) {</p><p>   var newRequestedItem = newRITM;</p><p>   var vars = [];</p><p>   var itemVars = new GlideRecord('sc_item_option_mtom');</p><p>   itemVars.addQuery('request_item', orginalRITM);</p><p>   itemVars.query();</p><p>   while (itemVars.next()) {</p><p>   vars.push(itemVars.sc_item_option.toString());</p><p>   }</p><p>   for (i = 0; i &lt; vars.length; i++) {</p><p>   var myOption = new GlideRecord('sc_item_option');</p><p>   myOption.addQuery('sys_id', vars[i]);</p><p>   myOption.query();</p><p>   while (myOption.next()) {</p><p>   //Catalog Item variable value will contain string/seconds/sys_ids/etc.</p><p>     //Question                               //Value                 //Order                 //new RITM</p><p>   createItemOptions(myOption.item_option_new, myOption.value, myOption.order, newRequestedItem);</p><p>   }</p><p>   }</p><p>}</p><p></p><p>// Copies the values in the variables from original RITM to new RITM</p><p>function createItemOptions(item_option_new, value, Order, newRITM) {</p><p>   var gr_answers = new GlideRecord('sc_item_option');</p><p>   gr_answers.initialize();</p><p>   gr_answers.item_option_new = item_option_new; // Map the answer to its question</p><p>   gr_answers.value = value;</p><p>   gr_answers.order = Order;</p><p>   gr_answers.insert(); // Insert the record</p><p></p><p>   // Now build the relationship between the answer and the request item</p><p>   var gr_m2m = new GlideRecord('sc_item_option_mtom');</p><p>   gr_m2m.initialize();</p><p>   gr_m2m.sc_item_option = gr_answers.sys_id;</p><p>   gr_m2m.request_item = newRITM;</p><p>   gr_m2m.insert(); // Create the new relationship</p><p>}</p></pre><p></p><p>The final step is to be sure you have Catalog Items to select as part of this process. Because the purpose of this entire exercise is to not allow end users to select these items, when you publish hardware items to the catalog, be sure to configure them to not display to the end users, either by publishing to an IT only catalog or the use of <a title="ocs.servicenow.com/bundle/jakarta-it-service-management/page/product/service-catalog-management/concept/c_ServiceCatalogAccessControls.html" href="https://docs.servicenow.com/bundle/jakarta-it-service-management/page/product/service-catalog-management/concept/c_ServiceCatalogAccessControls.html">User Criteria</a>.</p><p></p><p>Now the user places the request for the item, and in the process, the appropriate group selects the type of device provided to fulfill the request.</p><p></p><p>With this in place, you can avoid torrential generic requests that are difficult to manage and set the stage for sunny days, happy end users, and even happier IT staff.</p>