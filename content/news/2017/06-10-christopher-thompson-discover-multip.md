---
title: "Discover multiple CIs with the same serial number  Part II"
date: 2017-06-10T01:13:29.000Z
authors: ["christopher.thompson"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=a71da2e5dbd0dbc01dcaf3231f961963"
---
<p><span style="text-align: center;"><em>This is in regards to the new CMDB identifiers introduced along with Service Mapping starting in the Geneva release. For information on how to handle this scenario using the old CI identifiers, please reference the first part of this series: <a href="community?id&#61;community_blog&amp;sys_id&#61;c75de629dbd0dbc01dcaf3231f9619c9" target="_blank" rel="nofollow">Discover multiple CIs with the same serial number - Part I</a></em></span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Starting with the Geneva release of the ServiceNow platform, and the introduction of the new <span style="color: #505050;"><a title="ocs.servicenow.com/bundle/istanbul-it-operations-management/page/product/service-mapping/reference/c_ServiceMappingOverview.html" href="https://docs.servicenow.com/bundle/istanbul-it-operations-management/page/product/service-mapping/reference/c_ServiceMappingOverview.html" rel="nofollow">Service Mapping</a></span> application, we have initiated a new Identification Engine and process for CIs known as the <span style="color: #505050;"><a title="ocs.servicenow.com/bundle/istanbul-it-operations-management/page/product/discovery/reference/r_DiscoveryIdentifierConfiguration.html" href="https://docs.servicenow.com/bundle/istanbul-it-operations-management/page/product/discovery/reference/r_DiscoveryIdentifierConfiguration.html" rel="nofollow">CMDB Identifiers</a></span>. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">You can use these new identifiers if you have this <em>glide.discovery.use_cmdb_identifiers</em> property set as &#39;True&#39; on your instances (which is the case for new instances starting in Geneva), or if you have the Service Mapping application enabled on your instance (regardless of this property setting).</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">If you have read through part 1, with regard to handling a situation of <a title="" href="community/operations-management/blog/2015/04/29/how-to-discover-multiple-ci-s-with-the-same-serial-number" rel="nofollow">two valid CIs with the same serial number</a>, this was using the old CI identifiers. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">However, with the introduction of these new identifiers, there are still issues with how this situation is handled.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">As a reference, let&#39;s refer back starting with this scenario of the 2 AIX LPARs below.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<ol><li><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Name: Server 1<br /></span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">IP: 10.10.10.1<br /></span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Serial Number: abc123<br /><br /></span></li><li><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Name: Server 2<br /></span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">IP: 10.10.10.2<br /></span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Serial Number: abc123</span></li></ol>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">For the new CMDB identifiers, we still rely heavily on trying to make a match to existing CIs based on Serial Number(s). </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">The main Identifier Rule that will be used in most cases will be this Hardware Rule record.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: center;"><img class="image-5 jive-image" style="width: 620px; height: 303px;" src="0b7c404edb509fc068c1fb651f961931.iix" alt="cmdb_ci_hardware.jpg" /></p>
<p style="margin-bottom: .0001pt; background: white;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">In this Hardware Rule record, if you look at the first two out-of-box identifier entries highlighted above, you will see that we are trying to make a match first with trying in the <em>cmdb_serial_number</em> table. If we don&#39;t match there, we try to match with the serial number on the CI records themselves. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">This is very similar to how the previous &#34;Serial Number Table &amp; Class Name&#34; and &#34;Serial Number and Class Name&#34; identifiers worked, only this time we don&#39;t specify classes as we are querying within the very general <em>cmdb_ci_hardware</em> table.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Now, while this part of checking these CIs is somewhat similar, so is the situation we would run into when scanning the two AIX servers as mentioned above.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">If we scan Server 1 first, we will create a new AIX server record with its values. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">However, if we scan Server 2 next, what will happen is that we will match to the Server 1 CI (based on matching by serial number) and it will just update the CI record it matched against with the new Name and IP values we just discovered. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Thus, we will no longer have the reference to the Server 1 device information.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">In <a title="" href="community/operations-management/blog/2015/04/29/how-to-discover-multiple-ci-s-with-the-same-serial-number" rel="nofollow">part 1</a>, I provided some possible &#34;workarounds&#34; that could be implemented to handle this situation and some of those philosophies can be applied here. H</span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">owever, Creating the CI manually will not work with these new Identifiers because of this <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/product/configuration-management/task/t_ResolveDeDuplicationTask.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/product/configuration-management/task/t_ResolveDeDuplicationTask.html" rel="nofollow">de-duplicating tasks</a> feature that is part of this new CMDB Identification and Reconciliation meant to handle duplicate CIs. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">While this is meant to help in situations when duplicate CIs are existing in your CMDB, in this situation of having two separate CIs with the same serial number that are not actually duplicates, this &#34;de-duplication&#34; process may accidentally identify these as duplicates, which can cause issues.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">So, in this article, I am going to approach these following suggestions a little differently by presenting possible suggestions on how to handle certain situations of multiple CIs with the same serial number, based on how many different types of CIs you have that are affected.</span></p>
<p>The difficulty with this is that there are no two customer CI environments that are the same, so the suggestions that I make below may not exactly work for you. For example, I&#39;m going to be using some other fields as a unique identifier (Name, IP address, etc.), but in your environment these may not be unique as well. Even though some of these suggestions may not exactly work for you, hopefully this will at least give you a direction. This should help figure out where and how you can make some modifications. Once you are able to identify some unique combination of data, you will know how to implement them in your instances.</p>
<p style="margin-bottom: .0001pt; background: white;"><span style="color: #303030; font-size: 16pt; font-family: Arial;"><strong>Scenario 1: Multiple CIs of the same class, one class only</strong></span></p>
<p style="margin-bottom: .0001pt; background: white;"><span style="font-family: Arial; color: #505050; font-size: 10pt;">Continuing to reference the AIX example, suppose this is the only class of CI that affected. </span><span style="font-family: Arial; color: #505050; font-size: 10pt;">If that is the case, the easiest way to handle this scenario is to <a title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/product/configuration-management/task/t_CreateCIIdentificationRule.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/product/configuration-management/task/t_CreateCIIdentificationRule.html" rel="nofollow">create a new Identifier Rule</a> specifically for this class.</span></p>
<p style="margin-bottom: .0001pt; background: white;"> </p>
<p style="margin-bottom: .0001pt; background: white;"><span style="color: #505050; font-family: Arial; font-size: 10pt;">See the example below of an &#34;AIX Rule&#34; that could be used to handle this situation.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: center;"><img class="image-6 jive-image" style="width: 620px; height: 241px;" src="22782fb1dbd41fc068c1fb651f961913.iix" alt="aix server.jpg" /></p>
<p><span style="color: #505050; font-family: Arial; font-size: 13.3333px;">As noted in this <a style="font-family: Arial; font-size: 13.3333px;" title="ocs.servicenow.com/bundle/istanbul-servicenow-platform/page/product/configuration-management/task/t_CreateCIIdentificationRule.html" href="https://docs.servicenow.com/bundle/istanbul-servicenow-platform/page/product/configuration-management/task/t_CreateCIIdentificationRule.html" rel="nofollow">create a new Identifier Rule</a> article, there are several elements that make up how you define this Identifier, and there are a few in particular for this scenario that I have numbered in the image above that need to be set as described below.</span></p>
<p> </p>
<ol><li><span style="color: #505050; font-size: 10pt; font-family: Arial;">This rule should be marked as <strong>independent &#61; true</strong>, meaning that we won&#39;t fall back to try to use identifier rules of parent classes (ex. cmdb_ci_hardware) of the CI if we don&#39;t make a match here.</span></li><li><span style="color: #505050; font-size: 10pt; font-family: Arial;">For this first entry, I have set the criterion attributes as Name <em>and</em> Serial Number in order to be able to still use the Serial Number as some part of the criterion. </span><span style="font-family: Arial; color: #505050; font-size: 10pt;">This is mostly going to assume that the Name and Serial Number values on these devices will not be changing, as changing either of these values on this CI will result in this particular entry not making a match. </span><span style="font-family: Arial; color: #505050; font-size: 10pt;">Plus, this may be more preferable than just <em>Name</em> here in case you run into a scenario where you have multiple CIs with the same name (and different serial numbers).</span></li><li><span style="color: #505050; font-size: 10pt; font-family: Arial;">For this second entry, this is just another fallback in case the first entry doesn&#39;t make a match we are expecting for any reason. </span><span style="color: #505050; font-size: 10pt; font-family: Arial;">This is checking against the IP address and MAC address of the Network Adapter(s) associated to this CI. </span><span style="font-family: Arial; color: #505050; font-size: 10pt;">For example, if there is a scenario where a CI is being &#34;repurposed&#34; in that the Name and Serial Number on the CI are changed but the adapter information is the same, perhaps you still want this to be classified as the same CI. </span><span style="font-family: Arial; color: #505050; font-size: 10pt;">In this case, you would want this secondary identifier to make the match here.</span></li></ol>
<p style="padding-left: 45px; margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p><span style="font-family: Arial; color: #505050; font-size: 10pt;">Again, these entries and criteria are just a template and it would ultimately be up to you to decide what criteria to match against that works best for your environment.</span></p>
<p><span style="font-family: Arial; color: #505050; font-size: 10pt;">But overall, having this separate identifier in place to handle a specific Class where this duplicate Serial Number issue is occurring would be the best way to handle this.</span></p>
<p style="margin-bottom: .0001pt; background: white;"> </p>
<p style="margin-bottom: .0001pt; background: white;"><span style="color: #303030; font-size: 16pt; font-family: Arial;"><strong>Scenario 2: Multiple CIs of the same class, multiple classes</strong></span></p>
<p style="margin-bottom: .0001pt; background: white;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">This is the most common situation, where there are multiple classes in which this issue occurs (AIX, Windows, F5 Load Balancer Applications, etc.). </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">In this scenario, there are two main ways to handle this:</span></p>
<ol><li><span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 10pt;">The first method would be to extend what was described in Scenario 1 to create separate identifier rules for all the different classes that are being affected. While this may be the most ideal solution, depending on how many classes are involved and determining what criteria for each class would be necessary to implement, this may be a little cumbersome.</span></li><li><span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 10pt;">You can also modify the default Hardware Rule identifier to make this work for all these classes.</span></li></ol>
<p> </p>
<p><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">In this method, you have to tread a little more carefully because modifying this Hardware Rule will affect all your CI classes that don&#39;t have separate rules created for them - even ones that may not be having this issue. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Using some of the same philosophy in the first scenario, the modifications you may need to make may be as simple as doing this below.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: center;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;"><img class="image-7 jive-image" style="width: 620px; height: 302px;" src="43bcc98edbd497049c9ffb651f961967.iix" alt="sieral number identifier.jpg" /><br /></span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Here I have deactivated the two default Serial Number entries that would cause an issue and added a <em>name and serial_number</em> entry instead that would be the first one to be checked. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Again, this scenario assumes that the &#34;name&#34; is unique and unchanging.</span></p>
<p>As you can see in this screenshot, I have left the &#34;name&#34; only entry still as active here, but if you are in a setup where the name may consistently be changing or not unique, you may want to deactivate this &#34;300&#34; entry as well.</p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">I then still have the <em>ip_address and mac_address</em> Network Adapter entry as a fallback for this as well. </span><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">Once again, this is just a template, so please modify and customize these entries to fit your environment as needed for this scenario also.</span></p>
<p style="margin-bottom: .0001pt; background: white;"> </p>
<p style="margin-bottom: .0001pt; background: white;"><span style="color: #303030; font-size: 16pt; font-family: Arial;"><strong>Scenario 3: Multiple CIs of different classes, multiple classes</strong></span></p>
<p style="margin-bottom: .0001pt; background: white;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">In this rare (but seen) case of having multiple CIs with the same serial number but of different class types, this scenario gets tricky because now you are dealing with almost both the scenarios mentioned above combined.</span></p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"> </p>
<p style="margin-bottom: 0.0001pt; background: white; text-align: left;"><span style="font-family: arial, helvetica, sans-serif; color: #505050; font-size: 10pt;">For example, if you have 2 AIX servers and 1 Linux server all reporting the same serial number, you may think that only creating the rule for the AIX server like in scenario 1 would suffice.</span></p>
<p style="text-align: left;"><span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 10pt;">But, the problem will be that when scanning the Linux server, since this would fall back to use the default Hardware Rule identifier, we will see that there are matches in the <em>cmdb_ci_hardware</em> table with the same serial number (even though they are a different class) and we will end up either overwriting one of these records or throwing an error that duplicates exist (depending on the setting of your <span style="background: white;"><em>glide.identification_engine.skip_duplicates</em> property).</span></span></p>
<p style="text-align: left;"> </p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; background: white; color: #505050;">One potential fix for this would be that back in the Hardware Rule Identifier, for the existing serial number entries, you could add in an Optional Condition to add in a filter, like to check where &#34;sys_class_name !&#61; cmdb_ci_aix_server&#34; that would look like below:</span></p>
<p style="text-align: center;"><img class="image-8 jive-image" style="width: 620px; height: 87px;" src="48cc688edb5857049c9ffb651f9619ab.iix" alt="multiple serial numbers.jpg" /></p>
<p style="text-align: left;"> </p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; background: white; color: #505050;">The only problem with this (and why I am bringing this up) is that this Optional Condition only works if the <strong>Search on table</strong> value in the Entry is different than the <strong>Applies to </strong>value on the Rule itself.</span></p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; background: white; color: #505050;">For example, for the <strong>Search on table</strong> value of <em>Serial Number [cmdb_serial_number]</em>, you can apply an Optional Condition like this mentioned (and you can see by default this entry has some Optional Conditions on it), but for the <em>Hardware [cmdb_ci_hardware]</em> entries, an Optional Condition will not work here.</span></p>
<p style="text-align: left;"> </p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">This is a strange limitation, but one to be very aware of if you think you can try to set up your entries using these Optional Conditions.</span></p>
<p style="text-align: left;"> </p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">So, in this case, you likely should follow either of the suggestions mentioned from scenario 2 above to create the separate identifiers for both tables that would be affected, or modify the Hardware Rule identifier appropriately.</span></p>
<p> </p>
<p><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">A few final notes I would like to add:</span></p>
<p> </p>
<ul><li><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">Please be aware that for the <em>Criterion Attributes</em> in these Identifier entries, this has to be able to reference data that is found up through the Classify and Identity probes via Discovery. </span><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">So, data like Name, Serial Number, and IP Address are available from these initial probes. </span><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">However, other data like Model or Manufacturer or other OS details may not be available by the time you are running this Identification process for certain CI classes. </span><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">Therefore, it would be recommended to stick with using the default fields if possible that are used in the out-of-box identifiers if you need to make custom identifiers accordingly.</span></li><li><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">Another note about the <span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 13.3333px;"><em>Criterion Attributes</em></span> is that the values you select here does not support dot-walking. For example, if you have an entry with the <span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 13.3333px;"><strong>Search on table</strong></span><span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 13.3333px;"> value of </span><span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 13.3333px;"><em>Serial Number</em></span>, and in the <span style="color: #505050; font-family: arial, helvetica, sans-serif; font-size: 13.3333px;"><em>Criterion Attributes</em></span> you try to select something like &#34;Configuration Item.Serial number&#34;, you will not be able to save this value, and you will get an error message that pops up saying &#34;<span style="color: #024fa1; font-family: SourceSansPro, &#39;Helvetica Neue&#39;, Arial; font-size: 13px; font-weight: bold; background-color: #e4f1fe;">Reference or invalid attributes have been skipped!</span><span style="background-color: #e4f1fe; color: #505050; font-size: 13.3333px; font-family: arial, helvetica, sans-serif;">&#34;.</span></span></li><li><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">You should also be aware of where and how you are entering your CI data and how these different data sources may be utilizing these identifiers as well. </span><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">For example, while Discovery and Service Mapping are the most common ways of retrieving CI data that will use these identifiers, there are also several other sources like SCCM, Import Sets, and even manual creation that could have an effect on what and where data is existing for these records. </span><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">For reference, manually creating a CI record will likely not create records in the <em>cmdb_serial_number</em> table for this CI, so if you then scan this device via Discovery, we likely will not make a match using this Serial Number Table and instead will try using the Serial Number entry associated to the CI record itself.</span></li></ul>
<p style="text-align: left;"> </p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">Overall, I hope this information is helpful to help at least guide you to where and how you can handle some of the duplicate Serial Number issues with these new CMDB identifiers.</span></p>
<p style="text-align: left;"><span style="font-size: 10pt; font-family: arial, helvetica, sans-serif; color: #505050; background: white;">If you have any comments on some better ways to handle these scenarios or some better Identifier Rules and Entries that have worked for you, please share them. The more potential suggestions and answers we have, the better!</span></p>