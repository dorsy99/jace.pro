---
title: "Copying a Variable Set with variables client scripts and UI Policies"
date: 2012-02-05T12:25:32.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=012d26e5dbd0dbc01dcaf3231f96198d"
---
<p>I recently had a situation where I was copying lots of variable sets, and the "Insert and Stay" UI Action was getting used all too frequently. So I decided to create a "Copy" UI Action to make a copy of the variable set. Of course after I completed the script I discovered <a title="w.servicenowguru.com/scripting/copying-variable-set/" href="http://www.servicenowguru.com/scripting/copying-variable-set/">http://www.servicenowguru.com/scripting/copying-variable-set</a> which did <i>almost</i> everything I wanted to do. Of course that would have saved me some time, but... oh well. The difference between mine and the servicenowguru site is that mine includes the ability to copy over all UI Policies and their actions. If this version can help others, here it is.<br /><!--break--><br /><br /><b>Overview:</b><br />This "Copy" UI Action will <br /><ul><li>Make a copy of the variable set record</li><li>Copy the variables<br /><ul><li>Copy any variable questions to the new variable</li></ul><br /></li><li>Copy all client scripts</li><li>Copy all UI Policies<br /><ul><li>Copy all UI Policy Actions and associated the variables to their newly created variables (which was the tricky part in all of this).</li></ul><br /></li></ul><br /><br /><b>Implementation:</b><br />Create a new UI Policy<br />Set the table to be "Variable Set (item_option_new_set)"<br />Give it a condition. I gave it gs.hasRole('admin') <br />Check the "Form Button" box. Or however you want the UI Action to work.<br />Add this code:<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />//set some new default values<br />var name = current.name;<br />current.name = 'Copy of ' + name;<br /><br />//insert a copy of the variable set<br />var oldid = current.sys_id.toString();<br />var newid = current.insert();<br /><br />if (newid) {<br />var allVars = {};<br />createVariables(oldid,newid);<br />createCatalogClientScript(oldid,newid);<br />createCatalogUiPolicy(oldid,newid);<br />}<br /><br />//creates a copy of the variables and associates them to the new variable set<br />function createVariables(oldid,newid){<br />var vars = new GlideRecord('item_option_new');<br />vars.addQuery('variable_set', oldid);<br />vars.query();<br />while(vars.next()){<br />var varoldid = vars.sys_id.toString();<br />vars.variable_set = newid;<br />var varnewid = vars.insert();<br />allVars['IO:' + varoldid] = 'IO:' + varnewid.toString();<br /><br />var qc = new GlideRecord('question_choice');<br />qc.addQuery('question', varoldid);<br />qc.query();<br />while(qc.next()){<br />qc.question = varnewid;<br />qc.insert();<br />}<br />}<br />}<br /><br />//creates a copy of the client scripts and associates to the variable set.<br />function createCatalogClientScript(oldid,newid){<br />var ccs = new GlideRecord('catalog_script_client');<br />ccs.addQuery('variable_set',oldid);<br />ccs.query();<br />while (ccs.next()) {<br />ccs.variable_set = newid;<br />ccs.insert();<br />}<br />}<br /><br />//creates a copy of the UI Policies and associates them to the new variable set<br />function createCatalogUiPolicy(oldid,newid){<br />var cup = new GlideRecord('catalog_ui_policy');<br />cup.addQuery('variable_set',oldid);<br />cup.query();<br />while (cup.next()) {<br />var uipoldid = cup.sys_id.toString();<br />cup.variable_set = newid;<br />var newuip = cup.insert();<br /><br />var cupa = new GlideRecord('catalog_ui_policy_action');<br />cupa.addQuery('ui_policy', uipoldid);<br />cupa.query();<br />while(cupa.next()){<br />cupa.ui_policy = newuip;<br />cupa.variable_set = newid;<br />var cv = cupa.catalog_variable;<br />cupa.catalog_variable = allVars[cv];<br />cupa.insert();<br />}<br />}<br />}<br /><br />//Return the user to the new variable set record<br />action.setRedirectURL(current);<br /></pre><br /><br />Enjoy.<br /><br /><br />&lt;script&gt;&lt;/script&gt;var _gaq = _gaq || [];<br /> _gaq.push(['_setAccount', 'UA-22945975-1']);<br /> _gaq.push(['_trackPageview']);<br /><br /> (function() {<br /> var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;<br /> ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';<br /> var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);<br /> })();<br /></p>