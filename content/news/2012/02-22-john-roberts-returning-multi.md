---
title: "Returning multiple values with GlideAjax"
date: 2012-02-22T04:08:06.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=161d62e5dbd0dbc01dcaf3231f961933"
---
<p>I've heard a number of questions on how to use <a title="ki.service-now.com/index.php?title=GlideAjax" href="http://wiki.service-now.com/index.php?title=GlideAjax">GlideAJAX</a> to return multiple values. It wasn't clear in the wiki (until now) how to do this so most people were sending a string array of values to be parsed on the client. This works but there's much more you can do since the response is an XML document. <br /><!--break--><br /><br />Let's start with the requirement.<br />I want an AJAX service to get a favorite value for a particular item.<br />I also want the ability to return all favorite values if I don't provide an item.<br /><br /><br />First we need an AJAX Processor. These are specified in script include records. The script include must have "client callable" field enabled and the script class must extend AbstractAjaxProcessor.<br /><br /><br /><b>AJAX Processor Script Include</b><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />/*<br /> * MyFavoritesAjax script include Description - sample AJAX processor returning multiple value pairs<br /> */<br />var MyFavoritesAjax = Class.create();<br /><br />MyFavoritesAjax.prototype = Object.extendsObject(AbstractAjaxProcessor, {<br /><br />/*<br /> * method available to client scripts call using:<br /> * var gajax = new GlideAjax("MyFavoritesAjax");<br /> * gajax.addParam("sysparm_name", "getFavorites");<br /> */<br />ajaxFunction_getFavorites : function() {<br />// build new response xml element for result<br />var result = this.newItem("result");<br /><br />// get parameter from client request, force to string so switch is happy<br />var item = this.getParameter("sysparm_item") + "";<br /><br />// add requested item to response for debugging<br />result.setAttribute("requested_item", item);<br /><br />// get item favorite or return all<br />switch (item) {<br />case "color":<br />this._addFavorite("color", "blue");<br />break;<br />case "beer":<br />this._addFavorite("beer", "lager");<br />break;<br />case "pet":<br />this._addFavorite("pet", "dog");<br />break;<br />default:<br />// add message to return<br />result.setAttribute("message", "no item or invalid item specified, returning all available items");<br /><br />// no item specified, return all favorites<br />this._addFavorite("color", "blue");<br />this._addFavorite("beer", "lager");<br />this._addFavorite("pet", "dog");<br />}<br /><br />// elements are returned to the client through the inherited methods of AbstractAjaxProcessor<br />},<br /><br />_addFavorite : function(name, value) {<br />//create new favorite node with attributes<br />var favs = this.newItem("favorite");<br />favs.setAttribute("name", name);<br />favs.setAttribute("value", value);<br />},<br /><br />type : "MyFavoritesAjax"<br />});</pre><br /><br /><br /><br />Now we need a client side script to build and submit the AJAX request, plus a callback function to process the results from the server. In this example lets assume we only want the favorite value for "beer". We'll specify this in the "sysparm_item" parameter of the request.<br /><br /><b>Client Script with Specified Favorite Item Parameter</b><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />// new GlideAjax object referencing name of AJAX script include<br />var gajax = new GlideAjax("MyFavoritesAjax");<br />// add name parameter to define which function we want to call<br />// method name in script include will be ajaxFunction_getFavorites<br />gajax.addParam("sysparm_name", "getFavorites");<br /><br />// add optional item to get favorite<br />gajax.addParam("sysparm_item", "beer");<br /><br />// submit request to server, call ajaxResponse function with server response<br />gajax.getXML(ajaxResponse);<br /><br />function ajaxResponse(serverResponse) {<br />// get result element and attributes<br />var result = serverResponse.responseXML.getElementsByTagName("result");<br />var message = result[0].getAttribute("message");<br />var reqItem = result[0].getAttribute("requested_item");<br /><br />// check for message attribute and alert user<br />if (message)<br />alert(message);<br /><br />// build output to display on client for testing<br />var output = "";<br /><br />// get favorite elements<br />var favorites = serverResponse.responseXML.getElementsByTagName("favorite");<br />for ( var i = 0; i &lt; favorites.length; i++) {<br />var name = favorites&lt;i&gt;.getAttribute("name");<br />var value = favorites&lt;i&gt;.getAttribute("value");<br />output += name + " = " + value + "\n";<br />}<br />alert(output);<br />}</pre><br /><br /><br /><b>XML Response</b><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />&lt;xml sysparm_max="15" sysparm_name="getFavorites" sysparm_processor="MyFavoritesAjax"&gt;<br />   &lt;result requested_item="beer"&gt;&lt;/result&gt;<br />   &lt;favorite name="beer" value="lager"&gt;&lt;/favorite&gt;<br />&lt;/xml&gt;</pre><br /><br /><br /><br />This time we don't have a specific favorite item so we'll get multiple favorite nodes.<br /><br /><br /><b>Client Script Without Specific Item, Returns All Favorites</b><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />// new GlideAjax object referencing name of AJAX script include<br />var gajax = new GlideAjax("MyFavoritesAjax");<br />// add name parameter to define which function we want to call<br />// method name in script include will be ajaxFunction_getFavorites<br />gajax.addParam("sysparm_name", "getFavorites");<br /><br />// submit request to server, call ajaxResponse function with server response<br />gajax.getXML(ajaxResponse);<br /><br />function ajaxResponse(serverResponse) {<br />// get result element and attributes<br />var result = serverResponse.responseXML.getElementsByTagName("result");<br />var message = result[0].getAttribute("message");<br />var reqItem = result[0].getAttribute("requested_item");<br /><br />// check for message attribute and alert user<br />if (message)<br />alert(message);<br /><br />// build output to display on client for testing<br />var output = "";<br /><br />// get favorite elements<br />var favorites = serverResponse.responseXML.getElementsByTagName("favorite");<br />for ( var i = 0; i &lt; favorites.length; i++) {<br />var name = favorites&lt;i&gt;.getAttribute("name");<br />var value = favorites&lt;i&gt;.getAttribute("value");<br />output += name + " = " + value + "\n";<br />}<br />alert(output);<br />}</pre><br /><br /><br /><br /><b>XML Response</b><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />&lt;xml sysparm_max="15" sysparm_name="getFavorites" sysparm_processor="MyFavoritesAjax"&gt;<br />   &lt;result message="no item or invalid item specified, returning all available items" requested_item="null"&gt;&lt;/result&gt;<br />   &lt;favorite name="color" value="blue"&gt;&lt;/favorite&gt;<br />   &lt;favorite name="beer" value="lager"&gt;&lt;/favorite&gt;<br />   &lt;favorite name="pet" value="dog"&gt;&lt;/favorite&gt;<br />&lt;/xml&gt;</pre></p>