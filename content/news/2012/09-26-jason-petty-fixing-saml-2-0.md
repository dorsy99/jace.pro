---
title: "Fixing SAML  Update  FrameinFrame Timeout issues in ServiceNow"
date: 2012-09-25T21:53:13.000Z
authors: ["jason.petty"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=981daea5dbd0dbc01dcaf3231f961922"
---
<p>There is an article found on John Andersen's Blog here:<br /><br />http://www.john-james-andersen.com/blog/service-now/fixing-saml-2-0-frame-in-frame-timeout-issues-in-servicenow.html<br /><br />This blog demonstrates the way to fix the Frame-in-Frame problem with the SAML 2.0 plugin but the SAML 2.0 Update 1 plugin has changed the location of the code that is mentioned to change in the Login Script. This code is now in the Script Include. These are the steps you can take to fix this issue with the new plugin:<br /><br />1. You still want to create the frame_bust.do UI page with this code:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br />&lt;j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null"&gt;<br /><br />&lt;g:evaluate var="jvar_service_url"&gt;<br />  var prop = new GlideRecord("sys_properties");<br />  prop.addQuery("name", "glide.authenticate.sso.saml2.service_url");<br />  prop.query();<br />  prop.next();<br />  prop.value;<br />&lt;/g:evaluate&gt;<br /><br />&lt;script&gt;<br />  if("${jvar_service_url}"){<br />    top.location.replace("${jvar_service_url}");<br />  }<br />&lt;/script&gt;<br /><br />&lt;/j:jelly&gt;<br /></pre><br /><br />2. Modify the "SAML2_update1" Script Include. Find the following code:<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />      if (!requestURI ||requestURI.equals("") || requestURI.equals("/")) {<br />         // No deep linking<br />         this.logDebug("No Deep Linking for this SAML request");<br />         relayState = this.serviceUrl;<br />      } else if (this.needNavFrame(request)) {<br />         this.logDebug("There may be Deep Linking involved with this SAML request");<br />         //use saml_redirector to make sure we bust out of the current frame before loading another NavFrame.<br />         relayState = baseUrl + "/saml_redirector.do?sysparm_uri=/nav_to.do?uri=" + requestURI;<br />      } else {<br />         relayState = baseUrl + requestURI;<br />      }<br /></pre><br /><br /> Modify the above code to this (Just added a few lines of code at the top):<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />      if(!requestURI ||requestURI.equals("") || requestURI.equals("/")){<br />       requestURI = "frame_bust.do";<br />      }<br />      if (!requestURI ||requestURI.equals("") || requestURI.equals("/")) {<br />         // No deep linking<br />         this.logDebug("No Deep Linking for this SAML request");<br />         relayState = this.serviceUrl;<br />      } else if (this.needNavFrame(request)) {<br />         this.logDebug("There may be Deep Linking involved with this SAML request");<br />         //use saml_redirector to make sure we bust out of the current frame before loading another NavFrame.<br />         relayState = baseUrl + "/saml_redirector.do?sysparm_uri=/nav_to.do?uri=" + requestURI;<br />      } else {<br />         relayState = baseUrl + requestURI;<br />      }<br /></pre></p>