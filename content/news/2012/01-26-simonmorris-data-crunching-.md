---
title: "Data crunching your ServiceNow  month by month"
date: 2012-01-25T15:56:55.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=254e26addbd0dbc01dcaf3231f961944"
---
<p>I had an interesting task yesterday... Take a ServiceNow table and retrospectively create month end statistics.<br /><br />We are defining some new Key Performance Indicators for a process that we run internally, and it helps to be able to see how we would have performed in previous months if we had been tracking that metric.<br /><br />I love working with big data sets, but it took a bit of thinking to get my code iterating through all of the previous months data<br /><br /><h2>Getting the oldest record</h2><br /><br />First of all I needed to know where to start in my dataset, which is my oldest record. This was fairly easy to do with GlideRecord.<br /><br />(My code examples are from a Object Orientated class... if anyone would like the full script feel free to email)<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />get_oldest_prb: function() {<br /><br />    var gr = new GlideRecord('problem');<br />    gr.orderBy('sys_created_on');<br />    gr.setLimit(1);<br />    gr.query()<br />    if (gr.next()) {<br />        gs.print(gr.number + ' ' + gr.sys_created_on);<br />        return gr.sys_created_on;<br />    }<br />    gs.print('get_oldest_prb: Fatal error getting oldest record');<br />    return null;<br />},<br /></pre><br /><br />So, get_oldest_prb() returns a date time string in the format "2005-04-26 05:19:45"<br /><br /><h2>Getting the first and last day of that (oldest) month</h2><br /><br />I want to iterate through each month from the date of the oldest record to the present day.<br /><br />Next job is to work out the first and last day of the oldest month.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />//Get the date of the oldest Problem record as a starting point<br />var oldest_prb_date_string = this.get_oldest_prb();<br /><br />// What was the first and last day of that month (when the oldest ticket was)<br />var gdt = new Packages.com.glide.glideobject.GlideDateTime();<br />gdt.setValue(oldest_prb_date_string);<br />var oldest_month_start = gs.beginningOfMonth(gdt);<br />var oldest_month_end = gs.endOfMonth(gdt);<br /></pre><br /><br />So now I have 2 new string variables <i>oldest_month_start</i> and <i>oldest_month_end.</i><br /><br />My oldest problem record (<i>oldest_prb_date_string</i>) was "2005-04-26 05:19:45" so the beginning and end of that month is<br /><br /><ul><li>oldest_month_start = 2005-03-31 23:00:00</li><li>oldest_month_end = 2005-04-30 22:59:59</li></ul><br /><br />Note that the time is offset for my users timezone, but it was accurate enough for what I wanted to do.<br /><br /><h2>How many months ago was that?</h2><br /><br />Lets work out how many months we've had since the creation of the first record. We can do this by comparing the <i>oldest_prb_date_string</i> to todays date<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />// How many months from the beginning of the oldest month until today.. how many months<br />// to iterate through to get to the present time<br />var diff_seconds = gs.dateDiff(oldest_month_start, gs.nowDateTime(), false);<br />var diff_days = diff_seconds.split(' ')[0];<br />var diff_months = parseInt(diff_days/30);<br />gs.print('diff_months=' + diff_months);<br /></pre><br /><br />There is a bit of a hack to get diff_days. The output of gs.dateDiff is a string containing the number of days, hours and minutes between the 2 times. I split that string to only get the days which I divided into months. With my example there are 82 months between the creation of the first record and the present time.<br /><br /><h2>Iterate through each month and generate some stats!</h2><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />// Iterate through each month.<br />for (var x=diff_months; x&gt;0; x--) {<br />    var b = gs.monthsAgoStart(x);<br />    var e = gs.monthsAgoEnd(x);<br />    var d = new GlideDateTime(e);<br /><br />    this.create_ss_chart_1_for_month(b, e, d);<br />}<br /></pre><br /><br />The for loop here counts down from 82 to 0 and then stops.<br /><br />GlideSystem has 2 functions - gs.monthsAgoStart() and gs.monthsAgoEnd() - which give you the start and end of a given month.<br /><br />When we iterate through our 82 months we call a function - in this case called this.create_ss_chart_1_for_month() - which takes the beginning and end of the month as arguments <i>b</i> and <i>e</i><br /><br /><h2>Get the records for that month</h2><br /><br />My task involved getting a couple of different statistics.<br /><br /><ul><li>How many records were opened that month</li><li>How many records were closed that month</li><li>How many records were open at the end of that month (our backlog)</li></ul><br /><br />Now that we have the beginning and end of a month we can start to pull data from the database and get some stats from it.<br /><br /><h3>How many records were opened that month</h3><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />opened_that_month: function(b, e, d) {<br />    // Calculate the number of Problems opened between b and e<br />    var gr = new GlideRecord('problem');<br />    gr.addQuery('opened_at', '&gt;', b);<br />    gr.addQuery('opened_at', '&lt;', e);<br />    gr.query();<br /><br />    // Do something with gr<br />}<br /></pre><br /><br /><h3>How many records were closed that month</h3><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />closed_that_month: function(b, e, d) {<br />    // Calculate the number of Problems closed between b and e<br />    var gr = new GlideRecord('problem');<br />    gr.addQuery('closed_at', '&gt;', b);<br />    gr.addQuery('closed_at', '&lt;', e);<br />    gr.query();<br /><br />    // Do something with gr<br />}<br /></pre><br /><br /><h3>How many records were open at the end of that month (our backlog)</h3><br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />backlog_for_that_month: function(b, e, d) {<br />    // Calculate how many Problems were open at e<br />    var gr = new GlideRecord('problem');<br />    gr.addQuery('opened_at', '&lt;', e);<br />    var orQuery = gr.addQuery('closed_at', '&gt;', e);<br />    orQuery.addOrCondition('closed_at', '');<br />    gr.query();<br /><br />    // Do something with gr<br />}<br /></pre><br /><br />The backlog is slightly harder... you have to consider all of the Incidents opened before the end of that month and closed after that month (<i>e</i>) plus all of the records that may still be open. <br /><br />Hopefully not a problem for 82 months ago, but as you get closer to the present day you need to count records that are still open.<br /><br />If you've read to the bottom of this blog post... firstly well done! Now go and <a title="ki.service-now.com/index.php?title=Custom_Chart_Data_Generation" href="http://wiki.service-now.com/index.php?title=Custom_Chart_Data_Generation">read about Summary Sets</a> so that you can create cool graphs from your legacy data.<br /><br />Comments welcome below!</p>