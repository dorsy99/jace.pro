---
title: "Converting Global Business Rules to Script Includes"
date: 2012-08-09T23:12:18.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=78ccee25dbd0dbc01dcaf3231f9619d5"
---
<p><p><img src="http://i.imgur.com/PRS8b.jpg" alt="Switch" width="150px" align='right' /><br />Stop using custom Global Business Rules! That was the advice given out at K12 this year.</p><br /><br />I had that dreaded feeling that I was using custom Global Business Rules (GBR) occasionally. Was this going to be a big deal to switch? What kind of effort would that take? <br /><br /><!--break--><br /><br />Mostly I was using custom Global Business Rules (GBR) for reports and scripted filters. If you want to learn more about scripted filters, check out this wiki article:<br /><ul><li>http://wiki.servicenow.com/index.php?title=Using_Filters_and_Breadcrumbs#Scripted_Filters</li></ul><br /><br />Now how did this start? How did I start using GBRs?<br /><br />Well, I had seen another developer else use GBRs, so I used GBRs too. The other developer was maybe from earlier times, when Script Includes were not around, so they used GBRs instead. Or maybe they saw someone else use GBRs just like I did.<br /><br />GBRs do work well and it wasn't a problem before, so why should we switch? There are a couple of reasons, including following better object-oriented principles, but the main reason that I was interested was:<br /><br /><strong>Performance</strong><br /><br />GBRs are evaluated for every server interaction. Every insert,update, delete, or query of a record. They are "global". Script Includes are different. They are loaded on-demand and cached.<br /><br /><strong>How to switch to Script Includes</strong><br /><br />Lucky for me, I had a limited number of GBR to switch to Script Includes, and I could correct my habits early in the game.<br /><br />Here is an example GBR I used in for GRC report that found all <i>Controls not linked to Authoritative Source Content</i> . The report isn't that important here, just how to convert that GBR to a Script Include.<br /><br /><ol><li><strong>New Script Includes</strong><br /><br />Your new Script Include. Just copy the GBR script you are using into the Script Include. You can convert to a more object-oriented format if you want, but that is a bonus with accompanied risk of a coding mistake. The most efficient solution is just to copy the script.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />Name: getControlsNotLinkedtoASC<br />Description: Returns Controls Not Linked to Authoritative Source Content<br />Client Callable: true<br />Script:<br />getControlsNotLinkedtoASC();<br /><br />function getControlsNotLinkedtoASC() {<br />    var controlList = new Array();<br />    var grControl = new GlideRecord('grc_control');<br />    grControl.query();<br />    while (grControl.next()) {<br />        var grControlAuthSource = new GlideRecord('m2m_control_auth_src_content');<br />        grControlAuthSource.addQuery('control_name', grControl.sys_id);<br />        grControlAuthSource.query();<br />        if (!grControlAuthSource.hasNext()) {<br />            controlList.push(grControl.control_id.toString());<br />        }<br />    }<br />    return controlList;<br />}<br /></pre></li><li><strong>Deactivate Global Business Rule</strong><br /><br />Your Existing GBR. Either delete or deactivate. I choose to delete so that my past mistakes are gone forever.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />Business Rule<br />Name: getControlsNotLinkedtoASC<br />Table: Global [global]<br />Active: false<br />Script:<br />getControlsNotLinkedtoASC();<br /><br />function getControlsNotLinkedtoASC() {<br />    var controlList = new Array();<br />    var grControl = new GlideRecord('grc_control');<br />    grControl.query();<br />    while (grControl.next()) {<br />        var grControlAuthSource = new GlideRecord('m2m_control_auth_src_content');<br />        grControlAuthSource.addQuery('control_name', grControl.sys_id);<br />        grControlAuthSource.query();<br />        if (!grControlAuthSource.hasNext()) {<br />            controlList.push(grControl.control_id.toString());<br />        }<br />    }<br />    return controlList;<br />}<br /></pre></li><li style="list-style: none"><br /><br /><br /></li><li><strong>Report</strong><br /><br />Your reports don't need to change here. You can use them as you did previously.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />Name: Controls not Linked to Authoritative Source Content<br />Type: List<br />Table: Control<br />Control Number is one of javascript:getControlsNotLinkedtoASC()<br /></pre></li></ol><br /><br />Not too difficult actually. I suggest trying this one at a time, converting the least used GBR first. As you get more advanced, use object-oriented Script Includes. Also note that you can and/or should convert any custom Global Business Rule to Script Includes, any OOB global business rules should be left alone.<br /><br />Hope this helps you out!<br /><br />Mike</p>