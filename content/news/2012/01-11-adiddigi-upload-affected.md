---
title: "Upload Affected CIs for a Change Request from a csv or txt attachment"
date: 2012-01-10T21:55:29.000Z
authors: ["adiddigi"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=89aca225dbd0dbc01dcaf3231f96197d"
---
<p>Happy new year ! This post will explain the functionality toUpload list of Affected CI's from an .csv or .txt attachment for a change request. Thanks to <a title="w.servicenowguru.com/" href="http://www.servicenowguru.com/">SNC Guru</a> for providing me with a couple of ideas on handling Attachments in various ways.</p><p></p><p>Assumption : The text/csv will have one column where we have the names of affected CI's for a particular change request.</p><p></p><p>There are 3 parts to get this working,<br/>1.Identify the attachment from the sys_attachment table corresponding to a change request.<br/>2.Converting the attachments to a byte array,converting the byte to array of strings.<br/>3.Inserting the data into task_ci table.</p><p></p><p>When I had this requirement at the start, I had very less information to work on.Just a class called<br/>SysAttachment and a method called getBytes(Inherited from the Object class).</p><p></p><p>I am handling the entire conversion of the entire attachment into an array of strings in the UI action itself. You can use a Script Include and call this Script Include from the UI action if you choose to make this client callable.</p><p></p><p>Name of the UI Action : AddCI's<br/>//This will only get the CI names from a csv sheet. You can do similar thing for a .txt file.</p><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br/><br/>var gr = new GlideRecord('sys_attachment');<br/>gr.addQuery('table_sys_id', current.sys_id);<br/>gr.addQuery('file_name','UploadCI.csv');<br/>gr.addQuery('content_type','application/vnd.ms-excel');<br/>gr.query();<br/>if (gr.next()){<br/>     var sa = new Packages.com.glide.ui.SysAttachment();<br/>     var binData = sa.getBytes(gr);<br/>     var string = new Packages.java.lang.String(binData);<br/>     gs.log(string);var arr = string.split("\n");<br/>     for(i=0; i&lt;arr.length ; i++){<br/>         var taskCI = new GlideRecord("task_ci");<br/>         taskCI.initialize();<br/>         taskCI.task = current.sys_id;<br/>         var str = arr&lt;i&gt;.toString();<br/>         var len = str.length();<br/>         var newStr = str.substring(0,len-2);<br/>         var grA = new GlideRecord("cmdb_ci");<br/>         grA.addQuery("name",'STARTSWITH',newStr);<br/>         grA.query();<br/>         if(grA.next()){<br/>             taskCI.ci_item = grA.sys_id;<br/>             taskCI.insert();<br/>         }<br/>         else {<br/>             gs.addInfoMessage(" There is no CI by the name:"+arr&lt;i&gt;);<br/>         }<br/>     }<br/>     action.setRedirectURL(current);<br/>}<br/>else{<br/>     gs.addInfoMessage("You haven't attached any file by the name UploadCI.csv");<br/>     action.setRedirectURL(current);<br/>}</pre><p></p><p></p><p><br/>Also, As this is a one Column CSV i am just splitting it once using "\n". If you have more than one column you can split it twice, once using a "\n" the next time using a ","( if the delimiter is a comma).</p>