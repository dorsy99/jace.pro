---
title: "Where is the Order Guide Item Attachment Love"
date: 2012-01-12T06:14:35.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=224d6229dbd0dbc01dcaf3231f961959"
---
<p><img  alt="" class="jive-image" src="a14a3486db109f048c8ef4621f9619f5.iix" style="float:right;" /><br />So where is the Order Guide Item Attachment love? On a normal catalog item you are able to attach files, however when using that same catalog item within an order guide, there is no attachment icon. Hopefully I did not miss some functionality somewhere because here is a solution I came up with for you to enable attachments on Order Guides Items.<br /><br />I have created a <a title="ki.service-now.com/index.php?title=UI_Macros" href="http://wiki.service-now.com/index.php?title=UI_Macros">UI Macro</a> that can be added to any catalog item (or variable set). This UI Macro first checks to see if the catalog item is coming from an order guide. If it is, it will display the UI Macro, if not it won't, which will allow the default catalog item attachment icon to be used as normal.<br />Here is what it looks like.<br /><img  alt="" class="jive-image" src="152e5dc2dbdc97049c9ffb651f961911.iix" /><br /><br /><br />When you click on the "Manage Attachements" you get the standard attachment popup.<br /><img  alt="" class="jive-image" src="99bbd006db185344e9737a9e0f9619f8.iix" /><br /><br />All you need to do is to create a UI Macro with the following code. The add this macro as a variable into any catalog item or variable set. This UI Macro does NOT take into account attachment roles property as the standard form attachment use does. This is more of a "lite" version.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />&lt;?xml version="1.0" encoding="utf-8"?&gt;<br />&lt;j:jelly trim="true" xmlns:g="glide" xmlns:g2="null" xmlns:j="jelly:core" xmlns:j2="null"&gt;<br /><br />&lt;g:evaluate&gt;<br />var rprf = RP.getReferringURL();<br />var og = rprf.indexOf('sysparm_guide') &gt;= 0;<br />&lt;/g:evaluate&gt;<br /><br />&lt;j:if test="${og}"&gt;<br />&lt;div id="order_guide_item_attachment"&gt;<br />&lt;div id="header_attachment" style="display: block; width: 100%; overflow: hidden;"&gt;<br />&lt;div id="header_attachment_size_checker"&gt;<br />&lt;ul id="header_attachment_list"&gt;<br />&lt;li&gt;<br />&lt;a id="header_attachment_list_link" href='#' class="attachment" onclick="saveCatAttachment(gel('sysparm_cart_edit').value, 'sc_cart_item'); return false;"&gt;<br />                                 &lt;img title="Attachments..." src="images/icons/attachment.gifx" height="16" border="0" width="16" /&gt; $[sp]<br />         ${gs.getMessage('Manage Attachments')} (&lt;span class="attachmentNumber"&gt;&lt;/span&gt;):<br />&lt;/a&gt;<br />&lt;/li&gt;<br />&lt;script&gt;<br /> updateAttachmentCount(gel('sysparm_cart_edit').value);<br /> if($('header_attachment'))<br />$('header_attachment').style.height = '20px';<br />&lt;/script&gt;<br /><br />          &lt;/ul&gt;<br />          &lt;/div&gt;<br />&lt;/div&gt;<br />&lt;/div&gt;<br />&lt;/j:if&gt;<br /><br />&lt;script&gt;<br />//This initializes the default action. Do you want attachments to be displayed or not onload.  To show, change the .show() to .hide()<br />$('order_guide_item_attachment').show();<br />&lt;/script&gt;<br />&lt;/j:jelly&gt;<br /></pre><br /><br /><h1>Show/Hide this Macro</h1><br />What if you wanted to only show this macro in certain scenarios. The ones I had implements was, if someone selected a high risk, or slected a checkbox. <br />A simple client script can be created. Evaluate your condition like...<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />var risk = g_form.getValue('risk');<br />if(risk == 1){<br />//Here is the one-liner to show or hide the attachment macro.<br />$('order_guide_item_attachment').show();<br />//Here is the hide<br />$('order_guide_item_attachment').hide();<br />}<br /></pre><br />The UI Macro is wrappered in a DIV with the ID of "order_guide_item_attachment" making it easy to use a <a title="ototypejs.org/" href="http://prototypejs.org/">prototypejs</a> selector and hide or show it.<br /><br /><h1>Bonus - Confirm someone has attached something</h1><br />How can you make sure that someone has uploaded an attachment? I have used an onsubmit script I use to check this. I don't want someone to select a high risk value and then just submit the order guide item without any attachment.<br /><br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />function onSubmit() {<br />var og = $('sysparm_guide');<br />var rk = g_form.getValue('variables.risk');<br />var cont = 'yes';<br />if(og &amp;amp;&amp;amp; rk == 1){<br />$$('#header_attachment_list span[class="attachmentNumber"]').each(function(item){<br />var amt = item.innerHTML;<br />if(amt == 0){<br />cont = 'no';<br />alert('You have specified a High Risk Request. Please attach the necessary forms.');<br />}<br />});<br />if(cont == 'no'){<br />$('order_guide_item_attachment').show();<br />return false;<br />}<br />}<br />}<br /></pre><br /><br /><h1>Bonus, Bonus -- Popup the attachment dialog whenever</h1><br />If you want to open the attachment dialog after someone clicks a checkbox use the following code.<br /><pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br /><br />//some sort of onChange client script with a condition statement<br />if(checkbox == true){<br />//This function will open the window to attach files to the order guide item.<br />saveCatAttachment(gel('sysparm_cart_edit').value, 'sc_cart_item');<br />}<br /></pre><br /><div style="background-color:#FFCCCC;padding:10px;border:1px solid red;box-shadow:5px 5px 5px lightgrey;"><br /><span>NOTE: CALGARY UPDATE</span><br /><br /><p><br />It appears that in Calgary some additional Access Controls (ACL) were added which prevents the end user from using this functionality. I have found that the attachment popup (UI Page) checks to see if the user can write to the record. In this case the user is actually being displayed a record from the "Item" (sc_cart_item) table. Thus the attachment UI Page validates if the user can write to this particular record. In this scenario the end user (Requester) does not have write permissions to this "cart item" record resulting in a blank (no buttons etc.) on the attachment UI Page.<br /></p><br /><p><br />SOLUTION:<br /><br />In order to get around this you will need to add in two ACLs on the "sc_cart_item" table. We don't want to open this table wide up to everyone so here is what I suggest.<br /><br /><br />Create a READ ACL on the sc_cart_item table so the logged in user can only read their cart items. You will need to dot walk on the condition to get to the user field.<br /><br />Type: record<br /><br />Operation: read<br /><br />Name: Item [sc_cart_item] --&gt; -- None --<br /><br />Condition: Cart.User --&gt; IS --&gt; javascript:gs.getUserID()<br /><br /><br />Create a WRITE ACL on the sc_cart_item table so the logged in user can only write to their cart items. You will need to dot walk on the condition to get to the user field.<br /><br />Type: record<br /><br />Operation: write<br /><br />Name: Item [sc_cart_item] --&gt; -- None --<br /><br />Condition: Cart.User --&gt; IS --&gt; javascript:gs.getUserID()<br /><br /></p><br /><p><br />This should allow anyone logged in to see and write to only their cart items. In reality the end user should not know that they can read or write to these records as it is all behind the scenes, but from a security perspective this is how it works.<br />All in all this is obviously modifying the OOB functionality, in terms of security. So this solution is an AS IS, USE AT YOUR OWN RISK solution. The functionality could potentially change from one version to another, as we have seen. So take all of this into account when using this solution.<br /></p><br /></div><br />Again this UI Macro will run only if the item is coming from an Order Guide. Your normal catalog items will continue to use the standard attachment process.<br /><br />Enjoy.<br />&lt;script&gt;&lt;/script&gt;<br /> var _gaq = _gaq || [];<br /> _gaq.push(['_setAccount', 'UA-22945975-1']);<br /> _gaq.push(['_trackPageview']);<br /><br /> (function() {<br /> var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;<br /> ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';<br /> var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);<br /> })();<br /><br /></p>