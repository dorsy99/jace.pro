---
title: "Tips and Tricks Deeply Weird"
date: 2010-07-13T18:37:07.000Z
authors: ["SlightlyLoony"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=68edeae9dbd0dbc01dcaf3231f961908"
---
<p><img  alt="" class="jive-image" src="82fad8cadbd45344e9737a9e0f9619b5.iix" style="width: auto; height: 99px;" />Consider this little piece of code:<br /><pre style="margin-left:20px;line-height:1;"><br />var x = 0.1;<br />var y = 0.2;<br />var z = 0.3;<br />if(z == x + y)<br />   gs.log('Of course 0.3 equals 0.3!');<br />else<br />   gs.log('What a moronic computer!');<br /></pre><br />What do you think it will print out?<!--break--><br />Apparently 0.3 <i>doesn't</i> equal 0.3! What's going on here?<br /><br />Let's make one small change to the code to find out:<br /><pre style="margin-left:20px;line-height:1;"><br />var x = 0.1;<br />var y = 0.2;<br />var z = 0.3;<br />gs.log('x + y: ' + (x + y));<br />gs.log('z: ' + z);<br />if(z == x + y)<br />   gs.log('Of course 0.3 equals 0.3!');<br />else<br />   gs.log('What a moronic computer!');<br /></pre><br />Run that, and you'll see that 0.1 + 0.2 = 0.30000000000000004, not 0.3!<br /><br />You may be surprised to find out that this is not a bug — it's a feature. Of <a title=".wikipedia.org/wiki/Floating_point" href="http://en.wikipedia.org/wiki/Floating_point">floating point numeric representation</a>, that is.<br /><br />Many people — even many experienced programmers — get fooled by math with floating point numbers. It seems to be a widespread preconcieved notion that computers are really good with numbers — but in fact, conventional computers are actually only inherently good with <i>integers</i>. As soon as you start working with fractional or decimal values, things start to fall apart. There are several technical reasons for this, but the one most frequently encountered is simple enough to understand: there are many fractional values that <i>cannot be exactly represented</i> in a floating point number. If this seems weird to you, consider this: even in the decimal numbers you're familiar with, you cannot exactly represent many values. For example, one third is 0.3333… — but that's certainly not an exact representation. Floating point numbers in a computer suffer from the same problem, but for different numbers (mainly because floating point numbers in a computer are internally in binary, not decimal). If you're interested in the gory technical details, read <a title="cs.sun.com/source/806-3568/ncg_goldberg.html" href="http://docs.sun.com/source/806-3568/ncg_goldberg.html">this (a classic)</a> and <a title="l.archives-ouvertes.fr/docs/00/28/14/29/PDF/floating-point-article.pdf" href="http://hal.archives-ouvertes.fr/docs/00/28/14/29/PDF/floating-point-article.pdf">this</a> for an introduction. And yes, <a title="w.amazon.com/s/qid=1279031998/ref=sr_st?page=1&rh=i%3Astripbooks%2Cn%3A!1000%2Cn%3A5%2Cp_28%3Afloating+point&sort=reviewrank_authority" href="http://www.amazon.com/s/qid=1279031998/ref=sr_st?page=1&amp;rh=i%3Astripbooks%2Cn%3A!1000%2Cn%3A5%2Cp_28%3Afloating+point&amp;sort=reviewrank_authority">there are whole books on the topic</a>.<br /><br />But for the moment let's ignore the underlying cause of the unexpected result, and talk instead about what can be done about it. Here are the most common techniques:<br /><ul><li><i><u>Rounding</u></i>: Using methods <a title="lightlyLoony/blog/2010/7/9/2007" href="/community?id=community_blog&sys_id=b64d6229dbd0dbc01dcaf3231f9619cd">like those I discussed the other day</a>, round every result of an arithmetic operation. This is by far the easiest method to implement, and it works well in Javascript when you have less than (roughly) 15 decimal digits of precision required in your numbers. Most everyday problems fall into this category, but some applications do not (this happens especially often with financial applications).</li><li><i><u>Use scaled integers</u></i>: For instance, instead of representing $35.85 as 35.85, represent it as 3585 cents. This plays to your computer's strength: integer arithmetic. Because JavaScript always represent numbers in floating point, you'll need to use Math.round() to round every result of an arithmetic operation to the nearest integer. This method works great when the values you're representing have some definite "smallest value" (as in our example of American currency, where the smallest value is one cent, or $0.01).</li><li><i><u>Represent values as a ratio</u></i>: This is a very flexible solution, but much harder to implement. Libraries are available for some programming languages, but not (to my knowledge) for JavaScript. With this solution, we'd represent 83.00543 as 8300543/100000, and any computations would be done exactly the same way you'd do fractional math by hand.</li><li><i><u>Use arbitrary precision math libraries</u></i>: This is another very flexible solution, and quite appropriate for applications where you need more 15 or so decimal digits of precision. These are very challenging libraries to implement, but fortunately there are several JavaScript libraries available in open source. One word of warning: arbitrary precision math can be very, very slow — thousands of times slower than JavaScript's built in math.</li></ul></p>