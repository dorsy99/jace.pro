---
title: "JavaScript Tips and Tricks Aggregates"
date: 2010-03-15T17:41:47.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=5d1deea5dbd0dbc01dcaf3231f961968"
---
<p><img  alt="" class="jive-image" src="f8723c06db5cd704ed6af3231f961979.iix" style="width: auto; height: 186px;" />A few weeks ago I was talking with one of our customers (I'll call him Joe) who had just finished writing a script that created a little report of how many items of each type were in his CMDB. Joe was quite happy with his script except that it took a long time to run. Here's what Joe had written:<br /><pre style="margin-left:20px;line-height:1;"><br />var gr = new GlideRecord('cmdb_ci');<br />gr.orderBy('sys_class_name');<br />gr.query();<br /><br />var name = '';<br />var count = 0;<br />while (gr.next()) {<br />    var thisName = '' + gr.getValue('sys_class_name');<br />    if (thisName == name)<br />        count++;<br />    else {<br />        if (name != '')<br />            gs.log(thisName + ': ' + count);<br />        name = thisName;<br />        count = 1;<br />    }<br />}<br />gs.log(name + ': ' + count);<br /></pre><br />Joe did this the hard, slow way — there's a <i>much</i> easier way, one that exploits the capabilities of the database that underlies every Service-now.com instance.<br /><!--break--><br />Joe's little script queries the entire CMDB (which, in his case, had almost a half million entries!) and then one-by-one examines every record to see what's in it. It keeps track of the count of each of each kind of CMDB CI very nicely — and over the course of about 40 minutes, it got Joe the answer I wanted. But 40 minutes? Surely a computer could do better than that?!?<br /><br />So I showed Joe an alternative approach, based on GlideAggregate (<a title="ki.service-now.com/index.php?title=GlideAggregation" href="http://wiki.service-now.com/index.php?title=GlideAggregation">documented on our Wiki</a>):<br /><pre style="margin-left:20px;line-height:1;"><br />var ga = new GlideAggregate('cmdb_ci');<br />ga.addAggregate('COUNT', 'sys_class_name');<br />ga.query();<br />while(ga.next()) {<br />    var result = ga.getAggregate('COUNT', 'sys_class_name');<br />    gs.log(ga.getValue('sys_class_name') + ': ' + result);<br />}<br /></pre><br />The first thing Joe noticed is that my script was a bit shorter. The second thing he noticed is that it only took a couple of seconds to execute. Shorter, simpler, faster — <i>sweet</i>!<br /><br />GlideAggregates take advantage of the aggregation features built right into modern SQL databases. Computers really are very good at counting!</p>