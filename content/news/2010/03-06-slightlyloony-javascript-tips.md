---
title: "JavaScript Tips and Tricks Whats Up with the Functions"
date: 2010-03-05T20:00:30.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=9e2e2a6ddbd0dbc01dcaf3231f96190b"
---
<p><img __jive_id="2391" alt="" class="jive-image" src="password_reset2.JPG" style="width: auto; height: 176px;" />In a conversation I had with a customer the other day, she asked me why she saw so many examples of business rules written in functions, like this:<br /><pre style="margin-left:20px;line-height:1;"><br />doImportantStuff();<br /><br />function doImportantStuff() {<br />    var x = 15;<br />    var y = 22.3;<br />    var z = Math.pow(15, 22.3);<br />    current.answer = z;<br />}<br /></pre><br /><br />Well, leaving aside the questionable wisdom of <i>ever</i> raising 15 to the 22.3rd power, that's a good question — and the answer lies both in the nature of JavaScript and of the Service-now.com platform:<br /><!--break--><br /><br />First, consider that same (useless looking) business rule written without using a function:<br /><pre style="margin-left:20px;line-height:1;"><br />var x = 15;<br />var y = 22.3;<br />var z = Math.pow(15, 22.3);<br />current.answer = z;<br /></pre><br /><br />Doesn't that look simpler and <i>better</i>, somehow? Well, not so fast, code-monkey.<br /><br />First you need to understand something about JavaScript: when you declare (or assign) variables <i>outside</i> the context of a class or function that you wrote, those variables become properties on the GLOBAL object. This global object is something that every JavaScript environment has, by definition. In client-side JavaScript, the <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />window</pre>object is the global object; in server-side JavaScript on the Service-now.com platform, the global object is just an ordinary JavaScript object, with no special features or properties. So that simpler-looking version of the business rule defines three new (maybe) properties on the global object: <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />x</pre>, <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />y</pre>, and <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />z</pre>.<br /><br />Now a characteristic of the Service-now.com platform comes into play. When executing business rules, <i>all</i> of the business rules that run on a particular table (including global business rules) share the <i>same context</i>. That is, they share the same global object. That means that if you have ten business rules on a table, and one of those business rules defines a property — that property is then visible in <i>all</i> of those business rules.<br /><br />This broad visibilty of global properties can be very useful, as it allows business rules to share values or to call functions in each other. But it can also introduce very subtle and hard-to-find problems — and for that reason, you should never deliberately use this feature unless you really can't figure out another way to accomplish something.<br /><br />Here's an example of how this visibility can get you into trouble. Imagine two business rules like this:<br /><pre style="margin-left:20px;line-height:1;"><br />// business rule 1...<br />var x = 15;<br /><br />// business rule 2...<br />if (current.name == 'magic value')<br />    x = true;<br />current.description = '';<br />if (x)<br />   current.magic = true;<br /></pre><br /><br />If these two business rules were written by different people at different times, the person writing the second one probably has no idea that the first one sets the variable <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />x</pre>. In the second business rule, <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />x</pre>will <i>always</i> evauate to true, no matter what is in <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />current.name</pre>— because <pre __default_attr="plain" __jive_macro_name="code" class="jive_text_macro jive_macro_code"><br />x</pre>is a global property common to <i>both</i> business rules.<br /><br />So back to the functions... By putting all your business rule logic inside a function that you call, the only global property your business rule will set is the property containing the function. If you then give your function a name that's unlikely to be duplicated, you won't have any problem with "collisions" between business rules...</p>