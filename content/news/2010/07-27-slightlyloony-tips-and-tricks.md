---
title: "Tips and Tricks A Little Abstraction"
date: 2010-07-26T19:41:53.000Z
authors: ["SlightlyLoony"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=d36d2e29dbd0dbc01dcaf3231f9619e2"
---
<p><img __jive_id="4901" alt="Picture 1_1.png" class="jive-image" style="width: Screen shot 2011-04-13 at 11.51.56 AM.png; height: auto;" />Have you found yourself writing almost the same code, over and over again? I recently spoke with someone who had very similar code in several different places, always to get a related list of a CI. Each time, the same dozen or so lines of code appeared with only trivial differences between them. What would be nice is if you could instead write code like this when you needed to get a GlideRecord with the disks related to a computer (just as an example):<br /><pre style="margin-left:20px;line-height:1;"><br />var gr = getComputerByName('tbr');<br />var disks = getRL(gr, 'cmdb_ci_disk');<br /></pre><br />But how would you do that?<br /><!--break--><br />Take a look at the code below, which provides the abstraction that allows the code above to work:<br /><pre style="margin-left:20px;line-height:1;"><br />var getComputerByName = getGRFactory('cmdb_ci_computer', 'name');<br /><br />var gr = getComputerByName('tbr');<br />var disks = getRL(gr, 'cmdb_ci_disk');<br /><br />while (disks.next())<br />   gs.log('Disk: ' + disks.name);<br /><br /><br />function getRL(gr, related) {<br />   var target = gr.getTableName() + '';<br />   var ref_field = getReferenceField(target, related);<br />   var answer = new GlideRecord(related);<br />   answer.addQuery(ref_field, gr.getUniqueValue());<br />   answer.query();<br />   return answer;<br />}<br /><br />function getReferenceField(target, related) {<br />   var possible_targets = Packages.com.glide.db.DBObjectManager.getTables(target);<br />   var dgr = new GlideRecord('sys_dictionary');<br />   dgr.addQuery('name', related);<br />   dgr.addQuery('internal_type', 'reference');<br />   dgr.addQuery('reference', possible_targets);<br />   dgr.query();<br />   return dgr.next() ? '' + dgr.element : null;<br />}<br /><br />function getGRFactory(table, field) {<br />   var f_table = table;<br />   var f_field = field;<br />   return getter;<br /><br />   function getter(value) {<br />      return getGR(f_table, f_field, value);<br />   }<br />}<br /><br />function getGR(table, field, value) {<br />   var gr = new GlideRecord(table);<br />   gr.addQuery(field, value);<br />   gr.query();<br />   gr.next();<br />   return gr;<br />}<br /></pre><br />I used closures and a factory method to build the getComputerByName() function, and a generalized getRL() function to get any directly related list, given the GlideRecord of a base table. In this case the base table was one row of cmdb_ci_computer, representing a computer named 'tbr'. The getReferenceField() function searches the dictionary to find the field in the related list that is a reference to the base table (or one of its parents). Not too much code, and now you've got a completely generalized capability to find any related list. For instance, with the same functions, this code will return a list of network adapters for a computer, and list the MAC addresses:<br /><pre style="margin-left:20px;line-height:1;"><br />var gr = getComputerByName('tbr');<br />var nics = getRL(gr, 'cmdb_ci_network_adapter');<br /><br />while (nics.next())<br />   gs.log('NIC: ' + nics.name + ' - ' + nics.mac_address);<br /></pre></p>