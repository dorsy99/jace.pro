---
title: "GlideRecord Glimmerings Windows"
date: 2010-08-02T18:05:37.000Z
authors: ["SlightlyLoony"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=ca2ea66ddbd0dbc01dcaf3231f9619c2"
---
<p><img  alt="" class="jive-image" src="2cf1ff75dbd89b048c8ef4621f961988.iix" style="width: auto; height: 200px;" />Have you ever needed to write a script that did some work on a <i>lot</i> of records in a table? In such situations it can be very useful to work on one "chunk" of records at a time. There are many reasons why you might want to do this â€” but usually it's either because you want to produce intermediate results as your script progresses, or because doing the work a bit at a time will reduce the impact on other users. But how can you go about doing something like this, since GlideRecord will always return the entire set of records you've queried for?<br /><br />It turns out that windows are involved:<br /><!--break--><br />And not the Microsoft kind, either!. The "windows" we're talking about here are windows into the records that GlideRecord returns after a query. There's a pair of methods on GlideRecord that let you pick the window you want, as shown in this little script:<br /><pre style="clear: both;margin-left:20px;line-height:1;"><br />var gr = new GlideRecord('cmdb_ci');<br />gr.addQuery('name', '&gt;=', 'm');<br />gr.chooseWindow(10, 20);<br />gr.query();<br />while (gr.next())<br />   gs.log(gr.name);<br /><br />gr.initialize();<br />gr.addQuery('name', '&lt;', 'm');<br />gr.setLimit(10);<br />gr.query();<br />while (gr.next())<br />   gs.log(gr.name);<br /></pre><br />The <i>chooseWindow(first,last)</i> method lets you set the first and last row number that you want to retrieve. The rows for any given query result are numbered 0..(n-1), where there are n rows. The first parameter is the row number of the first result you'll get. The second parameter is the number of the row <i>after</i> the last row to be returned. In the example above, the parameters (10, 20) will cause 10 rows to be returned: rows 10..19, inclusive.<br /><br />The <i>setLimit(n)</i> is exactly the same thing as <i>chooseWindow(0,n)</i>. By setting a limit, you're telling GlideRecord to return the first n records, with row numbers 0..(n-1).<br /><br />Here's a slightly more complex example, showing how you might make use of chunking in a real problem:<br /><pre style="clear: both;margin-left:20px;line-height:1;"><br />var gr = new GlideRecord('cmdb_ci_computer');<br />gr.addQuery('install_status', 1);<br />var nextChunkOfCIs = chunker(gr, 100);<br />var ram_total = 0;<br />while (nextChunkOfCIs()) {<br />   var ram_chunk = 0;<br />   while (gr.next()) {<br />      ram_chunk += gr.ram;<br />   }<br />   ram_total += ram_chunk;<br />   gs.log('Chunk RAM: ' + ram_chunk + ' mb');<br />}<br />gs.log('Total RAM: ' + ram_total + ' mb');<br /><br /><br />function chunker(gr, size) {<br />   var window_start = 0;<br />   var window_size = size;<br />   var chunky_gr = gr;<br />   return nextChunk;<br /><br />   function nextChunk() {<br />      gr.chooseWindow(window_start, window_start + window_size);<br />      gr.query();<br />      var has_next = (window_start &lt; gr.getRowCount());<br />      window_start += window_size;<br />      return has_next;<br />   }<br />}</pre><br />The function <i>chunker</i> is a factory function, returning a function that can be called to get the next chunk of records. It uses closures to implement iteration through the chunks. The code example uses this to process chunks of 100 computers, adding up the RAM for each chunk (and in the end, the total for all computers)...</p>