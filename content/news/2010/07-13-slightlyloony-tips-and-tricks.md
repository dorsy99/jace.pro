---
title: "Tips and Tricks Analyzing Tabular Text"
date: 2010-07-12T18:02:58.000Z
link: "https://community.servicenow.com/community?id=community_blog&sys_id=f84ee2addbd0dbc01dcaf3231f961904"
---
<p><img  alt="" class="jive-image" src="6f7bfc8adb1c9344e9737a9e0f9619a8.iix" style="width: auto; height: 113px;" />It's a fairly common challenge when writing Discovery probes or Runbook activities: you've executed some command on a computer, it returns some text in a tabular format, and now you need to analyze it. For instance, suppose your probe or activity ran on a Linux computer and executed the command <pre style="margin-left:20px">cat /proc/net/arp</pre>You'd get a response that looked something like this, showing that computer's ARP table:<br /><pre style="margin-left:20px;line-height:1;"><br />IP address       HW type     Flags       HW address            Mask     Device<br />10.10.11.101     0x1         0x2         00:0C:29:9D:58:76     *        eth0<br />10.10.11.102     0x1         0x2         00:26:B0:FA:0E:C7     *        eth0<br />10.10.10.41      0x1         0x2         00:0C:29:81:1A:49     *        eth0<br />10.10.10.40      0x1         0x2         00:0C:29:79:B9:56     *        eth0<br />10.10.10.43      0x1         0x2         00:50:56:AE:7C:F1     *        eth0<br />10.10.10.70      0x1         0x2         00:26:B9:60:4F:8D     *        eth0<br />10.10.10.42      0x1         0x2         00:50:56:9C:7E:52     *        eth0<br /></pre><br />Now suppose that what you really wanted to end up with was a Javascript object with properties named for the IP addresses with values equal to the MAC address, all taken from this data. How would you code that?<br /><!--break--><br /> Here's some code that will do the job, in a form you can copy and past to <b>System Maintenance â†’ Scripts - Background</b>. The analyze function is the interesting part; the code above that function is just testing it.<br /><pre style="margin-left:20px;line-height:1;"><br />var text = "IP address       HW type     Flags       HW address            Mask     Device\n" +<br />           "10.10.11.101     0x1         0x2         00:0C:29:9D:58:76     *        eth0\n" +<br />           "10.10.11.102     0x1         0x2         00:26:B0:FA:0E:C7     *        eth0\n" +<br />           "10.10.10.41      0x1         0x2         00:0C:29:81:1A:49     *        eth0\n" +<br />           "10.10.10.40      0x1         0x2         00:0C:29:79:B9:56     *        eth0\n" +<br />           "10.10.10.43      0x1         0x2         00:50:56:AE:7C:F1     *        eth0\n" +<br />           "10.10.10.70      0x1         0x2         00:26:B9:60:4F:8D     *        eth0\n" +<br />           "10.10.10.42      0x1         0x2         00:50:56:9C:7E:52     *        eth0\n";<br /><br />JSUtil.logObject(analyze(text));<br /><br /><br />function analyze(text) {<br />   var parser = /^([0-9.]+)\s+0x[0-9a-fA-F]+\s+0x[0-9a-fA-F]+\s+([0-9a-fA-F:]+).*$/gm;<br />   var result = {};<br />   var ans;<br />   while ((ans = parser.exec(text)) != null) {<br />      var ip = ans[1];<br />      var mac = ans[2];<br />      result[ip] = mac;<br />   }<br />   return result;<br />}<br /></pre><br />All the hard work in this case is being done by the regular expression object (RegExp instance) in the first line of the analyze function. The rest of the function just iterates through all the matches (seven, in this case) within the data and pulls out the IP address and the MAC address. Let's pick that regular expression apart a bit:<br /><br /><span style="font-family: Courier">/^<span style="color: red;">([0-9.]+)</span><span style="color: blue;">\s+</span><span style="color: green;">0x[0-9a-fA-F]+</span><span style="color: blue;">\s+</span><span style="color: green;">0x[0-9a-fA-F]+</span><span style="color: blue;">\s+</span><span style="color: red;">([0-9a-fA-F:]+)</span><span style="color: deeppink;">.*</span>$/<span style="color: aqua;">gm</span></span><br /><br />What is all this stuff?<br /><ul><li>The slashes ("/") just mark the beginning and the end of the regular expression.</li><li>The aqua "gm" at the end are <i>flags</i> that tell the regular expression to be <i>global</i> and <i>multi-line</i>. The global flag tells the regular expression that it's looking for more than one match (which we need, because we want to match each IP/MAC pair). The multi-line flag tells the regular expression that it's looking for matches on more than one line.</li><li>The black "^" and "$" mean <i>beginning of line</i> and <i>end of line</i>, respectively. In other words, we're going to match an entire line with all the stuff between the ^ and the $.</li><li>The red bits in in parentheses are <i>capture groups</i>; they define the text we actually want to look at. The first one is looking for one or more digits or a periods in a row — the IP address. The second one is looking for one or more hexadecimal digits or a colon in a row — the MAC address.</li><li>The blue "\s+" sequences match one or more blank spaces (aka "whitespace") — the areas <i>between</i> the columns of data.</li><li>The pink ".*" matches anything at all, including nothing.</li><li>Finally, the green sequences match the hexadecimal number in the <i>HW Type</i> and <i>Flags</i> columns.</li></ul><br /><br />Put all this together and that regular expression matches entire lines that consist exactly (and only) of the following (in order):<br /><ul><li>The beginning of the line.</li><li>An IP address (which we capture).</li><li>Some whitespace.</li><li>A hexadecimal number.</li><li>Some whitespace.</li><li>A hexadecimal number.</li><li>Some whitespace.</li><li>A MAC address (which we capture).</li><li>Anything at all.</li><li>The end of the line.</li></ul><br /><br />Once we match a line, all we have to do is read the capture groups (1 and 2) from the array returned after calling the exec() function.<br /><br />Oh, and if you're not all that familiar with sea creatures and you're wondering what's going on in that photo — it's a fisherman who just caught a squid, and the unhappy squid has just <a title=".wikipedia.org/wiki/Squid_ink" href="http://en.wikipedia.org/wiki/Squid_ink">squirted his "ink"</a> in an effort to escape. The fisherman probably wasn't too happy about this, either...</p>